<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Forwarding workststation nginx to gateway and host - Development - Whonix Forum</title>
    <meta name="description" content="Hi! 
I do not want to do something really complex but in Whonix maybe it is not easy. I want to expose the port of my nginx (running inside of Workstation) into my host machine, so basically if I do curl 127.0.0.1:80 in &amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="12653.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Forwarding workststation nginx to gateway and host&#39;" href="12653.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/forwarding-workststation-nginx-to-gateway-and-host/12653" />
<meta name="twitter:url" content="https://forums.whonix.org/t/forwarding-workststation-nginx-to-gateway-and-host/12653" />
<meta property="og:title" content="Forwarding workststation nginx to gateway and host" />
<meta name="twitter:title" content="Forwarding workststation nginx to gateway and host" />
<meta property="og:description" content="Hi!  I do not want to do something really complex but in Whonix maybe it is not easy. I want to expose the port of my nginx (running inside of Workstation) into my host machine, so basically if I do curl 127.0.0.1:80 in my host machine I can get the output of the nginx running in Workstation.  I already read the documentation about how to SSH into Whonix Workstation an I understood that it is not an option adding a NAT interface to Whonix Workstation. So the schema I am looking for should be:  h..." />
<meta name="twitter:description" content="Hi!  I do not want to do something really complex but in Whonix maybe it is not easy. I want to expose the port of my nginx (running inside of Workstation) into my host machine, so basically if I do curl 127.0.0.1:80 in my host machine I can get the output of the nginx running in Workstation.  I already read the documentation about how to SSH into Whonix Workstation an I understood that it is not an option adding a NAT interface to Whonix Workstation. So the schema I am looking for should be:  h..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />
<meta property="article:published_time" content="2021-10-26T15:50:05+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="12653.html">Forwarding workststation nginx to gateway and host</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-26T15:50:05Z' class='post-time'>
                October 26, 2021,  3:50pm
              </time>
              <meta itemprop='dateModified' content='2021-10-26T15:50:05Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hi!</p>
<p>I do not want to do something really complex but in Whonix maybe it is not easy. I want to expose the port of my nginx (running inside of Workstation) into my host machine, so basically if I do curl 127.0.0.1:80 in my host machine I can get the output of the nginx running in Workstation.</p>
<p>I already read the documentation about how to SSH into Whonix Workstation an I understood that it is not an option adding a NAT interface to Whonix Workstation. So the schema I am looking for should be:<br>
<code>host → Whonix-Gateway ™ → Whonix-Workstation ™ (nginx)</code></p>
<p>Accessing Whonix Gateway’s ports from Host is not a problem following this tutorial:<br>
<a href="../../../external.html?link=https://www.whonix.org/wiki/Access_Gateway_Port_From_Host" rel="noopener nofollow ugc">Access Gateway Port From Host</a></p>
<p>I tested the example provided and everything worked fine. I want to do the same with the nginx port but before forwarding the port I must be able to access the nginx port from the Gateway, which currently is not possible because the gateway is not listening in that port (according with the output from netstat and when trying to curl it I get <code>curl: (7) Failed to connect to 127.0.0.1 port 80: Connection refused</code>)</p>
<p>So, unless that I am missing something what I need would be to redirect the traffic between Workstation and Gateway. If so, adding the following iptables route inside Whonix Gateway should be enough to have access the traffic from nginx inside the gateway?</p>
<p><code>sudo iptables -t nat -I PREROUTING -i eth0 -d 10.152.152.11 (the assigned ip of the workstation) -p tcp --dport 80 -j DNAT --to 127.0.0.1:80</code></p>
<p>I am new to iptables so any advice I really appreciate it <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a></p>
<p>Thanks!</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-26T16:25:59Z' class='post-time'>
                October 26, 2021,  4:25pm
              </time>
              <meta itemprop='dateModified' content='2021-10-26T16:25:59Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Prerequisite knowledge:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Stream_Isolation/Easy" target="_blank" rel="noopener" title="10:01AM - 26 December 2020">Whonix – 26 Dec 20</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:131/169;"><img src="../../../external.html?link=https://www.whonix.org/w/images/e/eb/Streamisolationme.jpg" class="thumbnail" width="131" height="169"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Stream_Isolation/Easy" target="_blank" rel="noopener">Stream Isolation: Easy</a></h3>

  <p>Whonix ™ Tor Stream Isolation Short Introduction</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<ol>
<li>i.e. don’t use plain <code>curl</code> for this. Disabling or circumventing stream isolation for <code>curl</code> required.</li>
</ol>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Stream_Isolation/Disable_Easy" target="_blank" rel="noopener" title="10:01AM - 26 December 2020">Whonix – 26 Dec 20</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:131/98;"><img src="../../../external.html?link=https://www.whonix.org/w/images/d/d9/Streamisolation213123.png" class="thumbnail" width="131" height="98"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Stream_Isolation/Disable_Easy" target="_blank" rel="noopener">Disable Stream Isolation: Easy</a></h3>

  <p>How to disable stream isolation. Easiest and most common methods only.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<ol start="2">
<li>Open port in Whonix-Workstation firewall:</li>
</ol>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Whonix-Workstation_Firewall" target="_blank" rel="noopener" title="06:40PM - 24 October 2021">Whonix – 24 Oct 21</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:131/140;"><img src="../../../external.html?link=https://www.whonix.org/w/images/9/9e/Firewall-34227640.png" class="thumbnail" width="131" height="140"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Whonix-Workstation_Firewall" target="_blank" rel="noopener">Whonix-Workstation Firewall</a></h3>

  <p>How to open a Port in Whonix-Workstation ™ Firewall</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<ol start="3">
<li>Open port in Whonix-Gatway firewall:</li>
</ol>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Whonix-Gateway_Firewall" target="_blank" rel="noopener" title="09:47AM - 11 July 2021">Whonix – 11 Jul 21</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:131/65;"><img src="../../../external.html?link=https://www.whonix.org/w/images/a/a0/Firewall146529640.png" class="thumbnail" width="131" height="65"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Whonix-Gateway_Firewall" target="_blank" rel="noopener">Whonix-Gateway Firewall</a></h3>

  <p>How to open a Port in Whonix-Gateway ™ Firewall</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-username="acis" data-post="1" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v4/letter/a/d26b3c/40.png" class="avatar"> acis:</div>
<blockquote>
<p>I must be able to access the nginx port from the Gateway, which currently is not possible because the gateway is not listening in that port</p>
</blockquote>
</aside>
<ol start="4">
<li>Options:</li>
</ol>
<ul>
<li><code>systemd-socket-proxyd</code></li>
<li><code>socat</code></li>
<li>
<code>ssh</code> port forwarding</li>
</ul>
<p>Not what you’re looking for but you might be able to figure out the <code>systemd-socket-proxyd</code> / <code>socat</code> of by reading and then looking how it’s done in the source code:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Redirect_Whonix-Workstation_Ports_or_Unix_Domain_Socket_Files_to_Whonix-Gateway" target="_blank" rel="noopener" title="10:08PM - 29 September 2021">Whonix – 29 Sep 21</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:131/73;"><img src="../../../external.html?link=https://www.whonix.org/w/images/2/23/Redirect12123.png" class="thumbnail" width="131" height="73"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Redirect_Whonix-Workstation_Ports_or_Unix_Domain_Socket_Files_to_Whonix-Gateway" target="_blank" rel="noopener">Redirect Whonix-Workstation Ports or Unix Domain Socket Files to Whonix-Gateway</a></h3>

  <p>redirect ports of unix domain socket files from Whonix-Gateway ™ localhost to Whonix-Workstation ™</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Or perhaps easier, duplicate/modify/emulate based on the following files:</p>
<ul>
<li><code>/lib/systemd/system/anon-ws-disable-stacked-tor_autogen_port_9050.service</code></li>
<li><code>/lib/systemd/system/anon-ws-disable-stacked-tor_autogen_port_9050.socket</code></li>
</ul>
<p>Something similar to this would have to run on Whonix-Gateway.</p>
<aside class="quote no-group" data-username="acis" data-post="1" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v4/letter/a/d26b3c/40.png" class="avatar"> acis:</div>
<blockquote>
<p>I already read the documentation about how to SSH into Whonix Workstation</p>
</blockquote>
</aside>
<p>Or different method based on that: tunnel nginx through SSH.</p>
<hr>
<p>related:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Ports" target="_blank" rel="noopener" title="10:01AM - 26 December 2020">Whonix – 26 Dec 20</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:131/87;"><img src="../../../external.html?link=https://www.whonix.org/w/images/8/88/Buttons-1688111640.jpg" class="thumbnail" width="131" height="87"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Ports" target="_blank" rel="noopener">Ports</a></h3>

  <p>How to open a port in Whonix ™ / port forwarding / opening ports</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-26T17:11:24Z' class='post-time'>
                October 26, 2021,  5:11pm
              </time>
              <meta itemprop='dateModified' content='2021-10-26T17:11:24Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks for your reply! I will carefully review all the information that you have sent me and the different options that you have presented to me. I hope I can implement it!</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-27T01:39:13Z' class='post-time'>
                October 27, 2021,  1:39am
              </time>
              <meta itemprop='dateModified' content='2021-10-27T01:39:13Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> After checking all resources, I decided to try socat to forward it. I think that I am missing something important because I have my nginx listening on port 8083 (nginx is working fine and I can access the hidden service in tor). So I am using the following command in the Workstation:</p>
<p><code>socat TCP-LISTEN:8083,fork TCP:10.152.152.10:80</code></p>
<p>And it is giving me the following output:</p>
<p><code>socat[145032] E bind(5, {AF=2 0.0.0.0:8083}, 16): Address already in use</code></p>
<p>Which makes sense for me, because nginx is listening in that port and I can check it through netstat too, but how can I forward that nginx port if I am listening in that port too? (Probably I am asking something really basic but I swear that I do not see it)</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-27T16:11:57Z' class='post-time'>
                October 27, 2021,  4:11pm
              </time>
              <meta itemprop='dateModified' content='2021-10-27T16:11:57Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Has to be done on Whonix-Gateway. Accept the connection and forward to host.</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T03:23:59Z' class='post-time'>
                October 28, 2021,  3:23am
              </time>
              <meta itemprop='dateModified' content='2021-10-28T03:23:59Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hi <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> , it seems that I am really close to what I am looking for but I still need one more step.</p>
<p>I decided to circumvent stream isolation (I do not want to disable it, just test if I can access nginx inside the Gateway). So I executed:</p>
<p><code>UWT_DEV_PASSTHROUGH=1 curl --output - 10.152.152.11:8083</code></p>
<p>And it is giving me the nginx’s output inside the Whonix Gateway!</p>
<p>To do port forwarding between my host and Whonix Gateway I followed next steps:</p>
<p>In Whonix Gateway I went to Settings &gt; Network &gt; Adapter 1 &gt; Advanced &gt; Port Forwarding and added</p>
<blockquote>
<p>Name: Nginx<br>
Protocol: TCP<br>
Host IP: 127.0.0.1<br>
Host Port: 80<br>
Guest IP: 10.152.152.10<br>
Guest Port: 8083</p>
</blockquote>
<p>And now I execute socat inside Whonix Gateway:</p>
<p><code>socat TCP-LISTEN:8083,fork TCP:10.152.152.10:80</code></p>
<p>In another terminal I try to curl the forwarded ip but it does not work:</p>
<pre><code>UWT_DEV_PASSTHROUGH=1 curl --output - 10.152.152.10:80
curl: (7) Failed to connect to 10.152.152.10 port 80: Connection refused
</code></pre>
<p>(Same result if I replace the gateway ip with localhost)</p>
<p>And if I curl localhost in my host:</p>
<pre><code>curl --output - 127.0.0.1:80
curl: (56) Recv failure: Connection reset by peer
</code></pre>
<p>So it seems the port forwarding is not being done between whonix gateway and the host, probably because I am not executing properly the socat command</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T15:59:46Z' class='post-time'>
                October 28, 2021,  3:59pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T15:59:46Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="acis" data-post="6" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v4/letter/a/d26b3c/40.png" class="avatar"> acis:</div>
<blockquote>
<p>And now I execute socat inside Whonix Gateway:</p>
<p><code>socat TCP-LISTEN:8083,fork TCP:10.152.152.10:80</code></p>
<p>In another terminal I try to curl the forwarded ip but it does not work:</p>
<pre><code class="lang-auto">UWT_DEV_PASSTHROUGH=1 curl --output - 10.152.152.10:80
curl: (7) Failed to connect to 10.152.152.10 port 80: Connection refused
</code></pre>
</blockquote>
</aside>
<p>socat IP might be wrong. Listen on Whonix-Gateway and forward to Whonix-Workstation IP.</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T16:19:16Z' class='post-time'>
                October 28, 2021,  4:19pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T16:19:16Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="7" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>socat IP might be wrong. Listen on Whonix-Gateway and forward to Whonix-Workstation IP.</p>
</blockquote>
</aside>
<p>I do not understand it, if I already have access to Whonix-Workstation IP where nginx is running ( <code>10.152.152.11:8083</code>) Why do I have to forward it to Whonix-Workstation IP? I thought that I needed to forward it from Whonix-Workstation IP ( <code>10.152.152.11:8083</code>) to Whonix-Gateway IP (<code>127.0.0.1:80</code>)</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T16:36:57Z' class='post-time'>
                October 28, 2021,  4:36pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T16:36:57Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>recommended pre exercise: using <a href="../../../external.html?link=https://www.whonix.org/wiki/Access_Gateway_Port_From_Host" class="inline-onebox">Access Whonix-Gateway ™ Ports from the Host</a> as is</p>
<blockquote>
<p>socat TCP-LISTEN:8083,fork TCP:10.152.152.10:80</p>
</blockquote>
<p>Listens on gateway 8083 and forwards to gateway internal interface IP 10.152.152.10 port 80. And then? I don’t see how it would connect to the workstation.</p>
<hr>
<p>The idea is:</p>
<ol>
<li>listen on workstation all interfaces using nginx</li>
<li>test: make sure gateway curl can connect to above (uwt circumvention required)</li>
<li>listen on gateway external interface and connect it to the workstation (same IP/port as for 2)) using socat or similar mention tool</li>
<li>test: make sure gateway uwt circumventing curl can connect to above</li>
<li><a href="../../../external.html?link=https://www.whonix.org/wiki/Access_Gateway_Port_From_Host" class="inline-onebox">Access Whonix-Gateway ™ Ports from the Host</a></li>
</ol>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T17:18:57Z' class='post-time'>
                October 28, 2021,  5:18pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T17:18:57Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks for your reply and your time <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> now I see the error on my socat command and once I specified the same ip it worked! <img src="../../images/emoji/twitter/smileyc164.png?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T17:21:34Z' class='post-time'>
                October 28, 2021,  5:21pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T17:21:34Z'>
          <span itemprop='position'>#11</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Just one last question <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> ! What is the best practice to execute always my socat command each time I restart the Gateway? Using <code>nohup</code> will work but if it is executed automatically once the system is restarted would be perfect</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T18:00:50Z' class='post-time'>
                October 28, 2021,  6:00pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T18:00:50Z'>
          <span itemprop='position'>#12</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="acis" data-post="11" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v4/letter/a/d26b3c/40.png" class="avatar"> acis:</div>
<blockquote>
<p>What is the best practice to execute always my socat command each time I restart the Gateway?</p>
</blockquote>
</aside>
<p>A systemd unit file.</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T18:01:35Z' class='post-time'>
                October 28, 2021,  6:01pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T18:01:35Z'>
          <span itemprop='position'>#13</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>If you’re up for it, would be nice if you could document the whole thing.</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-28T18:34:15Z' class='post-time'>
                October 28, 2021,  6:34pm
              </time>
              <meta itemprop='dateModified' content='2021-10-28T18:34:15Z'>
          <span itemprop='position'>#14</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="13" data-topic="12653" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If you’re up for it, would be nice if you could document the whole thing.</p>
</blockquote>
</aside>
<p>Sure, I do not think today I can do it but tomorrow or during the weekend I will do it. Do I post in this thread or in other place?</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-29T00:19:48Z' class='post-time'>
                October 29, 2021, 12:19am
              </time>
              <meta itemprop='dateModified' content='2021-10-29T14:42:09Z'>
          <span itemprop='position'>#15</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Reproduce following steps if you want to forward nginx (or any other service) from Whonix Workstation to your Whonix Gateway and Host</p>
<p>In this example, I am also configuring a hidden service for Nginx (although you can skip this)</p>
<ol>
<li>Editing Tor Configuration in Whonix Gateway:</li>
</ol>
<p><code>sudo nano /usr/local/etc/torrc.d/50_user.conf</code></p>
<p><code>HiddenServiceDir /var/lib/tor/hidden_service/</code><br>
<code>HiddenServicePort 80 10.152.152.11:8083 # IP assigned in Workstation</code></p>
<p>Restarted tor and get the generated onion domain (my_onion_domain)</p>
<ol start="2">
<li>Opening external port in Whonix Gateway:</li>
</ol>
<p><code>sudo mkdir -p /usr/local/etc/whonix_firewall.d</code><br>
<code>nano /usr/local/etc/whonix_firewall.d/50_user.conf</code></p>
<p><code>EXTERNAL_OPEN_PORTS+=" 80 "</code></p>
<p><code>sudo whonix_firewall</code></p>
<ol start="3">
<li>Prepare Nginx in Whonix Workstation</li>
</ol>
<p>In Nginx config add:</p>
<blockquote>
<p>server {<br>
server_name my_onion_domain;<br>
listen 8083;<br>
…</p>
</blockquote>
<p>I restarted nginx and at that point I could access my onion domain in Tor Browser</p>
<ol start="4">
<li>At this point we can test using curl if we can connect to Nginx directly from inside Whonix Gateway</li>
</ol>
<p>To test that the connection is working we must circumvent stream isolation in the Gateway using the following command:</p>
<p><code>UWT_DEV_PASSTHROUGH=1 curl --output - 10.152.152.11:8083</code></p>
<p>Curl’s output must be the same than you get in your Workstation or accessing your hidden service in Tor Browser, in case not double check that Nginx is working and that you are using the proper ports</p>
<ol start="5">
<li>Port Forwarding from Workstation to Gateway</li>
</ol>
<p>Once we can access our nginx directly from our Gateway we need to forward the IP and Port from our Whonix Workstation to our Whonix Gateway. Patrick suggested <code>systemd-socket-proxyd</code>, <code>socat</code> or <code>ssh port forwarding</code> (maybe it is possible to use sshuttle and faster than traditional openssh’s port forwarding but it is untested as mentioned before footnotes here: <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_SSH" class="inline-onebox" rel="noopener nofollow ugc">Connecting to Tor before SSH</a>). In my case I decided to use socat because it seemed easier to me, it was a personal choice</p>
<p><code>socat TCP-LISTEN:80,fork,bind=10.152.152.10 TCP:10.152.152.11:8083</code></p>
<p>10.152.152.10 assigned to eth1 Gateway internal interface<br>
10.152.152.11 assigned to my Workstation</p>
<p>Before continuing we must test if the port forwarding is working. We repeat the process as the previous step<br>
<code>UWT_DEV_PASSTHROUGH=1 curl --output - 10.152.152.10:80</code></p>
<ol start="6">
<li>Port forwarding from Gateway to Host</li>
</ol>
<p>In Whonix Gateway we go to Settings &gt; Network &gt; Adapter 1 &gt; Advanced &gt; Port Forwarding and added</p>
<blockquote>
<p>Name: Nginx<br>
Protocol: TCP<br>
Host IP: 127.0.0.1<br>
Host Port: 80<br>
Guest IP: 10.152.152.10<br>
Guest Port: 8083</p>
</blockquote>
<p>In case you want to do it from the command line check it here: <a href="../../../external.html?link=https://www.whonix.org/wiki/Access_Gateway_Port_From_Host" class="inline-onebox" rel="noopener nofollow ugc">Access Whonix-Gateway ™ Ports from the Host</a></p>
<p>After restarting Whonix Gateway we can test from our host if we have direct access to our Nginx running in the Workstation</p>
<p><code>curl 127.0.0.1:80</code></p>
<ol start="7">
<li>Use systemd to start automatically socat at boot</li>
</ol>
<p>If you want to start automatically your socat command follow next steps to create a new service and start it automatically at boot using systemd</p>
<p>sudo nano /lib/systemd/system/socat_autostart.service</p>
<blockquote>
<p>[Unit]<br>
Description=Start at boot socat command<br>
After=network.target</p>
<p>[Service]<br>
ExecStart=socat TCP-LISTEN:80,fork,bind=10.152.152.10 TCP:10.152.152.11:8083</p>
<p>[Install]<br>
WantedBy=multi-user.target</p>
</blockquote>
<p><code>chmod 644 /lib/systemd/system/socat_autostart.service</code></p>
<p><code>sudo systemctl enable socat_autostart</code></p>
<p><code>sudo systemctl start socat_autostart</code></p>
<p>You can check if your service is working fine with</p>
<p><code>sudo systemctl status socat_autostart</code></p>
<p><a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> feel to free to move this post or modify it if you see some typo.</p>
<p>P.S. I am facing a small issue with systemd when booting the system<br>
My service is working fine if I start/stops when Whonix Gateway is on but after restarting the Gateway, my service is executed but socat is failing with the following output (from <code>systemctl status socat_autostart</code>):</p>
<p><code>E bind(5, {AF=2 10.152.152.10:80}, 16): Cannot assign requested address</code></p>
<p>Any idea about how maybe delay the execution of my service after the reboot? (Edited: now it is fixed in my edit)</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-29T08:10:38Z' class='post-time'>
                October 29, 2021,  8:10am
              </time>
              <meta itemprop='dateModified' content='2021-10-29T08:10:38Z'>
          <span itemprop='position'>#16</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thank you!</p>
<p>systemd is parallelized and starts that service before even networking is up.</p>
<pre><code>After=network.target
</code></pre>
<p>Other files in folder <code>After=network.target</code> use it too. See these for proper syntax. Has to be in the <code>[Unit]</code> block.</p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-29T08:23:58Z' class='post-time'>
                October 29, 2021,  8:23am
              </time>
              <meta itemprop='dateModified' content='2021-10-29T08:23:58Z'>
          <span itemprop='position'>#17</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="acis" data-post="15" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../letter_avatar_proxy/v4/letter/a/d26b3c/40.png" class="avatar"> acis:</div>
<blockquote>
<p>Type=simple<br>
ExecStart=socat TCP-LISTEN:80,fork,bind=10.152.152.10 TCP:10.152.152.11:8083</p>
</blockquote>
</aside>
<p><code>fork</code> should likely be avoided for <code>Type=simple</code>.<br>
("<code>Type=forking</code> style" is outdated.)</p>
<hr>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Access_Workstation_Port_From_Host" target="_blank" rel="noopener" title="08:13AM - 29 October 2021">Whonix – 29 Oct 21</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:131/68;"><img src="../../../external.html?link=https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail" width="131" height="68"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Access_Workstation_Port_From_Host" target="_blank" rel="noopener">Access Whonix-Workstation ™ Ports from the Host</a></h3>

  <p>Access Whonix-Workstation ™ Port From Host (Esoteric Documentation)</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/acis'><span itemprop='name'>acis</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="12653.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-29T14:43:58Z' class='post-time'>
                October 29, 2021,  2:43pm
              </time>
              <meta itemprop='dateModified' content='2021-10-29T14:43:58Z'>
          <span itemprop='position'>#18</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="16" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Other files in folder <code>After=network.target</code> use it too. See these for proper syntax. Has to be in the <code>[Unit]</code> block.</p>
</blockquote>
</aside>
<p>Ok perfect, I updated my post with the proper syntax</p>
<aside class="quote no-group" data-username="Patrick" data-post="17" data-topic="12653">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><img src="../../../external.html?link=https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" alt="" width="131" height="68"></p>
<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Access_Workstation_Port_From_Host" rel="noopener nofollow ugc">Access Whonix-Workstation ™ Ports from the Host</a></h3>
<p>Access Whonix-Workstation ™ Port From Host (Esoteric Documentation)</p>
</blockquote>
</aside>
<p>Perfect! I am happy to contribute to this project <img src="../../images/emoji/twitter/raised_handsc164.png?v=9" title=":raised_hands:" class="emoji" alt=":raised_hands:"> <img src="../../images/emoji/twitter/grinning_face_with_smiling_eyesc164.png?v=9" title=":grinning_face_with_smiling_eyes:" class="emoji" alt=":grinning_face_with_smiling_eyes:"></p>
        </div>

        <meta itemprop='headline' content='Forwarding workststation nginx to gateway and host'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
