<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
    <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129</link>
    <description> hello, im hosting a hidden service on whonix. someone is ddosing it and i can see very high spikes of download/upload on ARM on the whonix-gateway.

In the whonix-workstation I installed mod security, quos and hardened apache as much as i could, but it doesnt stop. Im pretty sure i should do something on the whonix-gateway to protect my hidden serivice from ddos attacks. what can i do? without whonix fail2ban would work but here i dont know how. Please help.

----

**Edit by Patrick:**
**[https://www.whonix.org/wiki/Onion_Services#OnionBalance](https://www.whonix.org/wiki/Onion_Services#OnionBalance)**</description>
    <language>en</language>
    <lastBuildDate>Sun, 01 May 2022 17:26:19 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><strong><a href="https://www.whonix.org/wiki/Onion_Services#OnionBalance">https://www.whonix.org/wiki/Onion_Services#OnionBalance</a></strong></p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/9</link>
        <pubDate>Sun, 01 May 2022 17:26:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-9</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[anon36816226]]></dc:creator>
        <description><![CDATA[
            <p>I think Patrick talks about<br>
</p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://assets-cdn.github.com/favicon.ico" class="site-icon" width="32" height="32">
      <a href="https://github.com/DonnchaC/onionbalance" target="_blank" rel="nofollow noopener">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="https://avatars3.githubusercontent.com/u/3081375?s=400&amp;v=4" class="thumbnail onebox-avatar" width="400" height="400">

<h3><a href="https://github.com/DonnchaC/onionbalance" target="_blank" rel="nofollow noopener">DonnchaC/onionbalance</a></h3>

<p>onionbalance - OnionBalance provides load-balancing and redundancy for Tor hidden services</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
<span class="mention">@OP</span> if your Userbase is small you could try HS-Auth <a href="https://www.whonix.org/wiki/Hidden_Services#Hidden_Service_Authentication" rel="nofollow noopener">https://www.whonix.org/wiki/Hidden_Services#Hidden_Service_Authentication</a><br>
or you could take a look at<br>
<a href="https://github.com/korfuri/odon" rel="nofollow noopener">https://github.com/korfuri/odon</a><p></p>
<p>Hope it helps</p>
<ul>
<li>Goldstein</li>
</ul>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/8</link>
        <pubDate>Tue, 23 Feb 2016 20:51:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-8</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>There is some onion load balancing software somewhere on github. Type<br>
"tor onion load balancing" or so into search engines and you should find it.</p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/7</link>
        <pubDate>Tue, 23 Feb 2016 19:47:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-7</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[Ego]]></dc:creator>
        <description><![CDATA[
            <p>Good day,</p>
<aside class="quote" data-post="5" data-topic="2129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/v/ccd318/40.png" class="avatar"> vtfuyih:</div>
<blockquote>
<p>But more generally what can be done to protect a tor hidden service from ddos and similar attacks?</p>
</blockquote>
</aside>
<p>Sorry to say, but my previous answer contains pretty much all possibilities.</p>
<aside class="quote" data-post="5" data-topic="2129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/v/ccd318/40.png" class="avatar"> vtfuyih:</div>
<blockquote>
<p>With a .com clear website you can find help in services like cloudflare and use fail2ban with the apache / nginx filters, in addition to all the various apache mods and configurations. With a tor hidden service you dont have cloudflare.</p>
</blockquote>
</aside>
<p>Well, what cloudflare does is pretty much “put” their (massive) server between yours and show a captcha if the IP is suspicious. In the case of a hidden service, for this you’d have to trust a third party. So, not an option.</p>
<aside class="quote" data-post="5" data-topic="2129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/v/ccd318/40.png" class="avatar"> vtfuyih:</div>
<blockquote>
<p>A fail2ban filter to ban the ip when it makes too many requests would be useful on the whonix-gateway and also on the workstation?</p>
</blockquote>
</aside>
<p>Sadly isn’t possible. The way a hidden service is accessed is very different from a normal website. If you look at this, you’ll see that the whole design of a hidden service makes it impossible to block anyone: <a href="https://www.torproject.org/docs/hidden-services.html.en">https://www.torproject.org/docs/hidden-services.html.en</a> You’d at best block your own rendezvous, which means, no one will be able to access your site, no matter if friend or foe.</p>
<aside class="quote" data-post="5" data-topic="2129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/v/ccd318/40.png" class="avatar"> vtfuyih:</div>
<blockquote>
<p>it should ban either 127.0.0.1 or 10.152.152.10 on both virtual machines.</p>
</blockquote>
</aside>
<p>Those are all local IPs. You’d essentially block yourself then. Sorry.</p>
<aside class="quote" data-post="5" data-topic="2129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/v/ccd318/40.png" class="avatar"> vtfuyih:</div>
<blockquote>
<p>Also i think something should be done in the gateway as well, because i can ban everyone in the workstation fail2ban settings but the gateway its still naked, it receives all the spammy requests and sends them to apache on the worstation. I need to block it at the source <img src="//forums.whonix.org/images/emoji/twitter/slightly_smiling.png?v=5" title=":slightly_smiling:" class="emoji" alt=":slightly_smiling:"></p>
</blockquote>
</aside>
<p>Like mentioned before you can’t block anyone from accessing your hidden service that way, because people don’t directly connect to you, they use rendezvous points which, if blocked, would lead to noone beeing able to access you.</p>
<aside class="quote" data-post="5" data-topic="2129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/v/ccd318/40.png" class="avatar"> vtfuyih:</div>
<blockquote>
<p>I havent slept</p>
</blockquote>
</aside>
<p>Me neither.</p>
<p>The only thing you could do in theory, would be ask for a password via a prompt. Seen a few hidden service do that some time ago. They’d put the necessary password in the prompt to, so anyone could access the site, so it was simply another layer of verification.</p>
<p>Have a nice day,</p>
<p>Ego</p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/6</link>
        <pubDate>Tue, 23 Feb 2016 17:59:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-6</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[vtfuyih]]></dc:creator>
        <description><![CDATA[
            <p>I tried with both lighttpd and others, still overloads from too much traffic.<br>
I will try to transfer it into a server with a higher bandwidth tomorrow.<br>
Setting more resources to vbox doesnt do anything. I even tried 4 cpu cores for each virtual machine and 8 gb of ram. With more easy settings like 2 cpu cores / 2gb of ram for the workstation and 1 cpu core / 1gb ram for the gateway they use &lt; 30% of resources, so those are not the bottleneck, but the bandwidth it is since they keep filling it and it overloads.</p>
<p>But more generally what can be done to protect a tor hidden service from ddos and similar attacks?</p>
<p>With a .com clear website you can find help in services like cloudflare and use fail2ban with the apache / nginx filters, in addition to all the various apache mods and configurations. With a tor hidden service you dont have cloudflare.</p>
<p>Also with whonix every ip address in the apache access logs on the whonix-workstation is 10.152.152.10 (aka the whonix-gateway).<br>
In the whonix-gateway tor logs there are entries like “open sock listener on”, “you configured a non-loopback adress”, “opening socks listener” and either 127.0.0.1 or 10.152.152.10.</p>
<p>A fail2ban filter to ban the ip when it makes too many requests would be useful on the whonix-gateway and also on the workstation? i cant find a filter for that. it should ban either 127.0.0.1 or 10.152.152.10 on both virtual machines. On the workstation fail2ban can inspect apache logs but i dont know how to implement the same thing with tor logs on the gateway.<br>
Also i think something should be done in the gateway as well, because i can ban everyone in the workstation fail2ban settings but the gateway its still naked, it receives all the spammy requests and sends them to apache on the worstation. I need to block it at the source <img src="//forums.whonix.org/images/emoji/twitter/slightly_smiling.png?v=5" title=":slightly_smiling:" class="emoji" alt=":slightly_smiling:"></p>
<p>I havent slept so sorry for spaghetti explanation, to me right now it looks clear but yet i dont know what to do.<br>
Thank you</p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/5</link>
        <pubDate>Tue, 23 Feb 2016 16:57:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-5</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[Ego]]></dc:creator>
        <description><![CDATA[
            <p>Good day,</p>
<p>the only thing I can recommend then, would be switching from Apache to lighttpd, as it has the least overhead of any server and thus should be more stable. That’s the reason we actually recommend it in our guide to hidden service hosting, see: <a href="https://www.whonix.org/wiki/Hidden_Services">https://www.whonix.org/wiki/Hidden_Services</a></p>
<p>There is nothing really specific about Whonix which could really help you to solve this problem. Maybe increasing the RAM assigned, or, if you use VBox, looking at the more efficient alternatives (especially Qubes) could help reduce overload even more.</p>
<p>Have a nice day,</p>
<p>Ego</p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/4</link>
        <pubDate>Mon, 22 Feb 2016 22:42:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-4</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[vtfuyih]]></dc:creator>
        <description><![CDATA[
            <p>Hello, yes i redirect everyone to a captcha before they can enter the website.<br>
I know that preventing this stuff works the same as for clearnet, what i meant is that with whonix specifically i dont know if i should do anything on the gateway as well, since on the workstation and apache im doing everything possible to protect from ddos attacks. This is making the website offline for every legit user anyway.</p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/3</link>
        <pubDate>Mon, 22 Feb 2016 22:36:35 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-3</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[Ego]]></dc:creator>
        <description><![CDATA[
            <p>Good day,</p>
<p>changing something about the GW won’t help you with DOS/DDOS attacks, as they’d still reach you. Preventing such attacks on a hidden service works just the same as on a “normal website”, simply send anyone trying to reach you to a simple, light site which can’t create much overhead, were they have to somehow verify that they are real (e.g. via captcha).</p>
<p>Also, you may regard this: <a href="https://blog.torproject.org/blog/new-tor-denial-service-attacks-and-defenses">https://blog.torproject.org/blog/new-tor-denial-service-attacks-and-defenses</a></p>
<p>Have a nice day,</p>
<p>Ego</p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/2</link>
        <pubDate>Mon, 22 Feb 2016 19:33:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-2</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
      <item>
        <title>DDOS protection / mitigation for hidden service hosted with whonix</title>
        <dc:creator><![CDATA[vtfuyih]]></dc:creator>
        <description><![CDATA[
            <p>hello, im hosting a hidden service on whonix. someone is ddosing it and i can see very high spikes of download/upload on ARM on the whonix-gateway.</p>
<p>In the whonix-workstation I installed mod security, quos and hardened apache as much as i could, but it doesnt stop. Im pretty sure i should do something on the whonix-gateway to protect my hidden serivice from ddos attacks. what can i do? without whonix fail2ban would work but here i dont know how. Please help.</p>
<hr>
<p><strong>Edit by Patrick:</strong><br>
<strong><a href="https://www.whonix.org/wiki/Onion_Services#OnionBalance" rel="noopener nofollow ugc">https://www.whonix.org/wiki/Onion_Services#OnionBalance</a></strong></p>
          <p><a href="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129/1</link>
        <pubDate>Mon, 22 Feb 2016 19:26:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2129-1</guid>
        <source url="http://forums.whonix.org/t/ddos-protection-mitigation-for-hidden-service-hosted-with-whonix/2129.rss">DDOS protection / mitigation for hidden service hosted with whonix</source>
      </item>
  </channel>
</rss>
