<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Issue with user.js when installing SecBrowser on a Qube DispVM</title>
    <link>http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354</link>
    <description>Hi,

When I start SecBrowser on a DispVM, the file user.js that I modified is not present.


Expected results:
-----------------
1. Seeing the user.js file in the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder of the DispVM
2. ... which would lead to seeing the user.js modified prefs in the browser SecBrowser when going to about:config (ultimate goal)


Actual results:
---------------
1. The folder &quot;~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/user.js&quot; **in the DispVM** only contains:
    - bookmarks.html and
    - extensions
    
    Consequently, the user.js is not imported in the DispVM from secbrowser-dvm (the DisposableVM Template I created)

2. The folder &quot;~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/user.js&quot; **in secbrowser-dvm  (the DisposableVM Template)** contains many files, including the user.js that I modified. 
But, obviously, the goal is not to go on the internet with the SecBrowser of the DisposableVM Template!


Whonix or Qube issue?
---------------------
I was wondering... 

So I touched 3 files in secbrowser-dvm:

- `touch qwerty` in the ~ folder
- `touch qwerty` in the ~/.secbrowser folder
- `touch qwerty` in the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder 

When I launch an xterm on a DispVM:

- [+] I can see &quot;qwerty&quot; in the ~ folder
- [-] I cannot see &quot;qwerty&quot; in the ~/.secbrowser folder
- [-]  I cannot see &quot;qwerty&quot; in the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder

It **looks like** ***only*** the changes in the ~/.secbrowser folder (and subfolders) are not inherited from the DisposableVM Template to the DisposableVM!?

So I thought the issue was more related to Whonix&#39;s SecBrowser than to Qubes&#39; inheritance between a DisposableVM Template and a DispVM!?


Steps to reproduce
------------------

1. https ://www.whonix.org/wiki/SecBrowser/Qubes#Install_SecBrowser_.E2.84.A2 
2. From there, I modified my user.js
3. Then I turned my AppVM into a DisposableVM Template (called &quot;secbrowser-dvm&quot;)


Main Question
-------------

Why is the user.js file (and all of the other files of the profile, actually) not inherited from the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder of secbrowser-dvm to the DispVM?



Additionnal Questions
---------------------

May I ask additonnal clarifying questions on your webpage related to Qubes/SecBrowser? (https ://www.whonix.org/wiki/SecBrowser/Qubes )


1. I&#39;m confused by &quot;secbrowser&quot; and &quot;tb-updater&quot;. From https ://www.whonix.org/wiki/SecBrowser/Qubes#Package_Installation: 
	- First: &quot;The first step to install tb-updater is to add the Whonix repository.&quot;
	- Later: &quot;sudo apt-get install --no-install-recommends secbrowser&quot;
	- I wonder:
		+ How a command to install &quot;secbrowser&quot; can actually install the &quot;tb-updater&quot;?
		+ Why is the purpose of the &quot;--no-install-recommends&quot; switch, in this particular case?
		+ Could you describe how (i) tb-updater, (ii) tb-starter and (iii) secbrowser relate one to another?



2. From https ://www.whonix.org/wiki/SecBrowser/Qubes#New_Qubes_TemplateBasedVMs:_Latest_Tor_Browser_Version

	I read this paragraph several times but I still don&#39;t understand it. 

	It says (about `sudo touch /etc/secbrowser-qubes` in the TemplateVM): &quot;When using this setting, when the tb-updater package is updated, download-secbrowser runs automatically.&quot; 
	
	I thought the TemplateVMs updated all the applications from their repository. Consequently, the application SecBrowser (i.e. the Tor browser modified to go on clearnet) would be updated in the TemplateVM!? Why is `sudo touch /etc/secbrowser-qubes` in the TemplateVM necessary?
	

I realise this is quite a long post! So, thank you for your attention... and for the time you spend in developping Whonix!

PS: I had to &quot;break&quot; my URLs since I guess first time users are not allowed to post links.</description>
    <language>en</language>
    <lastBuildDate>Fri, 17 Apr 2020 17:27:07 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Issue with user.js when installing SecBrowser on a Qube DispVM</title>
        <dc:creator><![CDATA[john1234]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for your answers &amp; time, Patrick!</p>
          <p><a href="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/5</link>
        <pubDate>Fri, 17 Apr 2020 17:27:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9354-5</guid>
        <source url="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354.rss">Issue with user.js when installing SecBrowser on a Qube DispVM</source>
      </item>
      <item>
        <title>Issue with user.js when installing SecBrowser on a Qube DispVM</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>john1234 via Whonix Forum:</p>
<blockquote>
<p>Should it replace the default user.js into /var/cache/tb-binary/ before the link is made with the user home folder?</p>
</blockquote>
<p>That would work but that change would be lost when tb-updater upgrades<br>
SecBrowser during TemplateVM upgrade. Customization is currently not<br>
considered. If you can understand / hack the scripts it’s certainly<br>
possible.</p>
<blockquote>
<p>Is it even possible to achieve that without modifying any Whonix scripts?</p>
</blockquote>
<p>Yes.</p>
          <p><a href="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/4</link>
        <pubDate>Fri, 17 Apr 2020 13:04:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9354-4</guid>
        <source url="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354.rss">Issue with user.js when installing SecBrowser on a Qube DispVM</source>
      </item>
      <item>
        <title>Issue with user.js when installing SecBrowser on a Qube DispVM</title>
        <dc:creator><![CDATA[john1234]]></dc:creator>
        <description><![CDATA[
            <p>Hi Patrick,</p>
<p>Thank you for such a quick answer!</p>
<p>Maybe I should have mentionned that I’m close to a Linux noob. To give a better idea of my level:</p>
<ul>
<li>A long time ago, I used Linux at work on a very basic level (i.e. I knew what <code>ls</code> meant).</li>
<li>I’ve started digging into Linux on a Raspi4 on January</li>
<li>I’ve installed Qubes less than 2 weeks ago (after much head scratching thanks to my Nvidia graphic card <img src="//forums.whonix.org/images/emoji/twitter/wink.png?v=9" title=":wink:" class="emoji" alt=":wink:"> )</li>
</ul>
<p>I’m strongly motivated but I’m afraid many technical stuff is still out of my reach!  <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Therefore, may I check with you if I correctly understood your explanations?</p>
<h2>Main Question</h2>
<aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="9354">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>^ does this answer your question?</p>
<p>In short: in DispVM /var/cache/tb-binary is bind mounted to user home folder.</p>
</blockquote>
</aside>
<p>I’ve just googled what “bind mounted” means. If I understand correctly, in a DispVM, ~/.secbrowser is “kind of a hard link to” /var/cache/tb-binary/.secbrowser.</p>
<p>I’ve just launched SecBrowser in a DispVM and looked to confirm this. Both folders look indeed the same. They contains many files and user.js is one of them.</p>
<p><strong>But how can I manage to have SecBrowser use my modified user.js, then?</strong> Should it replace the default user.js into /var/cache/tb-binary/ before the link is made with the user home folder? Is it even possible to achieve that without modifying any Whonix scripts?</p>
<p>Thanks!</p>
<h2>Additional Questions</h2>
<p>I think I understood all your answers, here. Thanks, Patrick!!</p>
          <p><a href="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/3</link>
        <pubDate>Fri, 17 Apr 2020 02:58:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9354-3</guid>
        <source url="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354.rss">Issue with user.js when installing SecBrowser on a Qube DispVM</source>
      </item>
      <item>
        <title>Issue with user.js when installing SecBrowser on a Qube DispVM</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/tb-updater/blob/master/usr/lib/tb-updater/dispvm" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/tb-updater/blob/master/usr/lib/tb-updater/dispvm" target="_blank">Whonix/tb-updater/blob/master/usr/lib/tb-updater/dispvm</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2019 - 2020 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

set -x
set -e

user_name="user"

if ischroot --default-false ; then
   exit 0
fi

if command -v qubesdb-read &gt;/dev/null 2&gt;&amp;1 ; then
   qubes_vm_type="$(qubesdb-read /qubes-vm-type)"
   qubes_vm_name="$(qubesdb-read /name)"
   qubes_vm_persistence="$(qubesdb-read /qubes-vm-persistence)"
else
   ## Do not do any of this outside of Qubes.
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/tb-updater/blob/master/usr/lib/tb-updater/dispvm" target="_blank">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>^ does this answer your question?</p>
<p>In short: in DispVM /var/cache/tb-binary is bind mounted to user home folder.</p>
<p>You can post links now.</p>
<aside class="quote no-group" data-username="john1234" data-post="1" data-topic="9354">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/76d3ee/40.png" class="avatar"> john1234:</div>
<blockquote>
<p>How a command to install “secbrowser” can actually install the “tb-updater”?</p>
</blockquote>
</aside>
<p>Package secbrowser <code>Depends:</code> on <code>tb-updater</code>. When installing package <code>secbrowser</code> also all dependencies will be installed.</p>
<p>Documentation might be a bit confusing indeed.</p>
<aside class="quote no-group" data-username="john1234" data-post="1" data-topic="9354">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/76d3ee/40.png" class="avatar"> john1234:</div>
<blockquote>
<p>Why is the purpose of the “–no-install-recommends” switch, in this particular case?</p>
</blockquote>
</aside>
<p>Not sure still needed at this point. Compare difference with and without.</p>
<aside class="quote no-group" data-username="john1234" data-post="1" data-topic="9354">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/76d3ee/40.png" class="avatar"> john1234:</div>
<blockquote>
<p>Could you describe how (i) tb-updater, (ii) tb-starter and (iii) secbrowser relate one to another?</p>
</blockquote>
</aside>
<p><code>secbrowser</code> is a meta package which <code>Depends:</code> essentially on<br>
, tb-starter.</p>
<p>See <a href="https://github.com/Whonix/tb-starter">https://github.com/Whonix/tb-starter</a> and <a href="https://github.com/Whonix/tb-updater">https://github.com/Whonix/tb-updater</a></p>
<p>tb-starter contains /usr/bin/torbrowser. Originally only Tor Browser support. But once environment variables are changed it can do other stuff such as SecBrowser.</p>
<p>tb-starter now also contains /usr/bin/secbrowser which sets environment variables to start SecBrowser instead.</p>
<p>tb-updater originally only supported downloading Tor Browser and later support was added for SecBrowser.</p>
<aside class="quote no-group" data-username="john1234" data-post="1" data-topic="9354">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/76d3ee/40.png" class="avatar"> john1234:</div>
<blockquote>
<p>Why is <code>sudo touch /etc/secbrowser-qubes</code> in the TemplateVM necessary?</p>
</blockquote>
</aside>
<p>Technical limitations. It’s a status file used in in scripts. Not a pretty implementation. Maybe would have been better to check if package secbrowser is installed instead.</p>
<p>It’s all messy because of unfixed root, tons of features, and historic growth. But I also don’t want to loose more time on it due to risks of regressions, the already sunken cost, works stable now and good enough. I wouldn’t recommend a rewrite either but instead fixing the root issues which are these:</p>
<ul>
<li><a href="https://trac.torproject.org/projects/tor/ticket/5236">https://trac.torproject.org/projects/tor/ticket/5236</a></li>
<li><a href="https://trac.torproject.org/projects/tor/ticket/3994">https://trac.torproject.org/projects/tor/ticket/3994</a></li>
</ul>
          <p><a href="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/2</link>
        <pubDate>Thu, 16 Apr 2020 22:02:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9354-2</guid>
        <source url="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354.rss">Issue with user.js when installing SecBrowser on a Qube DispVM</source>
      </item>
      <item>
        <title>Issue with user.js when installing SecBrowser on a Qube DispVM</title>
        <dc:creator><![CDATA[john1234]]></dc:creator>
        <description><![CDATA[
            <p>Hi,</p>
<p>When I start SecBrowser on a DispVM, the file user.js that I modified is not present.</p>
<h2>Expected results:</h2>
<ol>
<li>Seeing the user.js file in the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder of the DispVM</li>
<li>… which would lead to seeing the user.js modified prefs in the browser SecBrowser when going to about:config (ultimate goal)</li>
</ol>
<h2>Actual results:</h2>
<ol>
<li>
<p>The folder “~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/user.js” <strong>in the DispVM</strong> only contains:</p>
<ul>
<li>bookmarks.html and</li>
<li>extensions</li>
</ul>
<p>Consequently, the user.js is not imported in the DispVM from secbrowser-dvm (the DisposableVM Template I created)</p>
</li>
<li>
<p>The folder “~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/user.js” <strong>in secbrowser-dvm  (the DisposableVM Template)</strong> contains many files, including the user.js that I modified.<br>
But, obviously, the goal is not to go on the internet with the SecBrowser of the DisposableVM Template!</p>
</li>
</ol>
<h2>Whonix or Qube issue?</h2>
<p>I was wondering…</p>
<p>So I touched 3 files in secbrowser-dvm:</p>
<ul>
<li>
<code>touch qwerty</code> in the ~ folder</li>
<li>
<code>touch qwerty</code> in the ~/.secbrowser folder</li>
<li>
<code>touch qwerty</code> in the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder</li>
</ul>
<p>When I launch an xterm on a DispVM:</p>
<ul>
<li>[+] I can see “qwerty” in the ~ folder</li>
<li>[-] I cannot see “qwerty” in the ~/.secbrowser folder</li>
<li>[-]  I cannot see “qwerty” in the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder</li>
</ul>
<p>It <strong>looks like</strong> <em><strong>only</strong></em> the changes in the ~/.secbrowser folder (and subfolders) are not inherited from the DisposableVM Template to the DisposableVM!?</p>
<p>So I thought the issue was more related to Whonix’s SecBrowser than to Qubes’ inheritance between a DisposableVM Template and a DispVM!?</p>
<h2>Steps to reproduce</h2>
<ol>
<li>https ://www.whonix.org/wiki/SecBrowser/Qubes#Install_SecBrowser_.E2.84.A2</li>
<li>From there, I modified my user.js</li>
<li>Then I turned my AppVM into a DisposableVM Template (called “secbrowser-dvm”)</li>
</ol>
<h2>Main Question</h2>
<p>Why is the user.js file (and all of the other files of the profile, actually) not inherited from the ~/.secbrowser/secbrowser/Browser/TorBrowser/Data/Browser/profile.default/ folder of secbrowser-dvm to the DispVM?</p>
<h2>Additionnal Questions</h2>
<p>May I ask additonnal clarifying questions on your webpage related to Qubes/SecBrowser? (https ://www.whonix.org/wiki/SecBrowser/Qubes )</p>
<ol>
<li>
<p>I’m confused by “secbrowser” and “tb-updater”. From https ://www.whonix.org/wiki/SecBrowser/Qubes#Package_Installation:</p>
<ul>
<li>First: “The first step to install tb-updater is to add the Whonix repository.”</li>
<li>Later: “sudo apt-get install --no-install-recommends secbrowser”</li>
<li>I wonder:
<ul>
<li>How a command to install “secbrowser” can actually install the “tb-updater”?</li>
<li>Why is the purpose of the “–no-install-recommends” switch, in this particular case?</li>
<li>Could you describe how (i) tb-updater, (ii) tb-starter and (iii) secbrowser relate one to another?</li>
</ul>
</li>
</ul>
</li>
<li>
<p>From https ://www.whonix.org/wiki/SecBrowser/Qubes#New_Qubes_TemplateBasedVMs:_Latest_Tor_Browser_Version</p>
<p>I read this paragraph several times but I still don’t understand it.</p>
<p>It says (about <code>sudo touch /etc/secbrowser-qubes</code> in the TemplateVM): “When using this setting, when the tb-updater package is updated, download-secbrowser runs automatically.”</p>
<p>I thought the TemplateVMs updated all the applications from their repository. Consequently, the application SecBrowser (i.e. the Tor browser modified to go on clearnet) would be updated in the TemplateVM!? Why is <code>sudo touch /etc/secbrowser-qubes</code> in the TemplateVM necessary?</p>
</li>
</ol>
<p>I realise this is quite a long post! So, thank you for your attention… and for the time you spend in developping Whonix!</p>
<p>PS: I had to “break” my URLs since I guess first time users are not allowed to post links.</p>
          <p><a href="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354/1</link>
        <pubDate>Thu, 16 Apr 2020 19:47:30 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9354-1</guid>
        <source url="http://forums.whonix.org/t/issue-with-user-js-when-installing-secbrowser-on-a-qube-dispvm/9354.rss">Issue with user.js when installing SecBrowser on a Qube DispVM</source>
      </item>
  </channel>
</rss>
