<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>kernel.deny_new_usb sysctl to deny new USB devices - #3 by Patrick - Development - Whonix Forum</title>
    <meta name="description" content="linux-hardened exposes a kernel.deny_new_usb sysctl to deny new USB devices. This defaults to being disabled but we might want to enable this to block any USB-based attacks. 
There’s multiple ways we can go about this. 

&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../8928.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;kernel.deny_new_usb sysctl to deny new USB devices&#39;" href="../8928.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/kernel-deny-new-usb-sysctl-to-deny-new-usb-devices/8928/3" />
<meta name="twitter:url" content="https://forums.whonix.org/t/kernel-deny-new-usb-sysctl-to-deny-new-usb-devices/8928/3" />
<meta property="og:title" content="kernel.deny_new_usb sysctl to deny new USB devices" />
<meta name="twitter:title" content="kernel.deny_new_usb sysctl to deny new USB devices" />
<meta property="og:description" content="Blockers before this can be worked at:   fixing USB (auto) mounting generally as per Disk &amp; USB Automount in Kicksecure   Things which can be done before this gets important:   T960: hardened kernel Debian packaging and APT integration - hkapt   Could you please describe what kind of attack you mean or give an example?  An USB device gets attached which then exploits a vulnerability in the kernel?  Quote https://www.qubes-os.org/doc/device-handling-security/#usb-security   USB Security  The conn..." />
<meta name="twitter:description" content="Blockers before this can be worked at:   fixing USB (auto) mounting generally as per Disk &amp; USB Automount in Kicksecure   Things which can be done before this gets important:   T960: hardened kernel Debian packaging and APT integration - hkapt   Could you please describe what kind of attack you mean or give an example?  An USB device gets attached which then exploits a vulnerability in the kernel?  Quote https://www.qubes-os.org/doc/device-handling-security/#usb-security   USB Security  The conn..." />
<meta property="article:published_time" content="2020-02-14T04:33:46+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../8928.html">kernel.deny_new_usb sysctl to deny new USB devices</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../../tag/status_open_issue_todo.html' class='discourse-tag' rel="tag">status_open_issue_todo</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-12T19:41:22Z' class='post-time'>
                February 12, 2020,  7:41pm
              </time>
              <meta itemprop='dateModified' content='2020-02-13T19:46:41Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>linux-hardened exposes a <code>kernel.deny_new_usb</code> sysctl to deny new USB devices. This defaults to being disabled but we might want to enable this to block any USB-based attacks.</p>
<p>There’s multiple ways we can go about this.</p>
<ol>
<li>
<p>Enable it normally in /etc/sysctl.d.</p>
</li>
<li>
<p>Patch it so the default is enabled (this would just change a single number, not a big change). This is better than (1) as it’d prevent attacks that happen before the sysctl is set.</p>
</li>
<li>
<p>Tie it into the lockscreen so whenever the lockscreen is being used, new USB devices are denied. This would prevent anyone from inserting a malicious USB as soon as the user leaves their device. This is what GrapheneOS does and seems to be the most user-friendly approach. <a href="../../../../external.html?link=https://github.com/AndroidHardeningArchive/documentation/blob/master/technical_overview.md#attack-surface-reduction">https://github.com/AndroidHardeningArchive/documentation/blob/master/technical_overview.md#attack-surface-reduction</a></p>
</li>
</ol>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>
          <meta itemprop='keywords' content='component_security, status_open_issue_todo'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../kernel-recompilation-for-better-hardening/7598/336.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../kernel-recompilation-for-better-hardening/7598/336.html'>
                      <span itemprop='name'>kernel recompilation for better hardening</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../tails-vs-whonix-removable-media/14553/2.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../tails-vs-whonix-removable-media/14553/2.html'>
                      <span itemprop='name'>Tails vs Whonix (Removable Media)</span>
                    </a>
                    <meta itemprop='position' content='3'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-13T23:24:01Z' class='post-time'>
                February 13, 2020, 11:24pm
              </time>
              <meta itemprop='dateModified' content='2020-02-13T23:24:01Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Much easier to manage than the annoyaning restrictions we have</p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-14T04:33:46Z' class='post-time'>
                February 14, 2020,  4:33am
              </time>
              <meta itemprop='dateModified' content='2020-02-14T04:33:46Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Blockers before this can be worked at:</p>
<ul>
<li>fixing USB (auto) mounting generally as per <a href="../../disk-usb-automount-in-kicksecure/8728/23.html" class="inline-onebox">Disk &amp; USB Automount in Kicksecure</a>
</li>
</ul>
<p>Things which can be done before this gets important:</p>
<ul>
<li><a href="../../../../external.html?link=https://phabricator.whonix.org/T960">T960: hardened kernel Debian packaging and APT integration - hkapt</a></li>
</ul>
<aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>This is better than (1) as it’d prevent attacks that happen before the sysctl is set.</p>
</blockquote>
</aside>
<p>Could you please describe what kind of attack you mean or give an example?</p>
<p>An USB device gets attached which then exploits a vulnerability in the kernel?</p>
<p>Quote <a href="../../../../external.html?link=https://www.qubes-os.org/doc/device-handling-security/#usb-security">https://www.qubes-os.org/doc/device-handling-security/#usb-security</a></p>
<blockquote>
<p>USB Security</p>
<p>The connection of an untrusted USB device to dom0 is a security risk since the device can attack an arbitrary USB driver (which are included in the linux kernel), exploit bugs during partition-table-parsing or simply pretend to be a keyboard. There are many ready-to-use implementations of such attacks, e.g. a <a href="../../../../external.html?link=https://shop.hak5.org/products/usb-rubber-ducky-deluxe">USB Rubber Ducky</a>. The whole USB stack is put to work to parse the data presented by the USB device in order to determine if it is a USB mass storage device, to read its configuration, etc. This happens even if the drive is then assigned and mounted in another qube.</p>
<p>To avoid this risk, use a <a href="../../../../external.html?link=https://www.qubes-os.org/doc/usb-qubes/">USB qube</a>.</p>
<p>Attaching a USB device to a VM (USB passthrough) will <strong>expose your target qube</strong> to most of the <a href="../../../../external.html?link=https://blog.invisiblethings.org/2011/05/31/usb-security-challenges.html">security issues</a> associated with the USB-stack. If possible, use a method specific for particular device type (for example, block devices described above), instead of this generic one.</p>
</blockquote>
<p>Or <a href="../../../../external.html?link=https://shop.hak5.org/products/usb-rubber-ducky-deluxe">USB Rubber Ducky</a>?</p>
<p>Which classes of attack is this supposed to prevent?</p>
<p>Implies that there is some kind of per VM filtering? How does that work?</p>
<p>It denies “new USB”. How are “old USB” configured? How would users allow an USB device?</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="2" data-topic="8928" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Much easier to manage than the annoyaning restrictions we have</p>
</blockquote>
</aside>
<p>No, not necessarily.<br>
There is no such thing as “restrictions we have” related to USB. The only conscious change was thunar USB auto mounting disabling.</p>
<p>Otherwise “restrictions we have” is technically undefined. It’s not yet clear what causes these issues. Therefore “don’t do what we do now” and “do it as in this thread” isn’t possible because “don’t do what we do now” prerequisites knowledge of “what do we do now?”.</p>
<p>“don’t do what we do now” also mixes together security hardening changes which were applied for reason totally unrelated to USB such as proc-hidepid.</p>
<p>There is no way to skip the details of this forum thread <a href="../../disk-usb-automount-in-kicksecure/8728/23.html" class="inline-onebox">Disk &amp; USB Automount in Kicksecure</a> and to generally say “doing as in this thread is better”.</p>
<p>I wouldn’t underestimate the difficulty of what is proposed in this forum thread either. I haven’t used this yet but looking at the documentation here (says “As of Jan 31, 2019, the information in this section has been deprecated. It may or may not be relevant for contemporary usage. Handle with care!”) does not look trivial either:</p>
<p><a href="../../../../external.html?link=https://wiki.gentoo.org/wiki/Allow_only_known_usb_devices" class="onebox" target="_blank">https://wiki.gentoo.org/wiki/Allow_only_known_usb_devices</a></p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-14T17:19:01Z' class='post-time'>
                February 14, 2020,  5:19pm
              </time>
              <meta itemprop='dateModified' content='2020-02-14T17:19:01Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>An USB device gets attached which then exploits a vulnerability in the kernel?</p>
</blockquote>
</aside>
<p>Yes. USB adds a lot of local attack surface and are commonly used in attacks. See e.g. <a href="../../../../external.html?link=https://en.wikipedia.org/wiki/Stuxnet">Stuxnet</a> or <a href="../../../../external.html?link=https://arstechnica.com/information-technology/2014/07/this-thumbdrive-hacks-computers-badusb-exploit-makes-devices-turn-evil/">BadUSB</a></p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Or <a href="../../../../external.html?link=https://shop.hak5.org/products/usb-rubber-ducky-deluxe">USB Rubber Ducky</a>?</p>
</blockquote>
</aside>
<p>Rubber duckies automatically exploit a vulnerability once plugged in. It’s not an “or”, it’s the same thing.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Implies that there is some kind of per VM filtering? How does that work?</p>
</blockquote>
</aside>
<p>Qubes requires you to specifically passthrough USBs to a VM.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It denies “new USB”. How are “old USB” configured?</p>
</blockquote>
</aside>
<p>“old USB” means before the sysctl is set and “new USB” is after the sysctl is set.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>How would users allow an USB device?</p>
</blockquote>
</aside>
<p>They can temporarily disable deny_new_usb and re-enable it after plugging their USB in.</p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-14T19:02:46Z' class='post-time'>
                February 14, 2020,  7:02pm
              </time>
              <meta itemprop='dateModified' content='2020-02-14T19:02:46Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Question is if malicious USBs can exploit the underlying USB PCI bus without ever being acknowledged/seen/loaded by the kernel.</p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-14T19:11:36Z' class='post-time'>
                February 14, 2020,  7:11pm
              </time>
              <meta itemprop='dateModified' content='2020-02-14T19:11:36Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>If you’re asking whether they can exploit the underlying hardware/firmware, then the answer is probably yes but that’s out of our reach and the only mitigation at that point is ripping out your USB ports.</p>
<p>I also find it really unlikely they’d even attempt to exploit that when the kernel USB stack is a far more promising target as it has plenty of vulnerabilities found regularly (syzbot found over 80 vulns soon after it started fuzzing the USB stack and that was just the start).</p>
<p>If you’re asking whether they can still exploit the kernel, then no. The kernel attack surface is only really exposed once the USB is recognized by the kernel.</p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-15T12:57:34Z' class='post-time'>
                February 15, 2020, 12:57pm
              </time>
              <meta itemprop='dateModified' content='2020-02-15T12:57:34Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>What about those users who only have keyboards / mice which are internally connected by USB? At first boot they would be presented with a broken system?</p>
<aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Patch it so the default is enabled (this would just change a single number, not a big change). This is better than (1) as it’d prevent attacks that happen before the sysctl is set.</p>
</blockquote>
</aside>
<p>Could a sysctl still undo this? I.e. we could boot with this kernel boot parameter and then users could switch the sysctl to allow new USB devices?</p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-15T17:37:21Z' class='post-time'>
                February 15, 2020,  5:37pm
              </time>
              <meta itemprop='dateModified' content='2020-02-15T17:37:21Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="7" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What about those users who only have keyboards / mice which are internally connected by USB? At first boot they would be presented with a broken system?</p>
</blockquote>
</aside>
<p>All devices connected at boot should be allowed. Any connected after boot should be denied.</p>
<aside class="quote no-group" data-username="Patrick" data-post="7" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could a sysctl still undo this? I.e. we could boot with this kernel boot parameter and then users could switch the sysctl to allow new USB devices?</p>
</blockquote>
</aside>
<p>Yes.</p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-15T20:22:59Z' class='post-time'>
                February 15, 2020,  8:22pm
              </time>
              <meta itemprop='dateModified' content='2020-02-15T20:22:59Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Looks really good overall.</p>
<p>Though a bit far in future (after <a href="../../../../external.html?link=https://phabricator.whonix.org/T961">https://phabricator.whonix.org/T961</a> and <a href="../../../../external.html?link=https://phabricator.whonix.org/T960">https://phabricator.whonix.org/T960</a>).</p>
<aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Patch it so the default is enabled (this would just change a single number, not a big change). This is better than (1) as it’d prevent attacks that happen before the sysctl is set.</p>
</blockquote>
</aside>
<p>Not sure that would be a trivial patch. I like the initiative of deny_new_usb but does not seem to have a complex state new vs old USB. (I am not suggesting it should.)</p>
<pre><code>kernel/sysctl.c:int deny_new_usb __read_mostly = 0;
kernel/sysctl.c:EXPORT_SYMBOL(deny_new_usb);
kernel/sysctl.c:                .procname       = "deny_new_usb",
kernel/sysctl.c:                .data           = &amp;deny_new_usb,
drivers/usb/core/hub.c:extern int deny_new_usb;
drivers/usb/core/hub.c: if (deny_new_usb) {
</code></pre>
<p>It is only used in function <code>hub_port_connect</code> which, correct me if I am wrong, is probably parsed at every boot for every port. By booting with <code>deny_new_usb</code> we would effectively block all USB.</p>
<aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Enable it normally in /etc/sysctl.d.</p>
</blockquote>
</aside>
<p>Also when reading about <code>deny_new_usb</code> suggests that init scripts (systemd) should set this.</p>
<hr>
<p>Proposal:</p>
<ul>
<li>
<code>deny_new_usb</code> after boot completed</li>
<li>set <code>deny_new_usb</code> when lockscreen</li>
<li>This could use a systray to indicate status and to easily toggle (left click) new USB disable/enable.</li>
<li>Enable action should have a timeout and notification how long until auto disable and timeout.</li>
</ul>
<p>There is a systray for i3 here:</p>
<p><a href="../../../../external.html?link=https://blog.lizzie.io/preventing-usb-attacks-with-linux-hardened.html" class="onebox" target="_blank">https://blog.lizzie.io/preventing-usb-attacks-with-linux-hardened.html</a></p>
<p>But we’d need a systray for XFCE.</p>
<p>Example XFCE systray (although that does not have clickable actions).</p>
<ul>
<li><a href="../../../../external.html?link=https://github.com/Whonix/whonix-xfce-desktop-config/blob/master/etc/skel/.config/xfce4/panel/genmon-12.rc">https://github.com/Whonix/whonix-xfce-desktop-config/blob/master/etc/skel/.config/xfce4/panel/genmon-12.rc</a></li>
<li><a href="../../../../external.html?link=https://github.com/Whonix/whonix-xfce-desktop-config/blob/master/usr/share/livecheck/livecheck.sh">https://github.com/Whonix/whonix-xfce-desktop-config/blob/master/usr/share/livecheck/livecheck.sh</a></li>
</ul>
<p>Related:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://github.githubassets.com/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../../external.html?link=https://github.com/anthraxx/usbctl" target="_blank">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="../../../../external.html?link=https://avatars2.githubusercontent.com/u/203012?s=400&amp;v=4" class="thumbnail" width="" height="">

<h3><a href="../../../../external.html?link=https://github.com/anthraxx/usbctl" target="_blank">anthraxx/usbctl</a></h3>

<p>Linux-hardened deny_new_usb control. Contribute to anthraxx/usbctl development by creating an account on GitHub.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p><a href="../../../../external.html?link=https://www.whonix.org/wiki/FAQ#Patches_are_Welcome">Patches welcome.</a></p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../8928.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-15T20:51:31Z' class='post-time'>
                February 15, 2020,  8:51pm
              </time>
              <meta itemprop='dateModified' content='2020-02-15T20:51:31Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="9" data-topic="8928">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It is only used in function <code>hub_port_connect</code> which, correct me if I am wrong, is probably parsed at every boot for every port. By booting with <code>deny_new_usb</code> we would effectively block all USB.</p>
</blockquote>
</aside>
<p><code>hub_port_connect</code> is only called by <code>hub_port_connect_change</code> which is only called if something <em>changes</em>. In <code>port_event</code>:</p>
<pre><code class="lang-auto">if (connect_change)
                hub_port_connect_change(hub, port1, portstatus, portchange);
</code></pre>
<p>i.e. if a new device is removed/added which wasn’t there to begin with (I think). Although I’m not entirely sure on this. We’d need to test.</p>
        </div>

        <meta itemprop='headline' content='kernel.deny_new_usb sysctl to deny new USB devices'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
