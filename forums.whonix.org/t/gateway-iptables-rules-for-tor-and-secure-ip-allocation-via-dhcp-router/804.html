<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Gateway iptables rules for Tor and secure IP allocation via DHCP router - Support - Whonix Forum</title>
    <meta name="description" content="Hi, 

I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network. 


Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in or&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="804.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Gateway iptables rules for Tor and secure IP allocation via DHCP router&#39;" href="804.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804" />
<meta name="twitter:url" content="https://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804" />
<meta property="og:title" content="Gateway iptables rules for Tor and secure IP allocation via DHCP router" />
<meta name="twitter:title" content="Gateway iptables rules for Tor and secure IP allocation via DHCP router" />
<meta property="og:description" content="Hi,  I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network.    Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in order to Torify everything via Tor transparent proxy including DNS so it will be anonymous and also allow hosts to resolve .onion addresses. This should also drop / reject everything non-tcp such as icmp or udp.    since this machine will act as a router also, I would like to have s..." />
<meta name="twitter:description" content="Hi,  I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network.    Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in order to Torify everything via Tor transparent proxy including DNS so it will be anonymous and also allow hosts to resolve .onion addresses. This should also drop / reject everything non-tcp such as icmp or udp.    since this machine will act as a router also, I would like to have s..." />
<meta property="article:published_time" content="2015-01-15T00:25:23+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="804.html">Gateway iptables rules for Tor and secure IP allocation via DHCP router</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/support/5.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #8C6238'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Support</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/s7r'><span itemprop='name'>s7r</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="804.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2015-01-15T00:25:23Z' class='post-time'>
                January 15, 2015, 12:25am
              </time>
              <meta itemprop='dateModified' content='2015-01-15T00:25:23Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hi,</p>
<p>I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network.</p>
<ol>
<li>
<p>Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in order to Torify everything via Tor transparent proxy including DNS so it will be anonymous and also allow hosts to resolve .onion addresses. This should also drop / reject everything non-tcp such as icmp or udp.</p>
</li>
<li>
<p>since this machine will act as a router also, I would like to have some kind of secure IP allocation (DHCP). The first idea was based on MAC address, but since a MAC address can be spoofed is it better to use switch ports? The goal is to identify each host in the subnet via something and only assign a certain IP address to it, which cannot be changed without the router’s express acceptance.</p>
</li>
</ol>
<p>Last but not least, would like to make all the hosts in the subnet not able to talk to each other and only be able to talk to the router. Let’s assume for simplicity that the router/gateway has the IP 10.0.8.1 and the other hosts in the subnet are 10.0.8.2 and 10.0.8.3 and 10.0.8.4<br>
I want 10.0.8.1 to be able to talk to all the hiosts (1)<br>
all the hosts to be able to talk to 10.0.8.1 (2)<br>
all the hosts NOT to be able to talk to each other, except 10.0.8.1 (e.g. 10.0.8.2 -&gt; 10.0.8.4).</p>
<p>Since we talk about hosts on the same subnet, these packets do not go via the router/gateway so not sure if I can filter them there. How can this be accomplished?</p>
        </div>

        <meta itemprop='headline' content='Gateway iptables rules for Tor and secure IP allocation via DHCP router'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="804.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2015-01-15T03:26:18Z' class='post-time'>
                January 15, 2015,  3:26am
              </time>
              <meta itemprop='dateModified' content='2015-01-15T03:26:18Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hard questions…</p>
<blockquote>I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network.</blockquote>
Use the amd64 build parameter in build documentation (chapter: 64bit Builds).
<blockquote>1. Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in order to Torify everything via Tor transparent proxy including DNS so it will be anonymous and also allow hosts to resolve .onion addresses. This should also drop / reject everything non-tcp such as icmp or udp.</blockquote>
Package: whonix-gw-firewall
https://github.com/Whonix/whonix-gw-firewall
<p>It’s currently load by the whonix-gw-network-conf package. (<a href="../../../external.html?link=https://github.com/Whonix/whonix-gw-network-conf">https://github.com/Whonix/whonix-gw-network-conf</a>)<br>
File: <a href="../../../external.html?link=https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/network/interfaces.whonix">https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/network/interfaces.whonix</a><br>
Using “pre-up”.<br>
Once based on jessie, the whonix-gw-firewall package can and will be made more independent. I.e. once jessie, we can use the /etc/network/if-pre-up.d/ hook mechanism:<br>
<a href="../../../external.html?link=https://phabricator.whonix.org/T68">https://phabricator.whonix.org/T68</a></p>
<p>I also advice to look though this page:<br>
</p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="../../../external.html?link=https://github.com/Whonix" target="_blank">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="../../../external.html?link=https://avatars0.githubusercontent.com/u/4500165?s=280&amp;v=4" class="thumbnail onebox-avatar" width="280" height="280">

<h3><a href="../../../external.html?link=https://github.com/Whonix" target="_blank">Whonix</a></h3>

<p>Anonymous Operating System. Whonix has 116 repositories available. Follow their code on GitHub.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>~110 packages on 5 pages with very short and concise summaries. You can get an overview what Whonix is doing there and pick and choose from there.</p>
<blockquote>2. since this machine will act as a router also, I would like to have some kind of secure IP allocation (DHCP).</blockquote>
Latest considerations on DHCP:
https://www.whonix.org/wiki/Dev/DHCP
<p>Main TODO for now:</p>
<ul>
<li>Does DHCP have some feature which a compromised Whonix-Workstation could abuse? Does DHCP have a feature such as “tell me the IP of your upstream router”?<br>
** TODO: Read this stuff…<br>
*** <a href="../../../external.html?link=https://www.ietf.org/rfc/rfc2131.txt">https://www.ietf.org/rfc/rfc2131.txt</a><br>
*** <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol</a>
</li>
</ul>
<p>Help welcome.</p>
<blockquote>The first idea was based on MAC address, but since a MAC address can be spoofed is it better to use switch ports? The goal is to identify each host in the subnet via something and only assign a certain IP address to it, which cannot be changed without the router's express acceptance.</blockquote>
No finished solution for that either.
<p>For basic approaches, see:<br>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../external.html?link=https://www.whonix.org/wiki/Connections_between_Whonix-Gateway_and_Whonix-Workstation" target="_blank" title="07:33PM - 30 March 2020">Whonix – 30 Mar 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:640/452;"><img src="../../../external.html?link=https://www.whonix.org/w/images/9/95/Binary-503583640.jpg" class="thumbnail" width="640" height="452"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Connections_between_Whonix-Gateway_and_Whonix-Workstation" target="_blank">Connections between Whonix-Gateway ™ and Whonix-Workstation ™</a></h3>

<p>Authenticated / Encrypted Connections between Whonix-Gateway ™ and Whonix-Workstation ™, ARP spoofing defense, SSH, OpenVPN, Using additional (isolated) network interfaces</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<p>I think ARP spoofing defense as mentioned on that wiki page is the most lucrative.</p>
<blockquote>Last but not least, would like to make all the hosts in the subnet not able to talk to each other and only be able to talk to the router. Let's assume for simplicity that the router/gateway has the IP 10.0.8.1 and the other hosts in the subnet are 10.0.8.2 and 10.0.8.3 and 10.0.8.4 
I want 10.0.8.1 to be able to talk to all the hiosts (1)
all the hosts to be able to talk to 10.0.8.1 (2)
all the hosts NOT to be able to talk to each other, except 10.0.8.1 (e.g. 10.0.8.2 -&gt; 10.0.8.4).
<p>Since we talk about hosts on the same subnet, these packets do not go via the router/gateway so not sure if I can filter them there. How can this be accomplished?</p>
</blockquote><br>
Dunno. I advice to wipe “Whonix” from your question. Then make up a question for a simpler, similar environment that does not include Tor-anything. And ask in more specialized places.
<p>Needless to say, if you figure out something. Please report back. Contributions welcome!</p>
        </div>

        <meta itemprop='headline' content='Gateway iptables rules for Tor and secure IP allocation via DHCP router'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
