<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Gateway iptables rules for Tor and secure IP allocation via DHCP router</title>
    <link>http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804</link>
    <description>Hi,

I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network.

1. Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in order to Torify everything via Tor transparent proxy including DNS so it will be anonymous and also allow hosts to resolve .onion addresses. This should also drop / reject everything non-tcp such as icmp or udp.

2. since this machine will act as a router also, I would like to have some kind of secure IP allocation (DHCP). The first idea was based on MAC address, but since a MAC address can be spoofed is it better to use switch ports? The goal is to identify each host in the subnet via something and only assign a certain IP address to it, which cannot be changed without the router&#39;s express acceptance.

Last but not least, would like to make all the hosts in the subnet not able to talk to each other and only be able to talk to the router. Let&#39;s assume for simplicity that the router/gateway has the IP 10.0.8.1 and the other hosts in the subnet are 10.0.8.2 and 10.0.8.3 and 10.0.8.4 
I want 10.0.8.1 to be able to talk to all the hiosts (1)
all the hosts to be able to talk to 10.0.8.1 (2)
all the hosts NOT to be able to talk to each other, except 10.0.8.1 (e.g. 10.0.8.2 -&gt; 10.0.8.4).

Since we talk about hosts on the same subnet, these packets do not go via the router/gateway so not sure if I can filter them there. How can this be accomplished?</description>
    <language>en</language>
    <lastBuildDate>Thu, 15 Jan 2015 03:26:18 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Gateway iptables rules for Tor and secure IP allocation via DHCP router</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Hard questions…</p>
<blockquote>I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network.</blockquote>
Use the amd64 build parameter in build documentation (chapter: 64bit Builds).
<blockquote>1. Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in order to Torify everything via Tor transparent proxy including DNS so it will be anonymous and also allow hosts to resolve .onion addresses. This should also drop / reject everything non-tcp such as icmp or udp.</blockquote>
Package: whonix-gw-firewall
https://github.com/Whonix/whonix-gw-firewall
<p>It’s currently load by the whonix-gw-network-conf package. (<a href="https://github.com/Whonix/whonix-gw-network-conf">https://github.com/Whonix/whonix-gw-network-conf</a>)<br>
File: <a href="https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/network/interfaces.whonix">https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/network/interfaces.whonix</a><br>
Using “pre-up”.<br>
Once based on jessie, the whonix-gw-firewall package can and will be made more independent. I.e. once jessie, we can use the /etc/network/if-pre-up.d/ hook mechanism:<br>
<a href="https://phabricator.whonix.org/T68">https://phabricator.whonix.org/T68</a></p>
<p>I also advice to look though this page:<br>
</p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/Whonix" target="_blank">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="https://avatars0.githubusercontent.com/u/4500165?s=280&amp;v=4" class="thumbnail onebox-avatar" width="280" height="280">

<h3><a href="https://github.com/Whonix" target="_blank">Whonix</a></h3>

<p>Anonymous Operating System. Whonix has 116 repositories available. Follow their code on GitHub.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>~110 packages on 5 pages with very short and concise summaries. You can get an overview what Whonix is doing there and pick and choose from there.</p>
<blockquote>2. since this machine will act as a router also, I would like to have some kind of secure IP allocation (DHCP).</blockquote>
Latest considerations on DHCP:
https://www.whonix.org/wiki/Dev/DHCP
<p>Main TODO for now:</p>
<ul>
<li>Does DHCP have some feature which a compromised Whonix-Workstation could abuse? Does DHCP have a feature such as “tell me the IP of your upstream router”?<br>
** TODO: Read this stuff…<br>
*** <a href="https://www.ietf.org/rfc/rfc2131.txt">https://www.ietf.org/rfc/rfc2131.txt</a><br>
*** <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol</a>
</li>
</ul>
<p>Help welcome.</p>
<blockquote>The first idea was based on MAC address, but since a MAC address can be spoofed is it better to use switch ports? The goal is to identify each host in the subnet via something and only assign a certain IP address to it, which cannot be changed without the router's express acceptance.</blockquote>
No finished solution for that either.
<p>For basic approaches, see:<br>
</p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Connections_between_Whonix-Gateway_and_Whonix-Workstation" target="_blank" title="07:33PM - 30 March 2020">Whonix – 30 Mar 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:640/452;"><img src="https://www.whonix.org/w/images/9/95/Binary-503583640.jpg" class="thumbnail" width="640" height="452"></div>

<h3><a href="https://www.whonix.org/wiki/Connections_between_Whonix-Gateway_and_Whonix-Workstation" target="_blank">Connections between Whonix-Gateway ™ and Whonix-Workstation ™</a></h3>

<p>Authenticated / Encrypted Connections between Whonix-Gateway ™ and Whonix-Workstation ™, ARP spoofing defense, SSH, OpenVPN, Using additional (isolated) network interfaces</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>I think ARP spoofing defense as mentioned on that wiki page is the most lucrative.</p>
<blockquote>Last but not least, would like to make all the hosts in the subnet not able to talk to each other and only be able to talk to the router. Let's assume for simplicity that the router/gateway has the IP 10.0.8.1 and the other hosts in the subnet are 10.0.8.2 and 10.0.8.3 and 10.0.8.4 
I want 10.0.8.1 to be able to talk to all the hiosts (1)
all the hosts to be able to talk to 10.0.8.1 (2)
all the hosts NOT to be able to talk to each other, except 10.0.8.1 (e.g. 10.0.8.2 -&gt; 10.0.8.4).
<p>Since we talk about hosts on the same subnet, these packets do not go via the router/gateway so not sure if I can filter them there. How can this be accomplished?</p>
</blockquote><br>
Dunno. I advice to wipe “Whonix” from your question. Then make up a question for a simpler, similar environment that does not include Tor-anything. And ask in more specialized places.
<p>Needless to say, if you figure out something. Please report back. Contributions welcome!</p>
          <p><a href="http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804/2</link>
        <pubDate>Thu, 15 Jan 2015 03:26:18 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-804-2</guid>
        <source url="http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804.rss">Gateway iptables rules for Tor and secure IP allocation via DHCP router</source>
      </item>
      <item>
        <title>Gateway iptables rules for Tor and secure IP allocation via DHCP router</title>
        <dc:creator><![CDATA[s7r]]></dc:creator>
        <description><![CDATA[
            <p>Hi,</p>
<p>I would like to configure a basic Debian Wheezy amd64 as a whonix gateway and router for the local network.</p>
<ol>
<li>
<p>Would like the firewall rules (iptables or whatever) as well as the necessary packages to install in order to Torify everything via Tor transparent proxy including DNS so it will be anonymous and also allow hosts to resolve .onion addresses. This should also drop / reject everything non-tcp such as icmp or udp.</p>
</li>
<li>
<p>since this machine will act as a router also, I would like to have some kind of secure IP allocation (DHCP). The first idea was based on MAC address, but since a MAC address can be spoofed is it better to use switch ports? The goal is to identify each host in the subnet via something and only assign a certain IP address to it, which cannot be changed without the router’s express acceptance.</p>
</li>
</ol>
<p>Last but not least, would like to make all the hosts in the subnet not able to talk to each other and only be able to talk to the router. Let’s assume for simplicity that the router/gateway has the IP 10.0.8.1 and the other hosts in the subnet are 10.0.8.2 and 10.0.8.3 and 10.0.8.4<br>
I want 10.0.8.1 to be able to talk to all the hiosts (1)<br>
all the hosts to be able to talk to 10.0.8.1 (2)<br>
all the hosts NOT to be able to talk to each other, except 10.0.8.1 (e.g. 10.0.8.2 -&gt; 10.0.8.4).</p>
<p>Since we talk about hosts on the same subnet, these packets do not go via the router/gateway so not sure if I can filter them there. How can this be accomplished?</p>
          <p><a href="http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804/1</link>
        <pubDate>Thu, 15 Jan 2015 00:25:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-804-1</guid>
        <source url="http://forums.whonix.org/t/gateway-iptables-rules-for-tor-and-secure-ip-allocation-via-dhcp-router/804.rss">Gateway iptables rules for Tor and secure IP allocation via DHCP router</source>
      </item>
  </channel>
</rss>
