<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
    <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596</link>
    <description>I am pretty new here compared to most of you, and probably not half as knowledgeable, but still I&#39;m trying to help out best I can.

For the past two weeks or so I have been messing around with Whonix 14 trying to implement different methods of RAM erasure that I have been able to locate.

I found a guideline on Tails website in their design subject about how they go about it on a page titled &quot;Memory Erasure&quot;. I&#39;m still working on trying to implement that in Whonix, but I have heard of some accomplishing this task on Debian so I feel it could be possible. If I am wrong about that I would love to know why cause I have been working quite hard at implementing it.

Aside from that I have also tried tools like sdmem which was quite easy to use as a solution on shutdown, but I have heard it to not be as effective as one would want. I am also checking out memtest86 as a possible solution, but still I fear that may suffer the same problems.

Has anyone else been working on this feature mostly for the live system that could point me in the right direction, or simply tell me if I am wasting my time. I just think this would be a wonderful feature to be available on Whonix. An amnesiac system with the added security provided by isolation Could really change things. A lot I have spoken with about this idea are quite excited by it so I have been working hard to make it possible, I just don&#39;t know if it is indeed possible or not.

Tails Documentation
----------------------------------------------------------------------------------
https://tails.boum.org/contribute/design/memory_erasure/
----------------------------------------------------------------------------------</description>
    <language>en</language>
    <lastBuildDate>Sat, 13 Aug 2022 20:33:08 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://lists.freedesktop.org/archives/systemd-devel/2022-August/048159.html">[systemd-devel] What is the shutdown sequence with systemd and dracut?</a></p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/47">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/47</link>
        <pubDate>Sat, 13 Aug 2022 20:33:08 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-47</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue" data-onebox-src="https://github.com/dracutdevs/dracut/issues/1888">
  <header class="source">

      <a href="https://github.com/dracutdevs/dracut/issues/1888" target="_blank" rel="noopener">github.com/dracutdevs/dracut</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/dracutdevs/dracut/issues/1888" target="_blank" rel="noopener">dracut should unmount the root encrypted disk `cryptsetup luksClose` during shutdown</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-08-04" data-time="22:15:46" data-timezone="UTC">10:15PM - 04 Aug 22 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          bug
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">**Describe the bug**
dracut does not unmount the root encrypted disk on shutdow<span class="show-more-container"><a href="http://forums.whonix.org" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">n. (Using `cryptsetup luksClose`.)

**Distribution used**
Debian bullseye

**Dracut version**
0.51

**Init system**
systemd

**To Reproduce**

I've wrote a dracut shutdown module that runs `dmsetup ls --target crypt` which reports that an encrypted disk is still open.

https://github.com/Kicksecure/security-misc/blob/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense/wipe-ram.sh#L57

Also searching inside the dracut source code didn't yield any result for closing the encrypted root disk during shutdown.

I am also seeing an error message during shutdown. (These messages are unreadable because shutdown is so quick. So I used a camera to record a video of the shutdown process to see these messages.)

&gt; device-mapper: remote ioctl on host--vg-root failed: Device or resource busy
&gt; device-mapper: remote ioctl on sda5_crypt failed: Device or resource busy
&gt; device-mapper: remote ioctl on host--vg-root failed: Device or resource busy
&gt; Powering off.

That error message is probably caused by `/usr/lib/systemd/systemd-shutdown` because [`shutdown.c`](https://github.com/systemd/systemd/blob/main/src/shutdown/shutdown.c) includes `dm_detach_all`. `log_info("Powering off.");`. That could be a bug in systemd but indicates that dracut exitrd didn't properly clean up by running `cryptsetup luksClose`.

These `Device or resource busy` messages are also reproducible on unmodified systems (no dracut modifications, no custom modules).

Please let me know if you need better instructions how to reproduce this.

**Expected behavior**
dracut performs `cryptsetup luksClose` on shutdown.

**Why should dracut perform `cryptsetup luksClose` on shutdown?**

* Good style.
* Everything dracut does to prepare the system for boot (initrd) should be undone, cleaned up during shutdown (exitrd) if it is reasonable to do so. This includes killing remaining processes, unmounting root and why not also `cryptsetup luksClose`.
* Lower chances of data loss. If the root risk could be unmounted as well as the root luks device. By running `cryptsetup luksClose`, it increases chances that the kernel will flush all cashes and write them to the disk.
* The time effort for `cryptsetup luksClose` on shutdown is really minimal but nice and clean.
* systemd's `/usr/lib/systemd/systemd-shutdown` because [`shutdown.c`](https://github.com/systemd/systemd/blob/main/src/shutdown/shutdown.c) apparently also attempts to unmount the root encrypted luks disk (by calling function `dm_detach_all`).
* Important for RAM wipe at shutdown to make sure (or at least increase chances) of releasing the luks disk encryption key - https://github.com/dracutdevs/dracut/issues/997

----

**Search dracut source code for `luksClose`.**

    grep -r -i luksclose /usr/lib/dracut

`90crypt/crypt-cleanup.sh`

&gt; `cryptsetup luksClose $i &gt;/dev/null 2&gt;&amp;1 &amp;&amp; do_break=n`

`91crypt-loop/crypt-loop-lib.sh`

&gt; `printf "%s\n" "cryptsetup luksClose \"$key\"" &gt; ${hookdir}/cleanup/"crypt-loop-cleanup-10-${key##*/}".sh`

`90crypt/module-setup.sh` defines `inst_hook cleanup 30 "$moddir/crypt-cleanup.sh"` so that isn't about shutdown.

`91crypt-loop/crypt-loop-lib.sh` isn't about shutdown either.

I also couldn't find any `inst_hook shutdown` for any crypto related dracut module.

    grep -r -i hook /usr/lib/dracut | grep --color -i shutdown

`99shutdown/shutdown.sh` runs `umount` but nothing related to crypto.

In conclusion, I don't think that anything like "`cryptsetup luksClose`" at shutdown is currently implemented in dracut.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/46">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/46</link>
        <pubDate>Thu, 04 Aug 2022 22:16:14 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-46</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="44" data-topic="5596" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Future design (additional kexec based RAM wipe) has been elaborated:<br>
<a href="https://www.kicksecure.com/wiki/Dev/RAM_Wipe#Future_Design" class="inline-onebox">RAM Wipe Development Notes</a></p>
</blockquote>
</aside>
<p>I’ll try to assign this task to implement also the future design to a contractor. Hopefully there will be a good news soon.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/45">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/45</link>
        <pubDate>Mon, 18 Jul 2022 09:38:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-45</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Future design (additional kexec based RAM wipe) has been elaborated:<br>
<a href="https://www.kicksecure.com/wiki/Dev/RAM_Wipe#Future_Design">https://www.kicksecure.com/wiki/Dev/RAM_Wipe#Future_Design</a></p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/44">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/44</link>
        <pubDate>Tue, 12 Jul 2022 17:15:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-44</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Huge progress has been made.</p>
<p>Implemented by dracut module <a href="https://github.com/Kicksecure/security-misc/tree/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense"><code>cold-boot-attack-defense</code></a> (by <a href="https://www.kicksecure.com/wiki/Security-misc">security-misc</a>).</p>
<p>Will in near future be available for Kicksecure hosts. Should be easy to port to other Linux distributions.</p>
<p>See design documentation, review welcome:</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.kicksecure.com/wiki/Dev/RAM_Wipe">
  <header class="source">
      <img src="https://www.kicksecure.com/w/images/4/45/Kicksecure-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="https://www.kicksecure.com/wiki/Dev/RAM_Wipe" target="_blank" rel="noopener" title="12:22PM - 03 July 2022">Kicksecure – 3 Jul 22</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://www.kicksecure.com/wiki/Dev/RAM_Wipe" target="_blank" rel="noopener">RAM Wipe Development Notes</a></h3>

  <p>Implementation notes.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>More documentation, call for testers coming in near future.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/43">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/43</link>
        <pubDate>Sun, 03 Jul 2022 13:01:15 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-43</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue" data-onebox-src="https://github.com/dracutdevs/dracut/issues/1862">
  <header class="source">

      <a href="https://github.com/dracutdevs/dracut/issues/1862" target="_blank" rel="noopener">github.com/dracutdevs/dracut</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/dracutdevs/dracut/issues/1862" target="_blank" rel="noopener">dracut-shutdown.service lacks DRACUT_SYSTEMD=1 environment variable</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-07-02" data-time="20:42:25" data-timezone="UTC">08:42PM - 02 Jul 22 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          bug
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">**Describe the bug**

dracut-shutdown.service lacks DRACUT_SYSTEMD=1 environme<span class="show-more-container"><a href="http://forums.whonix.org" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">nt variable

**Distribution used**

Debian but easily seen in dracut upstream source code:
https://github.com/dracutdevs/dracut/blob/master/modules.d/98dracut-systemd/dracut-shutdown.service#L11

**Dracut version**
latest git

**Init system**
systemd

**To Reproduce**
Write a shutdown hook and check for DRACUT_SYSTEMD variable existence.

**Expected behavior**
DRACUT_SYSTEMD=1 environment variable should be set during 

**Additional context**

dracut-lib.sh looks at the DRACUT_SYSTEMD environment variable. For example, the `info` and `warn` functions of dracut-lib.sh require a properly set DRACUT_SYSTEMD.

All other dracut systemd units in https://github.com/dracutdevs/dracut/blob/master/modules.d/98dracut-systemd/ are setting the DRACUT_SYSTEMD environment variable too.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox githubpullrequest" data-onebox-src="https://github.com/dracutdevs/dracut/pull/1863">
  <header class="source">

      <a href="https://github.com/dracutdevs/dracut/pull/1863" target="_blank" rel="noopener">github.com/dracutdevs/dracut</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/dracutdevs/dracut/pull/1863" target="_blank" rel="noopener">fix(dracut-systemd): set Environment=DRACUT_SYSTEMD=1 environment variable in dracut-shutdown.service</a>
    </h4>

    <div class="branches">
      <code>dracutdevs:master</code> ← <code>adrelanos:patch-1</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-07-02" data-time="20:42:44" data-timezone="UTC">08:42PM - 02 Jul 22 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 1 additions and 0 deletions">
        <a href="https://github.com/dracutdevs/dracut/pull/1863/files" target="_blank" rel="noopener">
          <span class="added">+1</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">## Changes

* set Environment=DRACUT_SYSTEMD=1 environment variable in dracut-<span class="show-more-container"><a href="https://github.com/dracutdevs/dracut/pull/1863" target="_blank" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">shutdown.service

## Checklist
- [x] I have tested it locally
- [x] I have reviewed and updated any documentation if relevant: none required
- [x] I am providing new code and test(s) for it: none required

Fixes #1862</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/42">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/42</link>
        <pubDate>Sat, 02 Jul 2022 20:43:25 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-42</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[TNT_BOM_BOM]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="40" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<pre><code class="lang-auto">sudo apt install sdmem time
</code></pre>
</blockquote>
</aside>
<p><a href="https://packages.debian.org/bullseye/secure-delete" rel="noopener nofollow ugc">secure-delete</a>* package name in debian (sdmem: secure-delete memory)</p>
<aside class="quote no-group" data-username="Patrick" data-post="40" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<pre><code class="lang-auto">time sudo sdmem -v
</code></pre>
</blockquote>
</aside>
<p>Wipe mode is secure (38 special passes)<br>
Using /dev/urandom for random input.</p>
<p>real    1m40.819s<br>
user   0m0.072s<br>
sys    0m0.163s</p>
<aside class="quote no-group" data-username="Patrick" data-post="40" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>time sudo sdmem -l -l -v</p>
</blockquote>
</aside>
<p>Wipe mode is insecure (one pass with 0x00)</p>
<p>real   0m0.503s<br>
user  0m0.008s<br>
sys   0m0.089s</p>
<aside class="quote no-group" data-username="Patrick" data-post="40" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Note: There’s a chance it might freeze a VM or host operating system. It didn’t happen to me yet but better to have this in mind.</p>
</blockquote>
</aside>
<p>Happen to me, i opened xfce-terminal and start moving it right and left until the screen freezed permanently (play for less than 3 minutes with anything like browse some stuff and open close terminal…).</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/41">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/41</link>
        <pubDate>Wed, 29 Jun 2022 23:28:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-41</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Could you please test the <a href="https://manpages.debian.org/sdmem" class="inline-onebox">sdmem(1) — secure-delete — Debian bullseye — Debian Manpages</a> command. Check the timing. How long the command requires to complete. Because the same time will be required on every reboot / shutdown.</p>
<p>Note: There’s a chance it might freeze a VM or host operating system. It didn’t happen to me yet but better to have this in mind.</p>
<p>Installation:</p>
<pre><code>sudo apt update
sudo apt install secure-delete time
</code></pre>
<p>Disabling swap is required. Otherwise smem would fill up all RAM and the system highly likely to permanently freeze.</p>
<pre><code>sudo swapoff --all
</code></pre>
<p>To verify that swap is off:</p>
<pre><code>sudo swapon --show ; echo $?
</code></pre>
<p>Expected output:</p>
<blockquote>
<p>0</p>
</blockquote>
<hr>
<p>Built-in help:</p>
<pre><code>sudo sdmem -h
</code></pre>
<hr>
<p>Default mode:</p>
<pre><code>time sudo sdmem
</code></pre>
<hr>
<p>Verbose mode:</p>
<pre><code>time sudo sdmem -v
</code></pre>
<p>Probably better because it shows some progress.</p>
<hr>
<p>For just a single pass of RAM wipe with zeros:</p>
<ul>
<li>without verbose mode:
<ul>
<li>
<blockquote>
<p>time sudo sdmem -l -l</p>
</blockquote>
</li>
</ul>
</li>
<li>with verbose mode:
<ul>
<li>
<blockquote>
<p>time sudo sdmem -l -l -v</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<hr>
<p>The <code>time</code> command is optional. Can be dropped. But useful here to measure how long it takes.</p>
<hr>
<p>Default mode does, quote:</p>
<blockquote>
<p>27 passes with special values defined by Peter Gutmann.</p>
</blockquote>
<p>Not sure that is really necessary because if I remember right, Peter Gutmann was about hard drives, not RAM. Is there any research how many passes RAM wipe requires?</p>
<hr>
<p>Should RAM wipe be skipped inside VMs for faster reboot / shutdown times? I am not sure about the dynamics of RAM wipe in VMs. In worst case, the VM might start use swap file on the host operating system. Therefore I tend to say RAM wipe should be skipped if a VM is detected.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/40">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/40</link>
        <pubDate>Wed, 29 Jun 2022 21:45:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-40</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Review welcome.</p>
<ul>
<li><a href="https://github.com/Kicksecure/security-misc/tree/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense" class="inline-onebox">security-misc/usr/lib/dracut/modules.d/40cold-boot-attack-defense at master · Kicksecure/security-misc · GitHub</a></li>
<li><a href="https://github.com/Kicksecure/security-misc/blob/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense/module-setup.sh">https://github.com/Kicksecure/security-misc/blob/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense/module-setup.sh</a></li>
<li><a href="https://github.com/Kicksecure/security-misc/blob/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense/wipe-ram-needshutdown.sh">https://github.com/Kicksecure/security-misc/blob/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense/wipe-ram-needshutdown.sh</a></li>
<li><a href="https://github.com/Kicksecure/security-misc/blob/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense/wipe-ram.sh">https://github.com/Kicksecure/security-misc/blob/master/usr/lib/dracut/modules.d/40cold-boot-attack-defense/wipe-ram.sh</a></li>
</ul>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/39">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/39</link>
        <pubDate>Wed, 29 Jun 2022 20:57:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-39</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><code>dracut</code> upstream pull request:</p>
<aside class="onebox githubpullrequest" data-onebox-src="https://github.com/dracutdevs/dracut/pull/1858">
  <header class="source">

      <a href="https://github.com/dracutdevs/dracut/pull/1858" target="_blank" rel="noopener">github.com/dracutdevs/dracut</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/dracutdevs/dracut/pull/1858" target="_blank" rel="noopener">Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks</a>
    </h4>

    <div class="branches">
      <code>dracutdevs:master</code> ← <code>friedy10:master</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-06-29" data-time="11:25:44" data-timezone="UTC">11:25AM - 29 Jun 22 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>

      <div class="lines" title="3 commits changed 3 files with 28 additions and 0 deletions">
        <a href="https://github.com/dracutdevs/dracut/pull/1858/files" target="_blank" rel="noopener">
          <span class="added">+28</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">Purpose of this pull request: Receiving some early feedback if this approach loo<span class="show-more-container"><a href="https://github.com/dracutdevs/dracut/pull/1858" target="_blank" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">ks acceptable.

* Work in progress.
* Console output are yet to be improved and documentation written.
* Untested by me. Will test soon.
* Tests I am not sure yet how this could realistically be tested.

## Changes

* Confirm in console output if encrypted mounts (root disk) is unmounted. (Because that is a pre-condition for wiping the LUKS full disk encryption key from RAM.)
* Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks.

## Checklist
- [ ] I have tested it locally
- [ ] I have reviewed and updated any documentation if relevant
- [ ] I am providing new code and test(s) for it

Fixes #997</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/38">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/38</link>
        <pubDate>Wed, 29 Jun 2022 11:26:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-38</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><code>dracut</code> upstream feature request:<br>
</p><aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/dracutdevs/dracut/issues/997" target="_blank" rel="noopener">github.com/dracutdevs/dracut</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/dracutdevs/dracut/issues/997" target="_blank" rel="noopener">Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-12-29" data-time="17:18:06" data-timezone="UTC">05:18PM - 29 Dec 20 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Is your feature request related to a problem? Please describe.
Defeat Cold Boot Attacks by wiping LUKS disk encryption during shutdown.
What is...</p>
</div>

<div class="labels">
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">enhancement</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/37">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/37</link>
        <pubDate>Tue, 29 Dec 2020 17:17:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-37</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Debian <code>dracut</code> feature request:<br>
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=978644">Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks from Dracut Initramfs</a></p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/36">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/36</link>
        <pubDate>Tue, 29 Dec 2020 17:06:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-36</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="34" data-topic="5596" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Debian feature request:<br>
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=978642">Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks from Initial Ramdisk (initramfs-tools or dracut)</a></p>
</blockquote>
</aside>
<blockquote>
<p>Control: severity -1 wishlist<br>
Control: reassign -1 cryptsetup-initramfs<br>
Control: block -1 by 778849</p>
<p>Hi,</p>
<p>AFAICT dracut has dracut-shutdown(8) which you can extend at will, or<br>
convince the maintainer to ship the required logic for everyone.<br>
However Debian’s default initramfs, namely initramfs-tools(7) currently<br>
has no interface to hook into at shutdown, and init doesn’t even hand<br>
execution over to the initramfs during the shutdown phase (<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=778849"><code>#778849</code></a>).<br>
When such an interface is available we can ship shutdown scripts into<br>
cryptsetup-initramfs.</p>
<p>cheers<br>
<code>-- </code><br>
Guilhem.</p>
</blockquote>
<p>related:<br>
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=778849">Support restoring initrd on shutdown and pivoting into it (<code>#778849</code>)</a></p>
<p>Maybe a good reason for <a href="https://forums.whonix.org/t/replacing-initramfs-tools-with-dracut/4487" class="inline-onebox">replacing initramfs-tools with dracut</a>.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/35">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/35</link>
        <pubDate>Tue, 29 Dec 2020 16:38:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-35</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Debian feature request:<br>
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=978642">Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks from Initial Ramdisk (initramfs-tools or dracut)</a></p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/34">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/34</link>
        <pubDate>Tue, 29 Dec 2020 15:52:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-34</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="32" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<h4><a href="https://github.com/systemd/systemd/issues/17887">Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks</a></h4>
</blockquote>
</aside>
<p><a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a>:</p>
<blockquote>
<p>Avoiding all sidelines, keeping this simple, for my understanding and for the record and please correct me if I am wrong… Summary:</p>
<p><code>"cryptsetup close" of root device during shutdown</code> is already implemented.</p>
</blockquote>
<p>@<a href="https://github.com/poettering">poettering</a>:</p>
<blockquote>
<blockquote>
<p><code>"cryptsetup close" of root device during shutdown</code> is already implemented.</p>
</blockquote>
<p>iff your initrd/distro of choice do so. For the root disk it doesn’t matter what systemd does, it matters what the initrd/distro do. hence ping the maintainers of those.</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/33">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/33</link>
        <pubDate>Tue, 29 Dec 2020 14:47:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-33</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/systemd/systemd/issues/17887" target="_blank" rel="noopener">github.com/systemd/systemd</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/systemd/systemd/issues/17887" target="_blank" rel="noopener">Wipe LUKS Disk Encryption Key for Root Disk from RAM during Shutdown to defeat Cold Boot Attacks</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-12-07" data-time="19:30:47" data-timezone="UTC">07:30PM - 07 Dec 20 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2020-12-07" data-time="20:23:14" data-timezone="UTC">08:23PM - 07 Dec 20 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Is your feature request related to a problem? Please describe.
https://www.youtube.com/watch?v=JDaicPIgn9U
https://en.wikipedia.org/wiki/Cold_boot_attack
https://blog.f-secure.com/cold-boot-attacks/
https://www.usenix.org/legacy/event/sec08/tech/full_papers/halderman/halderman.pdf
Describe the solution you'd like
Run cryptsetup close at end of shutdown procedure.
Quote...</p>
</div>

<div class="labels">
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">already-implemented</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">cryptsetup</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/32">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/32</link>
        <pubDate>Tue, 08 Dec 2020 11:16:03 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-32</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Dev/RAM_Wipe" target="_blank" rel="noopener" title="07:30PM - 07 December 2020">Whonix – 7 Dec 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:132/69;"><img src="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail" width="132" height="69"></div>

<h3><a href="https://www.whonix.org/wiki/Dev/RAM_Wipe" target="_blank" rel="noopener">RAM Wipe Development Notes</a></h3>

<p>cryptsetup-suspend could take care of removing LUKS master key from memory before system shutdown or suspend.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/31">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/31</link>
        <pubDate>Tue, 08 Dec 2020 11:15:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-31</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote quote-modified" data-post="1" data-topic="10393">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="https://forums.whonix.org/t/enable-secure-memory-encryption-sme-kernel-parameter-mem-encrypt-by-default/10393">Enable Secure Memory Encryption (SME) - kernel parameter mem_encrypt - by default?</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development/8"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    AMD CPU part: 
<a href="https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html" class="onebox" target="_blank">https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html</a> 

    mem_encrypt=    [X86-64] AMD Secure Memory Encryption (SME) control
                    Valid arguments: on, off
                    Default (depends on kernel configuration option):
                      on  (CONFIG_AMD_MEM_ENCRYPT_ACTIVE_BY_DEFAULT=y)
                      off (CONFIG_AMD_MEM_ENCRYPT_ACTIVE_BY_DEFAULT=n)
                    mem_encrypt=on:         Activate SME
                    mem…
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/30">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/30</link>
        <pubDate>Fri, 09 Oct 2020 12:05:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-30</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="27" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Is it worth porting the Tails magic to Whonix / Kicksecure?</p>
</blockquote>
</aside>
<p>Yes, we can’t wipe as much RAM without it but it seems complicated to implement.</p>
<aside class="quote no-group" data-username="Patrick" data-post="27" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Even if RAM wipe by Linux kernel without firmware support would not be complete it could still per perfect and it could certainly better than anything doable in user space such as the Tails implementation.</p>
</blockquote>
</aside>
<p>The kernel already has a RAM wiping function, <code>init_on_free</code> which is what Tails uses. Tails just improves this and makes it wipe more by returning to the initramfs upon shutdown and unmounting the filesystem, thereby freeing more memory and having it wiped.</p>
<p>This essentially wipes all user space memory which is the most important part but leaves some kernel memory as the kernel cannot wipe itself hence why a complete implementation must be done at a lower level.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/29">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/29</link>
        <pubDate>Tue, 06 Oct 2020 19:58:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-29</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="27" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Probably user space couldn’t wipe the kernel memory holding the FDE key (unless there is a kernel API for that which would be related but separate).</p>
</blockquote>
</aside>
<p>Any userspace to kernel memory has been greatly limited by security changes to Linux in recent years. A lot of attacks were basically about doing that to root the system. Unlikely that the memory erasure test can tell you anything about data remnance related to the kernel. This is done in more complicated way according to the cold boot attack papers.</p>
<p>You cannot trust third party firmware to do the wiping for you as they could be buggy or maliciously designed to not do a good job.</p>
<aside class="quote no-group" data-username="Patrick" data-post="27" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>On that view, wiping RAM might make sense for a live system such as Tails or Whonix / Kicksecure Host Live Mode (specifically when not using encrypted persistence) but would it also make sense for an FDE Whonix-Host or FDE Kicksecure-Host?</p>
</blockquote>
</aside>
<p>You should make a poll to see how many DRAM 2 systems are in use and or have non-removable batteries. Note that for the latter this isn’t guaranteed to aid data remnance, but may in some cases do unlike older RAM families which will always have slower data decay.</p>
<p>Summary: only a kernel solution makes sense and it is only worth pursuing if a substantial (20%+) number of systems need it.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/28">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/28</link>
        <pubDate>Tue, 06 Oct 2020 18:10:18 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-28</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Is it worth porting the Tails magic to Whonix / Kicksecure?</p>
<p>My post is presupposing that one has read this page beforehand:<br>
<a href="https://tails.boum.org/contribute/design/memory_erasure/" class="inline-onebox">Tails - Memory erasure</a></p>
<p>Tails has a test for this:<br>
<a href="https://0xacab.org/tails/tails/-/blob/master/features/erase_memory.feature" class="inline-onebox">features/erase_memory.feature · master · tails / tails · GitLab</a></p>
<p>^ that is a test definition file but pretty cool and human readable.</p>
<p>The test concludes with:</p>
<blockquote>
<p>Then I find very few patterns in the guest’s memory</p>
</blockquote>
<p>Which means the definition (the actual not so easily readable implementation of that human readable summary in source code) has some acceptance for leftover memory traces. Here it is:<br>
<a href="https://gitlab.tails.boum.org/tails/tails/-/blob/master/features/erase_memory.feature" class="inline-onebox">features/erase_memory.feature · master · tails / tails · GitLab</a></p>
<p>Relevant part:</p>
<pre><code>max_coverage = 0.008
</code></pre>
<p>I.e. less then 0.008% of the pattern which the test wrote can be found.</p>
<p>Is this 0.008% important or anything else not covered by the RAM wipe?</p>
<p>See also this for leftovers in RAM that cannot be wiped by Tails implementation:<br>
<a href="https://web.archive.org/web/20180628102336/https://mailman.boum.org/pipermail/tails-dev/2017-January/011134.html" class="onebox" target="_blank" rel="noopener">https://web.archive.org/web/20180628102336/https://mailman.boum.org/pipermail/tails-dev/2017-January/011134.html</a></p>
<p>Some things such as importantly, full disk encryption (FDE) is handled by the kernel. Probably user space couldn’t wipe the kernel memory holding the FDE key (unless there is a kernel API for that which would be related but separate).</p>
<p>On that view, wiping RAM might make sense for a live system such as Tails or Whonix / Kicksecure Host Live Mode (specifically when not using encrypted persistence) but would it also make sense for an FDE Whonix-Host or FDE Kicksecure-Host?</p>
<p>Without actual memory forensics we would not really know how severe any RAM wipe leftovers would be. If it includes the FDE key, then wiping the rest was worth little.</p>
<p>Even if RAM wipe by Linux kernel without firmware support would not be complete it could still per perfect and it could certainly better than anything doable in user space such as the Tails implementation. The kernel can certainly has the power to wipe any program from RAM since these are below the kernel in the hierarchy. And the kernel would not have to wipe things where the kernel knows that wiping these memory parts is not important because these are public anyhow, not private/secrets, or recoverable from the hard drive (assuming unencrypted <code>/boot</code>).</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/27">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/27</link>
        <pubDate>Tue, 06 Oct 2020 18:01:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-27</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="25" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does the kernel also support RAM wipe if the firmware does not support it?</p>
</blockquote>
</aside>
<p>Apart from <code>init_on_free</code> and so on, no.</p>
<aside class="quote no-group" data-username="Patrick" data-post="25" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If no, worth writing a feature request against the kernel?</p>
</blockquote>
</aside>
<p>No, the firmware is what wipes RAM. The kernel just enables that feature in the firmware. The kernel isn’t able to wipe all of the RAM itself which is why it must be done at a lower level like the firmware or Tails’ magic.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/26">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/26</link>
        <pubDate>Mon, 05 Oct 2020 19:44:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-26</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="22" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>systemd feature request: <a href="https://github.com/systemd/systemd/issues/17242">Wipe RAM to defeat Cold Boot Attacks</a></p>
</blockquote>
</aside>
<p>In summary: says cannot be implemented using systemd. Should be done by the kernel.</p>
<p>Quote Lennart Poettering:</p>
<blockquote>
<p>Uh, we can’t do that from userspace, we don’t even et access to that. This is something that needs to be implemented in the kernel, for example with a magic sysrq thing.</p>
<p>I think this feature requests has merits, but it really needs to be filed against the kernel as a feature request, systemd is not the right place where we could implement that.</p>
<p>Closing this here hence, I hope that makes sense?</p>
</blockquote>
<aside class="quote no-group" data-username="madaidan" data-post="23" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>hardened-host-kernel also enables <code>CONFIG_RESET_ATTACK_MITIGATION</code> to wipe memory if the firmware supports it.</p>
</blockquote>
</aside>
<p>Quote <a href="https://cateee.net/lkddb/web-lkddb/RESET_ATTACK_MITIGATION.html">https://cateee.net/lkddb/web-lkddb/RESET_ATTACK_MITIGATION.html</a></p>
<blockquote>
<p>Request that the firmware clear the contents of RAM after a reboot using the TCG Platform Reset Attack Mitigation specification. This protects against an attacker forcibly rebooting the system while it still contains secrets in RAM, booting another OS and extracting the secrets. This should only be enabled when userland is configured to clear the MemoryOverwriteRequest flag on clean shutdown after secrets have been evicted, since otherwise it will trigger even on clean reboots.</p>
</blockquote>
<p>So the kernel has support for RAM wipe when firmware supports it.</p>
<p>Does the kernel also support RAM wipe if the firmware does not support it? If no, worth writing a feature request against the kernel?</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/25">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/25</link>
        <pubDate>Mon, 05 Oct 2020 11:06:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-25</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="23" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We should advise users in the wiki to properly shutdown so this kicks in rather than forcing a shutdown (i.e. pulling the plug).</p>
</blockquote>
</aside>
<p>Some documentation on cold boot attack defense is indeed required.</p>
<p>I was wondering to add it here: <a href="https://www.whonix.org/wiki/Full_Disk_Encryption">https://www.whonix.org/wiki/Full_Disk_Encryption</a> (FDE) - but strictly while it matters a lot for FDE it also matters for non-FDE and use with <a href="https://www.whonix.org/wiki/Host_Live_Mode">https://www.whonix.org/wiki/Host_Live_Mode</a>. Created a stub here and added links to it:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Cold_Boot_Attack_Defense" target="_blank" title="09:41AM - 05 October 2020">Whonix – 5 Oct 20</a>
  </header>
  <article class="onebox-body">
    <img src="https://www.whonix.org/w/resources/assets/wiki.png" class="thumbnail onebox-avatar" width="60" height="60">

<h3><a href="https://www.whonix.org/wiki/Cold_Boot_Attack_Defense" target="_blank">Cold Boot Attack Defense</a></h3>

<p>Wipe RAM to prevent information extracted from memory.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/24">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/24</link>
        <pubDate>Mon, 05 Oct 2020 09:42:03 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-24</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
      <item>
        <title>Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="21" data-topic="5596">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>That part was implemented into security-misc during <a href="https://forums.whonix.org/t/kernel-hardening/7296">Kernel Hardening</a></p>
</blockquote>
</aside>
<p>We should advise users in the wiki to properly shutdown so this kicks in rather than forcing a shutdown (i.e. pulling the plug).</p>
<p>hardened-host-kernel also enables <code>CONFIG_RESET_ATTACK_MITIGATION</code> to wipe memory if the firmware supports it.</p>
          <p><a href="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/23">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596/23</link>
        <pubDate>Sun, 04 Oct 2020 14:44:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5596-23</guid>
        <source url="http://forums.whonix.org/t/is-ram-wipe-possible-inside-whonix-cold-boot-attack-defense/5596.rss">Is RAM Wipe possible inside Whonix? Cold Boot Attack Defense</source>
      </item>
  </channel>
</rss>
