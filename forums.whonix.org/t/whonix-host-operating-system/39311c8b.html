<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Whonix host operating system - Development - Whonix Forum</title>
    <meta name="description" content="There is already some discussion ongoing in the Whonix-Live mode thread but I guess a dedicated thread is more suitable. 
What would you consider important for an (official) Whonix host OS? 
Which OS should be used? 
Sim&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="39311c8b.html?page=11" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Whonix host operating system&#39;" href="3931.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/whonix-host-operating-system/3931?page=11" />
<meta name="twitter:url" content="https://forums.whonix.org/t/whonix-host-operating-system/3931?page=11" />
<meta property="og:title" content="Whonix host operating system" />
<meta name="twitter:title" content="Whonix host operating system" />
<meta property="og:description" content="Yes  Maybe the problem onion_knight ran into was caused by incorrect order of operations?   Yes   Seems redundant. qcow2 does the optimal compression by default IIRC. I will read more.  EDIT:  We already do the best we can in the compression department.     Of course the degree of compression you get depends on the amount of zeroed free space in the image, and the amount by which qcow2 is able to compress the other blocks containing data.  qcow2 uses zlib for compression, so the compression won..." />
<meta name="twitter:description" content="Yes  Maybe the problem onion_knight ran into was caused by incorrect order of operations?   Yes   Seems redundant. qcow2 does the optimal compression by default IIRC. I will read more.  EDIT:  We already do the best we can in the compression department.     Of course the degree of compression you get depends on the amount of zeroed free space in the image, and the amount by which qcow2 is able to compress the other blocks containing data.  qcow2 uses zlib for compression, so the compression won..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="87 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="211 ‚ù§" />
<meta property="article:published_time" content="2020-03-25T15:08:54+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="39311448.html?page=10">
        <link rel="next" href="3931ce37.html?page=12">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="3931.html">Whonix host operating system</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/component_whonix-host.html' class='discourse-tag' rel="tag">component_whonix-host</a>, 
            <a href='../../tag/status_open_issue_todo.html' class='discourse-tag' rel="tag">status_open_issue_todo</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-25T15:08:54Z' class='post-time'>
                March 25, 2020,  3:08pm
              </time>
              <meta itemprop='dateModified' content='2020-03-25T15:16:50Z'>
          <span itemprop='position'>#205</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="203" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Don‚Äôt we create a sparse qcow2 image here? //cc <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
</blockquote>
</aside>
<p>Yes</p>
<p>Maybe the problem onion_knight ran into was caused by incorrect order of operations?</p>
<aside class="quote no-group" data-username="Patrick" data-post="203" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>And then don‚Äôt we copy the sparse qcow2 image as sparse qcow2 image into the Whonix-Host raw image?</p>
</blockquote>
</aside>
<p>Yes</p>
<aside class="quote no-group" data-username="Patrick" data-post="203" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>We convert qcow2 to qcow2? At what point that command says ‚Äúuse compression‚Äù?</p>
</blockquote>
</aside>
<p>Seems redundant. qcow2 does the optimal compression by default IIRC. I will read more.</p>
<p>EDIT:</p>
<p>We already do the best we can in the compression department.</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://s1.wp.com/i/favicon.ico" class="site-icon" width="32" height="32">
      <a href="../../../external.html?link=https://rwmj.wordpress.com/2010/05/18/tip-compress-raw-disk-images-using-qcow2/" target="_blank" title="02:16PM - 18 May 2010">Richard WM Jones ‚Äì 18 May 10</a>
  </header>
  <article class="onebox-body">
    <img src="../../../external.html?link=https://s0.wp.com/i/blank.jpg" class="thumbnail onebox-avatar" width="200" height="200">

<h3><a href="../../../external.html?link=https://rwmj.wordpress.com/2010/05/18/tip-compress-raw-disk-images-using-qcow2/" target="_blank">Tip: compress raw disk images using qcow2</a></h3>

<p>$ qemu-img convert -c -f raw -O qcow2 win.img winq.img $ ls -lh win* -rw-r‚Äìr‚Äì. 1 root root 10G May 18 14:34 win.img -rw-r‚Äìr‚Äì. 1 rjones rjones 6.5G May 18 14:59 winq.img Of c‚Ä¶</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<blockquote>
<p>Of course the degree of compression you get depends on the amount of zeroed free space in the image, and the amount by which qcow2 is able to compress the other blocks containing data.</p>
<p><a href="../../../external.html?link=http://people.gnome.org/~markmc/qcow-image-format.html">qcow2 uses zlib for compression</a>, so the compression won‚Äôt be that spectacular. It‚Äôs better to keep the filesystems ‚Äúsparse‚Äù in the first place, by ensuring unused disk blocks are zeroed.</p>
<p>For ext2/3 filesystems, Fedora ships a utility called <a href="../../../external.html?link=http://intgat.tigress.co.uk/rmy/uml/sparsify.html">zerofree</a>, which you can either run inside the guest, or <a href="../../../external.html?link=http://libguestfs.org/guestfish.1.html#zerofree">run offline from guestfish</a>. This turns unused filesystem blocks into zeroes, which will make outside compression eg with qcow2 much more efficient. For other filesystems, the usual trick is to create a large file of all zeroes until you fill up the free space, then delete it.</p>
</blockquote>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>
          <meta itemprop='keywords' content='component_whonix-host, status_open_issue_todo'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-25T18:51:11Z' class='post-time'>
                March 25, 2020,  6:51pm
              </time>
              <meta itemprop='dateModified' content='2020-03-25T20:07:55Z'>
          <span itemprop='position'>#206</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>As I said I don‚Äôt think it‚Äôs a compression issue, I think it is related to how Calamares ‚Äúperceives‚Äù the gw/ws VM size when it <code>rsync</code> the ISO squashfs filesystem into the install target. When copying .qcow2 files created by <code>cp --sparse</code> it interprets their virtual 101G size as a real size, whereas when copying .qcow2 files obtained with <code>qemu-img convert</code>, it sticks to their actual size.</p>
<p>See also <code>ls</code> command output:</p>
<pre><code>user@host:~$ ls -lh Whonix-Gateway-15.0.1.0.7.qcow2 
-rw-r--r--  1 user user 101G Mar 22 18:30 Whonix-Gateway-15.0.1.0.7.qcow2
user@host:~$ cp --sparse=always Whonix-Gateway-15.0.1.0.7.qcow2 Whonix-Gateway-cp-sparse.qcow2     
user@host:~$ qemu-img convert -f qcow2 -O qcow2 Whonix-Gateway-15.0.1.0.7.qcow2 Whonix-Gateway-qemu-img.qcow2
user@host:~$ ls -lh Whonix-Gateway-*
-rw-r--r-- 1 user user 101G Mar 22 18:30 Whonix-Gateway-15.0.1.0.7.qcow2
-rw-r--r-- 1 user user 101G Mar 25 18:31 Whonix-Gateway-cp-sparse.qcow2
-rw-r--r-- 1 user user 2.5G Mar 25 18:32 Whonix-Gateway-qemu-img.qcow2</code></pre>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-26T21:24:27Z' class='post-time'>
                March 26, 2020,  9:24pm
              </time>
              <meta itemprop='dateModified' content='2020-03-26T21:24:27Z'>
          <span itemprop='position'>#207</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="203" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Awesome!</p>
<p>Packages: yes, please add here <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/blob/master/debian/control" rel="nofollow noopener">https://github.com/Whonix/anon-meta-packages/blob/master/debian/control</a></p>
</blockquote>
</aside>
<p>See pull request. Added packages as dependencies for whonix-host-xfce-kvm-freedom. Not sure it‚Äôs the right place to have them?<br>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/pull/22" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-meta-packages</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/pull/22" target="_blank" rel="nofollow noopener">Update control</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ‚Üê <code>onions-knight:patch-1</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-03-26" data-time="20:52:28" data-timezone="UTC">08:52PM - 26 Mar 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/onions-knight" target="_blank" rel="nofollow noopener">
          <img alt="onions-knight" src="../../../external.html?link=https://avatars2.githubusercontent.com/u/38859709?v=4" class="onebox-avatar-inline" width="20" height="20">
          onions-knight
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 1 additions and 0 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/pull/22/files" target="_blank" rel="nofollow noopener">
          <span class="added">+1</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="203" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<p>Don‚Äôt we create a sparse qcow2 image here? //cc <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
</blockquote>
<p>Yes</p>
<p>Maybe the problem onion_knight ran into was caused by incorrect order of operations?</p>
<blockquote>
<p>And then don‚Äôt we copy the sparse qcow2 image as sparse qcow2 image into the Whonix-Host raw image?</p>
</blockquote>
<p>Yes</p>
</blockquote>
</aside>
<p>It‚Äôs definitely weird, as during the build qcow2 images are actually created using <code>qemu-img convert</code><br>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/Whonix/blob/master/build-steps.d/2400_convert-raw-to-qcow2#L37" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../external.html?link=https://github.com/Whonix/Whonix/blob/master/build-steps.d/2400_convert-raw-to-qcow2#L37" target="_blank" rel="nofollow noopener">Whonix/Whonix/blob/master/build-steps.d/2400_convert-raw-to-qcow2#L37</a></h4>
<pre class="onebox"><code class="lang-d/2400_convert-raw-to-qcow2"><ol class="start lines" start="27" style="counter-reset: li-counter 26 ;">
<li>sudo $SUDO_OPTS mkdir --parents "$WHONIX_BINARY/"</li>
<li>
</li>
<li>## Debugging.</li>
<li>sudo $SUDO_OPTS \</li>
<li>   qemu-img \</li>
<li>      info \</li>
<li>         "$binary_image_raw"</li>
<li>
</li>
<li>## Create qcow2 image form raw image.</li>
<li>## VMSIZE defaults to 100G as per help-steps/variables.</li>
<li class="selected">sudo $SUDO_OPTS \</li>
<li>   qemu-img \</li>
<li>      convert \</li>
<li>         -p \</li>
<li>         -O qcow2 \</li>
<li>         -o cluster_size=2M \</li>
<li>         -o preallocation=metadata \</li>
<li>         "$binary_image_raw" \</li>
<li>         "$binary_image_qcow2"</li>
<li>
</li>
<li>## Debugging.</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<p>But this is an empiric observation that I already did in the past: when using <code>qemu-img convert</code> in Whonix script, size is kept at 101G (although it‚Äôs a virtual size). When using <code>qemu-img convert</code> manually outside the script on the same files, the resulting qcow2 images are shown as using their real size, i.e. approximately 2.5G. I don‚Äôt have an explanation for that. Tested again just now:</p>
<pre><code>user@host:~$ ls -lh Whonix-Gateway-XFCE-15.0.1.0.7.raw
-rw-r--r-- 1 user user 100G Mar 26 22:17 Whonix-Gateway-XFCE-15.0.1.0.7.raw
user@host:~$ qemu-img convert -f raw -O qcow2 Whonix-Gateway-XFCE-15.0.1.0.7.raw Whonix-Gateway-XFCE-15.0.1.0.7.test-qemu-img.qcow2
user@host:~$ ls -lh Whonix-Gateway-XFCE-15.0.1.0.7.*
-rw-r--r-- 1 user user 100G Mar 26 22:17 Whonix-Gateway-XFCE-15.0.1.0.7.raw
-rw-r--r-- 1 user user 2.5G Mar 26 22:20 Whonix-Gateway-XFCE-15.0.1.0.7.test-qemu-img.qcow2
</code></pre>
<aside class="quote no-group quote-modified" data-username="onion_knight" data-post="202" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<blockquote>
<p>Installed Whonix-Host GRUB menuentry is currently ‚ÄúWhonix GNU/Linux‚Äù -&gt; shouldn‚Äôt it be changed to ‚ÄúWhonix-Host GNU/Linux‚Äù? Same thing for <code>/etc/motd</code></p>
</blockquote>
<p>Should be doable. That, /etc/issue, /etc/motd could use a ticket.</p>
</blockquote>
</aside>
<p>Do you want me to create a ticket on phabricator?</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-27T08:18:08Z' class='post-time'>
                March 27, 2020,  8:18am
              </time>
              <meta itemprop='dateModified' content='2020-03-27T08:18:08Z'>
          <span itemprop='position'>#208</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>onion_knight via Whonix Forum:</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="203" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Awesome!</p>
<p>Packages: yes, please add here <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/blob/master/debian/control">https://github.com/Whonix/anon-meta-packages/blob/master/debian/control</a></p>
</blockquote>
</aside>
<p>See pull request.</p>
</blockquote>
<p>Merged.</p>
<blockquote>
<p>Added packages as dependencies for whonix-host-xfce-kvm-freedom. Not sure it‚Äôs the right place to have them?</p>
</blockquote>
<p>Not sure if perfect but good enough for now. Could be split into a<br>
different package later on that makes clear that it‚Äôs non-essential.<br>
Supposing these packages should only be there on an Whonix-Host XFCE<br>
build but not inside VMs.</p>
<blockquote>
<p>Do you want me to create a ticket on phabricator?</p>
</blockquote>
<p>Yes.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-27T08:27:10Z' class='post-time'>
                March 27, 2020,  8:27am
              </time>
              <meta itemprop='dateModified' content='2020-03-27T08:27:10Z'>
          <span itemprop='position'>#209</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/commit/2eef11e73d5892fd8e7262de1ef57d1cb703d37b" target="_blank">github.com/Whonix/anon-meta-packages</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/commit/2eef11e73d5892fd8e7262de1ef57d1cb703d37b" target="_blank">add 'grub-live | grub-live-boot | boot-live' to kicksecure-xfce</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-03-27" data-time="08:20:49" data-timezone="UTC">08:20AM - 27 Mar 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 1 additions and 0 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/anon-meta-packages/commit/2eef11e73d5892fd8e7262de1ef57d1cb703d37b" target="_blank">
          <span class="added">+1</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>^ Kicksecure-Hosts and Whonix-Hosts will now have <a href="../../../external.html?link=https://www.whonix.org/wiki/Grub-live">grub-live</a> installed by default. I.e. installed Whonix-Host should have the grub live boot menu entries.</p>
<hr>
<p>When booting the host for the first time it might be interesting to boot into <a href="../../../external.html?link=https://www.whonix.org/wiki/Recovery#Recovery_Mode">recovery mode</a>. In Whonix VMs I could see that /home/user does not exist yet at that time (no pam mkhomedir run yet), which is expected. Might be interesting for installed Whonix-Host.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-27T11:46:11Z' class='post-time'>
                March 27, 2020, 11:46am
              </time>
              <meta itemprop='dateModified' content='2020-03-27T11:46:11Z'>
          <span itemprop='position'>#210</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Using qemu-img now instead of <code>cp --sparse=always</code> to hopefully fix sparse file issue.</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/Whonix/commit/7cb5ca4e7f52de5cfd7557655fc05e629e565dd1" target="_blank">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/Whonix/commit/7cb5ca4e7f52de5cfd7557655fc05e629e565dd1" target="_blank">fix Whonix-Host sparse file handling for Whonix qcow2 images</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-03-27" data-time="11:41:56" data-timezone="UTC">11:41AM - 27 Mar 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 18 additions and 2 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/Whonix/commit/7cb5ca4e7f52de5cfd7557655fc05e629e565dd1" target="_blank">
          <span class="added">+18</span>
          <span class="removed">-2</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">use qemu-img instead of cp --sparse=always
https://forums.whonix.org/t/whonix-host-operating-system/3931/202
Thanks to @onions-knight for the bug report and fix suggestion!</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>See TODO in commit above.</p>
<p>Should we use these qemu-img command line parameters?</p>
<ul>
<li>
<code>-p</code> - progress - that one shouldn‚Äôt hurt.</li>
<li><code>-o cluster_size=2M</code></li>
<li><code>-o preallocation=metadata</code></li>
</ul>
<p>Or would these cause the issue?</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-27T11:49:38Z' class='post-time'>
                March 27, 2020, 11:49am
              </time>
              <meta itemprop='dateModified' content='2020-03-27T11:49:38Z'>
          <span itemprop='position'>#211</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><code>15.0.1.0.8-developers-only</code> includes above fix as well as grub, /etc/issue and /etc/motd branding specific to host, gateway, workstation. Untested.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-28T11:58:14Z' class='post-time'>
                March 28, 2020, 11:58am
              </time>
              <meta itemprop='dateModified' content='2020-03-28T11:58:14Z'>
          <span itemprop='position'>#212</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I‚Äôve just built <code>15.0.1.0.8-developers-only</code></p>
<p><code>/etc/motd</code> and <code>/etc/issue</code> are empty (no content inside, applies to Whonix-Host and gw/ws).</p>
<p>Besides, something went completely wrong, VMs were unbootable (‚ÄúBoot failed: not a bootable disk‚Äù).</p>
<p>It seems that this was caused by a faulty <code>qemu-img convert</code> command in 1800_copy_vms_into_raw</p>
<p>Changing -f raw to -f qcow2 and rebuilding Whonix-Host seemed to fix the issue.</p>
<p>Se my pull request:<br>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/Whonix/pull/434" target="_blank" rel="nofollow noopener">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/Whonix/pull/434" target="_blank" rel="nofollow noopener">Update 1800_copy_vms_into_raw</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ‚Üê <code>onions-knight:patch-7</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-03-28" data-time="11:57:39" data-timezone="UTC">11:57AM - 28 Mar 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/onions-knight" target="_blank" rel="nofollow noopener">
          <img alt="onions-knight" src="../../../external.html?link=https://avatars2.githubusercontent.com/u/38859709?v=4" class="onebox-avatar-inline" width="20" height="20">
          onions-knight
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 2 additions and 2 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/Whonix/pull/434/files" target="_blank" rel="nofollow noopener">
          <span class="added">+2</span>
          <span class="removed">-2</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<p>More testing later.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-28T12:09:50Z' class='post-time'>
                March 28, 2020, 12:09pm
              </time>
              <meta itemprop='dateModified' content='2020-03-28T12:09:50Z'>
          <span itemprop='position'>#213</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="onion_knight" data-post="212" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p><a href="../../../external.html?link=https://github.com/Whonix/Whonix/pull/434">Update 1800_copy_vms_into_raw</a></p>
</blockquote>
</aside>
<p>Merged, thanks! <img src="../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<aside class="quote no-group" data-username="onion_knight" data-post="212" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p><code>/etc/motd</code> and <code>/etc/issue</code> are empty (no content inside, applies to Whonix-Host and gw/ws).</p>
</blockquote>
</aside>
<p>This is expected.<br>
Changed files: <a href="../../../external.html?link=https://github.com/Whonix/Whonix/commit/f59f94616188d1c3d3fa69b60ec62cdc2ea6aa19">https://github.com/Whonix/Whonix/commit/f59f94616188d1c3d3fa69b60ec62cdc2ea6aa19</a><br>
Implementation:</p>
<hr>
<ul>
<li><a href="../../../external.html?link=https://github.com/Whonix/anon-gw-base-files/blob/master/etc/issue.d/30_whonix-gateway.issue">https://github.com/Whonix/anon-gw-base-files/blob/master/etc/issue.d/30_whonix-gateway.issue</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/anon-gw-base-files/blob/master/usr/lib/motd.d/30_whonix-gateway.motd">https://github.com/Whonix/anon-gw-base-files/blob/master/usr/lib/motd.d/30_whonix-gateway.motd</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/anon-gw-base-files/blob/master/etc/default/grub.d/30_whonix-gateway.cfg">https://github.com/Whonix/anon-gw-base-files/blob/master/etc/default/grub.d/30_whonix-gateway.cfg</a></li>
</ul>
<hr>
<ul>
<li><a href="../../../external.html?link=https://github.com/Whonix/anon-ws-base-files/blob/master/etc/issue.d/30_whonix-workstation.issue">https://github.com/Whonix/anon-ws-base-files/blob/master/etc/issue.d/30_whonix-workstation.issue</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/anon-ws-base-files/blob/master/usr/lib/motd.d/30_whonix-workstation.motd">https://github.com/Whonix/anon-ws-base-files/blob/master/usr/lib/motd.d/30_whonix-workstation.motd</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/anon-ws-base-files/blob/master/etc/default/grub.d/30_whonix-workstation.cfg">https://github.com/Whonix/anon-ws-base-files/blob/master/etc/default/grub.d/30_whonix-workstation.cfg</a></li>
</ul>
<hr>
<ul>
<li><a href="../../../external.html?link=https://github.com/Whonix/whonix-libvirt/blob/master/etc/issue.d/30_whonix-host.issue">https://github.com/Whonix/whonix-libvirt/blob/master/etc/issue.d/30_whonix-host.issue</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/whonix-libvirt/blob/master/etc/default/grub.d/30_whonix-host.cfg">https://github.com/Whonix/whonix-libvirt/blob/master/etc/default/grub.d/30_whonix-host.cfg</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/whonix-libvirt/blob/master/usr/lib/motd.d/30_whonix-host.motd">https://github.com/Whonix/whonix-libvirt/blob/master/usr/lib/motd.d/30_whonix-host.motd</a></li>
</ul>
<hr>
<ul>
<li>
<a href="../../../external.html?link=https://wiki.debian.org/motd">https://wiki.debian.org/motd</a> on <code>motd.d</code>
</li>
<li>
<a href="../../../external.html?link=https://www.mankier.com/8/pam_motd">https://www.mankier.com/8/pam_motd</a> on <code>motd.d</code>
</li>
<li>
<a href="../../../external.html?link=https://manpages.debian.org/buster/util-linux/getty.8.en.html">https://manpages.debian.org/buster/util-linux/getty.8.en.html</a> on <code>/etc/issue.d</code>
</li>
</ul>
<hr>
<p>motd and issue should now be dynamically created from drop-in configuration folder. Any idea why this isn‚Äôt working?</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">

            <link itemprop="image" href="../../uploads/default/original/2X/d/d75b6a01891afb34d33ee07bce9d79505a6ec28e.png">

          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-28T19:30:41Z' class='post-time'>
                March 28, 2020,  7:30pm
              </time>
              <meta itemprop='dateModified' content='2020-03-28T19:51:02Z'>
          <span itemprop='position'>#214</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>All right, I am making some progress with EFI installation (all tests done in KVM for now, not real hardware).</p>
<p>Previously, Calamares would fail at the very beginning, unable to create an EFI partition. Turns out it needed <code>dosfstools</code> to do so, which is installed now on the ISO. So fixed.</p>
<p>Then it failed to install <code>grub-efi-amd64</code> at module <code>bootloader</code>. This is because it needs module <code>sources-media</code> in order to have a working apt sources list to download the package. So it seems we will need this module, which creates a temporary sources.list in the chrooted installed environment, as well as module <code>sources-media-unmount</code> which removes it at the end.</p>
<p>So now theoretically all works well,  Calamares installs grub-efi, doesn‚Äôt complain and completes the installation. Problem: it won‚Äôt boot unless the Whonix-Host ISO is attached:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/d/d75b6a01891afb34d33ee07bce9d79505a6ec28e.png" data-download-href="//forums.whonix.org/uploads/default/d75b6a01891afb34d33ee07bce9d79505a6ec28e" title="39"><img src="../../uploads/default/original/2X/d/d75b6a01891afb34d33ee07bce9d79505a6ec28e.png" alt="39" data-base62-sha1="uJ8vC8Mv339DmBrHqKK0abpC6ZM" width="690" height="304" data-small-upload="../../uploads/default/optimized/2X/d/d75b6a01891afb34d33ee07bce9d79505a6ec28e_2_10x10.png"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">39</span><span class="informations">712√ó314 1.34 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>There is something  broken somewhere, or conflicts with something, although Calamares installation logs don‚Äôt show anything alarming. I also did an installation with a vanilla live Debian 10 XFCE  system with Calamares to compare between the two. I didn‚Äôt notice anything out of the extraordinary, logs seem pretty much the same.</p>
<p>I am kind of stuck at this stage. I can‚Äôt figure what‚Äôs going wrong. I will research some more, I‚Äôm sure it must be something really stupid blocking me.</p>
<p>EDIT: comparison of <code>efibootmgr -v</code> on plain Debian 10 XFCE and Whonix-Host right after Calamares installation:</p>
<p><strong>Debian 10</strong></p>
<pre><code>BootCurrent: 0004
Timeout: 0 seconds
BootOrder: 0004,0002,0001,0000,0003
Boot0000* UiApp	FvVol(7cb8bdc9-f8eb-4f34-aaea-3ee4af6516a1)/FvFile(462caa21-7614-4503-836e-8ab6f4662331)
Boot0001* UEFI QEMU DVD-ROM QM00005 	PciRoot(0x0)/Pci(0x6,0x0)/Sata(0,65535,0)N.....YM....R,Y.
Boot0002* UEFI Misc Device	PciRoot(0x0)/Pci(0x8,0x0)N.....YM....R,Y.
Boot0003* EFI Internal Shell	FvVol(7cb8bdc9-f8eb-4f34-aaea-3ee4af6516a1)/FvFile(7c04a583-9e3e-4f1c-ad65-e05268d0b4d1)
Boot0004* Debian	HD(1,GPT,1155be0b-252a-46cb-9cd2-735846abcf0c,0x1000,0x96000)/File(\EFI\Debian\shimx64.efi)
</code></pre>
<p><strong>Whonix-Host</strong></p>
<pre><code>BootCurrent: 0001
Timeout: 0 seconds
BootOrder: 0001,0004,0002,0000,0003
Boot0000* UiApp	FvVol(7cb8bdc9-f8eb-4f34-aaea-3ee4af6516a1)/FvFile(462caa21-7614-4503-836e-8ab6f4662331)
Boot0001* UEFI QEMU DVD-ROM QM00005 	PciRoot(0x0)/Pci(0x6,0x0)/Sata(0,65535,0)N.....YM....R,Y.
Boot0002* UEFI Misc Device	PciRoot(0x0)/Pci(0x8,0x0)N.....YM....R,Y.
Boot0003* EFI Internal Shell	FvVol(7cb8bdc9-f8eb-4f34-aaea-3ee4af6516a1)/FvFile(7c04a583-9e3e-4f1c-ad65-e05268d0b4d1)
Boot0004* Whonix-Host	HD(1,GPT,aa03e154-6750-4877-9cc5-9d1fc075184b,0x1000,0x96000)/File(\EFI\Whonix-Host\shimx64.efi)
</code></pre>
<p>We see that Whonix-Host bootorder doesn‚Äôt default on entry 4. But even after correcting the order manually, it still doesn‚Äôt boot‚Ä¶</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-28T22:24:35Z' class='post-time'>
                March 28, 2020, 10:24pm
              </time>
              <meta itemprop='dateModified' content='2020-03-28T22:24:35Z'>
          <span itemprop='position'>#215</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Still no success. I tried:</p>
<ul>
<li>Removing all grub packages and configuration files from the Whonix-Host master raw file, then reburning the ISO</li>
<li>Running Calamares installer with default settings.conf of Debian (all default modules)</li>
<li>Manually changing the efi boot order</li>
<li>Manually reinstalling grub (efi) on the installed host</li>
<li>Making sure that blkid UUID correspond to grub/efibootmgr entries</li>
<li>Trying it on real hardware</li>
</ul>
<p>All to no avail. Still stuck to the ‚ÄúMinimal BASH-like line editing‚Äù mode.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-29T09:05:51Z' class='post-time'>
                March 29, 2020,  9:05am
              </time>
              <meta itemprop='dateModified' content='2020-03-29T09:05:51Z'>
          <span itemprop='position'>#216</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I don‚Äôt know much about that stuff.</p>
<p>Does Whonix-Host installed have a /boot partition?</p>
<p>Is there file <code>/boot/grub/grub.cfg</code>?</p>
<p>Could you please compare <code>/boot</code> from a working EFI system with Whonix-Host installed? There are tools which can compare whole folders such as <code>meld</code>. Using <code>sudo find /boot</code> to get a list of all files and compare those working vs non-working.</p>
<aside class="quote no-group" data-username="onion_knight" data-post="215" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>Still stuck to the ‚ÄúMinimal BASH-like line editing‚Äù mode.</p>
</blockquote>
</aside>
<p>Which is ‚Äú50%‚Äù done. Meaning, EFI Bios boots until grub-efi.</p>
<aside class="quote no-group" data-username="onion_knight" data-post="215" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>Still stuck to the ‚ÄúMinimal BASH-like line editing‚Äù mode.</p>
</blockquote>
</aside>
<p>Maybe that can help to debug. Here is a list of commands there:</p>
<p><a href="../../../external.html?link=https://www.gnu.org/software/grub/manual/grub/grub.html#Command_002dline-and-menu-entry-commands" class="onebox" target="_blank">https://www.gnu.org/software/grub/manual/grub/grub.html#Command_002dline-and-menu-entry-commands</a></p>
<p>Could you try please command <code>ls</code>?<br>
For inspiration what other commands are useful see file <code>/boot/grub/grub.cfg</code> from any system that has working EFI booting.<br>
There might also be some commands online how to manually boot.</p>
<p>Anyone we can ask? Grub people on IRC?</p>
<pre><code>irc://irc.gnu.org/grub
</code></pre>
<p>Or <a href="../../../external.html?link=https://lists.gnu.org/mailman/listinfo/help-grub">https://lists.gnu.org/mailman/listinfo/help-grub</a>.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-29T11:47:40Z' class='post-time'>
                March 29, 2020, 11:47am
              </time>
              <meta itemprop='dateModified' content='2020-03-29T11:47:40Z'>
          <span itemprop='position'>#217</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="216" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does Whonix-Host installed have a /boot partition?</p>
<p>Is there file <code>/boot/grub/grub.cfg</code> ?</p>
</blockquote>
</aside>
<p>Yes. And btw live-mode works (but again, it boots only if the Whonix-Host ISO is attached).</p>
<pre><code>user@host:~$ cat /boot/grub/grub.cfg 
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
if [ -s $prefix/grubenv ]; then
  set have_grubenv=true
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="0"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}
function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

if [ x$feature_default_font_path = xy ] ; then
   font=unicode
else
insmod part_gpt
insmod ext2
if [ x$feature_platform_search_hint = xy ]; then
  search --no-floppy --fs-uuid --set=root  83cbe41d-2c9b-4986-b803-4af882749597
else
  search --no-floppy --fs-uuid --set=root 83cbe41d-2c9b-4986-b803-4af882749597
fi
    font="/usr/share/grub/unicode.pf2"
fi

if loadfont $font ; then
  set gfxmode=auto
  load_video
  insmod gfxterm
  set locale_dir=$prefix/locale
  set lang=en_US
  insmod gettext
fi
terminal_output gfxterm
if [ "${recordfail}" = 1 ] ; then
  set timeout=30
else
  if [ x$feature_timeout_style = xy ] ; then
    set timeout_style=menu
    set timeout=5
  # Fallback normal timeout code in case the timeout_style feature is
  # unavailable.
  else
    set timeout=5
  fi
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/05_debian_theme ###
set menu_color_normal=cyan/blue
set menu_color_highlight=white/blue
### END /etc/grub.d/05_debian_theme ###

### BEGIN /etc/grub.d/10_linux ###
function gfxmode {
	set gfxpayload="${1}"
}
set linux_gfx_mode=1024x768
export linux_gfx_mode
menuentry 'Whonix GNU/Linux' --class whonix --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-83cbe41d-2c9b-4986-b803-4af882749597' {
	load_video
	gfxmode $linux_gfx_mode
	insmod gzio
	if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
	insmod part_gpt
	insmod ext2
	if [ x$feature_platform_search_hint = xy ]; then
	  search --no-floppy --fs-uuid --set=root  83cbe41d-2c9b-4986-b803-4af882749597
	else
	  search --no-floppy --fs-uuid --set=root 83cbe41d-2c9b-4986-b803-4af882749597
	fi
	echo	'Loading Linux 4.19.0-8-amd64 ...'
	linux	/boot/vmlinuz-4.19.0-8-amd64 root=UUID=83cbe41d-2c9b-4986-b803-4af882749597 ro  spectre_v2=on spec_store_bypass_disable=on tsx=off tsx_async_abort=full,nosmt mds=full,nosmt l1tf=full,force nosmt=force kvm.nx_huge_pages=force random.trust_cpu=off intel_iommu=on amd_iommu=on efi=disable_early_pci_dma slab_nomerge slub_debug=FZP page_poison=1 mce=0 pti=on vsyscall=none extra_latent_entropy quiet resume=UUID=adfbad2f-cd8a-4fc4-a4cb-14e551d4b5f8
	echo	'Loading initial ramdisk ...'
	initrd	/boot/initrd.img-4.19.0-8-amd64
}
submenu 'Advanced options for Whonix GNU/Linux' $menuentry_id_option 'gnulinux-advanced-83cbe41d-2c9b-4986-b803-4af882749597' {
	menuentry 'Whonix GNU/Linux, with Linux 4.19.0-8-amd64' --class whonix --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.19.0-8-amd64-advanced-83cbe41d-2c9b-4986-b803-4af882749597' {
		load_video
		gfxmode $linux_gfx_mode
		insmod gzio
		if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
		insmod part_gpt
		insmod ext2
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root  83cbe41d-2c9b-4986-b803-4af882749597
		else
		  search --no-floppy --fs-uuid --set=root 83cbe41d-2c9b-4986-b803-4af882749597
		fi
		echo	'Loading Linux 4.19.0-8-amd64 ...'
		linux	/boot/vmlinuz-4.19.0-8-amd64 root=UUID=83cbe41d-2c9b-4986-b803-4af882749597 ro  spectre_v2=on spec_store_bypass_disable=on tsx=off tsx_async_abort=full,nosmt mds=full,nosmt l1tf=full,force nosmt=force kvm.nx_huge_pages=force random.trust_cpu=off intel_iommu=on amd_iommu=on efi=disable_early_pci_dma slab_nomerge slub_debug=FZP page_poison=1 mce=0 pti=on vsyscall=none extra_latent_entropy quiet resume=UUID=adfbad2f-cd8a-4fc4-a4cb-14e551d4b5f8
		echo	'Loading initial ramdisk ...'
		initrd	/boot/initrd.img-4.19.0-8-amd64
	}
	menuentry 'Whonix GNU/Linux, with Linux 4.19.0-8-amd64 (recovery mode)' --class whonix --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.19.0-8-amd64-recovery-83cbe41d-2c9b-4986-b803-4af882749597' {
		load_video
		gfxmode $linux_gfx_mode
		insmod gzio
		if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
		insmod part_gpt
		insmod ext2
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root  83cbe41d-2c9b-4986-b803-4af882749597
		else
		  search --no-floppy --fs-uuid --set=root 83cbe41d-2c9b-4986-b803-4af882749597
		fi
		echo	'Loading Linux 4.19.0-8-amd64 ...'
		linux	/boot/vmlinuz-4.19.0-8-amd64 root=UUID=83cbe41d-2c9b-4986-b803-4af882749597 ro single  spectre_v2=on spec_store_bypass_disable=on tsx=off tsx_async_abort=full,nosmt mds=full,nosmt l1tf=full,force nosmt=force kvm.nx_huge_pages=force random.trust_cpu=off intel_iommu=on amd_iommu=on efi=disable_early_pci_dma slab_nomerge slub_debug=FZP page_poison=1 mce=0 pti=on vsyscall=none extra_latent_entropy
		echo	'Loading initial ramdisk ...'
		initrd	/boot/initrd.img-4.19.0-8-amd64
	}
}

### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/11_linux_live ###
function gfxmode {
	set gfxpayload="${1}"
}
set linux_gfx_mode=1024x768
export linux_gfx_mode
menuentry 'LIVE mode USER (For daily activities.) GNU/Linux, with Linux 4.19.0-8-amd64' --class live --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.19.0-8-amd64-advanced-83cbe41d-2c9b-4986-b803-4af882749597' {
	load_video
	gfxmode $linux_gfx_mode
	insmod gzio
	if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
	insmod part_gpt
	insmod ext2
	if [ x$feature_platform_search_hint = xy ]; then
	  search --no-floppy --fs-uuid --set=root  83cbe41d-2c9b-4986-b803-4af882749597
	else
	  search --no-floppy --fs-uuid --set=root 83cbe41d-2c9b-4986-b803-4af882749597
	fi
	echo	'Loading Linux 4.19.0-8-amd64 ...'
	linux	/boot/vmlinuz-4.19.0-8-amd64 root=/dev/disk/by-uuid/83cbe41d-2c9b-4986-b803-4af882749597 ro  spectre_v2=on spec_store_bypass_disable=on tsx=off tsx_async_abort=full,nosmt mds=full,nosmt l1tf=full,force nosmt=force kvm.nx_huge_pages=force random.trust_cpu=off intel_iommu=on amd_iommu=on efi=disable_early_pci_dma slab_nomerge slub_debug=FZP page_poison=1 mce=0 pti=on vsyscall=none extra_latent_entropy boot=live plainroot union=overlay ip=frommedia noeject nopersistence quiet resume=UUID=adfbad2f-cd8a-4fc4-a4cb-14e551d4b5f8
	echo	'Loading initial ramdisk ...'
	initrd	/boot/initrd.img-4.19.0-8-amd64
}

### END /etc/grub.d/11_linux_live ###

### BEGIN /etc/grub.d/20_linux_xen ###

### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/30_uefi-firmware ###
menuentry 'System setup' $menuentry_id_option 'uefi-firmware' {
	fwsetup
}
### END /etc/grub.d/30_uefi-firmware ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###
</code></pre>
<aside class="quote no-group" data-username="Patrick" data-post="216" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could you please compare <code>/boot</code> from a working EFI system with Whonix-Host installed? There are tools which can compare whole folders such as <code>meld</code> . Using <code>sudo find /boot</code> to get a list of all files and compare those working vs non-working.</p>
</blockquote>
</aside>
<p>Seems pretty much the same. Just compared with a Debian 10 XFCE install with Calamares.</p>
<aside class="quote no-group" data-username="Patrick" data-post="216" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><a href="../../../external.html?link=https://www.gnu.org/software/grub/manual/grub/grub.html#Command_002dline-and-menu-entry-commands" rel="nofollow noopener">https://www.gnu.org/software/grub/manual/grub/grub.html#Command_002dline-and-menu-entry-commands</a></p>
<p>Could you try please command <code>ls</code> ?</p>
</blockquote>
</aside>
<pre><code>grub&gt; ls
(proc) (hd0) (hd0,gpt3) (hd0,gpt2) (hd0,gpt1) (cd0)
</code></pre>
<p>This answer here allowed me to boot into Whonix-Host from minimal grub menuentry:<br>
<aside class="onebox stackexchange">
  <header class="source">
      <a href="../../../external.html?link=https://askubuntu.com/questions/883992/stuck-at-grub-command-line" target="_blank" rel="nofollow noopener">askubuntu.com</a>
  </header>
  <article class="onebox-body">
      <a href="../../../external.html?link=https://askubuntu.com/users/655261/khivraj-rathore" target="_blank" rel="nofollow noopener">
    <img alt="Khivraj Rathore" src="../../../external.html?link=https://www.gravatar.com/avatar/bc3ce93ec030393296d6dc375677e73d?s=128&amp;d=identicon&amp;r=PG&amp;f=1" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="../../../external.html?link=https://askubuntu.com/questions/883992/stuck-at-grub-command-line" target="_blank" rel="nofollow noopener">Stuck at GRUB command line</a>
</h4>

<div class="tags">
  <strong>boot</strong>
</div>

<div class="date">
  asked by
  
  <a href="../../../external.html?link=https://askubuntu.com/users/655261/khivraj-rathore" target="_blank" rel="nofollow noopener">
    Khivraj Rathore
  </a>
  on <a href="../../../external.html?link=https://askubuntu.com/questions/883992/stuck-at-grub-command-line" target="_blank" rel="nofollow noopener">12:23PM - 16 Feb 17 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<pre><code>set prefix=(hd0,gpt1)/efi/Whonix-Host
set root=(hd0,gpt1)
insmod linux
insmod normal
normal
</code></pre>
<p>But it doesn‚Äôt survive reboot. <code>sudo update-grub</code> doesn‚Äôt help either.<br>
My guess is that at this point there is just a little something wrong somewhere that caused a faulty grub configuration‚Ä¶ Just need to find it.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-29T13:36:08Z' class='post-time'>
                March 29, 2020,  1:36pm
              </time>
              <meta itemprop='dateModified' content='2020-03-29T13:36:08Z'>
          <span itemprop='position'>#218</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>UEFI  booting in KVM needs all kinds of tweaks to work such as enrolling the signing keys. Never got it to work</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-30T07:16:18Z' class='post-time'>
                March 30, 2020,  7:16am
              </time>
              <meta itemprop='dateModified' content='2020-03-30T07:16:18Z'>
          <span itemprop='position'>#219</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="HulaHoop" data-post="218" data-topic="3931" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>UEFI booting in KVM needs all kinds of tweaks to work such as enrolling the signing keys. Never got it to work</p>
</blockquote>
</aside>
<p>Well it just worked out of the box with Debian 10 and Calamares installer.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-07T16:05:11Z' class='post-time'>
                April 7, 2020,  4:05pm
              </time>
              <meta itemprop='dateModified' content='2020-04-07T16:05:11Z'>
          <span itemprop='position'>#220</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Tails recently managed to implement EFI and Secure Boot as per:<br>
<a href="../../../external.html?link=https://tails.boum.org/news/test_4.5-rc1/" class="onebox" target="_blank">https://tails.boum.org/news/test_4.5-rc1/</a></p>
<p>Maybe that could help?</p>
<ul>
<li><a href="../../../external.html?link=https://tails.boum.org/blueprint/UEFI/">https://tails.boum.org/blueprint/UEFI/</a></li>
<li><a href="../../../external.html?link=https://tails.boum.org/contribute/design/UEFI/">https://tails.boum.org/contribute/design/UEFI/</a></li>
<li><a href="../../../external.html?link=https://git-tails.immerda.ch/tails/tree/config/chroot_local-hooks/60-copy-syslinux-modules">https://git-tails.immerda.ch/tails/tree/config/chroot_local-hooks/60-copy-syslinux-modules</a></li>
<li><a href="../../../external.html?link=https://git-tails.immerda.ch/tails/tree/config/binary_local-includes/EFI/BOOT/grub/grub.cfg">https://git-tails.immerda.ch/tails/tree/config/binary_local-includes/EFI/BOOT/grub/grub.cfg</a></li>
<li><a href="../../../external.html?link=https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks">https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks</a></li>
<li><a href="../../../external.html?link=https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks/30-syslinux_fixup">https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks/30-syslinux_fixup</a></li>
<li><a href="../../../external.html?link=https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks/50-grub-efi-ia32">https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks/50-grub-efi-ia32</a></li>
<li><a href="../../../external.html?link=https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks/99-syslinux_uefi">https://git-tails.immerda.ch/tails/tree/config/binary_local-hooks/99-syslinux_uefi</a></li>
</ul>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-07T16:37:32Z' class='post-time'>
                April 7, 2020,  4:37pm
              </time>
              <meta itemprop='dateModified' content='2020-04-07T16:37:32Z'>
          <span itemprop='position'>#221</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Great, let me have a look.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-09T20:30:50Z' class='post-time'>
                April 9, 2020,  8:30pm
              </time>
              <meta itemprop='dateModified' content='2020-04-09T20:30:50Z'>
          <span itemprop='position'>#222</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>In fact we <em>already</em> have an ISO file that boots on EFI and BIOS systems.</p>
<p>What we could not achieve is having an EFI bootable installed Whonix-Host system. Reasons still unknown.</p>
<p><a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a>, would you maybe consider already releasing Whonix-Host ISO as it is, without EFI support for Calamares installer? This way people could already start to test it and maybe we could gather some feedback on how to fix this issue.</p>
<p>The way it is now I fear that otherwise we will once again be stuck for a long time. I have fewer time available right now.</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-09T22:15:36Z' class='post-time'>
                April 9, 2020, 10:15pm
              </time>
              <meta itemprop='dateModified' content='2020-04-09T22:15:36Z'>
          <span itemprop='position'>#223</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Just built Whonix-Host-XFCE-15.0.1.2.2.<br>
Bad news: encrypted install (BIOS) is broken. That means, unable to boot the system after grub menu</p>
<pre><code>Volume group "luks" not found 
Cannot process volume group luks
</code></pre>
<p>And then<br>
<code>ALERT! /dev/mapper/luks-xxxxxx-xxx does not exist. Dropping to a shell!</code></p>
<p>I have NO IDEA why it‚Äôs broken. I see nothing unusual in the encrypted disk, nor during the installation process. It used to work before. Of course, I have erased all previous copies of working Whonix-Host ISO, so I couldn‚Äôt even tell which versions used to work nor compare them‚Ä¶</p>
<p>Non-encrypted BIOS install still works (both persistent and live mode).</p>
<p>We must have broken something somewhere during the last weeks or so‚Ä¶</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="3931.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-10T00:21:55Z' class='post-time'>
                April 10, 2020, 12:21am
              </time>
              <meta itemprop='dateModified' content='2020-04-10T01:31:53Z'>
          <span itemprop='position'>#224</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="onion_knight" data-post="223" data-topic="3931">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>Just built Whonix-Host-XFCE-15.0.1.2.2.<br>
Bad news: encrypted install (BIOS) is broken. That means, unable to boot the system after grub menu</p>
</blockquote>
</aside>
<p>I think I found the reason. <code>live-boot</code> packages must be removed on the installed host during Calamares <code>packages</code> module. Otherwise Calamares will fail to update initramfs (<code>update-initramfs is disabled live system is running without media mounted on /lib/live/mount/medium</code>).</p>
<p><a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> did you modify this file?<br>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/live-config-dist/blob/master/etc/calamares/modules/packages.conf.dist" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../external.html?link=https://github.com/Whonix/live-config-dist/blob/master/etc/calamares/modules/packages.conf.dist" target="_blank" rel="nofollow noopener">Whonix/live-config-dist/blob/master/etc/calamares/modules/packages.conf.dist</a></h4>
<pre><code class="lang-dist">backend: apt

operations:
   - remove:
      - 'calamares'
      - 'calamares-settings-debian'
      - 'live-config-dist'
</code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<p>As far as I remember, we used to remove all <code>live-boot</code> packages.</p>
<p>See also <code>/usr/lib/x86_64-linux-gnu/calamares/modules/initramfs/README.md</code>:</p>
<pre><code>## initramfs module

This module is specific to Debian based distros. Post installation on Debian
the initramfs needs to be updated so as to not interrupt the boot process
with a error about fsck.ext4 not being found.

## Debian specific notes

If you're using live-build to build your ISO and setup the runtime env
make sure that you purge the live-\* packages on the target system
before running this module, since live-config dpkg-diverts update-initramfs
and can cause all sorts of fun issues.
</code></pre>
<p>Now the question is how do we achieve a live-bootable installed Host if we have to remove all live-build packages‚Ä¶</p>
<p>There might be a workaround here, which is calling directly <code>mkinitramfs</code> instead of <code>update-initramfs</code><br>
<aside class="onebox stackexchange">
  <header class="source">
      <a href="../../../external.html?link=https://superuser.com/questions/903142/how-to-run-update-initramfs-from-bootable-usb" target="_blank" rel="nofollow noopener">superuser.com</a>
  </header>
  <article class="onebox-body">
      <a href="../../../external.html?link=https://superuser.com/users/438890/josh" target="_blank" rel="nofollow noopener">
    <img alt="Josh" src="../../../external.html?link=https://lh3.googleusercontent.com/-cARXatNlwrA/AAAAAAAAAAI/AAAAAAAAAFI/kxuGxVL_KL4/photo.jpg?sz=128" class="thumbnail onebox-avatar" width="128" height="128">
  </a>
<h4>
  <a href="../../../external.html?link=https://superuser.com/questions/903142/how-to-run-update-initramfs-from-bootable-usb" target="_blank" rel="nofollow noopener">How to run update-initramfs from bootable usb?</a>
</h4>

<div class="tags">
  <strong>boot, ubuntu-12.04, ubuntu-14.04, kernel-panic</strong>
</div>

<div class="date">
  asked by
  
  <a href="../../../external.html?link=https://superuser.com/users/438890/josh" target="_blank" rel="nofollow noopener">
    Josh
  </a>
  on <a href="../../../external.html?link=https://superuser.com/questions/903142/how-to-run-update-initramfs-from-bootable-usb" target="_blank" rel="nofollow noopener">03:50PM - 18 Apr 15 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<p>I tried replacing</p>
<pre><code>return_code = target_env_call(["update-initramfs", "-k", "all", "-c",
                                   "-t"])
</code></pre>
<p>with</p>
<pre><code>return_code = target_env_call(["mkinitramfs", "-o", "/boot/initrd.img-$(uname -r)"])
</code></pre>
<p>in <code>/usr/lib/x86_64-linux-gnu/calamares/modules/initramfs/main.py</code></p>
<p>No error during Calamares install. But still no luck, won‚Äôt boot.</p>
<p>EDIT the command generated an initramfs wrongly named <code>'initrd.img-$(uname -r)'</code>. Replacing the old initramfs with this new one works. Using ‚Äú/boot/initrd.img-4.19.0-8-amd64‚Äù in main.py also worked (meaning encrypted install Whonix-Host boots in persistent and live-mode).</p>
<p>So it‚Äôs just a question of correct python coding I guess‚Ä¶</p>
        </div>

        <meta itemprop='headline' content='Whonix host operating system'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="39311448.html?page=10">‚Üê previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="3931ce37.html?page=12">next page ‚Üí</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
