<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Restrict root access</title>
    <link>http://forums.whonix.org/t/restrict-root-access/7658</link>
    <description>It would be good to restrict root access to make it a lot harder to login as root.

Uncommenting, `auth       required   pam_wheel.so` in /etc/pam.d/su will make it so only users in the `root` group can use `su`. This can prevent a compromised system user (e.g. the `whonixcheck` user) from switching to another user and/or gaining root. The user `user` can be added to the `root` group so they can use `su` normally or they can also be restricted and will have to use `sudo`.

Emptying the /etc/securetty file can prevent someone from logging in as root from a tty or console.

While not necessarily helpful for just the root account, we can increase the number of hashing rounds when hashing passwords by adding `rounds=(number)` to the end of the pam_unix.so module in /etc/pam.d/common-password. E.g. `rounds=65536`. The higher the amount of rounds, the longer it takes to login and set passwords. 65536 rounds takes 1 second even on slow computers.</description>
    <language>en</language>
    <lastBuildDate>Wed, 01 Jun 2022 20:28:22 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/restrict-root-access/7658.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue" data-onebox-src="https://github.com/QubesOS/qubes-issues/issues/7538">
  <header class="source">

      <a href="https://github.com/QubesOS/qubes-issues/issues/7538" target="_blank" rel="noopener">github.com/QubesOS/qubes-issues</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/QubesOS/qubes-issues/issues/7538" target="_blank" rel="noopener">make Qubes / Whonix graphical user interface (GUI) applications that require root compatible with wayland</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-06-01" data-time="20:27:01" data-timezone="UTC">08:27PM - 01 Jun 22 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          T: bug
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          P: default
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">In wayland it's no longer easily possible to run `lxsudo application`. I found m<span class="show-more-container"><a href="http://forums.whonix.org" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">any users asking how to do that, workarounds. But I haven't found any cannoncial suggestion for developers how that should now be implemented.

This might only affect (Qubes-)Whonix as I am not sure Qubes has any GUIs that perform actions which require root rights (except probably the installer).

Affected application examples:

* anon-connection-wizard (writing Tor configuration)
* tor-control-panel (same as above)
* repository-dist-wizard (writing APT sources list)

Options:

* PolicyKit (deprecated, replaced by polkit)
* polkit: Has itself security vulnerabilities.
* dbus: Same as above.
* sudo: I doubt Qubes can ever fully get rid of sudo?

Maybe Qubes has long term goals to get rid of a default installed polkit / dbus?

The new implementation should also be compatible with Qubes long term plans:
https://github.com/QubesOS/qubes-issues/issues/2695

I am wary of porting to polkit or dbus, if not knowing the Linux desktop's long term vision on GUI vs root and/or how likely that these options are soon invalidated.

If there is no guidance, I'll probably implement this `sudo` based solution:
https://unix.stackexchange.com/a/423287/49297</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/119">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/119</link>
        <pubDate>Wed, 01 Jun 2022 20:28:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-119</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="1" data-topic="12823">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/letter_avatar_proxy/v4/letter/m/85f322/40.png" class="avatar">
    <a href="https://forums.whonix.org/t/required-to-change-user-sudo-password-on-whonix-gateway-install-keepassx-c-by-default-on-whonix-gateway/12823">Required to change user/sudo password on Whonix-Gateway? Install KeePassX(C) by default on Whonix-Gateway?</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development/8"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of components looking for maintainer)">Development</span></a>
  </div>
  <blockquote>
    Ok, you tell us that we should change the default password for user in both Gateway and Workstation. So, how to do that on a Gateway? There is no keepassx(c) installed by default. I suggest to preinstall keepassx or keepassxc in Gateway by default so users can easily change the user password and keep it inside an encrypted database on Gateway machine to easy copy-paste it in future.
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/118">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/118</link>
        <pubDate>Thu, 18 Nov 2021 15:36:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-118</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">

      <a href="https://github.com/Whonix/security-misc/commit/74e39cbf690dae2bf72bd9f152ea91c364f5feff" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/74e39cbf690dae2bf72bd9f152ea91c364f5feff" target="_blank" rel="noopener">pam-abort-on-locked-password: more descriptive error handling</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2021-06-20" data-time="15:18:56" data-timezone="UTC">03:18PM - 20 Jun 21 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>

      <div class="lines" title="changed 1 files with 13 additions and 3 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/74e39cbf690dae2bf72bd9f152ea91c364f5feff" target="_blank" rel="noopener">
          <span class="added">+13</span>
          <span class="removed">-3</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">
https://forums.whonix.org/t/restrict-root-access/7658/1</p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/117">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/117</link>
        <pubDate>Sun, 20 Jun 2021 15:20:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-117</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="115" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>What if we create a second group for access to sudo like <code>sudo-access</code> or <code>sudo-execute</code> and then add the necessary users to it in Debian postinst scripts?</p>
</blockquote>
</aside>
<p>That sounds like a good idea! Patches welcome. Seems like quite a lot to work through.</p>
<p>Alternatively these uses of sudo could also be reviewed / implemented any other way so sudo can be avoided and perhaps this solution can be avoided as well.</p>
<aside class="quote no-group" data-username="madaidan" data-post="115" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Or maybe create a script that parses <code>/etc/sudoers.d</code>?</p>
</blockquote>
</aside>
<p>Seems harder to do and get right. Perhaps an APT trigger.</p>
<aside class="quote no-group quote-modified" data-username="madaidan" data-post="112" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<h4><a href="https://github.com/Whonix/security-misc/pull/101">Restrict sudo’s file permissions </a></h4>
</blockquote>
</aside>
<p>Will out comment this for now due to breakage mentioned above.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/116">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/116</link>
        <pubDate>Sun, 20 Jun 2021 14:09:30 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-116</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>What if we create a second group for access to sudo like <code>sudo-access</code> or <code>sudo-execute</code> and then add the necessary users to it in Debian postinst scripts? Or maybe create a script that parses <code>/etc/sudoers.d</code>? Then there would be two groups: one for filesystem access and one for sudo’s internal authorisation.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/115">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/115</link>
        <pubDate>Thu, 17 Jun 2021 20:16:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-115</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="madaidan" data-post="112" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<h4><a href="https://github.com/Whonix/security-misc/pull/101">Restrict sudo’s file permissions </a></h4>
</blockquote>
</aside>
<p>Happening in Qubes-Whonix:</p>
<pre><code>upgrade-nonroot
</code></pre>
<blockquote>
<p>/usr/bin/upgrade-nonroot: line 8: /usr/bin/sudo: Permission denied</p>
</blockquote>
<p>As said earlier, elsewhere, I don’t consider upgrade-nonroot too important. Could be phased out.</p>
<p>Unrelated to Qubes-Whonix. Applying to all Whonix / Kicksecure…</p>
<p>Other things likely broken:</p>
<ul>
<li>whonix-xfce-desktop-config /usr/share/livecheck/livecheck.sh</li>
<li>sdwdate-gui /usr/lib/sdwdate-gui/log-viewer</li>
<li>Probably other uses of sudo.</li>
</ul>
<blockquote>
<p>mygrep -r -i --invert-match “#|man/” | grep --color "sudo "</p>
</blockquote>
<p>Things confirmed broken:</p>
<ul>
<li>systemcheck</li>
</ul>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/114">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/114</link>
        <pubDate>Wed, 16 Jun 2021 15:44:28 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-114</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Merged.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/113">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/113</link>
        <pubDate>Sat, 05 Jun 2021 19:55:52 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-113</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest">
  <header class="source">

      <a href="https://github.com/Whonix/security-misc/pull/101" target="_blank" rel="noopener nofollow ugc">github.com/Whonix/security-misc</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/pull/101" target="_blank" rel="noopener nofollow ugc">Restrict sudo's file permissions</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>madaidan:sudo</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2021-06-05" data-time="19:18:40" data-timezone="UTC">07:18PM - 05 Jun 21 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/madaidan" target="_blank" rel="noopener nofollow ugc">
          <img alt="madaidan" src="https://avatars.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 19 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/pull/101/files" target="_blank" rel="noopener nofollow ugc">
          <span class="added">+19</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">https://forums.whonix.org/t/restrict-root-access/7658/109</p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/112">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/112</link>
        <pubDate>Sat, 05 Jun 2021 19:18:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-112</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Since <a href="https://www.whonix.org/wiki/SUID_Disabler_and_Permission_Hardener">SUID Disabler and Permission Hardener</a> is (not yet) default in (security-misc | Whonix | Kicksecure) anyhow, I guess adding to security-misc config folder would be OK.</p>
<p>Where/how we enable <a href="https://www.whonix.org/wiki/SUID_Disabler_and_Permission_Hardener">SUID Disabler and Permission Hardener</a> by deafult when time has come is a different question. Might be too heavy for security-misc indeed. But doesn’t really belong to dist-base-files either.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/111">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/111</link>
        <pubDate>Sat, 05 Jun 2021 14:04:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-111</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a> in which package would the above permission change best be suited? We could use permission-hardening in security-misc, although that may be too invasive for a general (i.e. not just Whonix) security package so a permission-hardening drop-in config file in dist-base-files or similar may be better.</p>
<pre><code>/usr/bin/sudo 4750 root sudo
</code></pre>
<p>Seems to work fine for me.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/110">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/110</link>
        <pubDate>Fri, 04 Jun 2021 22:12:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-110</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>Our current restrictions on sudo would not prevent an attacker from exploiting an actual vulnerability in the program itself. For example, the widely-publicised buffer overflow vulnerability discovered a few months ago can still be exploited to gain root access. sudo is a very complex program and is setuid so vulnerabilities in it can allow privilege escalation, regardless of our root access restrictions. To help against this, we can restrict the file permissions of the executable to only allow users within group <code>sudo</code> to execute it at all in the first place. This will prevent e.g. a compromised <code>sdwdate</code> user from exploiting it.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/109">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/109</link>
        <pubDate>Sat, 29 May 2021 16:11:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-109</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>A post was split to a new topic: <a href="http://forums.whonix.org/t/eliminate-ld-preload-and-other-dangerous-environment-variables/10594">Eliminate LD_PRELOAD and other Dangerous Environment Variables</a></p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/108">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/108</link>
        <pubDate>Sun, 15 Nov 2020 17:53:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-108</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>The number of ways the lockdown patches increases root / kernel separation. Can be useful to see what needs to be done besides toggling the sysctl when 5.4 hits:</p>
<p><a href="https://mjg59.dreamwidth.org/55105.html" class="onebox" target="_blank">https://mjg59.dreamwidth.org/55105.html</a></p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/107">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/107</link>
        <pubDate>Thu, 23 Apr 2020 13:43:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-107</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>There are some device timing sidechannels that may be dangerous although I’ve not seen proof of them being used as a full-blown keylogger yet. Grsecurity fixed this by restricting them to CAP_MKNOD.</p>
<p><a href="https://en.wikibooks.org/wiki/Grsecurity/Appendix/Grsecurity_and_PaX_Configuration_Options#Eliminate_stat/notify-based_device_sidechannels" class="onebox" target="_blank">https://en.wikibooks.org/wiki/Grsecurity/Appendix/Grsecurity_and_PaX_Configuration_Options#Eliminate_stat/notify-based_device_sidechannels</a></p>
<blockquote>
<p>If you say Y here, timing analyses on block or character devices like /dev/ptmx using stat or inotify/dnotify/fanotify will be thwarted for unprivileged users.  If a process without CAP_MKNOD stats such a device, the last access and last modify times will match the device’s create time.  No access or modify events will be triggered through inotify/dnotify/fanotify for such devices.<br>
This feature will prevent attacks that may at a minimum allow an attacker to determine the administrator’s password length.</p>
</blockquote>
<p>Thankfully, linux-hardened has this.</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/anthraxx/linux-hardened/commit/72b66e85807fd92b0c8ee53df59492806a6234aa" target="_blank">github.com/anthraxx/linux-hardened</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/anthraxx/linux-hardened/commit/72b66e85807fd92b0c8ee53df59492806a6234aa" target="_blank">restrict device timing side channels</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2017-05-16" data-time="22:26:10" data-timezone="UTC">10:26PM - 16 May 17 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/thestinger" target="_blank">
          <img alt="thestinger" src="https://avatars1.githubusercontent.com/u/1505226?v=4" class="onebox-avatar-inline" width="20" height="20">
          thestinger
        </a>
        
      </div>

      <div class="lines" title="changed 6 files with 55 additions and 5 deletions">
        <a href="https://github.com/anthraxx/linux-hardened/commit/72b66e85807fd92b0c8ee53df59492806a6234aa" target="_blank">
          <span class="added">+55</span>
          <span class="removed">-5</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">Based on the public grsecurity patches.</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Will need to do more research to see how dangerous this is. I’ll add it to the wiki.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/106">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/106</link>
        <pubDate>Wed, 22 Apr 2020 22:17:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-106</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>madaidan via Whonix Forum:</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="102" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If one can log keystrokes</p>
</blockquote>
</aside>
<p>LD_PRELOAD is how they can log keystrokes.</p>
</blockquote>
<p>Also xinput (<br>
<a href="https://blog.invisiblethings.org/2011/04/23/linux-security-circus-on-gui-isolation.html" class="onebox" target="_blank">https://blog.invisiblethings.org/2011/04/23/linux-security-circus-on-gui-isolation.html</a><br>
).</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="102" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>and view all data in /home/user</p>
</blockquote>
</aside>
<p>For example, you aren’t storing your passwords in /home/user (I hope) but you are entering them into websites in your browser. LD_PRELOAD can hook into the browser and grab passwords.</p>
<p>If an attacker can set LD_PRELOAD globally, security in the user’s session is basically non-existent. Not even sandboxing etc. would help as they can just hook into the sandbox program too.</p>
<p>LD_PRELOAD can also likely introduce new arbitrary code to bypass <code>noexec</code>/TPE/apparmor execution restrictions. They can probably run</p>
<pre><code>LD_PRELOAD=/path/to/malicious_libary /bin/echo test
</code></pre>
<p>that redefines <code>printf()</code> to a new function that exploits some vulnerability.</p>
</blockquote>
<p>These are really good reasons. Needs to be documented when implemented.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/105">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/105</link>
        <pubDate>Thu, 26 Mar 2020 10:30:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-105</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>It appears that environment scrubbing won’t be a solution after all. I think it only applies to profile transitions i.e. transitioning from init-systemd to another profile. So we can’t just enable it globally to get rid of LD_PRELOAD.</p>
<p>The issue with enabling it globally I talked about in the apparmor-profile-everything thread was to do with /lib. If you exclude just that, you can get near-global environment scrubbing. Testing LD_PRELOAD with hardened_malloc and <code>cat /proc/self/maps</code> still worked fine indicating it’s not effective for non-profile transitions.</p>
<p>This is also further backed up by the fact that there is no environment scrubbing available for the <code>ix</code> permission. Only permissions that transition profiles do such as <code>Px</code> or <code>Cx</code>.</p>
<p>We’d need to disable LD_PRELOAD in another way.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/104">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/104</link>
        <pubDate>Wed, 25 Mar 2020 18:10:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-104</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="102" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If one can log keystrokes</p>
</blockquote>
</aside>
<p>LD_PRELOAD is how they can log keystrokes.</p>
<aside class="quote no-group" data-username="Patrick" data-post="102" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>and view all data in /home/user</p>
</blockquote>
</aside>
<p>For example, you aren’t storing your passwords in /home/user (I hope) but you are entering them into websites in your browser. LD_PRELOAD can hook into the browser and grab passwords.</p>
<p>If an attacker can set LD_PRELOAD globally, security in the user’s session is basically non-existent. Not even sandboxing etc. would help as they can just hook into the sandbox program too.</p>
<p>LD_PRELOAD can also likely introduce new arbitrary code to bypass <code>noexec</code>/TPE/apparmor execution restrictions. They can probably run</p>
<pre><code>LD_PRELOAD=/path/to/malicious_libary /bin/echo test
</code></pre>
<p>that redefines <code>printf()</code> to a new function that exploits some vulnerability.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/103">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/103</link>
        <pubDate>Wed, 25 Mar 2020 15:52:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-103</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Use case?</p>
<p>Threat scenario: compromised user <code>user</code> but no root compromise.</p>
<p>If one can log keystrokes and view all data in /home/user, I don’t see much extra harm with LD_PRELOAD.</p>
<p>LD_PRELOAD prevention would lower attack surface for root compromise if combined with noexec? Then no new, extra, arbitrary code could be downloaded/created executed? That might depend on the type of exploit used to gain user <code>user</code> compromise.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/102">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/102</link>
        <pubDate>Wed, 25 Mar 2020 02:50:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-102</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox wikipedia">
  <header class="source">
      <a href="https://en.wikipedia.org/wiki/DLL_injection" target="_blank">en.wikipedia.org</a>
  </header>
  <article class="onebox-body">
    

<h3><a href="https://en.wikipedia.org/wiki/DLL_injection" target="_blank">DLL injection</a></h3>

<p>
In computer programming, DLL injection is a technique used for running code within the address space of another process by forcing it to load a dynamic-link library. DLL injection is often used by external programs to influence the behavior of another program in a way its authors did not anticipate or intend. For example, the injected code could hook system function calls, or read the contents of password textboxes, which cannot be done the usual way. A program used to injec There are multiple w...</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>^ the LD_PRELOAD thing I was talking about.</p>
<p>I think we should just enable environment scrubbing globally in apparmor-profile-everything and sandbox-app-launcher.</p>
<p>hardened_malloc isn’t a big issue currently as we aren’t using it for much yet. If we want to use it, we can just set it in /etc/ld.so.preload. I don’t see much breakage with it anyway.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/101">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/101</link>
        <pubDate>Tue, 24 Mar 2020 20:31:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-101</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="99" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Though the actual implementation of <code>rbash</code> at is <a href="https://en.wikipedia.org/wiki/Restricted_shell#Weaknesses_of_a_restricted_shell">quite limited</a></p>
</blockquote>
</aside>
<p>Interpreter lock should fix that. Deny execution of the real shells and only allow rbash.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/100">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/100</link>
        <pubDate>Mon, 23 Mar 2020 16:44:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-100</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="97" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<p>Control/spy on the memory of the application?</p>
</blockquote>
<p>Yes. LD_PRELOAD can hook into all processes and can be used to spy on essentially everything in the user’s session. It’s used in many rootkits such as the example I gave above <a href="https://github.com/naworkcaj/bdvl">https://github.com/naworkcaj/bdvl</a></p>
<p>It’s similar to ptrace in a sense.</p>
</blockquote>
</aside>
<p>OK.</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="97" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<p>Would <a href="https://phabricator.whonix.org/T941">interpreter lock</a> help?</p>
</blockquote>
<p>That would entail removing all shell access which might be far too restrictive. Users wouldn’t be able to even open their terminals anymore.</p>
</blockquote>
</aside>
<p><a href="https://phabricator.whonix.org/T941">interpreter lock</a> doesn’t necessarily have to become a default enabled feature. That’s actually unlikely. Not sure yet.</p>
<p>On top of user / admin / superadmin boot modes, users who boot into user mode could choose to turn that user <code>user</code> into a additionally restricted user (new term required also vs normal user <code>user</code>). In such a mode the user would only be able to do a few things such as starting high risk applications. Or perhaps for example one mode would only allow to run Tor Browser but nothing else. Suppose the Tor Browser process would be compromised, the attacker couldn’t do much if we suppose /home/, /tmp, etc. noexec, interpreter lock, restricted shell, apparmor, sandbox, and whatnot. That would be similar to Chromium OS (<a href="https://chromium.googlesource.com/chromiumos/docs/+/master/security/noexec_shell_scripts.md">which has interpreter lock</a>) or Android. I.e. some users might choose to reduce the functionality of their VM in order to get better security.</p>
<aside class="quote no-group" data-username="madaidan" data-post="98" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Maybe we could create a <a href="https://en.wikipedia.org/wiki/Restricted_shell">restricted shell</a>?</p>
</blockquote>
</aside>
<p>Yes. The concept is good.<br>
Though the actual implementation of <code>rbash</code> at is <a href="https://en.wikipedia.org/wiki/Restricted_shell#Weaknesses_of_a_restricted_shell">quite limited</a><br>
But maybe that could be improved. Perhaps such fixed restricted shells already exist.</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="97" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<pre><code class="lang-auto">unset DISPLAY
</code></pre>
</blockquote>
<p>mousepad</p>
<blockquote>
<pre><code class="lang-auto"></code></pre>
</blockquote>
<p>That won’t work. The attacker can just reset <code>$DISPLAY</code> :</p>
<pre><code class="lang-auto">DISPLAY=:0.0 mousepad
</code></pre>
</blockquote>
</aside>
<p>The DISPLAY variable is just to start imagination. Maybe apparmor, sandbox, restricted shell or something could prohibit from setting the DISPLAY variable? Or some other environment variable? Or DISPLAY (or so) containing a random hash which cannot be guessed/find out by the attacker?</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/99">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/99</link>
        <pubDate>Mon, 23 Mar 2020 10:46:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-99</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="97" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Control/spy on the memory of the application?</p>
</blockquote>
</aside>
<p>Yes. LD_PRELOAD can hook into all processes and can be used to spy on essentially everything in the user’s session. It’s used in many rootkits such as the example I gave above <a href="https://github.com/naworkcaj/bdvl">https://github.com/naworkcaj/bdvl</a></p>
<p>It’s similar to ptrace in a sense.</p>
<aside class="quote no-group" data-username="Patrick" data-post="97" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would <a href="https://phabricator.whonix.org/T941">interpreter lock</a> help?</p>
</blockquote>
</aside>
<p>That would entail removing all shell access which might be far too restrictive. Users wouldn’t be able to even open their terminals anymore.</p>
<p>Maybe we could create a <a href="https://en.wikipedia.org/wiki/Restricted_shell">restricted shell</a>?</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="97" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>There’s still risk of malicious process drawing malicious fake windows? And that issue cannot be resolved? Or could we invent something like “scripts/programs running in /home, /tmp shall not be able to create GUI windows?"</p>
</blockquote>
</aside>
<p>I think it’s a good idea. We’d need to research how though.</p>
<aside class="quote no-group" data-username="Patrick" data-post="97" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<pre><code class="lang-auto">unset DISPLAY
mousepad
</code></pre>
</blockquote>
</aside>
<p>That won’t work. The attacker can just reset <code>$DISPLAY</code>:</p>
<pre><code>DISPLAY=:0.0 mousepad</code></pre>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/98">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/98</link>
        <pubDate>Sun, 22 Mar 2020 23:45:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-98</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="96" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Yes, LD_PRELOAD can be abused for a lot more than just getting the sudo password. The attacker can just add</p>
<pre><code class="lang-auto">export LD_PRELOAD=/path/to/malicious_library
</code></pre>
<p>to <code>~/.bashrc</code> or similar to compromise all programs in the user’s session. It’s not just monitoring keystrokes but a full compromise.</p>
</blockquote>
</aside>
<p>What else an attacker running a malicious process under user <code>user</code> (and therefore ability to spy on keystrokes and read all files by user <code>user</code> would want? That seems to me as a pretty complete compromise (except root). I.e. what do you mean by full compromise? Control/spy on the memory of the application?</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="95" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<p>By that, do you mean dotfiles in home folder such as .bash_profile .bash_login .bash_logout .profile (and <a href="https://github.com/tasket/Qubes-VM-hardening/blob/master/vm-boot-protect.sh#L37">others</a>)?</p>
</blockquote>
<p>Doesn’t have to be them specifically. My example, <code>/tmp/sudo</code> would still work when <code>/tmp</code> is mounted with <code>noexec</code> because <code>/bin/bash</code> is still executable.</p>
</blockquote>
</aside>
<p>Ah, <code>bash /path/to/script</code>. That was non-obvious to me. Clarified in wiki just now. Would <a href="https://phabricator.whonix.org/T941">interpreter lock</a> help?</p>
<p><code>/bin/bash</code> is the actual real, non-malicious bash. And in this threat model user <code>user</code> is compromised while sudo/root is not compromised yet and desired stay that way. Therefore <code>/bin/bash</code> is not writeable by the attacker, i.e. cannot be replaced with a malicious bash version by the attacker.</p>
<p>Even if we had interpreter lock and immutable dotfiles… There’s still risk of malicious process drawing malicious fake windows? And that issue cannot be resolved? Or could we invent something like “scripts/programs running in /home, /tmp shall not be able to create GUI windows?” Dunno if this would be a viable path…</p>
<pre><code>unset DISPLAY
mousepad
</code></pre>
<blockquote>
<p>Unable to init server: Could not connect: Connection refused</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/97">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/97</link>
        <pubDate>Sun, 22 Mar 2020 23:34:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-97</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="95" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Is that worth it if fake sudo issue cannot be solved?</p>
</blockquote>
</aside>
<p>Yes, LD_PRELOAD can be abused for a lot more than just getting the sudo password. The attacker can just add</p>
<pre><code>export LD_PRELOAD=/path/to/malicious_library
</code></pre>
<p>to <code>~/.bashrc</code> or similar to compromise all programs in the user’s session. It’s not just monitoring keystrokes but a full compromise.</p>
<aside class="quote no-group" data-username="Patrick" data-post="95" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>By that, do you mean dotfiles in home folder such as .bash_profile .bash_login .bash_logout .profile (and <a href="https://github.com/tasket/Qubes-VM-hardening/blob/master/vm-boot-protect.sh#L37">others</a>)?</p>
</blockquote>
</aside>
<p>Doesn’t have to be them specifically. My example, <code>/tmp/sudo</code> would still work when <code>/tmp</code> is mounted with <code>noexec</code> because <code>/bin/bash</code> is still executable.</p>
<p>Those dotfiles are especially dangerous as they’re sourced upon login and can be used for persistent rootkits.</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/96">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/96</link>
        <pubDate>Sun, 22 Mar 2020 23:10:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-96</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
      <item>
        <title>Restrict root access</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="94" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>The LD_PRELOAD solution isn’t meant to solve the fake sudo issue.</p>
</blockquote>
</aside>
<p>Is that worth it if fake sudo issue cannot be solved?</p>
<blockquote>
<p>Mounting all user-writeable places such as /home and /tmp as non-executable is not a solution because an attacker can use the bash interpreter to bypass the restrictions.</p>
</blockquote>
<p>By that, do you mean dotfiles in home folder such as .bash_profile .bash_login .bash_logout .profile (and <a href="https://github.com/tasket/Qubes-VM-hardening/blob/master/vm-boot-protect.sh#L37">others</a>)?</p>
<p>I was wondering anyhow if such vulnerable files should be made immutable (a root script running <code>chattr +i file-name</code> on these). That could be a feature of <a href="https://www.whonix.org/wiki/Dev/VirusForget">VirusForget</a>. Though, it might be an impossible game of whack a mole trying to close all the vulnerable files in home folders that could be abused for virus persistence among reboots. (I <a href="https://github.com/tasket/Qubes-VM-hardening/issues/38">reported</a> <code>~/.pam_environment</code> during unrelated development reading a man page.) Or perhaps AppArmor could be configured to only allow XFCE to write into folders such as <code>~/.config/xfce</code>?</p>
<p>But could such solutions might never be sufficient to fix the <a href="https://www.whonix.org/wiki/Dev/Strong_Linux_User_Account_Isolation#sudo_password_sniffing">fake sudo prompt issue</a>?</p>
<p>One definition of a compromised user <code>user</code> account includes that some malicious process (Trojan horse) is running there already wanting to gain sudo/root access. Such a process could paint its own lxsudo window. There are also utilities (therefore probably also APIs) which allow scripts/programs to do keystroke entries and mice movements. A malicious program could open a fake xfce4-terminal emulator window. (Perhaps open fake xfce4-terminal in background, redraw contents from real xfce4-terminal in background, close real xfce4-terminal.)</p>
<p>Qubes has trusted window decorations. VM window title bars have identifiers such as [private] or [vault], the VM name. And the window decorations (color frames).<br>
( <a href="https://www.qubes-os.org/getting-started/">https://www.qubes-os.org/getting-started/</a> )<br>
(Trusted window manager.)</p>
<p>In Desktop Linux there is no such distinctions. There is no way to know for any user which process is drawing a window if the user account is compromised. I.e. a fake sudo prompt cannot be distinguished from a real sudo prompt. Or a fake xfce4-terminal cannot be distinguished from a real xfce4-terminal. Therefore I guess there can be no solution for the fake sudo prompt issue except user <code>user</code> not being a member of group <code>sudo</code>. (Except perhaps inventing something similar as a trusted window manager.)</p>
          <p><a href="http://forums.whonix.org/t/restrict-root-access/7658/95">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/restrict-root-access/7658/95</link>
        <pubDate>Sun, 22 Mar 2020 22:40:28 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7658-95</guid>
        <source url="http://forums.whonix.org/t/restrict-root-access/7658.rss">Restrict root access</source>
      </item>
  </channel>
</rss>
