<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Restrict root access - #46 by Patrick - Development - Whonix Forum</title>
    <meta name="description" content="It would be good to restrict root access to make it a lot harder to login as root. 
Uncommenting, auth required pam_wheel.so in /etc/pam.d/su will make it so only users in the root group can use su. This can prevent a co&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../76589ba9.html?page=3" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Restrict root access&#39;" href="../7658.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/restrict-root-access/7658/46" />
<meta name="twitter:url" content="https://forums.whonix.org/t/restrict-root-access/7658/46" />
<meta property="og:title" content="Restrict root access" />
<meta name="twitter:title" content="Restrict root access" />
<meta property="og:description" content="How to boot into recovery (single user) mode is now documented: https://www.whonix.org/wiki/Recovery#Recovery_Mode   The issue with locking and expiring root account is, that it breaks recovery mode.   Cannot open access to console, the root account is locked.  See sulogin(8) man page for more details.   Solution: passwordless recovery console  References:   https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=802211 https://salsa.debian.org/ah/user-setup/commit/bc5ca2de85ec27845d0b46059cb7cc02bae7..." />
<meta name="twitter:description" content="How to boot into recovery (single user) mode is now documented: https://www.whonix.org/wiki/Recovery#Recovery_Mode   The issue with locking and expiring root account is, that it breaks recovery mode.   Cannot open access to console, the root account is locked.  See sulogin(8) man page for more details.   Solution: passwordless recovery console  References:   https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=802211 https://salsa.debian.org/ah/user-setup/commit/bc5ca2de85ec27845d0b46059cb7cc02bae7..." />
<meta property="article:published_time" content="2019-07-17T18:39:09+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="../76584658.html?page=2">
        <link rel="next" href="../7658fdb0.html?page=4">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7658.html">Restrict root access</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../../tag/status_closed_issue_implemented.html' class='discourse-tag' rel="tag">status_closed_issue_implemented</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T12:22:07Z' class='post-time'>
                July 14, 2019, 12:22pm
              </time>
              <meta itemprop='dateModified' content='2019-07-14T12:22:07Z'>
          <span itemprop='position'>#41</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="40" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I don’t think that by itself would have worked? Did you test that?</p>
</blockquote>
</aside>
<p>Yes, that works fine.</p>
<aside class="quote no-group" data-post="40" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>So we would have had to create a group <code>root</code> and add user <code>user</code> to that group <code>root</code> too.</p>
</blockquote>
</aside>
<p>Group <code>root</code> is created by default.</p>
<p>I think we should just leave it as is and not add the user to the <code>root</code> group. I don’t see any reason why they should be able to use <code>su</code> instead of just using <code>sudo</code>.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>
          <meta itemprop='keywords' content='component_security, status_closed_issue_implemented'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T12:45:40Z' class='post-time'>
                July 14, 2019, 12:45pm
              </time>
              <meta itemprop='dateModified' content='2019-07-14T12:45:40Z'>
          <span itemprop='position'>#42</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Please review:</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/cfdf46b3913a0b176814c93f5343d0b31462393f" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-base-files</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/cfdf46b3913a0b176814c93f5343d0b31462393f" target="_blank" rel="nofollow noopener">lock and expire root account in new Whonix builds</a>
</h4>

  <pre class="message" style="white-space: normal;">https://forums.whonix.org/t/restrict-root-access/7658
https://www.whonix.org/wiki/Dev/Permissions
https://www.whonix.org/wiki/Root</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/cfdf46b3913a0b176814c93f5343d0b31462393f" target="_blank" rel="nofollow noopener">12:39PM - 14 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>17 additions</strong>
  and <strong>0 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>New wiki page:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:120/63;"><img src="../../../../external.html?link=https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail"></div>

<h3><a href="../../../../external.html?link=https://www.whonix.org/wiki/Root" target="_blank" rel="nofollow noopener">Root</a></h3>

<p>Tips on using sudo / root safely</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-post="41" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Group <code>root</code> is created by default.</p>
</blockquote>
</aside>
<p>Indeed.</p>
<aside class="quote no-group" data-post="41" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I think we should just leave it as is and not add the user to the <code>root</code> group. I don’t see any reason why they should be able to use <code>su</code> instead of just using <code>sudo</code> .</p>
</blockquote>
</aside>
<p>Reasons for making <code>su</code> work:</p>
<ul>
<li>less things broken by default.</li>
<li>if <code>sudo</code> is broken, one can recover using <code>su</code>? (Otherwise the only option would be to boot into single user / recovery mode?)</li>
</ul>
<p>Reasons against making <code>su</code> work:</p>
<ul>
<li>attack surface <code>su</code> vs <code>sudo</code>? But also not really since one could still use <code>sudo su</code>?</li>
</ul>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T12:51:56Z' class='post-time'>
                July 14, 2019, 12:51pm
              </time>
              <meta itemprop='dateModified' content='2019-07-14T12:51:56Z'>
          <span itemprop='position'>#43</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="42" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>less things broken by default.</p>
</blockquote>
</aside>
<p>The root account will be locked so the user can’t use <code>su</code> to login to the root account. Unless the user is using <code>su</code> to switch to system accounts which is unlikely, nothing more will be broken.</p>
<aside class="quote no-group" data-post="42" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>if <code>sudo</code> is broken, one can recover using <code>su</code> ?</p>
</blockquote>
</aside>
<p>Probably not since the root account is locked.</p>
<aside class="quote no-group" data-post="42" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But also not really since one could still use <code>sudo su</code> ?</p>
</blockquote>
</aside>
<p><code>su</code> requires the account you’re logging into’s password rather than <code>sudo su</code> which just requires the user’s password. If there is a weak password for other accounts but a strong one for the user account, an attacker can easily login to other accounts without needing to know the user’s password (the strong one).</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-15T13:14:46Z' class='post-time'>
                July 15, 2019,  1:14pm
              </time>
              <meta itemprop='dateModified' content='2019-07-15T13:14:46Z'>
          <span itemprop='position'>#44</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Makes a lot sense. Removed <code>group=sudo</code>.</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/2f276cdb10aedf0d30c01d25e50b17cac7d1c62c" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/2f276cdb10aedf0d30c01d25e50b17cac7d1c62c" target="_blank" rel="nofollow noopener">set back to default group "root" rather than group "sudo" membership required to use su</a>
</h4>

  <pre class="message" style="white-space: normal;">since root login will be locked by default anyhow
Thanks to @madaidan for providing the rationale!
https://forums.whonix.org/t/restrict-root-access/7658/42</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/2f276cdb10aedf0d30c01d25e50b17cac7d1c62c" target="_blank" rel="nofollow noopener">12:44PM - 15 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>2 additions</strong>
  and <strong>2 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-17T18:29:14Z' class='post-time'>
                July 17, 2019,  6:29pm
              </time>
              <meta itemprop='dateModified' content='2019-07-17T18:29:14Z'>
          <span itemprop='position'>#45</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Reverted above commit. Reasons:</p>
<p>As it was before, there was no more way to run commands as root. <code>sudo something</code> was broken. This is because of the way it is implemented now. Which is no longer editing <code>/etc/pam.d/su</code> (bad as explained above) but <code>/usr/share/pam-configs/</code> (standard conform) mechanism. Therefore <code>auth required pam_wheel.so debug</code> does not only apply to <code>su</code> but any file using <code>/etc/pam.d/common-auth</code> which includes <code>sudo</code>.</p>
<p>In result members of the group <code>sudo</code> will be able to use both, <code>su</code> and <code>sudo</code>.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-17T18:39:09Z' class='post-time'>
                July 17, 2019,  6:39pm
              </time>
              <meta itemprop='dateModified' content='2019-07-17T18:39:09Z'>
          <span itemprop='position'>#46</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>How to boot into recovery (single user) mode is now documented: <a href="../../../../external.html?link=https://www.whonix.org/wiki/Recovery#Recovery_Mode" rel="nofollow noopener">https://www.whonix.org/wiki/Recovery#Recovery_Mode</a></p>
<hr>
<p>The issue with locking and expiring root account is, that it breaks recovery mode.</p>
<blockquote>
<p>Cannot open access to console, the root account is locked.<br>
See sulogin(8) man page for more details.</p>
</blockquote>
<p>Solution: <strong>passwordless</strong> recovery console<br>
References:</p>
<ul>
<li><a href="../../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=802211" rel="nofollow noopener">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=802211</a></li>
<li><a href="../../../../external.html?link=https://salsa.debian.org/ah/user-setup/commit/bc5ca2de85ec27845d0b46059cb7cc02bae7b44d" rel="nofollow noopener">https://salsa.debian.org/ah/user-setup/commit/bc5ca2de85ec27845d0b46059cb7cc02bae7b44d</a></li>
</ul>
<p>One could argue this is insecure in very special situations (such as kios mode or without <a href="../../../../external.html?link=https://www.whonix.org/wiki/Full_Disk_Encryption" rel="nofollow noopener">FDE</a>) (see references above) but I think the balance locked/expired root account in regular boot mode and functional recovery mode is more important. Recovery mode on real hardware can still be secured by using some of the following combinations: BIOS password protection; grub password protection; FDE.</p>
<hr>
<p>Expired root password breaks lxsu but not lxsudo which is ok.</p>
<hr>
<p>When locking root account, when trying to login as root at virtual console will say:</p>
<blockquote>
<p>Login incorrect.</p>
</blockquote>
<p>Without previously asking for a password. This is not the worst case for usability. Better than asking for password and then failing. Will update /etc/<a href="../../../../external.html?link=https://github.com/Whonix/whonix-base-files/blob/master/etc/issue.whonix" rel="nofollow noopener">issue.whonix</a> to document this.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../whonix-desktop-installer-with-calamares-field-report/7350/91.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../whonix-desktop-installer-with-calamares-field-report/7350/91.html'>
                      <span itemprop='name'>Whonix Desktop Installer with Calamares - field report</span>
                    </a>
                    <meta itemprop='position' content='6'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T00:14:56Z' class='post-time'>
                July 19, 2019, 12:14am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T00:14:56Z'>
          <span itemprop='position'>#47</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="45" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>As it was before, there was no more way to run commands as root. <code>sudo something</code> was broken. This is because of the way it is implemented now. Which is no longer editing <code>/etc/pam.d/su</code> (bad as explained above) but <code>/usr/share/pam-configs/</code> (standard conform) mechanism. Therefore <code>auth required pam_wheel.so debug</code> does not only apply to <code>su</code> but any file using <code>/etc/pam.d/common-auth</code> which includes <code>sudo</code> .</p>
</blockquote>
</aside>
<p>That’s weird. This might work:</p>
<pre><code>su auth required pam_wheel.so</code></pre>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T00:49:01Z' class='post-time'>
                July 19, 2019, 12:49am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T00:49:01Z'>
          <span itemprop='position'>#48</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>pam-configs doesn’t seem to work for me. I’m not being restricted at all but editing /etc/pam.d/su does work.</p>
<p>I don’t know if I’ve done something wrong or not.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T09:22:53Z' class='post-time'>
                July 19, 2019,  9:22am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T09:22:53Z'>
          <span itemprop='position'>#49</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="48" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>pam-configs doesn’t seem to work for me.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-post="48" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t know if I’ve done something wrong or not.</p>
</blockquote>
</aside>
<p>Did you make a new build and install of the security-misc package? It should automate everything. (No package uninstallation required.)</p>
<p>/usr/share/pam-configs do not work on its own. That folder is ignored by pam. Running with root rights <code>pam-auth-update --package</code> is required. This is done in security-misc postinst.</p>
<p>A new line</p>
<pre><code>auth        required        pam_wheel.so debug group=sudo
</code></pre>
<p>will be added in /etc/pam.d/common-auth.</p>
<p>Could you please put /etc/pam.d under (git) version control and/or share <code>/etc/pam.d/common-auth</code>?</p>
<p>The package is in the developers repository (among other packages which are not fully tested yet).</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T10:40:00Z' class='post-time'>
                July 19, 2019, 10:40am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T10:40:00Z'>
          <span itemprop='position'>#50</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<p>That’s weird. This might work:</p>
<pre><code>su auth required pam_wheel.so
</code></pre>
</blockquote>
<p>Doesn’t work. To be expected. The syntax of <code>usr/share/pam-configs/</code><br>
goes like this:</p>
<pre><code class="lang-auto">Auth:
	required	pam_wheel.so debug group=sudo
</code></pre>
<p>Source code of pam-auth-update looks like it only edits<br>
<code>/usr/share/pam/common-*</code> files.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T14:06:32Z' class='post-time'>
                July 19, 2019,  2:06pm
              </time>
              <meta itemprop='dateModified' content='2019-07-19T14:06:32Z'>
          <span itemprop='position'>#51</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Not sure root account locking / expiration (either or both) is a good idea yet.</p>
<p>This is happening during boot (sanity test).</p>
<pre><code>sudo --non-interactive -u root echo 'This is a test echo.'
</code></pre>
<blockquote>
<p>sudo: unable to resolve host host: No address associated with hostname<br>
sudo: account validation failure, is your account locked?</p>
</blockquote>
<p>Either root account locking and/or root account expiration is the cause of this.</p>
<p>In other words, root can probably no longer run <code>sudo -u root something</code>. Might also be a non-issue.</p>
<p>("<code>sudo: unable to resolve host host: No address associated with hostname</code>" very most likely non-issue - happening a lot during build without issue.)</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T14:35:55Z' class='post-time'>
                July 19, 2019,  2:35pm
              </time>
              <meta itemprop='dateModified' content='2019-07-19T14:35:55Z'>
          <span itemprop='position'>#52</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="49" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Did you make a new build and install of the security-misc package?</p>
</blockquote>
</aside>
<p>No, I created the file manually.</p>
<aside class="quote no-group" data-post="49" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>/usr/share/pam-configs do not work on its own. That folder is ignored by pam. Running with root rights <code>pam-auth-update --package</code> is required.</p>
</blockquote>
</aside>
<p>That worked. Thanks.</p>
<aside class="quote no-group" data-post="51" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Either root account locking and/or root account expiration is the cause of this.</p>
</blockquote>
</aside>
<p>Expiring the password for the root account forces you to set a new password when running <code>sudo -u root something</code>. This is probably the issue here.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-30T07:27:09Z' class='post-time'>
                July 30, 2019,  7:27am
              </time>
              <meta itemprop='dateModified' content='2019-07-30T07:27:09Z'>
          <span itemprop='position'>#53</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I am considering to drop <code>wheel</code>, i.e.</p>
<ul>
<li><a href="../../../../external.html?link=https://github.com/Whonix/security-misc/blob/master/usr/share/pam-configs/wheel" rel="nofollow noopener">https://github.com/Whonix/security-misc/blob/master/usr/share/pam-configs/wheel</a></li>
<li><a href="../../../../external.html?link=https://github.com/Whonix/security-misc/blob/3f9437f1ecfd292f06ce021f12cb5430da280f84/usr/share/pam-configs/wheel" rel="nofollow noopener">https://github.com/Whonix/security-misc/blob/3f9437f1ecfd292f06ce021f12cb5430da280f84/usr/share/pam-configs/wheel</a></li>
<li><code>auth required	pam_wheel.so debug group=sudo</code></li>
</ul>
<p>Because implementing it through <code>/usr/share/pam-configs/wheel</code> also applies to <code>/etc/pam.d/login</code> i.e. to <code>login</code> in a virtual console, which then fails to login with user <code>user</code> (!).</p>
<blockquote>
<p>Jul 29 15:42:13 host login[787]: pam_wheel(login:auth): Access denied to ‘root’ for ‘user’<br>
Jul 29 15:42:18 host login[787]: FAILED LOGIN (3) on ‘/dev/tty1’ FOR ‘user’, Permission denied</p>
</blockquote>
<p>Adding <code>root_only</code> to <code>auth required	pam_wheel.so debug group=sudo</code> so it would look like <code>auth required	pam_wheel.so debug group=sudo root_only</code> helped. But I am not entirely sure what that does. Form the man page:</p>
<p><a href="../../../../external.html?link=https://manpages.debian.org/pam_wheel" class="onebox" target="_blank" rel="nofollow noopener">https://manpages.debian.org/pam_wheel</a></p>
<blockquote>
<p>root_only<br>
The check for wheel membership is done only when the target user UID is 0.</p>
</blockquote>
<p>However, I am not sure pam_wheel is worth bothering with at all, since:</p>
<ul>
<li>When locking/expiring the root account, <code>su</code> isn’t relevant anymore anyhow.</li>
<li>This is further protected by using anti linux user account brueforce mechanisms such as pam_tally2 (<code>auth required pam_tally2.so deny=4 even_deny_root</code>) discussed in (<a href="../../protect-linux-user-accounts-against-brute-force-attacks/7698.html" class="inline-onebox">How strong do linux user account passwords have to be when using Full Disk Encryption (FDE) too?</a>).</li>
</ul>
<p>With these two bullet points, I don’t see what pam_wheel would give us on top.</p>
<hr>
<p>Something to look out for when testing:</p>
<blockquote>
<p>Jul 29 16:17:01 host CRON[8330]: pam_unix(cron:account): account root has expired (account expired)<br>
Jul 29 16:17:01 host audit[8330]: USER_ACCT pid=8330 uid=0 auid=4294967295 ses=4294967295 subj==unconfined msg=‘op=PAM:accounting grantors=? acct=“root” exe="/usr/sbin/cron" hostname=? addr=? terminal=cron res=failed’<br>
Jul 29 16:17:01 host cron[411]: Authentication failure<br>
Jul 29 16:17:01 host CRON[8330]: Authentication failure</p>
</blockquote>
<p>(This was probably from a misconfigured VM of mine during experimenting.)</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-30T15:05:45Z' class='post-time'>
                July 30, 2019,  3:05pm
              </time>
              <meta itemprop='dateModified' content='2019-07-30T15:05:45Z'>
          <span itemprop='position'>#54</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="53" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Because implementing it through <code>/usr/share/pam-configs/wheel</code> also applies to <code>/etc/pam.d/login</code> i.e. to <code>login</code> in a virtual console, which then fails to login with user <code>user</code> (!).</p>
</blockquote>
</aside>
<p>pam_wheel is restricting the root user. Just add the root user to the sudo group and it works fine.</p>
<aside class="quote no-group" data-post="53" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>With these two bullet points, I don’t see what pam_wheel would give us on top.</p>
</blockquote>
</aside>
<p>pam_wheel would prevent a compromised system user from using <code>su</code> to access the user’s account. Bruteforce protection won’t help if the attacker already know’s the user’s password so pam_wheel will still help with that.</p>
<aside class="quote no-group" data-post="53" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Something to look out for when testing:</p>
</blockquote>
</aside>
<p>I’m not getting that error. It’s probably related to something else.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-31T05:53:25Z' class='post-time'>
                July 31, 2019,  5:53am
              </time>
              <meta itemprop='dateModified' content='2019-07-31T05:53:25Z'>
          <span itemprop='position'>#55</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="54" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>pam_wheel would prevent a compromised system user from using <code>su</code> to access the user’s account.</p>
</blockquote>
</aside>
<p>Right. This is amazing. Note to self:<br>
A compromised account (such as user <code>man</code>) could not attempt to <code>su</code> to user <code>user</code> even if the password is known - such as if the user keeps using the default password, which probably many users are doing. Combined with a locked/expired root account, this gives effective per-user separation.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-31T06:21:20Z' class='post-time'>
                July 31, 2019,  6:21am
              </time>
              <meta itemprop='dateModified' content='2019-07-31T06:21:20Z'>
          <span itemprop='position'>#56</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I am wondering if this will break something. Are there any existing legitimate packages/software which use <code>su</code> (or <code>runuser</code>)?</p>
<p>Checked Debian maintainer scripts.</p>
<pre><code>grep -r runuser /var/lib/dpkg/info
grep -r "su " /var/lib/dpkg/info
</code></pre>
<p>More to check:</p>
<p><a href="../../../../external.html?link=https://codesearch.debian.net/search?q=runuser" class="onebox" target="_blank" rel="nofollow noopener">https://codesearch.debian.net/search?q=runuser</a></p>
<p>Seems like there are some. (Check box <code>Group search results by Debian source package</code>.)</p>
<p><a href="../../../../external.html?link=https://manpages.debian.org/pam_rootok" rel="nofollow noopener">https://manpages.debian.org/pam_rootok</a> / <code>auth sufficient pam_rootok.so</code> might help. That would “at least” allow root to always do anything.</p>
<p>I am wondering if we are already effectively using <code>pam_rootok</code> anyhow?</p>
<p>Would<br>
<code>auth sufficient pam_rootok.so</code><br>
above<br>
<code>auth required	pam_wheel.so debug group=sudo</code></p>
<p>i.e.</p>
<pre><code>auth sufficient pam_rootok.so
auth required	pam_wheel.so debug group=sudo
</code></pre>
<p>Cause any security issue?</p>
<p><code>auth sufficient pam_rootok.so</code> might actually be the same as adding user <code>root</code> to group <code>sudo</code>. I don’t see any reason not to add user <code>root</code> to group <code>sudo</code>. It seems a bit weird that this is required but no real disadvantage.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-31T07:23:49Z' class='post-time'>
                July 31, 2019,  7:23am
              </time>
              <meta itemprop='dateModified' content='2019-07-31T07:23:49Z'>
          <span itemprop='position'>#57</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>pam_rootok was a bad idea since it allows login in virtual console without a password.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-31T18:05:09Z' class='post-time'>
                July 31, 2019,  6:05pm
              </time>
              <meta itemprop='dateModified' content='2019-07-31T18:05:09Z'>
          <span itemprop='position'>#58</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="56" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I am wondering if this will break something. Are there any existing legitimate packages/software which use <code>su</code> (or <code>runuser</code> )?</p>
</blockquote>
</aside>
<p><code>runuser</code> can only be executed by root anyway. I doubt <code>runuser</code> would be restricted with pam_wheel and even if it was, it could be fixed by just adding the root user to the sudo group.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-10T10:53:14Z' class='post-time'>
                August 10, 2019, 10:53am
              </time>
              <meta itemprop='dateModified' content='2019-08-10T10:53:14Z'>
          <span itemprop='position'>#59</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Need to set the root account to be expired by default<br>
(<code>sudo chage --expiredate 0 root</code>)<br>
since that causes an issue.</p>
<pre><code>sudo adduser user2
Adding user `user2' ...
Adding new group `user2' (1001) ...
Adding new user `user2' (1001) with group `user2' ...
Creating home directory `/home/user2' ...
Copying files from `/etc/skel' ...
New password: 
Retype new password: 
passwd: password updated successfully
Your account has expired; please contact your system administrator
chfn: PAM: Authentication failure
adduser: `/usr/bin/chfn user2' returned error code 1. Exiting

Aug 10 07:38:15 host sudo[2774]: pam_wheel(sudo:auth): Ignoring access request 'user' for 'user'
Aug 10 07:38:15 host sudo[2774]: pam_tally2(sudo:auth): user user (1000) tally 3, deny 5
Aug 10 07:38:18 host sudo[2774]: pam_unix(sudo:auth): authentication failure; logname= uid=1000 euid=0 tty=/dev/pts/1 ruser=user rhost=  user=user
Aug 10 07:38:18 host audit[2774]: USER_AUTH pid=2774 uid=1000 auid=1000 ses=1 subj==unconfined msg='op=PAM:authentication grantors=? acct="user" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=failed'
Aug 10 07:38:19 host sudo[2774]: pam_wheel(sudo:auth): Ignoring access request 'user' for 'user'
Aug 10 07:38:19 host sudo[2774]: pam_tally2(sudo:auth): user user (1000) tally 4, deny 5
Aug 10 07:38:22 host audit[2774]: USER_AUTH pid=2774 uid=1000 auid=1000 ses=1 subj==unconfined msg='op=PAM:authentication grantors=pam_tally2,pam_permit acct="user" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 10 07:38:22 host audit[2774]: USER_ACCT pid=2774 uid=1000 auid=1000 ses=1 subj==unconfined msg='op=PAM:accounting grantors=pam_permit acct="user" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 10 07:38:22 host audit[2774]: USER_CMD pid=2774 uid=1000 auid=1000 ses=1 subj==unconfined msg='cwd="/home/user" cmd=61646475736572207573657232 terminal=pts/1 res=success'
Aug 10 07:38:22 host sudo[2774]:     user : TTY=pts/1 ; PWD=/home/user ; USER=root ; COMMAND=/usr/sbin/adduser user2
Aug 10 07:38:22 host audit[2774]: CRED_REFR pid=2774 uid=0 auid=1000 ses=1 subj==unconfined msg='op=PAM:setcred grantors=pam_tally2,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 10 07:38:22 host sudo[2774]: pam_unix(sudo:session): session opened for user root by (uid=0)
Aug 10 07:38:22 host audit[2774]: USER_START pid=2774 uid=0 auid=1000 ses=1 subj==unconfined msg='op=PAM:session_open grantors=pam_permit,pam_umask,pam_unix,pam_cgfs acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 10 07:38:22 host audit[2776]: ADD_GROUP pid=2776 uid=0 auid=1000 ses=1 subj==unconfined msg='op=adding group to /etc/group id=1001 exe="/usr/sbin/groupadd" hostname=host addr=? terminal=pts/1 res=success'
Aug 10 07:38:22 host groupadd[2776]: group added to /etc/group: name=user2, GID=1001
Aug 10 07:38:22 host audit[2776]: ADD_GROUP pid=2776 uid=0 auid=1000 ses=1 subj==unconfined msg='op=adding group to /etc/gshadow id=1001 exe="/usr/sbin/groupadd" hostname=host addr=? terminal=pts/1 res=success'
Aug 10 07:38:22 host groupadd[2776]: group added to /etc/gshadow: name=user2
Aug 10 07:38:22 host audit[2776]: ADD_GROUP pid=2776 uid=0 auid=1000 ses=1 subj==unconfined msg='op= id=1001 exe="/usr/sbin/groupadd" hostname=host addr=? terminal=pts/1 res=success'
Aug 10 07:38:22 host groupadd[2776]: new group: name=user2, GID=1001
Aug 10 07:38:23 host useradd[2780]: new user: name=user2, UID=1001, GID=1001, home=/home/user2, shell=/bin/bash
Aug 10 07:38:23 host audit[2780]: ADD_USER pid=2780 uid=0 auid=1000 ses=1 subj==unconfined msg='op=adding user id=1001 exe="/usr/sbin/useradd" hostname=host addr=? terminal=pts/1 res=success'
Aug 10 07:38:23 host audit[2783]: USER_ACCT pid=2783 uid=0 auid=1000 ses=1 subj==unconfined msg='pam_tally2 uid=1001 reset=0 exe="/sbin/pam_tally2" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 10 07:38:26 host passwd[2788]: pam_unix(passwd:chauthtok): password changed for user2
Aug 10 07:38:26 host audit[2788]: USER_CHAUTHTOK pid=2788 uid=0 auid=1000 ses=1 subj==unconfined msg='op=PAM:chauthtok grantors=pam_permit acct="user2" exe="/usr/bin/passwd" hostname=host addr=? terminal=pts/1 res=success'
Aug 10 07:38:26 host audit[2789]: USER_AUTH pid=2789 uid=0 auid=1000 ses=1 subj==unconfined msg='op=PAM:authentication grantors=pam_rootok acct="root" exe="/usr/bin/chfn" hostname=host addr=? terminal=pts/1 res=success'
Aug 10 07:38:26 host chfn[2789]: pam_unix(chfn:account): account root has expired (account expired)
Aug 10 07:38:26 host audit[2789]: USER_ACCT pid=2789 uid=0 auid=1000 ses=1 subj==unconfined msg='op=PAM:accounting grantors=? acct="root" exe="/usr/bin/chfn" hostname=host addr=? terminal=pts/1 res=failed'
Aug 10 07:38:26 host chfn[2789]: Authentication failure
Aug 10 07:38:26 host sudo[2774]: pam_unix(sudo:session): session closed for user root
Aug 10 07:38:26 host audit[2774]: USER_END pid=2774 uid=0 auid=1000 ses=1 subj==unconfined msg='op=PAM:session_close grantors=pam_permit,pam_umask,pam_unix,pam_cgfs acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 10 07:38:26 host audit[2774]: CRED_DISP pid=2774 uid=0 auid=1000 ses=1 subj==unconfined msg='op=PAM:setcred grantors=pam_tally2,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'</code></pre>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-10T10:58:40Z' class='post-time'>
                August 10, 2019, 10:58am
              </time>
              <meta itemprop='dateModified' content='2019-08-10T10:58:40Z'>
          <span itemprop='position'>#60</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/a86ed82f4c4505bc8dd89d7d2c95f8bad644425b" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-base-files</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/a86ed82f4c4505bc8dd89d7d2c95f8bad644425b" target="_blank" rel="nofollow noopener">Disable setting root account to expire.</a>
</h4>

  <pre class="message" style="white-space: normal;">(`chage --expiredate 0 root`)
Because it breaks `adduser`.
https://forums.whonix.org/t/restrict-root-access/7658/59</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/a86ed82f4c4505bc8dd89d7d2c95f8bad644425b" target="_blank" rel="nofollow noopener">10:57AM - 10 Aug 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>3 additions</strong>
  and <strong>1 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/0f896a9d8d6f7c125311a0e226755f8a00214f3c" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/0f896a9d8d6f7c125311a0e226755f8a00214f3c" target="_blank" rel="nofollow noopener">add onerr=fail audit to pam_tally2</a>
</h4>


<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/0f896a9d8d6f7c125311a0e226755f8a00214f3c" target="_blank" rel="nofollow noopener">10:05AM - 10 Aug 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>1 additions</strong>
  and <strong>1 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/d17e25272b9b7bbb6abc4dccd500a6b34311a7dd" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/d17e25272b9b7bbb6abc4dccd500a6b34311a7dd" target="_blank" rel="nofollow noopener">effectively (not directly) add "required	pam_tally2.so debug" to /etc/pam.d/common-account</a>
</h4>

  <pre class="message" style="white-space: normal;">This is required because otherwise something like "sudo bash" would count as a
failed login for pam_tally2 even though it was successful.
https://bugzilla.redhat.com/show_bug.cgi?id=707660
https://forums.whonix.org/t/restrict-root-access/7658...</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/d17e25272b9b7bbb6abc4dccd500a6b34311a7dd" target="_blank" rel="nofollow noopener">10:06AM - 10 Aug 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>3 additions</strong>
  and <strong>0 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="../76584658.html?page=2">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="../7658fdb0.html?page=4">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
