<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Restrict root access - #37 by Patrick - Development - Whonix Forum</title>
    <meta name="description" content="It would be good to restrict root access to make it a lot harder to login as root. 
Uncommenting, auth required pam_wheel.so in /etc/pam.d/su will make it so only users in the root group can use su. This can prevent a co&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../76584658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Restrict root access&#39;" href="../7658.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/restrict-root-access/7658/37" />
<meta name="twitter:url" content="https://forums.whonix.org/t/restrict-root-access/7658/37" />
<meta property="og:title" content="Restrict root access" />
<meta name="twitter:title" content="Restrict root access" />
<meta property="og:description" content="A clean implementation might require to config-package-dev displace /usr/share/pam-configs/unix. I don’t think it’s worth the risk of this implementation. All this does is better protect the hashed password in /etc/shadow from an attacker who got an offline copy of /etc/shadow and runs an offline cracking attack against it. Cases where this applies:   someone not using full disk encryption (FDE) and /etc/shadow leaked broken FDE but no knowledge of root password (but also no longer by attacker ..." />
<meta name="twitter:description" content="A clean implementation might require to config-package-dev displace /usr/share/pam-configs/unix. I don’t think it’s worth the risk of this implementation. All this does is better protect the hashed password in /etc/shadow from an attacker who got an offline copy of /etc/shadow and runs an offline cracking attack against it. Cases where this applies:   someone not using full disk encryption (FDE) and /etc/shadow leaked broken FDE but no knowledge of root password (but also no longer by attacker ..." />
<meta property="article:published_time" content="2019-07-13T14:01:09+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="../7658.html">
        <link rel="next" href="../76589ba9.html?page=3">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7658.html">Restrict root access</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../../tag/status_closed_issue_implemented.html' class='discourse-tag' rel="tag">status_closed_issue_implemented</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-13T11:42:11Z' class='post-time'>
                July 13, 2019, 11:42am
              </time>
              <meta itemprop='dateModified' content='2019-07-13T11:42:11Z'>
          <span itemprop='position'>#32</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/4079632d1aed4f3e50ea21de674a9b6d537d3e05" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/4079632d1aed4f3e50ea21de674a9b6d537d3e05" target="_blank" rel="nofollow noopener">remove modifying to /etc/pam.d directly (unrelased)</a>
</h4>

  <pre class="message" style="white-space: normal;">config-package-dev displace /etc/securetty
remove trailing spaces
https://forums.whonix.org/t/restrict-root-access/7658/31</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/4079632d1aed4f3e50ea21de674a9b6d537d3e05" target="_blank" rel="nofollow noopener">11:41AM - 13 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>5 files</strong>
  with <strong>12 additions</strong>
  and <strong>38 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>
          <meta itemprop='keywords' content='component_security, status_closed_issue_implemented'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-13T12:40:17Z' class='post-time'>
                July 13, 2019, 12:40pm
              </time>
              <meta itemprop='dateModified' content='2019-07-13T12:40:17Z'>
          <span itemprop='position'>#33</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/69b97981f3b5e4efc75954d6957659f1bb8e7d18" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/69b97981f3b5e4efc75954d6957659f1bb8e7d18" target="_blank" rel="nofollow noopener">convert etc/pam.d/su.security-misc to usr/share/pam-configs/wheel</a>
</h4>

  <pre class="message" style="white-space: normal;">https://forums.whonix.org/t/restrict-root-access/7658/32</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/69b97981f3b5e4efc75954d6957659f1bb8e7d18" target="_blank" rel="nofollow noopener">12:33PM - 13 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>2 files</strong>
  with <strong>6 additions</strong>
  and <strong>61 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-13T12:49:41Z' class='post-time'>
                July 13, 2019, 12:49pm
              </time>
              <meta itemprop='dateModified' content='2019-07-13T12:49:41Z'>
          <span itemprop='position'>#34</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Instructions for experimentation:</p>
<p>Get rid of all previous modifications firsts.</p>
<p>Put folder <code>/etc/pam.d</code> under git version control (or similar) so you can see what files get changed in which way.</p>
<p>Get a file into folder <code>/usr/share/pam-configs</code> such as for example <code>/usr/share/pam-configs/wheel</code> into place.</p>
<p>Here is a link below to a version in the git history. It might be removed/updated at a later point.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/blob/69b97981f3b5e4efc75954d6957659f1bb8e7d18/usr/share/pam-configs/wheel" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../../external.html?link=https://github.com/Whonix/security-misc/blob/69b97981f3b5e4efc75954d6957659f1bb8e7d18/usr/share/pam-configs/wheel" target="_blank" rel="nofollow noopener">Whonix/security-misc/blob/69b97981f3b5e4efc75954d6957659f1bb8e7d18/usr/share/pam-configs/wheel</a></h4>
<pre><code class="lang-">Name: group root membership required to use su (by package security-misc)
Default: yes
Priority: 260
Auth-Type: Primary
Auth:
	required	pam_wheel.so
</code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>To simulate what the package would do during installation:</p>
<pre><code>sudo pam-auth-update --package
</code></pre>
<p>Or for manual experimentation:</p>
<pre><code>sudo pam-auth-update
</code></pre>
<p>Then check which changes happened in /etc/pam.d folder using git version control or similar.</p>
<hr>
<p>What’s happening in last commit is instead of editing <code>/etc/pam.d/su</code> directly, in effect <code>/etc/pam.d/common-auth</code> gets modified. This is the diff:</p>
<pre><code class="lang-auto">diff --git a/common-auth b/common-auth
index 1ed8786..fcaf1b3 100644
--- a/common-auth
+++ b/common-auth
@@ -14,8 +14,7 @@
 # pam-auth-update(8) for details.
 
 # here are the per-package modules (the "Primary" block)
-auth   required        pam_wheel.so 
-auth   [success=1 default=ignore]      pam_unix.so nullok_secure try_first_pass
+auth   [success=1 default=ignore]      pam_unix.so nullok_secure
 # here's the fallback if no module succeeds
 auth   requisite                       pam_deny.so
 # prime the stack with a positive return value if there isn't one already;
</code></pre>
<p>So the line</p>
<pre><code>auth   required        pam_wheel.so 
</code></pre>
<p>gets added above “quite early”. Early enough?</p>
<p>Another important difference is that most if not all pam config files import <code>/etc/pam.d/common-auth</code>. So this change does not only effect <code>/etc/pam.d/su</code> but also sudo, login, cron, polkit-1, others. Is this ok or could cause some issues?</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-13T13:37:52Z' class='post-time'>
                July 13, 2019,  1:37pm
              </time>
              <meta itemprop='dateModified' content='2019-07-13T13:37:52Z'>
          <span itemprop='position'>#35</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>upstream bug report:<br>
<a href="../../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931994" rel="nofollow noopener">improve key strengthening, add rounds=65536 to /etc/pam.d/common-password</a></p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-13T13:46:47Z' class='post-time'>
                July 13, 2019,  1:46pm
              </time>
              <meta itemprop='dateModified' content='2019-07-13T13:46:47Z'>
          <span itemprop='position'>#36</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2019-July/001402.html" rel="nofollow noopener">Appropriate place to ask questions on how Debian derivatives would best interact with Debian’s implementation of pam?</a></p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-13T14:01:09Z' class='post-time'>
                July 13, 2019,  2:01pm
              </time>
              <meta itemprop='dateModified' content='2019-07-13T14:01:09Z'>
          <span itemprop='position'>#37</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="1" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>While not necessarily helpful for just the root account, we can increase the number of hashing rounds when hashing passwords by adding <code>rounds=(number)</code> to the end of the pam_unix.so module in /etc/pam.d/common-password. E.g. <code>rounds=65536</code> . The higher the amount of rounds, the longer it takes to login and set passwords. 65536 rounds takes 1 second even on slow computers.</p>
</blockquote>
</aside>
<p>A clean implementation might require to config-package-dev displace <code>/usr/share/pam-configs/unix</code>. I don’t think it’s worth the risk of this implementation. All this does is better protect the hashed password in <code>/etc/shadow</code> from an attacker who got an offline copy of <code>/etc/shadow</code> and runs an offline cracking attack against it. Cases where this applies:</p>
<ul>
<li>someone not using full disk encryption (FDE) and /etc/shadow leaked</li>
<li>broken FDE but no knowledge of root password (but also no longer by attacker required to view any file)</li>
<li>an attacker who didn’t manage to get the root password through a keylogger (unrealistic since it assumes attacker can already read /etc/shadow)</li>
<li>an attacker who thinks that the password used for linux user  authentication is being used elsewhere and while having full disk access still wants to crack that password too</li>
</ul>
<p>To add the delay against online bruteforcing we are better off using something like tally / tally2 as discussed here:</p>
<aside class="quote" data-post="6" data-topic="7698">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar">
    <a href="../../protect-linux-user-accounts-against-brute-force-attacks/7698/6.html">How strong do linux user account passwords have to be when using Full Disk Encryption (FDE) too?</a> <a class="badge-wrapper  bullet" href="../../../c/development/8.html"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    Related info for setting timeouts:
  </blockquote>
</aside>

<p>I will revert our current implementation.</p>
<p>After <a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2019-July/001402.html" rel="nofollow noopener">Appropriate place to ask questions on how Debian derivatives would best interact with Debian’s implementation of pam?</a> was answered, I will ask how to cleanly implement this. Already prepared a draft for that:</p>
<p><code>How to append rounds=65536 in /etc/pam.d/common-password as a Debian derivative?</code></p>
<blockquote>
<p>In /etc/pam.d/common-password we would like to change from</p>
<p>password	[success=1 default=ignore]	pam_unix.so obscure sha512</p>
<p>to</p>
<p>password	[success=1 default=ignore]	pam_unix.so obscure sha512 rounds=65536</p>
<p>How would we do that? Fork libpam-runtime and edit /usr/share/pam-configs/unix ? [1] [2] Or is there some more elegant solution using a /usr/share/pam-configs drop-in or so?</p>
<p>Kind regards,<br>
Patrick</p>
<p>[1]<br>
dpkg -S /usr/share/pam-configs/unix<br>
libpam-runtime: /usr/share/pam-configs/unix</p>
<p>[2] <a href="../../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931994" rel="nofollow noopener">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931994</a></p>
</blockquote>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-13T14:03:01Z' class='post-time'>
                July 13, 2019,  2:03pm
              </time>
              <meta itemprop='dateModified' content='2019-07-13T14:03:01Z'>
          <span itemprop='position'>#38</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/ac25733de871b0da5ef42e2e0283a44d94ac3112" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/ac25733de871b0da5ef42e2e0283a44d94ac3112" target="_blank" rel="nofollow noopener">remove etc/pam.d/common-password.security-misc rounds=65536</a>
</h4>

  <pre class="message" style="white-space: normal;">due to unclean implementation, see:
https://forums.whonix.org/t/restrict-root-access/7658/37</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/ac25733de871b0da5ef42e2e0283a44d94ac3112" target="_blank" rel="nofollow noopener">02:01PM - 13 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>0 additions</strong>
  and <strong>33 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T10:52:23Z' class='post-time'>
                July 14, 2019, 10:52am
              </time>
              <meta itemprop='dateModified' content='2019-07-14T10:52:23Z'>
          <span itemprop='position'>#39</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <ul>
<li><a href="../../../../external.html?link=https://github.com/QubesOS/qubes-issues/issues/1128#issuecomment-511185971" rel="nofollow noopener">https://github.com/QubesOS/qubes-issues/issues/1128#issuecomment-511185971</a></li>
</ul>
<hr>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/QubesOS/qubes-core-agent-linux/pull/171" target="_blank" rel="nofollow noopener">github.com/QubesOS/qubes-core-agent-linux</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/QubesOS/qubes-core-agent-linux/pull/171" target="_blank" rel="nofollow noopener">fix, forbid non-root users using 'su'</a>
</h4>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/QubesOS/qubes-core-agent-linux/pull/171" target="_blank" rel="nofollow noopener">10:40AM - 14 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>3 commits</strong>
  changed <strong>8 files</strong>
  with <strong>84 additions</strong>
  and <strong>70 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T11:15:56Z' class='post-time'>
                July 14, 2019, 11:15am
              </time>
              <meta itemprop='dateModified' content='2019-07-14T11:15:56Z'>
          <span itemprop='position'>#40</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="23" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><a href="../../../../external.html?link=https://github.com/Whonix/security-misc/pull/22" rel="nofollow noopener">Restrict access to the root account</a></p>
</blockquote>
</aside>
<p><a href="../../../../external.html?link=https://github.com/Whonix/security-misc/pull/22/files#r303238717" rel="nofollow noopener">https://github.com/Whonix/security-misc/pull/22/files#r303238717</a></p>
<blockquote>
<p>auth       required   pam_wheel.so</p>
</blockquote>
<p>I don’t think that by itself would have worked? Did you test that?</p>
<pre><code># Uncomment this to force users to be a member of group root
# before they can use `su'. You can also add "group=foo"
# to the end of this line if you want to use a group other
# than the default "root" (but this may have side effect of
# denying "root" user, unless she's a member of "foo" or explicitly
# permitted earlier by e.g. "sufficient pam_rootok.so").
# (Replaces the `SU_WHEEL_ONLY' option from login.defs)
auth       required   pam_wheel.so
</code></pre>
<p>So we would have had to create a group <code>root</code> and add user <code>user</code> to that group <code>root</code> too.</p>
<p>(And hopefully <code>pam_wheel.so</code> in Debian wouldn’t default to group <code>wheel</code> for historic reasons either (potential bug).)</p>
<p>It seems required to add <code>group=sudo</code>.<br>
For debugging I’ve also added <code>debug</code>.</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/ffb61f43ea8011d71cf9c5bba1e277a2f825eea7" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/ffb61f43ea8011d71cf9c5bba1e277a2f825eea7" target="_blank" rel="nofollow noopener">fix, add 'group=sudo' and 'debug' for debugging</a>
</h4>

  <pre class="message" style="white-space: normal;">https://forums.whonix.org/t/restrict-root-access/7658</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/ffb61f43ea8011d71cf9c5bba1e277a2f825eea7" target="_blank" rel="nofollow noopener">11:11AM - 14 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>1 additions</strong>
  and <strong>1 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Do you think we should create group <code>sudo</code> and add user <code>user</code> to group <code>root</code>? I am wondering which is the better implementation?</p>
<ul>
<li>More groups don’t make thing simpler for users, developers, auditors.</li>
<li>Not much point to differentiate between <code>sudo</code> and <code>root</code> nowadays, less so when we preconfigure the whole system with locked down, secure defaults?</li>
<li>Not using <code>root</code> group is less standard conform could be more confusing for something?</li>
</ul>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T12:22:07Z' class='post-time'>
                July 14, 2019, 12:22pm
              </time>
              <meta itemprop='dateModified' content='2019-07-14T12:22:07Z'>
          <span itemprop='position'>#41</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="40" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I don’t think that by itself would have worked? Did you test that?</p>
</blockquote>
</aside>
<p>Yes, that works fine.</p>
<aside class="quote no-group" data-post="40" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>So we would have had to create a group <code>root</code> and add user <code>user</code> to that group <code>root</code> too.</p>
</blockquote>
</aside>
<p>Group <code>root</code> is created by default.</p>
<p>I think we should just leave it as is and not add the user to the <code>root</code> group. I don’t see any reason why they should be able to use <code>su</code> instead of just using <code>sudo</code>.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T12:45:40Z' class='post-time'>
                July 14, 2019, 12:45pm
              </time>
              <meta itemprop='dateModified' content='2019-07-14T12:45:40Z'>
          <span itemprop='position'>#42</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Please review:</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/cfdf46b3913a0b176814c93f5343d0b31462393f" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-base-files</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/cfdf46b3913a0b176814c93f5343d0b31462393f" target="_blank" rel="nofollow noopener">lock and expire root account in new Whonix builds</a>
</h4>

  <pre class="message" style="white-space: normal;">https://forums.whonix.org/t/restrict-root-access/7658
https://www.whonix.org/wiki/Dev/Permissions
https://www.whonix.org/wiki/Root</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/commit/cfdf46b3913a0b176814c93f5343d0b31462393f" target="_blank" rel="nofollow noopener">12:39PM - 14 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>17 additions</strong>
  and <strong>0 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>New wiki page:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:120/63;"><img src="../../../../external.html?link=https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail"></div>

<h3><a href="../../../../external.html?link=https://www.whonix.org/wiki/Root" target="_blank" rel="nofollow noopener">Root</a></h3>

<p>Tips on using sudo / root safely</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-post="41" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Group <code>root</code> is created by default.</p>
</blockquote>
</aside>
<p>Indeed.</p>
<aside class="quote no-group" data-post="41" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I think we should just leave it as is and not add the user to the <code>root</code> group. I don’t see any reason why they should be able to use <code>su</code> instead of just using <code>sudo</code> .</p>
</blockquote>
</aside>
<p>Reasons for making <code>su</code> work:</p>
<ul>
<li>less things broken by default.</li>
<li>if <code>sudo</code> is broken, one can recover using <code>su</code>? (Otherwise the only option would be to boot into single user / recovery mode?)</li>
</ul>
<p>Reasons against making <code>su</code> work:</p>
<ul>
<li>attack surface <code>su</code> vs <code>sudo</code>? But also not really since one could still use <code>sudo su</code>?</li>
</ul>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-14T12:51:56Z' class='post-time'>
                July 14, 2019, 12:51pm
              </time>
              <meta itemprop='dateModified' content='2019-07-14T12:51:56Z'>
          <span itemprop='position'>#43</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="42" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>less things broken by default.</p>
</blockquote>
</aside>
<p>The root account will be locked so the user can’t use <code>su</code> to login to the root account. Unless the user is using <code>su</code> to switch to system accounts which is unlikely, nothing more will be broken.</p>
<aside class="quote no-group" data-post="42" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>if <code>sudo</code> is broken, one can recover using <code>su</code> ?</p>
</blockquote>
</aside>
<p>Probably not since the root account is locked.</p>
<aside class="quote no-group" data-post="42" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But also not really since one could still use <code>sudo su</code> ?</p>
</blockquote>
</aside>
<p><code>su</code> requires the account you’re logging into’s password rather than <code>sudo su</code> which just requires the user’s password. If there is a weak password for other accounts but a strong one for the user account, an attacker can easily login to other accounts without needing to know the user’s password (the strong one).</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-15T13:14:46Z' class='post-time'>
                July 15, 2019,  1:14pm
              </time>
              <meta itemprop='dateModified' content='2019-07-15T13:14:46Z'>
          <span itemprop='position'>#44</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Makes a lot sense. Removed <code>group=sudo</code>.</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/2f276cdb10aedf0d30c01d25e50b17cac7d1c62c" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/2f276cdb10aedf0d30c01d25e50b17cac7d1c62c" target="_blank" rel="nofollow noopener">set back to default group "root" rather than group "sudo" membership required to use su</a>
</h4>

  <pre class="message" style="white-space: normal;">since root login will be locked by default anyhow
Thanks to @madaidan for providing the rationale!
https://forums.whonix.org/t/restrict-root-access/7658/42</pre>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/commit/2f276cdb10aedf0d30c01d25e50b17cac7d1c62c" target="_blank" rel="nofollow noopener">12:44PM - 15 Jul 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>2 additions</strong>
  and <strong>2 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-17T18:29:14Z' class='post-time'>
                July 17, 2019,  6:29pm
              </time>
              <meta itemprop='dateModified' content='2019-07-17T18:29:14Z'>
          <span itemprop='position'>#45</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Reverted above commit. Reasons:</p>
<p>As it was before, there was no more way to run commands as root. <code>sudo something</code> was broken. This is because of the way it is implemented now. Which is no longer editing <code>/etc/pam.d/su</code> (bad as explained above) but <code>/usr/share/pam-configs/</code> (standard conform) mechanism. Therefore <code>auth required pam_wheel.so debug</code> does not only apply to <code>su</code> but any file using <code>/etc/pam.d/common-auth</code> which includes <code>sudo</code>.</p>
<p>In result members of the group <code>sudo</code> will be able to use both, <code>su</code> and <code>sudo</code>.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-17T18:39:09Z' class='post-time'>
                July 17, 2019,  6:39pm
              </time>
              <meta itemprop='dateModified' content='2019-07-17T18:39:09Z'>
          <span itemprop='position'>#46</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>How to boot into recovery (single user) mode is now documented: <a href="../../../../external.html?link=https://www.whonix.org/wiki/Recovery#Recovery_Mode" rel="nofollow noopener">https://www.whonix.org/wiki/Recovery#Recovery_Mode</a></p>
<hr>
<p>The issue with locking and expiring root account is, that it breaks recovery mode.</p>
<blockquote>
<p>Cannot open access to console, the root account is locked.<br>
See sulogin(8) man page for more details.</p>
</blockquote>
<p>Solution: <strong>passwordless</strong> recovery console<br>
References:</p>
<ul>
<li><a href="../../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=802211" rel="nofollow noopener">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=802211</a></li>
<li><a href="../../../../external.html?link=https://salsa.debian.org/ah/user-setup/commit/bc5ca2de85ec27845d0b46059cb7cc02bae7b44d" rel="nofollow noopener">https://salsa.debian.org/ah/user-setup/commit/bc5ca2de85ec27845d0b46059cb7cc02bae7b44d</a></li>
</ul>
<p>One could argue this is insecure in very special situations (such as kios mode or without <a href="../../../../external.html?link=https://www.whonix.org/wiki/Full_Disk_Encryption" rel="nofollow noopener">FDE</a>) (see references above) but I think the balance locked/expired root account in regular boot mode and functional recovery mode is more important. Recovery mode on real hardware can still be secured by using some of the following combinations: BIOS password protection; grub password protection; FDE.</p>
<hr>
<p>Expired root password breaks lxsu but not lxsudo which is ok.</p>
<hr>
<p>When locking root account, when trying to login as root at virtual console will say:</p>
<blockquote>
<p>Login incorrect.</p>
</blockquote>
<p>Without previously asking for a password. This is not the worst case for usability. Better than asking for password and then failing. Will update /etc/<a href="../../../../external.html?link=https://github.com/Whonix/whonix-base-files/blob/master/etc/issue.whonix" rel="nofollow noopener">issue.whonix</a> to document this.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../whonix-desktop-installer-with-calamares-field-report/7350/91.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../whonix-desktop-installer-with-calamares-field-report/7350/91.html'>
                      <span itemprop='name'>Whonix Desktop Installer with Calamares - field report</span>
                    </a>
                    <meta itemprop='position' content='6'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T00:14:56Z' class='post-time'>
                July 19, 2019, 12:14am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T00:14:56Z'>
          <span itemprop='position'>#47</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="45" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>As it was before, there was no more way to run commands as root. <code>sudo something</code> was broken. This is because of the way it is implemented now. Which is no longer editing <code>/etc/pam.d/su</code> (bad as explained above) but <code>/usr/share/pam-configs/</code> (standard conform) mechanism. Therefore <code>auth required pam_wheel.so debug</code> does not only apply to <code>su</code> but any file using <code>/etc/pam.d/common-auth</code> which includes <code>sudo</code> .</p>
</blockquote>
</aside>
<p>That’s weird. This might work:</p>
<pre><code>su auth required pam_wheel.so</code></pre>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T00:49:01Z' class='post-time'>
                July 19, 2019, 12:49am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T00:49:01Z'>
          <span itemprop='position'>#48</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>pam-configs doesn’t seem to work for me. I’m not being restricted at all but editing /etc/pam.d/su does work.</p>
<p>I don’t know if I’ve done something wrong or not.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T09:22:53Z' class='post-time'>
                July 19, 2019,  9:22am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T09:22:53Z'>
          <span itemprop='position'>#49</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="48" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>pam-configs doesn’t seem to work for me.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-post="48" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t know if I’ve done something wrong or not.</p>
</blockquote>
</aside>
<p>Did you make a new build and install of the security-misc package? It should automate everything. (No package uninstallation required.)</p>
<p>/usr/share/pam-configs do not work on its own. That folder is ignored by pam. Running with root rights <code>pam-auth-update --package</code> is required. This is done in security-misc postinst.</p>
<p>A new line</p>
<pre><code>auth        required        pam_wheel.so debug group=sudo
</code></pre>
<p>will be added in /etc/pam.d/common-auth.</p>
<p>Could you please put /etc/pam.d under (git) version control and/or share <code>/etc/pam.d/common-auth</code>?</p>
<p>The package is in the developers repository (among other packages which are not fully tested yet).</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T10:40:00Z' class='post-time'>
                July 19, 2019, 10:40am
              </time>
              <meta itemprop='dateModified' content='2019-07-19T10:40:00Z'>
          <span itemprop='position'>#50</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<p>That’s weird. This might work:</p>
<pre><code>su auth required pam_wheel.so
</code></pre>
</blockquote>
<p>Doesn’t work. To be expected. The syntax of <code>usr/share/pam-configs/</code><br>
goes like this:</p>
<pre><code class="lang-auto">Auth:
	required	pam_wheel.so debug group=sudo
</code></pre>
<p>Source code of pam-auth-update looks like it only edits<br>
<code>/usr/share/pam/common-*</code> files.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-07-19T14:06:32Z' class='post-time'>
                July 19, 2019,  2:06pm
              </time>
              <meta itemprop='dateModified' content='2019-07-19T14:06:32Z'>
          <span itemprop='position'>#51</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Not sure root account locking / expiration (either or both) is a good idea yet.</p>
<p>This is happening during boot (sanity test).</p>
<pre><code>sudo --non-interactive -u root echo 'This is a test echo.'
</code></pre>
<blockquote>
<p>sudo: unable to resolve host host: No address associated with hostname<br>
sudo: account validation failure, is your account locked?</p>
</blockquote>
<p>Either root account locking and/or root account expiration is the cause of this.</p>
<p>In other words, root can probably no longer run <code>sudo -u root something</code>. Might also be a non-issue.</p>
<p>("<code>sudo: unable to resolve host host: No address associated with hostname</code>" very most likely non-issue - happening a lot during build without issue.)</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="../7658.html">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="../76589ba9.html?page=3">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
