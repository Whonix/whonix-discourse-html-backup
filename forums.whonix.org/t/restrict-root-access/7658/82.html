<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Restrict root access - #82 - Development - Whonix Forum</title>
    <meta name="description" content="It would be good to restrict root access to make it a lot harder to login as root. 
Uncommenting, auth required pam_wheel.so in /etc/pam.d/su will make it so only users in the root group can use su. This can prevent a co&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../7658fdb0.html?page=4" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Restrict root access&#39;" href="../7658.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/restrict-root-access/7658/82" />
<meta name="twitter:url" content="https://forums.whonix.org/t/restrict-root-access/7658/82" />
<meta property="og:title" content="Restrict root access" />
<meta name="twitter:title" content="Restrict root access" />
<meta property="og:description" content="Parsing this thread can be difficult. Therefore my goal is to summarize it all on this wiki page:    Did you read https://www.whonix.org/wiki/Dev/Permissions?  Anything missing there?   Yes, and the rationale of this is explained here: https://www.whonix.org/wiki/Dev/Permissions   This is a different issue.  This forum thread “restrict root access” can be considered done. It does everything as described on page https://www.whonix.org/wiki/Dev/Permissions.  ~/.bashrc and other problematic files ..." />
<meta name="twitter:description" content="Parsing this thread can be difficult. Therefore my goal is to summarize it all on this wiki page:    Did you read https://www.whonix.org/wiki/Dev/Permissions?  Anything missing there?   Yes, and the rationale of this is explained here: https://www.whonix.org/wiki/Dev/Permissions   This is a different issue.  This forum thread “restrict root access” can be considered done. It does everything as described on page https://www.whonix.org/wiki/Dev/Permissions.  ~/.bashrc and other problematic files ..." />
<meta property="article:published_time" content="2019-09-12T07:21:28+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="../76589ba9.html?page=3">
        <link rel="next" href="../7658af4d.html?page=5">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7658.html">Restrict root access</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../../tag/status_closed_issue_implemented.html' class='discourse-tag' rel="tag">status_closed_issue_implemented</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-12T07:21:28Z' class='post-time'>
                September 12, 2019,  7:21am
              </time>
              <meta itemprop='dateModified' content='2019-09-12T07:21:28Z'>
          <span itemprop='position'>#76</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="75" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Yes I agree but there’s no mention of that in this thread.</p>
</blockquote>
</aside>
<p>Parsing this thread can be difficult. Therefore my goal is to summarize it all on this wiki page:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Permissions" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    

<h3><a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Permissions" target="_blank" rel="nofollow noopener">Dev/Permissions</a></h3>

<p>Development Notes about strong linux user account separation, sudo, su, linux user account cracking, /etc/securetty, root account locking</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Did you read <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Permissions" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/Permissions</a>?</p>
<p>Anything missing there?</p>
<aside class="quote no-group" data-post="75" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>The chosen method in this thread seems to be disable login as root, and force sudo instead. So now people login as user and run sudo instead of logging in as a separate user (root/admin).</p>
</blockquote>
</aside>
<p>Yes, and the rationale of this is explained here: <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Permissions" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/Permissions</a></p>
<aside class="quote no-group" data-post="75" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>It still sources ~/.bashrc which could do whatever it wants.</p>
</blockquote>
</aside>
<p>This is a different issue.<br>
This forum thread “restrict root access” can be considered done. It does everything as described on page <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Permissions" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/Permissions</a>.</p>
<p>~/.bashrc and other problematic files and folders might be covered in future by something like <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/VirusForget" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/VirusForget</a> or <a href="../../../../external.html?link=https://github.com/tasket/Qubes-VM-hardening" rel="nofollow noopener">https://github.com/tasket/Qubes-VM-hardening</a>.</p>
<p>But even then, <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password" rel="nofollow noopener">https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password</a> remains valid. A user <code>user</code> used for the majority of daily tasks such as browsing the internet cannot be at the same time be an ideal user to run applications with root rights using <code>sudo</code>. That is because one user <code>user</code> is compromised, the sudo password can be sniffed. That is why boot modes without sudo/root access are being planned:</p>
<ul>
<li><a href="../../multiple-boot-modes-for-better-security-persistent-user-live-user-persistent-secureadmin-persistent-superadmin-persistent-recovery-mode/7708.html" class="inline-onebox">multiple boot modes for better security: persistent + root | persistent + noroot | live + root | live + noroot</a></li>
<li><a href="../../walled-garden-firewall-whitelisting-application-whitelisting-sudo-lockdown-superuser-mode-protected-mode/5725.html" class="inline-onebox">walled garden, firewall whitelisting, application whitelisting, sudo lockdown, superuser mode, protected mode</a></li>
</ul>
        </div>

        <meta itemprop='headline' content='Restrict root access'>
          <meta itemprop='keywords' content='component_security, status_closed_issue_implemented'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-12T17:06:04Z' class='post-time'>
                September 12, 2019,  5:06pm
              </time>
              <meta itemprop='dateModified' content='2019-09-12T17:06:04Z'>
          <span itemprop='position'>#77</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="75" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>It still sources ~/.bashrc which could do whatever it wants.</p>
</blockquote>
</aside>
<p>.bashrc can be made unwritable if you want.</p>
<aside class="quote no-group" data-post="75" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Or user might “debug” you.</p>
</blockquote>
</aside>
<p>What do you mean? You mean with ptrace? Whonix uses YAMA now so they have to be root use ptrace.</p>
<aside class="quote no-group" data-post="75" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Or read/write /dev/tty$x.</p>
</blockquote>
</aside>
<p>I don’t see how this can be an actual attack vector.</p>
<aside class="quote no-group" data-post="75" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Yes I agree but there’s no mention of that in this thread.</p>
</blockquote>
</aside>
<aside class="quote quote-modified" data-post="14" data-topic="7658">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="14.html">Restrict root access</a> <a class="badge-wrapper  bullet" href="../../../c/development/8.html"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    Valid point. There might be a solution for that. 
What about adding a new user admin? 
Long term version: 

user user not being member of group sudo / su etc.
Users are advised to login as user admin and then use sudo.

At first, this could be a documentation-only thing for advanced users. (This could be implemented very soon.) 
Not sure the cumbersomeness usability wise would allow this to ever become a default configuration. 

Very long term version: 

wayland will sort the need to login usin…
  </blockquote>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/iamwho'><span itemprop='name'>iamwho</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-13T04:47:08Z' class='post-time'>
                September 13, 2019,  4:47am
              </time>
              <meta itemprop='dateModified' content='2019-09-13T18:27:19Z'>
          <span itemprop='position'>#78</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Ok profile can be taken out.<br>
Ok ptrace and process_vm_readv are out.</p>
<aside class="quote no-group" data-post="77" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t see how this can be an actual attack vector.</p>
</blockquote>
</aside>
<p>TIOCSTI is out but once “user” is logged into tty1, “user” owns it and can emulate a shell after SIGSTOPing the real one.<br>
I think we can agree Xorg sniffing is only a symptom of not trusting your own account. That is all I mean. But yes, it’s a big one.</p>
<p>Edit: I see, I did find in page, not find in javascript, so it didn’t show up. Sorry.</p>
<aside class="quote no-group" data-post="14" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Very long term version:</p>
<ul>
<li>wayland will sort the need to login using a virtual console.</li>
</ul>
</blockquote>
</aside>
<p>Right, the issue is isolation of processes by the same user, and Wayland removes the X-factor. But any malware must remain sandboxed to have secure password entry. Or does Wayland have some sort of sudo built in so it doesn’t have to be run by “user”?</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-19T11:45:21Z' class='post-time'>
                September 19, 2019, 11:45am
              </time>
              <meta itemprop='dateModified' content='2019-09-19T11:45:21Z'>
          <span itemprop='position'>#79</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>
<p>wayland will sort the need to login using a virtual console.</p>
</blockquote>
<p>User can switch to another user account <code>admin</code> using wayland. Can use a graphical session and don’t need to use a different virtual console.<br>
Hopefully. This can be researched when wayland XFCE is done.<br>
I would hope wayland comes with a secure implementation of secure attention key, user account switching and user <code>user</code> not being able to sniff user <code>admin</code>.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-19T11:45:26Z' class='post-time'>
                September 19, 2019, 11:45am
              </time>
              <meta itemprop='dateModified' content='2019-09-19T11:45:26Z'>
          <span itemprop='position'>#80</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Might have broken pkexec.</p>
<aside class="quote" data-post="1" data-topic="8129">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/a/ed8c4c/40.png" class="avatar">
    <a href="../../cannot-use-pkexec/8129.html">cannot use pkexec</a> <a class="badge-wrapper  bullet" href="../../../c/support/5.html"><span class="badge-category-bg" style="background-color: #8C6238;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="User support for the Whonix operating system. (devs)">Support</span></a>
  </div>
  <blockquote>
    I have found a solution, but it only works in my friend’s (fresh) Whonix 15, and not mine. The easy test anyone can do is to do pkexec mousepad from Workstation Terminal. It SHOULD launch the pkexec prompt, as a simple test of its operation. 
It does in my friend’s, but it does not in mine. This is literally the latest Whonix OVA I’m trying 
Does it work in yours? Can others please test this and report back?
  </blockquote>
</aside>

        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
              split this topic 
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-28T08:43:17Z' class='post-time'>
                September 28, 2019,  8:43am
              </time>
              <meta itemprop='dateModified' content='2019-09-28T08:43:17Z'>
          <span itemprop='position'>#83</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>A post was split to a new topic: <a href="../../proc-pid-sched-spy-on-keystrokes-proof-of-concept-spy-gksu/8225.html">/proc/pid/sched spy on keystrokes - proof of concept spy-gksu</a></p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-22T19:17:51Z' class='post-time'>
                November 22, 2019,  7:17pm
              </time>
              <meta itemprop='dateModified' content='2019-11-22T19:17:51Z'>
          <span itemprop='position'>#84</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Also, switching to wayland won’t solve all of our problems.</p>
<p>Attackers can use the TIOCSTI ioctl to inject input to other processes in the same session. linux-hardened solves this though <a href="../../../../external.html?link=https://github.com/anthraxx/linux-hardened/commit/70d9a407e85d6e6648e30e058561be77f19fd55d">https://github.com/anthraxx/linux-hardened/commit/70d9a407e85d6e6648e30e058561be77f19fd55d</a></p>
<p>This can’t be used for other ttys AFAIK.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-23T06:00:03Z' class='post-time'>
                November 23, 2019,  6:00am
              </time>
              <meta itemprop='dateModified' content='2019-11-23T06:00:03Z'>
          <span itemprop='position'>#85</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I don’t know: At least wayland doesn’t have an exclusive lock on display, keyboard etc.? By switching to to another <a href="../../../../external.html?link=https://www.whonix.org/wiki/Desktop#Virtual_Consoles">virtual console</a> it should be a clean virtual console, TIOCSTI ioctl should be no longer possible?</p>
<ul>
<li>
<a href="../../../../external.html?link=https://www.whonix.org/wiki/SysRq">SysRq</a> <code>unraw</code> should be no longer required?</li>
<li>Should simplify <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password">Prevent Malware from Sniffing the Root Password</a>?</li>
</ul>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-23T12:47:21Z' class='post-time'>
                November 23, 2019, 12:47pm
              </time>
              <meta itemprop='dateModified' content='2019-11-23T12:47:21Z'>
          <span itemprop='position'>#86</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="85" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>By switching to to another <a href="../../../../external.html?link=https://www.whonix.org/wiki/Desktop#Virtual_Consoles">virtual console</a> it should be a clean virtual console, TIOCSTI ioctl should be no longer possible?</p>
</blockquote>
</aside>
<p>Yes, that would prevent it. Unprivileged users can only use TIOCSTI on their own console.</p>
<p>Root (processes with at least CAP_SYS_ADMIN) can use TIOCSTI on whatever console though.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.html'>
                      <span itemprop='name'>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</span>
                    </a>
                    <meta itemprop='position' content='1'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
              split this topic 
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-06T15:33:28Z' class='post-time'>
                December 6, 2019,  3:33pm
              </time>
              <meta itemprop='dateModified' content='2019-12-06T15:33:28Z'>
          <span itemprop='position'>#87</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>7 posts were split to a new topic: <a href="../../kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.html">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root</a></p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-21T16:38:44Z' class='post-time'>
                March 21, 2020,  4:38pm
              </time>
              <meta itemprop='dateModified' content='2020-03-21T17:07:01Z'>
          <span itemprop='position'>#88</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I think we should setup <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password">https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password</a> by default or go further and remove <code>sudo</code> entirely.</p>
<p>I see what “iamwho” meant now.</p>
<p>It is trivial to grab the password and gain full root access.</p>
<p>For example, the attacker can exploit the plethora of keylogging opportunities such as X’s lack of GUI isolation, the <a href="../../proc-pid-sched-spy-on-keystrokes-proof-of-concept-spy-gksu/8225.html">many infoleaks in /proc</a> and so much more.</p>
<p>Even if we mitigate every single way to log keystrokes, the attacker can just setup their own fake <code>sudo</code> program:</p>
<pre><code class="lang-auto">cat &lt;&lt;\EOF &gt; /tmp/sudo
#!/bin/bash
if [[ "${@}" = "" ]]; then
  /usr/bin/sudo
else
  read -r -p "[sudo] password for user: " password
  echo "${password}" &gt; /tmp/password
  echo "Sorry, try again."
  /usr/bin/sudo ${@}
fi
EOF
chmod +x /tmp/sudo
export PATH="/tmp:${PATH}"
</code></pre>
<p>Using <code>sudo</code> is essentially <a href="../../../../external.html?link=https://en.wikipedia.org/wiki/Security_theater">security theater</a>.</p>
<p>Edit: the LD_PRELOAD method won’t work on setuid binaries like <code>sudo</code>.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-21T20:05:25Z' class='post-time'>
                March 21, 2020,  8:05pm
              </time>
              <meta itemprop='dateModified' content='2020-03-21T20:05:25Z'>
          <span itemprop='position'>#89</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Actually, LD_PRELOAD would work as you can preload malicious libraries for e.g. the shell to log keystrokes. It doesn’t have to be <code>sudo</code>.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T09:10:59Z' class='post-time'>
                March 22, 2020,  9:10am
              </time>
              <meta itemprop='dateModified' content='2020-03-22T09:10:59Z'>
          <span itemprop='position'>#90</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="madaidan" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I think we should setup <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password">https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password</a> by default</p>
</blockquote>
</aside>
<p>That issue is described here:<br>
<a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Strong_Linux_User_Account_Isolation#sudo_password_sniffing">https://www.whonix.org/wiki/Dev/Strong_Linux_User_Account_Isolation#sudo_password_sniffing</a></p>
<p>If that description is insufficient (if there is something that new (reasonably technical people) readers might overlook), please edit. It’s crucial to get these things properly documented so these issues and our solutions can be understood by as many people as possible to make sure it is actually effective.</p>
<aside class="quote no-group" data-username="madaidan" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I think we should setup <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password">https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password</a> by default</p>
</blockquote>
</aside>
<p>That’s the plan. That’s the idea of <a href="../../multiple-boot-modes-for-better-security-persistent-user-live-user-persistent-secureadmin-persistent-superadmin-persistent-recovery-mode/7708.html" class="inline-onebox">multiple boot modes for better security: persistent user | live user | persistent admin | persistent superadmin | persistent recovery mode</a>. Booting in mode persistent/live user would result in user <code>user</code> not being a member of group <code>sudo</code>.</p>
<aside class="quote no-group" data-username="madaidan" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>or go further and remove <code>sudo</code> entirely.</p>
</blockquote>
</aside>
<p>That might not be possible or take years to implement. For existing use of <code>sudo</code><br>
<a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/git#grep_Whonix_source_code">grep Whonix source code</a> for <code>sudo</code> and <code>lxsudo</code>.</p>
<pre><code>grep -r sudo | wc -l
</code></pre>
<blockquote>
<p>819</p>
</blockquote>
<p>Well, a lot of it are source code comments / source documentation / user documentation. Will try to narrow that down.</p>
<aside class="quote no-group" data-username="madaidan" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>For example, the attacker can exploit the plethora of keylogging opportunities such as X’s lack of GUI isolation, the <a href="../../proc-pid-sched-spy-on-keystrokes-proof-of-concept-spy-gksu/8225.html">many infoleaks in /proc</a> and so much more.</p>
</blockquote>
</aside>
<p>I guess I know what you mean but exactly such things need to be spelled out more detailed (in wiki, news posts) to generate awareness for the issue. I.e. including examples for which non-root user might be compromised and do what to compromise desktop users.</p>
<aside class="quote no-group" data-username="madaidan" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>For example, the attacker can exploit the plethora of keylogging opportunities such as X’s lack of GUI isolation, the <a href="../../proc-pid-sched-spy-on-keystrokes-proof-of-concept-spy-gksu/8225.html">many infoleaks in /proc</a> and so much more.</p>
</blockquote>
</aside>
<p>Trying to follow that line of thought more… If such infoleaks can spy on keystrokes to get access to the sudo password then that’s not only the sudo password but any keystroke. That’s not an issue for privilege escalation / exploitation but still a huge security issue as nobody wants all their typing leaked. Therefore let’s not just secure sudo but make sure that keystroke spying gets blocked.</p>
<p>Non-root users (let’s say user <code>www</code>) might find out the sudo password not be able to do anything with it due to the existing implementation.<br>
( <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Strong_Linux_User_Account_Isolation">https://www.whonix.org/wiki/Dev/Strong_Linux_User_Account_Isolation</a> )<br>
These users not a member of group <code>sudo</code> and due to <code>su</code> restrictions, no login to other user accounts is possible.</p>
<aside class="quote no-group" data-username="madaidan" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Even if we mitigate every single way to log keystrokes, the attacker can just setup their own fake <code>sudo</code> program:</p>
<pre><code class="lang-auto">cat &lt;&lt;\EOF &gt; /tmp/sudo
#!/bin/bash
</code></pre>
</blockquote>
</aside>
<p>That might not even be stoppable when making /tmp, /home etc. non-executable. Because this attack supposes a compromised non-user account that is a member of group <code>sudo</code>, i.e. in our case most likely user <code>user</code>. “compromised non-user account” could include, “there is already a malicious process running”. And if there is already a malicious process being executed there no stop to that by non-executable anything.</p>
<p>In other words, <code>a compromised non-root user account which is member of group </code>sudo<code> is almost(?) equal to full root compromise</code>. This needs to be documented somehow. No awareness -&gt; no fix.</p>
<p>And most Linux desktop nowadays are single user systems. There is only 1 non-root user being used. And that non-root user can in most Linux distributions either use <code>su</code> to gain root or is member of group <code>sudo</code> by default.</p>
<aside class="quote no-group" data-username="madaidan" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Using <code>sudo</code> is essentially <a href="../../../../external.html?link=https://en.wikipedia.org/wiki/Security_theater">security theater</a>.</p>
</blockquote>
</aside>
<p>Not entirely, but I see your point. sudo seems to work as expected. sudo is useful. (A script running under root <code>sudo -u www touch /var/log/www/something</code> while <code>www</code> is not a part of group <code>sudo</code>.</p>
<p>Just perhaps the developers of sudo aren’t doing the best job of explaining X exclusive lock, secure attention key unraw. I don’t think many people know that when you switch from X to a <a href="../../../../external.html?link=https://www.whonix.org/wiki/Desktop#Virtual_Consoles">virtual console</a> that X might still have an exclusive lock and show a malicious, fake virtual console that could spy on the password entry. But we shouldn’t blame that on the developers of sudo.</p>
<p>Can easily create the impression of security theater.<br>
Quote <a href="../../../../external.html?link=https://www.jwz.org/xscreensaver/faq.html#root-lock">https://www.jwz.org/xscreensaver/faq.html#root-lock</a></p>
<blockquote>
<p>The solution to this is simple: you shouldn’t be logging in on the console as root in the first place! (What, are you crazy or something?)</p>
<p>Proper Unix hygiene dictates that you should log in as yourself, and <em>su</em> to root as necessary. People who spend their day logged in as root are just begging for disaster.</p>
</blockquote>
<p>The author might understand all of these things but that text is written as if that’s common knowledge which it is not.</p>
<p>Let’s imagine (not going to happen, actually opposite) Whonix shipped with passwordless sudo by default because currently Linux desktop distribution use of sudo is mostly security theater and a usability degradation. I am sure, suddenly everyone would come out of the woods and complain how dangerous that is. But I also guess at the same time nobody would point out how to <a href="../../../../external.html?link=https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password"> Prevent Malware from Sniffing the Root Password</a> and most would still use 1 user <code>user</code> that is a member of group <code>sudo</code> for most daily tasks which then gain gives very little security. This seems ironic when knowing the background how much work/time is otherwise spent by Linux desktop distributions on user access rights related development (file permissions) and not just running everything as root.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T09:41:33Z' class='post-time'>
                March 22, 2020,  9:41am
              </time>
              <meta itemprop='dateModified' content='2020-03-22T09:41:33Z'>
          <span itemprop='position'>#91</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Excluding user/developer documentation, program output (suggestions to run commandos including sudo) we are down to just 208 uses of sudo.</p>
<pre><code>grep \
--recursive \
--exclude=README.md \
--exclude=GPLv2 \
--exclude=GPLv3 \
--exclude=COPYING \
--exclude=control \
--exclude=whonix \
--exclude=ci_test \
--exclude=changelog.upstream-old1 \
--exclude=changelog.upstream \
--exclude-dir=.git \
--exclude-dir=sudoers.d \
--exclude-dir=apparmor.d \
--exclude=\*.{mediawiki,md,ronn,8,yml,examples} \
--exclude-dir=whonix-developer-meta-files \
--exclude-dir=lkrg \
--exclude-dir=gateway-shortcuts \
sudo | \
grep --invert-match '\#' | \
grep --invert-match '&lt;blockquote&gt;' | \
grep --invert-match '&lt;code&gt;' | \
grep --invert-match 'echo "' | \
grep --invert-match 'true "'
</code></pre>
<p>Adding another <code>grep non-interactive</code> (because Whonix source code uses <code>sudo</code> with parameter <code>--non-interactive</code> whenever possible for better reliability/spotting bugs easier) getting rid of sudo entirely or most uses of it might be possible.</p>
<p>Some examples how sudo is used:</p>
<hr>
<p>whonix-legacy /usr/lib/whonix-legacy/fixes</p>
<pre><code>sudo --non-interactive -u "$user_name" mkdir -p "/home/$user_name/.local/share/Bisq/btc_mainnet/tor" || true
</code></pre>
<p>root uses sudo to never create files with the wrong access rights.</p>
<hr>
<p>anon-connection-wizard runs as user <code>user</code> but has to edit Tor configuration which is owned by root. Hence, uses sudo to make modifications. Also has to restart or reload Tor which also requires root, hence uses sudo.</p>
<p>How would we solve that? Maybe Whonix-Gateway doesn’t need a boot mode to boot into user? Perhaps Whonix-Gateway should always boot into admin mode? Because booting into user mode (no sudo possible) is mostly useful when running untrusted applications such as Tor Browser. But on Whonix-Gateway the user shouldn’t run applications much (anything?) that does not require sudo.</p>
<hr>
<p>onioncircuits can be started from tor-control-panel. onioncircuits needs to run under user <code>debian-tor</code>. Therefore sudo is used to run onioncircuits nder user <code>debian-tor</code>.</p>
<hr>
<p>On Whonix-Gateway it’s also allowed for user <code>user</code> to restart Tor / whonix-firewall without sudo password. Maybe another reason for Whonix-Gateway to not provide a limited user but only admin boot mode.</p>
<hr>
<p>whonixcheck can be run by user <code>user</code> to make it as simple as possible to run the tests. whonixcheck runs under user <code>whonixcheck</code> for better security. whonixcheck has preconfigured sudoers.d exceptions so it can test things which require root.</p>
<p>Maybe “full whonixcheck” should only be possible as user <code>admin</code> (sudo allowed)? Some tests maybe even only possible as user <code>superadmin</code>? When whonixcheck is run as user <code>user</code> (in future no sudo possible) it would check very little?</p>
<hr>
<p>Currently whonix repository tool GUI can be started by user <code>user</code> and them modifies file /etc/apt/souces.list.d/whonix.list. Therefore it is started with lxsudo (which is a GUI frontend, internally uses sudo). Requires sudo password. In future this would only be possible in admin mode. But I don’t see how to get rid of sudo entirely. Some applications are started by limited, non-root users but require root privileges to make changes.</p>
<hr>
<p>Restarting sdwdate can be done by user <code>user</code>. Currently has a sudoers.d exception.</p>
<hr>
<p>By getting rid of whonixcheck GUI output (CLI only) we would be one step closer to deprecating msgcollector (or at least msgcollector sudo wrapper / msgdispatcher). By deprecating tb-updater and replacing that with Tor Browser archive in binaries-freedom package + automated extraction on first Tor Browser start we might be able to get rid of msgcollector entirely.</p>
<hr>
<p>Consider also <code>reverse-depends sudo</code>.</p>
<hr>
<p>In conclusion, I think getting rid of user <code>user</code> being a member of group <code>sudo</code> might be very possible and worthwhile but getting rid of sudo entirely might not be possible on a desktop system unless perhaps requires functionality is ported to pkexec.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T15:38:33Z' class='post-time'>
                March 22, 2020,  3:38pm
              </time>
              <meta itemprop='dateModified' content='2020-03-22T15:38:33Z'>
          <span itemprop='position'>#92</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I made some changes to the wiki: <a href="../../../../external.html?link=https://www.whonix.org/w/index.php?title=Dev/Strong_Linux_User_Account_Isolation&amp;oldid=55432">https://www.whonix.org/w/index.php?title=Dev/Strong_Linux_User_Account_Isolation&amp;oldid=55432</a></p>
<aside class="quote no-group" data-username="Patrick" data-post="90" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Trying to follow that line of thought more… If such infoleaks can spy on keystrokes to get access to the sudo password then that’s not only the sudo password but any keystroke. That’s not an issue for privilege escalation / exploitation but still a huge security issue as nobody wants all their typing leaked. Therefore let’s not just secure sudo but make sure that keystroke spying gets blocked.</p>
</blockquote>
</aside>
<p>Yes, we should definitely fix all known ways to monitor keystrokes. apparmor-profile-everything can do a great job at this.</p>
<p>We should look through the source code of public keyloggers/rootkits and see what methods they use. For example, <a href="../../../../external.html?link=https://github.com/naworkcaj/bdvl">https://github.com/naworkcaj/bdvl</a> which works with LD_PRELOAD.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T17:40:40Z' class='post-time'>
                March 22, 2020,  5:40pm
              </time>
              <meta itemprop='dateModified' content='2020-03-22T17:40:40Z'>
          <span itemprop='position'>#93</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Made some more edits. Could you check please and “answer” by editing more?</p>
<p><a href="../../../../external.html?link=https://www.whonix.org/w/index.php?title=Dev%2FStrong_Linux_User_Account_Isolation&amp;type=revision&amp;diff=55437&amp;oldid=55432">https://www.whonix.org/w/index.php?title=Dev%2FStrong_Linux_User_Account_Isolation&amp;type=revision&amp;diff=55437&amp;oldid=55432</a></p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T18:02:53Z' class='post-time'>
                March 22, 2020,  6:02pm
              </time>
              <meta itemprop='dateModified' content='2020-03-22T18:02:53Z'>
          <span itemprop='position'>#94</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a href="../../../../external.html?link=https://www.whonix.org/w/index.php?title=Dev/Strong_Linux_User_Account_Isolation&amp;diff=55439">https://www.whonix.org/w/index.php?title=Dev/Strong_Linux_User_Account_Isolation&amp;diff=55439</a></p>
<p>The LD_PRELOAD solution isn’t meant to solve the fake sudo issue.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T22:40:28Z' class='post-time'>
                March 22, 2020, 10:40pm
              </time>
              <meta itemprop='dateModified' content='2020-03-22T22:40:28Z'>
          <span itemprop='position'>#95</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="madaidan" data-post="94" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>The LD_PRELOAD solution isn’t meant to solve the fake sudo issue.</p>
</blockquote>
</aside>
<p>Is that worth it if fake sudo issue cannot be solved?</p>
<blockquote>
<p>Mounting all user-writeable places such as /home and /tmp as non-executable is not a solution because an attacker can use the bash interpreter to bypass the restrictions.</p>
</blockquote>
<p>By that, do you mean dotfiles in home folder such as .bash_profile .bash_login .bash_logout .profile (and <a href="../../../../external.html?link=https://github.com/tasket/Qubes-VM-hardening/blob/master/vm-boot-protect.sh#L37">others</a>)?</p>
<p>I was wondering anyhow if such vulnerable files should be made immutable (a root script running <code>chattr +i file-name</code> on these). That could be a feature of <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/VirusForget">VirusForget</a>. Though, it might be an impossible game of whack a mole trying to close all the vulnerable files in home folders that could be abused for virus persistence among reboots. (I <a href="../../../../external.html?link=https://github.com/tasket/Qubes-VM-hardening/issues/38">reported</a> <code>~/.pam_environment</code> during unrelated development reading a man page.) Or perhaps AppArmor could be configured to only allow XFCE to write into folders such as <code>~/.config/xfce</code>?</p>
<p>But could such solutions might never be sufficient to fix the <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Strong_Linux_User_Account_Isolation#sudo_password_sniffing">fake sudo prompt issue</a>?</p>
<p>One definition of a compromised user <code>user</code> account includes that some malicious process (Trojan horse) is running there already wanting to gain sudo/root access. Such a process could paint its own lxsudo window. There are also utilities (therefore probably also APIs) which allow scripts/programs to do keystroke entries and mice movements. A malicious program could open a fake xfce4-terminal emulator window. (Perhaps open fake xfce4-terminal in background, redraw contents from real xfce4-terminal in background, close real xfce4-terminal.)</p>
<p>Qubes has trusted window decorations. VM window title bars have identifiers such as [private] or [vault], the VM name. And the window decorations (color frames).<br>
( <a href="../../../../external.html?link=https://www.qubes-os.org/getting-started/">https://www.qubes-os.org/getting-started/</a> )<br>
(Trusted window manager.)</p>
<p>In Desktop Linux there is no such distinctions. There is no way to know for any user which process is drawing a window if the user account is compromised. I.e. a fake sudo prompt cannot be distinguished from a real sudo prompt. Or a fake xfce4-terminal cannot be distinguished from a real xfce4-terminal. Therefore I guess there can be no solution for the fake sudo prompt issue except user <code>user</code> not being a member of group <code>sudo</code>. (Except perhaps inventing something similar as a trusted window manager.)</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T23:10:51Z' class='post-time'>
                March 22, 2020, 11:10pm
              </time>
              <meta itemprop='dateModified' content='2020-03-22T23:10:51Z'>
          <span itemprop='position'>#96</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="95" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Is that worth it if fake sudo issue cannot be solved?</p>
</blockquote>
</aside>
<p>Yes, LD_PRELOAD can be abused for a lot more than just getting the sudo password. The attacker can just add</p>
<pre><code>export LD_PRELOAD=/path/to/malicious_library
</code></pre>
<p>to <code>~/.bashrc</code> or similar to compromise all programs in the user’s session. It’s not just monitoring keystrokes but a full compromise.</p>
<aside class="quote no-group" data-username="Patrick" data-post="95" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>By that, do you mean dotfiles in home folder such as .bash_profile .bash_login .bash_logout .profile (and <a href="../../../../external.html?link=https://github.com/tasket/Qubes-VM-hardening/blob/master/vm-boot-protect.sh#L37">others</a>)?</p>
</blockquote>
</aside>
<p>Doesn’t have to be them specifically. My example, <code>/tmp/sudo</code> would still work when <code>/tmp</code> is mounted with <code>noexec</code> because <code>/bin/bash</code> is still executable.</p>
<p>Those dotfiles are especially dangerous as they’re sourced upon login and can be used for persistent rootkits.</p>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7658.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-22T23:34:04Z' class='post-time'>
                March 22, 2020, 11:34pm
              </time>
              <meta itemprop='dateModified' content='2020-03-22T23:34:04Z'>
          <span itemprop='position'>#97</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="madaidan" data-post="96" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Yes, LD_PRELOAD can be abused for a lot more than just getting the sudo password. The attacker can just add</p>
<pre><code class="lang-auto">export LD_PRELOAD=/path/to/malicious_library
</code></pre>
<p>to <code>~/.bashrc</code> or similar to compromise all programs in the user’s session. It’s not just monitoring keystrokes but a full compromise.</p>
</blockquote>
</aside>
<p>What else an attacker running a malicious process under user <code>user</code> (and therefore ability to spy on keystrokes and read all files by user <code>user</code> would want? That seems to me as a pretty complete compromise (except root). I.e. what do you mean by full compromise? Control/spy on the memory of the application?</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="95" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<p>By that, do you mean dotfiles in home folder such as .bash_profile .bash_login .bash_logout .profile (and <a href="../../../../external.html?link=https://github.com/tasket/Qubes-VM-hardening/blob/master/vm-boot-protect.sh#L37">others</a>)?</p>
</blockquote>
<p>Doesn’t have to be them specifically. My example, <code>/tmp/sudo</code> would still work when <code>/tmp</code> is mounted with <code>noexec</code> because <code>/bin/bash</code> is still executable.</p>
</blockquote>
</aside>
<p>Ah, <code>bash /path/to/script</code>. That was non-obvious to me. Clarified in wiki just now. Would <a href="../../../../external.html?link=https://phabricator.whonix.org/T941">interpreter lock</a> help?</p>
<p><code>/bin/bash</code> is the actual real, non-malicious bash. And in this threat model user <code>user</code> is compromised while sudo/root is not compromised yet and desired stay that way. Therefore <code>/bin/bash</code> is not writeable by the attacker, i.e. cannot be replaced with a malicious bash version by the attacker.</p>
<p>Even if we had interpreter lock and immutable dotfiles… There’s still risk of malicious process drawing malicious fake windows? And that issue cannot be resolved? Or could we invent something like “scripts/programs running in /home, /tmp shall not be able to create GUI windows?” Dunno if this would be a viable path…</p>
<pre><code>unset DISPLAY
mousepad
</code></pre>
<blockquote>
<p>Unable to init server: Could not connect: Connection refused</p>
</blockquote>
        </div>

        <meta itemprop='headline' content='Restrict root access'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="../76589ba9.html?page=3">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="../7658af4d.html?page=5">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
