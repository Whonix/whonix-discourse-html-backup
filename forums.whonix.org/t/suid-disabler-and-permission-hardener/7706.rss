<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>SUID Disabler and Permission Hardener</title>
    <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706</link>
    <description>https://github.com/QubesOS/qubes-issues/issues/2695 has interesting ideas.

Quote Solar Designer (someone that Joanna Rutkowska respects):

&gt; Ideally, there should be no SUID binaries reachable from the user account, as otherwise significant extra attack surface inside the VM is exposed (dynamic linker, libc startup, portions of Linux kernel including ELF loader, etc.)

No idea yet.

Related:
 https://forums.whonix.org/t/walled-garden-firewall-whitelisting-application-whitelisting-sudo-lockdown-superuser-mode-protected-mode/5725

Edit by Patrick:
See also https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707

Edit #2 by Patrick:
https://www.whonix.org/wiki/SUID_Disabler_and_Permission_Hardener</description>
    <language>en</language>
    <lastBuildDate>Sat, 23 Jul 2022 22:08:11 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[TNT_BOM_BOM]]></dc:creator>
        <description><![CDATA[
            <p>working fine (tested in qubes) except it all add additional boot delay.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/79">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/79</link>
        <pubDate>Sat, 23 Jul 2022 22:08:11 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-79</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest" data-onebox-src="https://github.com/Kicksecure/security-misc/pull/104">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/pull/104" target="_blank" rel="noopener">github.com/Kicksecure/security-misc</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Kicksecure/security-misc/pull/104" target="_blank" rel="noopener">Fix issues found with permission-hardening on my system</a>
    </h4>

    <div class="branches">
      <code>Kicksecure:master</code> ← <code>ntninja:patch-1</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-06-07" data-time="08:12:42" data-timezone="UTC">08:12AM - 07 Jun 22 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/ntninja" target="_blank" rel="noopener">
          <img alt="ntninja" src="https://avatars.githubusercontent.com/u/246386?v=4" class="onebox-avatar-inline" width="20" height="20">
          ntninja
        </a>
      </div>

      <div class="lines" title="4 commits changed 3 files with 37 additions and 3 deletions">
        <a href="https://github.com/Kicksecure/security-misc/pull/104/files" target="_blank" rel="noopener">
          <span class="added">+37</span>
          <span class="removed">-3</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">See commit list for details.</p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/78">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/78</link>
        <pubDate>Wed, 08 Jun 2022 12:05:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-78</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="76" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>In result:</p>
<ul>
<li>Only the whitelisted user(s) would be permitted to run it.</li>
<li>Using capabilities.</li>
<li>Still only a very specific command.</li>
</ul>
</blockquote>
</aside>
<p>This may be a good idea then.</p>
<aside class="quote no-group" data-username="Patrick" data-post="76" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Any solution for that? We’d have to invent C(++) based wrappers?</p>
</blockquote>
</aside>
<p>Wrappers in C should be easy to implement.</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;pwd.h&gt;
#include &lt;string.h&gt;

int main() {
  const char *permitted_user = "user";
  struct passwd *current_user = getpwuid(geteuid());

  if (strcmp(current_user-&gt;pw_name, permitted_user) == 0) {
    system("/bin/journalctl --boot --no-pager -u whonix-firewall"); 
    exit(0);
  }

  puts("ERROR: You are not the correct user.");
  exit(1);
}
</code></pre>
<aside class="quote no-group" data-username="Patrick" data-post="76" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>How to auto detect the user name then?</p>
</blockquote>
</aside>
<p><code>stat -c "%U %G"</code></p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/77">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/77</link>
        <pubDate>Sat, 12 Dec 2020 19:13:28 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-77</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="74" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Which kind of configurablity do we need? Can we re-implement these?</p>
</blockquote>
</aside>
<p>For example, <a href="https://github.com/Whonix/whonixcheck/blob/master/etc/sudoers.d/whonixcheck">https://github.com/Whonix/whonixcheck/blob/master/etc/sudoers.d/whonixcheck</a> restricts a lot of commands to the <code>whonixcheck</code> user or specific arguments. When switching to capabilities, we can’t really do this.</p>
<aside class="quote no-group" data-username="Patrick" data-post="74" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If output of <code>whoami</code> or similar could be trusted, the script itself could check if it’s running under user <code>user</code> and exit if not so?</p>
</blockquote>
</aside>
<p>But we cannot add <code>whoami</code> checks to every program.</p>
</blockquote>
</aside>
<p>Why not? Not every program indeed. Just to every script by Whonix currently using <code>sudo</code>. I guess Whonix using <code>/etc/sudoers.d</code> is rather uncommon anyhow, and should be avoided? Not a big deal now. But also not great? Uncommon…</p>
<pre><code>dpkg -S /etc/sudoers.d/*
</code></pre>
<blockquote>
<p>msgcollector: /etc/sudoers.d/msgcollector<br>
security-misc: /etc/sudoers.d/pkexec-security-misc<br>
usability-misc: /etc/sudoers.d/pwfeedback<br>
qubes-core-agent: /etc/sudoers.d/qt_x11_no_mitshm<br>
qubes-core-agent-passwordless-root: /etc/sudoers.d/qubes<br>
qubes-input-proxy-sender: /etc/sudoers.d/qubes-input-trigger<br>
sudo: /etc/sudoers.d/README<br>
security-misc: /etc/sudoers.d/security-misc<br>
usability-misc: /etc/sudoers.d/sudo-lecture-disable<br>
tb-starter: /etc/sudoers.d/tb-starter<br>
tb-updater: /etc/sudoers.d/tpo-downloader<br>
usability-misc: /etc/sudoers.d/tunnel_unpriv<br>
qubes-core-agent: /etc/sudoers.d/umask<br>
usability-misc: /etc/sudoers.d/upgrade-passwordless<br>
usability-misc: /etc/sudoers.d/user-passwordless<br>
security-misc: /etc/sudoers.d/xfce-security-misc</p>
</blockquote>
<p>On my system only Whonix and Qubes dropping files into <code>/etc/sudoers.d</code>.</p>
<p>Could be a configurable wrapper somewhere in <code>/etc</code>, perhaps even <code>.d</code>, to allow extending the list of permitted users per program. A script function to be <code>source</code>ed so it doesn’t have to be re-invented for every script.</p>
<aside class="quote no-group" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<pre><code class="lang-auto">whonixcheck ALL=NOPASSWD: /bin/dmesg
</code></pre>
<p>, we added the <code>CAP_SYSLOG</code> capability to the <code>/bin/dmesg</code> binary, any user would now be able to execute <code>/bin/dmesg</code> with that capability.</p>
</blockquote>
</aside>
<p>Yes, we certainly shouldn’t add capabilities to <code>/bin/dmesg</code>. What I had in mind…</p>
<aside class="quote no-group" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Only by shipping our own <code>/bin/dmesg</code> program would we be able to implement user checks</p>
</blockquote>
</aside>
<p>That’s what I had in mind. Creating wrapper scripts for that. The wrapper script would:</p>
<ul>
<li>check <code>whoami</code> (based on <code>source</code>ed shell function and config folder)</li>
<li>have required capability</li>
<li>run command with all parameters (example: <code>/bin/journalctl --boot --no-pager -u whonix-firewall</code>)</li>
</ul>
<p>Simplified example:</p>
<blockquote>
<p>#!/bin/bash</p>
<p>if [ ! “$(whoami)” = “user” ]; then<br>
exit 1<br>
fi</p>
<p>/bin/journalctl --boot --no-pager -u whonix-firewall</p>
</blockquote>
<p>In result:</p>
<ul>
<li>Only the whitelisted user(s) would be permitted to run it.</li>
<li>Using capabilities.</li>
<li>Still only a very specific command.</li>
</ul>
<p>There would be the risk of malicious input in the script being able to run other commands with the given capability but since these wrapper scripts should be similarly simple as above and not parse any command line parameters I think that risk is worth the gain. In other words, I think it’s very doable to get these scripts right and benefit from a fully SUID free system that doesn’t depend on <code>sudo</code>.</p>
<aside class="quote no-group" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>infeasible when considering the large amount of programs we’d need to do this for.</p>
</blockquote>
</aside>
<p>I don’t think we have such a massive amount of <code>/etc/sudoers.d</code> reliance that porting to capability enabled wrapper scripts is infeasible?</p>
<aside class="quote no-group" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Also, LD_PRELOAD wouldn’t work on binaries with capabilities. It’s sanitized to prevent trivial privilege escalation, similar to setuid binaries.</p>
</blockquote>
</aside>
<p>Nice, that’s something.</p>
<p>What do you think?</p>
<p>But then my design proposal might fail because capabilities cannot be set on scripts. Only on programs. As per:</p>
<aside class="onebox stackexchange">
  <header class="source">
      <a href="https://unix.stackexchange.com/questions/87348/capabilities-for-a-script-on-linux" target="_blank" rel="noopener">unix.stackexchange.com</a>
  </header>
  <article class="onebox-body">
      <a href="https://unix.stackexchange.com/users/5462/0xc0000022l" target="_blank" rel="noopener">
    <img alt="0xC0000022L" src="https://www.gravatar.com/avatar/1798dbdad64383304a00c178ad458830?s=128&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="https://unix.stackexchange.com/questions/87348/capabilities-for-a-script-on-linux" target="_blank" rel="noopener">Capabilities for a script on Linux</a>
</h4>

<div class="tags">
  <strong>linux, scripting, capabilities</strong>
</div>

<div class="date">
  asked by
  
  <a href="https://unix.stackexchange.com/users/5462/0xc0000022l" target="_blank" rel="noopener">
    0xC0000022L
  </a>
  on <a href="https://unix.stackexchange.com/questions/87348/capabilities-for-a-script-on-linux" target="_blank" rel="noopener">02:01PM - 19 Aug 13 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Any solution for that? We’d have to invent C(++) based wrappers? Perhaps a thin, perhaps even generic wrapper that sets the capability and then runs the helper script?</p>
<aside class="quote no-group" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>All we’d need to do on our end is to not handle the strings literally and some basic sanitizing.</p>
</blockquote>
</aside>
<p>I guess the config parser could run the function doing the actual work (which runs <code>find</code>) several times per config entry. But I don’t see much benefit. I don’t foresee a lot users or even packages dropping config snippets there, changing expanding the default configuration. This is not going to be the new <code>/etc/apparmor.d</code> with lots of contributions which really deserves a sophisticated configuration language.</p>
<aside class="quote no-group quote-modified" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>But this misses any other user’s home directory whereas if it supported regex, we could change this to:</p>
<pre><code class="lang-auto">/home/user/ 0700 user user
</code></pre>
</blockquote>
</aside>
<p>vs</p>
<aside class="quote no-group" data-username="madaidan" data-post="75" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><code>/home/*/ 0700</code></p>
</blockquote>
</aside>
<p>Second one lacks user names.</p>
<p>How to auto detect the user name then? If we want to harden permissions for different user names in /home, wouldn’t it be better to have a special function in the script? In that case would be easier to have a function (feature) parsing <code>/home</code> rather than inventing a complex config parsing just for <code>/home</code> folder permission hardening.</p>
<p>(That feature would then be enabled in config using <code>harden_home_folder_permissions=true</code> or so. Or default buit-in enabled and disabled with <code>harden_home_folder_permissions=false</code>.)</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/76">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/76</link>
        <pubDate>Mon, 07 Dec 2020 22:08:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-76</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="74" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Which kind of configurablity do we need? Can we re-implement these?</p>
</blockquote>
</aside>
<p>For example, <a href="https://github.com/Whonix/whonixcheck/blob/master/etc/sudoers.d/whonixcheck" rel="noopener nofollow ugc">https://github.com/Whonix/whonixcheck/blob/master/etc/sudoers.d/whonixcheck</a> restricts a lot of commands to the <code>whonixcheck</code> user or specific arguments. When switching to capabilities, we can’t really do this.</p>
<aside class="quote no-group" data-username="Patrick" data-post="74" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If output of <code>whoami</code> or similar could be trusted, the script itself could check if it’s running under user <code>user</code> and exit if not so?</p>
</blockquote>
</aside>
<p>But we cannot add <code>whoami</code> checks to every program. For example, if instead of the following sudoers exception:</p>
<pre><code>whonixcheck ALL=NOPASSWD: /bin/dmesg
</code></pre>
<p>, we added the <code>CAP_SYSLOG</code> capability to the <code>/bin/dmesg</code> binary, any user would now be able to execute <code>/bin/dmesg</code> with that capability. Only by shipping our own <code>/bin/dmesg</code> program would we be able to implement user checks which is infeasible when considering the large amount of programs we’d need to do this for.</p>
<p>Also, LD_PRELOAD wouldn’t work on binaries with capabilities. It’s sanitized to prevent trivial privilege escalation, similar to setuid binaries.</p>
<aside class="quote no-group" data-username="Patrick" data-post="74" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Seems difficult. I would not know how to implement this without over complicating the code.</p>
</blockquote>
</aside>
<p>Bash supports this type of regex already.</p>
<pre><code>echo /{,usr/,usr/local/}{,s}bin/
</code></pre>
<blockquote>
<p>/bin/ /sbin/ /usr/bin/ /usr/sbin/ /usr/local/bin/ /usr/local/sbin/</p>
</blockquote>
<p>All we’d need to do on our end is to not handle the strings literally and some basic sanitizing.</p>
<aside class="quote no-group" data-username="Patrick" data-post="74" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I don’t think many people will read that config, let alone edit it or view the logs.</p>
</blockquote>
</aside>
<p>This feature wouldn’t only be useful for readability purposes. Permission Hardener currently restricts the permissions of <code>/home/user/</code>:</p>
<pre><code>/home/user/ 0700 user user
</code></pre>
<p>But this misses any other user’s home directory whereas if it supported regex, we could change this to:</p>
<pre><code>/home/*/ 0700</code></pre>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/75">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/75</link>
        <pubDate>Mon, 07 Dec 2020 20:18:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-75</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="72" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>The lack of <code>dpkg-statoverride</code> support is an issue however. Maybe we can implement something ourselves via an apt / dpkg hook? I.e. on package upgrade, it checks <code>/etc/permission-hardening.d/</code> for any needed capabilities and if so, sets them.</p>
</blockquote>
</aside>
<p>Issue indeed… The essential issue is this…<br>
(You probably know but I am writing this down as reminder to self and everyone else reading.)</p>
<pre><code class="lang-auto">sudo getcap /bin/ping
</code></pre>
<blockquote></blockquote>
<p>(Capabilities of <code>/bin/ping</code> already removed.)</p>
<pre><code class="lang-auto">sudo apt install --reinstall iputils-ping 
</code></pre>
<pre><code class="lang-auto">sudo getcap /bin/ping
</code></pre>
<blockquote>
<p>/bin/ping = cap_net_raw+ep</p>
</blockquote>
<aside class="quote no-group" data-username="madaidan" data-post="72" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Maybe we can implement something ourselves via an apt / dpkg hook? I.e. on package upgrade, it checks <code>/etc/permission-hardening.d/</code> for any needed capabilities and if so, sets them.</p>
</blockquote>
</aside>
<p>Even if we could, there would a race condition. A time window of vulnerability. Malware with the ability to abuse a capability could use <code>inotifywait</code> (or some other mechanism (perhaps brute force trying)) to wait until the binary is updated and the capability reinstated.</p>
<p>Perhaps once [1] <a href="https://www.whonix.org/wiki/Dev/boot_modes">https://www.whonix.org/wiki/Dev/boot_modes</a> existed, malware lurking under user <code>user</code> should be deactivated once rebooted into <code>admin mode</code>. Then malware running under user <code>user</code> couldn’t exploit the vulnerable time window of the capability briefly being re-introduced. If we go for that, we should probably remove <code>upgrade-nonroot</code> command. It would still be an incomplete solution until… Even if rebooted into <code>admin mode</code>, there might be daemons running under for example user <code>www-data</code>. Once [1] is implemented, probbly when booting into <code>admin mode</code> only a limited amount of systemd services should be executed.</p>
<p>Nothing really is as great as a proper implementation of <code>dpkg-statoverride</code>. In case of permissions, dpkg never changes back to the different/original/weaker permissions (won’t re-enable SUID even briefly).</p>
<aside class="quote no-group quote-modified" data-username="madaidan" data-post="72" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="71" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Worthwhile development goal to even get rid of Whonix / Kicksecure requiring <code>sudo</code> / any <code>/etc/sudoers.d</code> exceptions?</p>
</blockquote>
</aside>
<p>Capabilities don’t have the same configurability as sudoers exceptions.</p>
</blockquote>
</aside>
<p>Which kind of configurablity do we need? Can we re-implement these?</p>
<aside class="quote no-group" data-username="madaidan" data-post="72" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We cannot restrict which user can execute the program with higher privileges or what arguments they can use.</p>
</blockquote>
</aside>
<p>Can the output of <code>whoami</code> or some alternative command be trusted? Or can that be fooled with some LD_PRELOAD trick or something?</p>
<p>Let’s pick <a href="https://gitlab.com/whonix/whonix-xfce-desktop-config/-/blob/master/usr/share/livecheck/livecheck.sh">livecheck.sh</a> <a href="https://web.archive.org/web/https://gitlab.com/whonix/whonix-xfce-desktop-config/-/blob/master/usr/share/livecheck/livecheck.sh">[archive]</a> as an example. The script currently uses <code>sudo --non-interactive /bin/lsblk --noheadings --all --raw --output RO</code>. This could probably be translated to some capability.</p>
<ol>
<li>You’re right. We don’t want all users to have that capability. If output of <code>whoami</code> or similar could be trusted, the script itself could check if it’s running under user <code>user</code> and exit if not so?</li>
<li>The capability might give access to a lot more than <code>sudo --non-interactive /bin/lsblk --noheadings --all --raw --output RO</code>.</li>
</ol>
<p>Am I re-inventing SUID or <code>sudo</code> here?</p>
<p>My conclusion for now: An SUID free desktop system (including free of <code>sudo</code>) is impractical.</p>
<p>Now on a second thought… Perhaps <code>livecheck.sh</code> could be implemented in a more sophisticated way. A systemd unit running as root [2] could run <code>sblk --noheadings --all --raw --output RO</code>, then write the output to a world readable file. [3]  <code>livecheck.sh</code> could then read from that file instead of running a command with SUID (meaning <code>sudo</code>).</p>
<p>Perhaps similar solutions could be invented for other cases currently dependent on a <code>/etc/sudoers.d</code> exception.</p>
<aside class="quote no-group" data-username="madaidan" data-post="73" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We should add support for basic bash/AppArmor-style regex so we can, for example, shorten:</p>
</blockquote>
</aside>
<p>Seems difficult. I would not know how to implement this without over complicating the code. I don’t think many people will read that config, let alone edit it or view the logs.</p>
<p>Currently config doesn’t even support white spaces in folder names. (Untested.) Such as basic feature should be implemented before going fancy with bash/AppArmor-style regex?</p>
<p>Config parsing, the script looks complex enough already for my taste.</p>
<aside class="quote no-group" data-username="madaidan" data-post="73" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Also, do directories like <code>/usr/local/usr/bin/</code> even exist?</p>
</blockquote>
</aside>
<p><code>/usr/local</code> seems to hold anything that also the root <code>/</code> could hold. I found mentions of all newly added entries on Google when putting the serach term into quotes such as.</p>
<blockquote>
<p>“/usr/local/usr/bin/”</p>
</blockquote>
<p>Also for consistency, thought good to add. At worst in costs a second or so and a log entry.</p>
<hr>
<p>[2] Or limited user with sudoers exception or capability? Too complex, fancy?<br>
[3] Or only user <code>user</code>? Too complex, fancy?</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/74">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/74</link>
        <pubDate>Mon, 07 Dec 2020 14:17:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-74</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>We should add support for basic bash/AppArmor-style regex so we can, for example, shorten:</p>
<pre><code class="lang-auto">/bin/ nosuid
/usr/local/bin/ nosuid
/usr/bin/ nosuid
/usr/local/usr/bin/ nosuid
/sbin/ nosuid
/usr/local/sbin/ nosuid
/usr/sbin/ nosuid
/usr/local/usr/sbin/ nosuid
/lib/ nosuid
/usr/local/lib/ nosuid
/lib32/ nosuid
/usr/local/lib32/ nosuid
/lib64/ nosuid
/usr/local/lib64/ nosuid
/usr/lib/ nosuid
/usr/local/usr/lib/ nosuid
/usr/lib32/ nosuid
/usr/local/usr/lib32/ nosuid
/usr/lib64/ nosuid
/usr/local/usr/lib64/ nosuid
</code></pre>
<p>to:</p>
<pre><code class="lang-auto">/{,usr/,usr/local/}{,s}bin/ nosuid
/{,usr/,usr/local/}lib{,32,64}/ nosuid
</code></pre>
<p>like in apparmor-profile-everything.</p>
<p>Also, do directories like <code>/usr/local/usr/bin/</code> even exist?</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/73">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/73</link>
        <pubDate>Sun, 06 Dec 2020 22:32:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-73</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="71" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><code>dpkg-statoverride</code> does not support that yet. <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502580" rel="noopener nofollow ugc">feature request: dpkg-statoverride: support for capabilities</a></p>
<p>Meaning there might be no standard way in which packages implement setting capabilities yet. Therefore I wanted to look at a package that sets capabilities. For example package <code>iputils-ping</code> contains capability enabled binary <code>ping</code>.</p>
</blockquote>
</aside>
<p>Permission Hardener does already support setting capabilities: <a href="https://github.com/Whonix/security-misc/blob/master/usr/lib/security-misc/permission-hardening#L458" rel="noopener nofollow ugc">https://github.com/Whonix/security-misc/blob/master/usr/lib/security-misc/permission-hardening#L458</a></p>
<p>This is used by anon-apps-config to remove capabilities from ping: <a href="https://github.com/Whonix/anon-apps-config/blob/master/etc/permission-hardening.d/30_ping.conf" rel="noopener nofollow ugc">https://github.com/Whonix/anon-apps-config/blob/master/etc/permission-hardening.d/30_ping.conf</a></p>
<p>The lack of <code>dpkg-statoverride</code> support is an issue however. Maybe we can implement something ourselves via an apt / dpkg hook? I.e. on package upgrade, it checks <code>/etc/permission-hardening.d/</code> for any needed capabilities and if so, sets them.</p>
<aside class="quote no-group" data-username="Patrick" data-post="71" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Worthwhile development goal to even get rid of Whonix / Kicksecure requiring <code>sudo</code> / any <code>/etc/sudoers.d</code> exceptions?</p>
</blockquote>
</aside>
<p>Capabilities don’t have the same configurability as sudoers exceptions. We cannot restrict which user can execute the program with higher privileges or what arguments they can use.</p>
<p>It may even be better to replace capabilities or setuid with sudoers exceptions as we can restrict execution of those binaries to specific users. For example, if <code>/bin/example</code> is setuid, it can be executed by any user and potentially exploited whereas if a sudoers exception was made, it will only be able to be executed by user <code>user</code>, preventing a compromised <code>sdwdate</code> user from exploiting that program.</p>
<aside class="quote no-group" data-username="Patrick" data-post="71" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Or don’t care much about this and just ignore errors using <code>setcap [...] || true</code>?</p>
</blockquote>
</aside>
<p>Those conditions seem rather niche so yes.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/72">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/72</link>
        <pubDate>Sun, 06 Dec 2020 22:22:29 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-72</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Nice changes by <a class="mention" href="http://forums.whonix.org/u/madaidan">@madaidan</a>:<br>
<a href="https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;type=revision&amp;diff=61183&amp;oldid=61082">https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;type=revision&amp;diff=61183&amp;oldid=61082</a></p>
<p>Inspired me to improve a bit more:<br>
<a href="https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;action=historysubmit&amp;type=revision&amp;diff=61190&amp;oldid=61183">https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;action=historysubmit&amp;type=revision&amp;diff=61190&amp;oldid=61183</a></p>
<hr>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/f73c55f16c10ee2cd0532f4032cec56c484bd4d5" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/f73c55f16c10ee2cd0532f4032cec56c484bd4d5" target="_blank" rel="noopener">/opt</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-06" data-time="09:08:58" data-timezone="UTC">09:08AM - 06 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 4 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/f73c55f16c10ee2cd0532f4032cec56c484bd4d5" target="_blank" rel="noopener">
          <span class="added">+4</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">https://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/68</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/11cdce02a048b323c6f56cb15f98e6060aab8346" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/11cdce02a048b323c6f56cb15f98e6060aab8346" target="_blank" rel="noopener">refactoring</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-06" data-time="09:10:10" data-timezone="UTC">09:10AM - 06 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 6 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/11cdce02a048b323c6f56cb15f98e6060aab8346" target="_blank" rel="noopener">
          <span class="added">+6</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/5bd267d7747521fa5bb053da19dc79991e2c4bb5" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/5bd267d7747521fa5bb053da19dc79991e2c4bb5" target="_blank" rel="noopener">refactoring</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-06" data-time="09:10:50" data-timezone="UTC">09:10AM - 06 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 4 additions and 3 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/5bd267d7747521fa5bb053da19dc79991e2c4bb5" target="_blank" rel="noopener">
          <span class="added">+4</span>
          <span class="removed">-3</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/b2b614ed2a1a62ff4c917aba80eeef505810dbf8" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/b2b614ed2a1a62ff4c917aba80eeef505810dbf8" target="_blank" rel="noopener">cover more folders in /usr/local</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-06" data-time="09:15:52" data-timezone="UTC">09:15AM - 06 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 12 additions and 5 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/b2b614ed2a1a62ff4c917aba80eeef505810dbf8" target="_blank" rel="noopener">
          <span class="added">+12</span>
          <span class="removed">-5</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<hr>
<aside class="quote no-group quote-modified" data-username="madaidan" data-post="70" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="65" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What do you think?</p>
</blockquote>
</aside>
<p>It can be done for GUI environments also. Nothing <em>really</em> requires setuid. We can replace them with capabilities.</p>
</blockquote>
</aside>
<p>Great idea!</p>
<p><code>dpkg-statoverride</code> does not support that yet. <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502580">feature request: dpkg-statoverride: support for capabilities</a></p>
<p>Meaning there might be no standard way in which packages implement setting capabilities yet. Therefore I wanted to look at a package that sets capabilities. For example package <code>iputils-ping</code> contains capability enabled binary <code>ping</code>. From the package postinst script:</p>
<blockquote>
<p>/var/lib/dpkg/info/iputils-ping.postinst</p>
</blockquote>
<pre><code class="lang-auto">#!/bin/sh

set -e

if [ "$1" = configure ]; then
    # If we have setcap is installed, try setting cap_net_raw+ep,
    # which allows us to install our binaries without the setuid
    # bit.
    if command -v setcap &gt; /dev/null; then
        if setcap cap_net_raw+ep /bin/ping; then
            chmod u-s /bin/ping
        else
            echo "Setcap failed on /bin/ping, falling back to setuid" &gt;&amp;2
            chmod u+s /bin/ping
        fi
    else
        echo "Setcap is not installed, falling back to setuid" &gt;&amp;2
        chmod u+s /bin/ping
    fi
fi



exit 0

# Local variables:
# mode: shell-script
# tab-width: 4
# indent-tabs-mode: nil
# end:
</code></pre>
<blockquote>
<p>dpkg -S /sbin/setcap</p>
</blockquote>
<pre><code>libcap2-bin: /sbin/setcap
</code></pre>
<blockquote>
<p>cat debian/control  | grep cap</p>
</blockquote>
<pre><code>Recommends: libcap2-bin
</code></pre>
<p>So if <code>libcap2-bin</code> does not get installed early enough (before <code>iputils-ping</code>) is installed, the Debian maintainer script will set SUID instead of using capabilities. Assuming that other packages might be implemented in a similar way, we should find a way to make sure package <code>libcap2-bin</code> is installed during the build process as early as possible.</p>
<p>Other random examples having a similar use of <code>setcap</code>:</p>
<pre><code>grep -rl setcap /var/lib/dpkg/info
</code></pre>
<blockquote>
<p>/var/lib/dpkg/info/iproute2.config<br>
/var/lib/dpkg/info/iproute2.postinst<br>
/var/lib/dpkg/info/libcap2-bin.md5sums<br>
/var/lib/dpkg/info/libcap2-bin.list<br>
/var/lib/dpkg/info/libgstreamer1.0-0:amd64.postinst<br>
/var/lib/dpkg/info/gnome-keyring.postinst<br>
/var/lib/dpkg/info/wireshark-common.postinst<br>
/var/lib/dpkg/info/wireshark-common.templates<br>
/var/lib/dpkg/info/iproute2.templates<br>
/var/lib/dpkg/info/kinit.postinst<br>
/var/lib/dpkg/info/iputils-ping.postinst</p>
</blockquote>
<p>Meanwhile for packages by Whonix or Kicksecure we can just add <code>Depends: libcap2-bin</code> in debian/control and run <code>setcap</code> during postinst.</p>
<p>Happy to work towards a completely SUID / SGID free by default system. Worthwhile development goal to even get rid of Whonix / Kicksecure requiring <code>sudo</code> / any <code>/etc/sudoers.d</code> exceptions?</p>
<p>Would be specifically interesting in context of:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Dev/boot_modes" target="_blank" rel="noopener" title="01:34PM - 01 December 2020">Whonix – 1 Dec 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:121/63;"><img src="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail" width="121" height="63"></div>

<h3><a href="https://www.whonix.org/wiki/Dev/boot_modes" target="_blank" rel="noopener">Multiple Boot Modes for Better Security - an Implementation of Untrusted Root</a></h3>

<p>Persistent User / Live user / Persistent Secureadmin / Persistent Superadmin / Persistent Recovery Mode</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Now this list of sudoers exceptions needs to be ported to capabilities.</p>
<blockquote>
<p>./sdwdate/etc/sudoers.d/sdwdate<br>
./dist-base-files/etc/sudoers.d/30_default-password-lecture<br>
./anon-gw-anonymizer-config/etc/sudoers.d/anonymizer-config-gateway<br>
./tor-control-panel/etc/sudoers.d/tor-control-panel<br>
./tor-control-panel/etc/sudoers.d/restart-tor-gui<br>
./uwt/etc/sudoers.d/uwt<br>
./security-misc/etc/sudoers.d/xfce-security-misc<br>
./security-misc/etc/sudoers.d/security-misc<br>
./security-misc/etc/sudoers.d/pkexec-security-misc<br>
./tb-updater/etc/sudoers.d/tpo-downloader<br>
./whonix-setup-wizard/etc/sudoers.d/whonix-setup-wizard<br>
./usability-misc/etc/sudoers.d/tunnel_unpriv<br>
./usability-misc/etc/sudoers.d/sudo-lecture-disable<br>
./usability-misc/etc/sudoers.d/pwfeedback<br>
./usability-misc/etc/sudoers.d/user-passwordless<br>
./usability-misc/etc/sudoers.d/upgrade-passwordless<br>
./live-config-dist/etc/sudoers.d/live-config-dist<br>
./qubes-whonix/etc/sudoers.d/qubes-whonix<br>
./whonixsetup/etc/sudoers.d/whonixsetup<br>
./sdwdate-gui/etc/sudoers.d/sdwdate-gui<br>
./whonix-xfce-desktop-config/etc/sudoers.d/whonix-xfce-desktop-config<br>
./vm-config-dist/etc/sudoers.d/power-savings-disable-in-vms<br>
./whonixcheck/etc/sudoers.d/whonixcheck<br>
./msgcollector/etc/sudoers.d/msgcollector<br>
./tb-starter/etc/sudoers.d/tb-starter</p>
</blockquote>
<p>Help welcome!</p>
<p>Would we need a wrapper around <code>setcap</code>? Because <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502580">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502580</a> mentions several conditions under which <code>setcap</code> can fail.</p>
<blockquote>
<ul>
<li>Take into account systems no supporting fcaps, this includes:
<ul>
<li>(for now) non-Linux systems,</li>
<li>Linux w/ old kernels or kernels w/o fcap compiled in,</li>
<li>file systems not supporting fcaps, and/or w/o mount time enabled<br>
xattr.</li>
</ul>
</li>
</ul>
</blockquote>
<p>Or don’t care much about this and just ignore errors using <code>setcap [...] || true</code>?</p>
<aside class="quote no-group" data-username="madaidan" data-post="70" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Unlikely. We could cover <code>/root</code> since that’s a bit more likely to contain suid binaries and it wouldn’t increase scan time much since most users would be storing their files in an unprivileged user’s home directory.</p>
</blockquote>
</aside>
<p>Added to wiki:</p>
<blockquote>
<ul>
<li>It does not search folders <code>/root</code> because no SUID binaries should be there by default. That folder is by default readable only by <code>root</code>. If <code>root</code> was to create a custom SUID and move it there, then <code>root</code> should be able to execute it.</li>
</ul>
</blockquote>
<aside class="quote no-group" data-username="madaidan" data-post="70" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>That would break a lot of things. For example, if I mounted a drive containing another Linux system to <code>/mnt</code> in order to debug an issue, permission hardener would kill all suid binaries in it and become extremely slow. A better solution would be mounting those filesystems with the <code>nosuid</code> option since it’s much easier to revert (<code>mount -o remount,suid /mnt</code> vs. resetting all file permissions).</p>
</blockquote>
</aside>
<p>Good point. Now mentioned in wiki.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/71">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/71</link>
        <pubDate>Sun, 06 Dec 2020 09:56:29 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-71</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="65" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What do you think?</p>
</blockquote>
</aside>
<p>It can be done for GUI environments also. Nothing <em>really</em> requires setuid. We can replace them with capabilities.</p>
<aside class="quote no-group" data-username="Patrick" data-post="68" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Rationale for <code>/opt</code> is that some manually installed software installs itself to <code>/opt</code>. Some lesser important functionality might require suid or sgid.</p>
</blockquote>
</aside>
<p>The admin could whitelist their binaries.</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="68" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><code>/home</code>?<br>
<code>/root</code>?</p>
</blockquote>
</aside>
<p>Unlikely. We could cover <code>/root</code> since that’s a bit more likely to contain suid binaries and it wouldn’t increase scan time much since most users would be storing their files in an unprivileged user’s home directory.</p>
<aside class="quote no-group" data-username="Patrick" data-post="68" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><code>/mnt</code>?<br>
<code>/media</code>?</p>
</blockquote>
</aside>
<p>That would break a lot of things. For example, if I mounted a drive containing another Linux system to <code>/mnt</code> in order to debug an issue, permission hardener would kill all suid binaries in it and become extremely slow. A better solution would be mounting those filesystems with the <code>nosuid</code> option since it’s much easier to revert (<code>mount -o remount,suid /mnt</code> vs. resetting all file permissions).</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/70">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/70</link>
        <pubDate>Sat, 05 Dec 2020 17:27:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-70</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/318ab570aacd48b7f163331dc2ba8b012e0d2336" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/318ab570aacd48b7f163331dc2ba8b012e0d2336" target="_blank">simplify disabling of SUID Disabler and Permission Hardener whitelist</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-01" data-time="09:28:15" data-timezone="UTC">09:28AM - 01 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 13 files with 128 additions and 49 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/318ab570aacd48b7f163331dc2ba8b012e0d2336" target="_blank">
          <span class="added">+128</span>
          <span class="removed">-49</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">split `/etc/permission-hardening.d/30_default.conf` into multiple files
`/etc/permission-hardening.d/40_default_whitelist_[...].conf`
therefore make it easier to delete any whitelisted SUID binaries</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/36a471ebce883f7a1660977f486b21ece320d0c2" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/36a471ebce883f7a1660977f486b21ece320d0c2" target="_blank">SUID Disabler and Permission Hardener: introduce configuration option to disable all whitelists</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-01" data-time="10:02:34" data-timezone="UTC">10:02AM - 01 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 2 files with 24 additions and 4 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/36a471ebce883f7a1660977f486b21ece320d0c2" target="_blank">
          <span class="added">+24</span>
          <span class="removed">-4</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">`whitelists_disable_all=true`</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/704f0500ba4e23a1e5b33688db02e03b1169046d" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/704f0500ba4e23a1e5b33688db02e03b1169046d" target="_blank">fix, rename 40_default_whitelist_[...].conf to 25_default_whitelist_[...].conf</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-01" data-time="10:03:16" data-timezone="UTC">10:03AM - 01 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 12 files with 0 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/704f0500ba4e23a1e5b33688db02e03b1169046d" target="_blank">
          <span class="added">+0</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">since whitelist needs to be defined before SUID removal commands</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/b09cc0de6af2d7e12110a0f3030234539288abad" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/b09cc0de6af2d7e12110a0f3030234539288abad" target="_blank">Revert "SUID Disabler and Permission Hardener: introduce configuration option to disable all whitelists"</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-01" data-time="10:10:26" data-timezone="UTC">10:10AM - 01 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 2 files with 4 additions and 24 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/b09cc0de6af2d7e12110a0f3030234539288abad" target="_blank">
          <span class="added">+4</span>
          <span class="removed">-24</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">This reverts commit 36a471ebce883f7a1660977f486b21ece320d0c2.</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/c031f22995a1e073bd81189ee97a3de32a2b278f" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/c031f22995a1e073bd81189ee97a3de32a2b278f" target="_blank">SUID Disabler and Permission Hardener: introduce configuration option to disable all whitelists</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-12-01" data-time="10:14:48" data-timezone="UTC">10:14AM - 01 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 2 files with 15 additions and 1 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/c031f22995a1e073bd81189ee97a3de32a2b278f" target="_blank">
          <span class="added">+15</span>
          <span class="removed">-1</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">`whitelists_disable_all=true`</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/69">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/69</link>
        <pubDate>Tue, 01 Dec 2020 10:17:35 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-69</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Should we add</p>
<ul>
<li><code>/opt/ nosuid</code></li>
<li><code>/usr/local/opt nosuid</code></li>
</ul>
<p>?</p>
<p>Rationale for <code>/opt</code> is that some manually installed software installs itself to <code>/opt</code>. Some lesser important functionality might require suid or sgid. The suid/sgid bit might have been accidentally set by a developer. (Or part of legacy install scripts. Useful in past, then forgotten, now obsolete.) Removal of suid / sgid might in many cases go unnoticed by the user. (In cases where that software is run as root anyhow.)</p>
<p>On the other hand, the <code>/opt</code> folder is empty on a default Debian (based) installation. One could argue if the (super) admin installs files there it should be honored by the system and kept unobstructed.</p>
<p>I guess it depends if <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707" class="inline-onebox">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> would re-mount <code>/opt</code> with <code>nosuid</code> anyhow?</p>
<hr>
<p>Other folders where suid binaries might end up?</p>
<ul>
<li>
<code>/home</code>?</li>
</ul>
<p>But adding that I guess would be excessive because:</p>
<ul>
<li>Will be covered by <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707" class="inline-onebox">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> anyhow which will be a better solution.</li>
<li>Avoid long scan times during boot.</li>
<li>Requires root anyhow to create root owned suid binaries. System administrator shouldn’t create root owned suid binaries in home folder anyhow.</li>
</ul>
<p>Also <code>/root</code>? Depends on outcome of this post <a href="https://forums.whonix.org/t/disable-suid-binaries/7706/65" class="inline-onebox">Disable SUID Binaries</a> - A) vs B).</p>
<p>Others:</p>
<ul>
<li>
<code>/mnt</code>?</li>
<li>
<code>/media</code>?</li>
<li>Any others?</li>
</ul>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/68">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/68</link>
        <pubDate>Sun, 29 Nov 2020 15:22:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-68</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/cf07e977bd6697af7a4326d7705447d500d35593" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/cf07e977bd6697af7a4326d7705447d500d35593" target="_blank">add `/bin/pkexec exactwhitelist` for consistency</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-11-29" data-time="14:09:42" data-timezone="UTC">02:09PM - 29 Nov 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 2 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/cf07e977bd6697af7a4326d7705447d500d35593" target="_blank">
          <span class="added">+2</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">since there is already `/usr/bin/pkexec exactwhitelist`</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<hr>
<p>More documentation enhancements:<br>
<a href="https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;type=revision&amp;diff=61041&amp;oldid=61017">https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;type=revision&amp;diff=61041&amp;oldid=61017</a></p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/67">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/67</link>
        <pubDate>Sun, 29 Nov 2020 14:13:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-67</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/28a326a8a14f56d588ed6f2b4d7d748d53120109" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/28a326a8a14f56d588ed6f2b4d7d748d53120109" target="_blank">add feature `/usr/lib/security-misc/permission-hardening-undo /path/to/filename`</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-11-28" data-time="10:31:12" data-timezone="UTC">10:31AM - 28 Nov 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 90 additions and 6 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/28a326a8a14f56d588ed6f2b4d7d748d53120109" target="_blank">
          <span class="added">+90</span>
          <span class="removed">-6</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">to allow removing 1 SUID
fix, show INFO message if file does not exist during removal rather than ERROR</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<hr>
<p>Improved documentation:</p>
<ul>
<li><a href="https://www.whonix.org/w/index.php?title=Security-misc&amp;type=revision&amp;diff=60993&amp;oldid=55566">https://www.whonix.org/w/index.php?title=Security-misc&amp;type=revision&amp;diff=60993&amp;oldid=55566</a></li>
<li><a href="https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;type=revision&amp;diff=61017&amp;oldid=60996">https://www.whonix.org/w/index.php?title=SUID_Disabler_and_Permission_Hardener&amp;type=revision&amp;diff=61017&amp;oldid=60996</a></li>
</ul>
<p>Moved to dedicated wiki page:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/SUID_Disabler_and_Permission_Hardener" target="_blank" title="10:58AM - 28 November 2020">Whonix – 28 Nov 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/58;"><img src="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail" width="110" height="58"></div>

<h3><a href="https://www.whonix.org/wiki/SUID_Disabler_and_Permission_Hardener" target="_blank">SUID Disabler and Permission Hardener</a></h3>

<p>Attack surface reduction through disabling of SUID enabled binaries.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Please review.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/66">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/66</link>
        <pubDate>Sat, 28 Nov 2020 11:02:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-66</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="1" data-topic="7706">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><a href="https://github.com/QubesOS/qubes-issues/issues/2695">https://github.com/QubesOS/qubes-issues/issues/2695 </a> has interesting ideas.</p>
<p>Quote Solar Designer (someone that Joanna Rutkowska respects):</p>
<blockquote>
<p>Ideally, there should be no SUID binaries reachable from the user account, as otherwise significant extra attack surface inside the VM is exposed (dynamic linker, libc startup, portions of Linux kernel including ELF loader, etc.)</p>
</blockquote>
</blockquote>
</aside>
<p>I think there are two security issues with SUID.</p>
<ul>
<li>
<code>A)</code> As I’ve added to the wiki just now <code>Some SUID binaries have a history of privilege escalation security vulnerabilities.</code>.</li>
<li>
<code>B)</code> General attack surface such as kernel attack surface.</li>
</ul>
<p>What <code>SUID Disabler and Permission Hardener</code> is currently doing is disable as many SUID binaries as reasonable without breaking a Linux desktop operating system. Improving the situation for <code>A)</code></p>
<p>To however have the full benefit, to do <code>B)</code> we would have to eliminate all SUID binaries. This might be reasonable and doable for CLI environments such as servers ( also think Kicksecure).</p>
<p>What do you think?</p>
<p>If you agree, I guess the configuration file of <code>SUID Disabler and Permission Hardener</code> should be split. The whitelist should be in a separate file. Then a system administrator could easily nuke the whitelist. Alternatively or additional perhaps a <code>ignore_whitelist=true</code> configuration option would be useful? Then we could document this and some users could benefit from a completely SUID free system.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/65">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/65</link>
        <pubDate>Sat, 28 Nov 2020 09:46:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-65</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="madaidan" data-post="7" data-topic="10594">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"><a href="//forums.whonix.org/t/eliminate-ld-preload-and-other-dangerous-environment-variables/10594/7">Eliminate LD_PRELOAD and other Dangerous Environment Variables</a>
</div>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="6" data-topic="10594">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"><a href="//forums.whonix.org/t/eliminate-ld-preload-and-other-dangerous-environment-variables/10594/6">Eliminate LD_PRELOAD and other Dangerous Environment Variables</a>
</div>
<blockquote>
<p>SUID disabling feature will most likely be enabled by default one day.</p>
</blockquote>
</aside>
<p>Is there any blocker stopping it from being enabled now?</p>
</blockquote>
</aside>
<p>Needs a call for testers.</p>
<p>Polishing a few things just now.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/64">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/64</link>
        <pubDate>Sat, 28 Nov 2020 09:27:43 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-64</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Anyone got time to read?</p>
<ul>
<li><a href="https://pen-testing.sans.org/resources/papers/gcih/discovering-local-suid-exploit-105447">https://pen-testing.sans.org/resources/papers/gcih/discovering-local-suid-exploit-105447</a></li>
<li><a href="https://web.archive.org/web/20180212122001/https://pen-testing.sans.org/resources/papers/gcih/discovering-local-suid-exploit-105447">https://web.archive.org/web/20180212122001/https://pen-testing.sans.org/resources/papers/gcih/discovering-local-suid-exploit-105447</a></li>
</ul>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/63">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/63</link>
        <pubDate>Tue, 16 Jun 2020 15:20:02 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-63</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Fixed.</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/f3ff32ddbb8a7cf7555b9f1b2154e83154532a3d" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/f3ff32ddbb8a7cf7555b9f1b2154e83154532a3d" target="_blank">Protect /bin/mount from 'chmod -x'.</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2019-12-30" data-time="11:39:24" data-timezone="UTC">11:39AM - 30 Dec 19 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 11 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/f3ff32ddbb8a7cf7555b9f1b2154e83154532a3d" target="_blank">
          <span class="added">+11</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">/bin/mount exactwhitelist
/usr/bin/mount exactwhitelist
Remove SUID from 'mount' but keep executable.
/bin/mount 745 root root
/usr/bin/mount 745 root root
https://forums.whonix.org/t/disable-suid-binaries/7706/61</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Not an ideal solution. First add <code>/bin/mount</code> to <code>exactwhitelist</code> and then below set <code>/bin/mount 745 root root</code>. A unintuitive config. But good enough for now?</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/62">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/62</link>
        <pubDate>Mon, 30 Dec 2019 11:41:25 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-62</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Found bug.</p>
<blockquote>
<p>/usr/bin/torbrowser: line 252: /bin/mount: Permission denied<br>
/usr/bin/torbrowser: line 270: /bin/mount: Permission denied</p>
</blockquote>
<p>/usr/bin/torbrowser (by Whonix developers) uses <code>mount</code> to check if Tor Browser folder is mounted noexec.</p>
<p><code>/bin/mount</code> is SUID by Debian default.</p>
<aside class="onebox stackexchange">
  <header class="source">
      <a href="https://unix.stackexchange.com/questions/107500/why-does-mount-have-the-suid-bit-set" target="_blank">unix.stackexchange.com</a>
  </header>
  <article class="onebox-body">
      <a href="https://unix.stackexchange.com/users/11318/daisy" target="_blank">
    <img alt="daisy" src="https://www.gravatar.com/avatar/f72f8a11c26cf73334dc5c97e9564257?s=128&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="https://unix.stackexchange.com/questions/107500/why-does-mount-have-the-suid-bit-set" target="_blank">Why does mount have the SUID bit set?</a>
</h4>

<div class="tags">
  <strong>mount</strong>
</div>

<div class="date">
  asked by
  
  <a href="https://unix.stackexchange.com/users/11318/daisy" target="_blank">
    daisy
  </a>
  on <a href="https://unix.stackexchange.com/questions/107500/why-does-mount-have-the-suid-bit-set" target="_blank">08:22AM - 02 Jan 14 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Therefore <code>/bin/mount</code> makes sense as executable but with SUID removed.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/61">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/61</link>
        <pubDate>Mon, 30 Dec 2019 11:31:02 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-61</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Did that. And probably found the cause:</p>
<aside class="quote quote-modified" data-post="26" data-topic="7707">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/26">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    These two things must not run together. 

Dec 29 04:17:12 debian-buster-test remount-secure[410]: mount -o nosuid,nodev --bind /tmp /tmp 


Dec 29 04:17:12 debian-buster-test permission-hardening[413]: /usr/lib/security-misc/permission-hardening: line 255: cannot create temp file for here-document: No such file or directory 
Dec 29 04:17:12 debian-buster-test permission-hardening[413]: ERROR: cannot parse line: /usr/bin/sudo exactwhitelist 

Can cause issues such as this: 


How can a systemd un…
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/60">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/60</link>
        <pubDate>Sun, 29 Dec 2019 09:54:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-60</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Really bad bug disabling sudo. Unexplained. Non-reproducible. Not a full disk issue, plenty of free space.</p>
<blockquote>
<p>Dec 29 04:17:11 debian-buster-test permission-hardening[413]: INFO: START parsing config_file: ‘/etc/permission-hardening.d/30_default.conf’<br>
Dec 29 04:17:12 debian-buster-test permission-hardening[413]: /usr/lib/security-misc/permission-hardening: line 255: cannot create temp file for here-document: No such file or directory<br>
Dec 29 04:17:12 debian-buster-test permission-hardening[413]: ERROR: cannot parse line: /usr/bin/sudo exactwhitelist</p>
</blockquote>
<p>Probably better to abort processing the config file and immediately <code>exit</code> with error when that happens. Will implement that.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/59">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/59</link>
        <pubDate>Sun, 29 Dec 2019 09:34:21 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-59</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/674840e6f9fb362dc713da3edde07132b5ae17d4" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/674840e6f9fb362dc713da3edde07132b5ae17d4" target="_blank">/fusermount matchwhitelist</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2019-12-26" data-time="10:44:35" data-timezone="UTC">10:44AM - 26 Dec 19 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 7 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/674840e6f9fb362dc713da3edde07132b5ae17d4" target="_blank">
          <span class="added">+7</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">unbreak AppImages such as electrum Bitcoin wallet
https://forums.whonix.org/t/disable-suid-binaries/7706/57</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/58">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/58</link>
        <pubDate>Thu, 26 Dec 2019 10:45:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-58</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <pre><code>./electrum*.AppImage 
</code></pre>
<blockquote>
<p>fuse: failed to exec fusermount: Permission denied</p>
<p>Cannot mount AppImage, please check your FUSE setup.<br>
You might still be able to extract the contents of this AppImage<br>
if you run it with the --appimage-extract option.<br>
See <a href="https://github.com/AppImage/AppImageKit/wiki/FUSE">https://github.com/AppImage/AppImageKit/wiki/FUSE</a><br>
for more information<br>
open dir error: No such file or directory</p>
</blockquote>
<p>To fix:</p>
<pre><code>sudo chmod +sx /bin/fusermount</code></pre>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/57">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/57</link>
        <pubDate>Thu, 26 Dec 2019 10:41:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-57</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>Should it do that anyway? The point of those options are for whitelisting, not adding back permissions. This doesn’t seem needed.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/56">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/56</link>
        <pubDate>Tue, 24 Dec 2019 23:24:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-56</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
      <item>
        <title>SUID Disabler and Permission Hardener</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>The only missing feature is: if suid / sgid was already removed during a previous run of the service and the user adds it to exactwhitelist of machwhitelist after that, it will not be re-enabled suid / sgid.</p>
<p>An easy fix would be to tell users “boot into admin mode”, run <code>/usr/lib/security-misc/permission-hardening-undo</code> and reboot. But this is a bit unsafe if other services are already started. “boot into admin mode” should probably mean “don’t start any services such as web services”? Will discuss in <a href="https://forums.whonix.org/t/multiple-boot-modes-for-better-security-persistent-root-persistent-noroot-live-root-live-noroot/7708" class="inline-onebox">multiple boot modes for better security: persistent + root | persistent + noroot | live + root | live + noroot</a></p>
<p>We could auto-restore permissions for later added whitelist entries since permission before change are recorded in <code>/var/lib/permission-hardening/existing_mode</code>.</p>
<pre><code>if [ "$mode_from_config" = "exactwhitelist" ]; then
</code></pre>
<p>could check <code>/var/lib/permission-hardening/existing_mode</code>. Same for</p>
<pre><code>if [ "$mode_from_config" = "matchwhitelist" ]; then
</code></pre>
<p>But not sure if worth the effort.</p>
          <p><a href="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/55">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706/55</link>
        <pubDate>Tue, 24 Dec 2019 23:19:03 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7706-55</guid>
        <source url="http://forums.whonix.org/t/suid-disabler-and-permission-hardener/7706.rss">SUID Disabler and Permission Hardener</source>
      </item>
  </channel>
</rss>
