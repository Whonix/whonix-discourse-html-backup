<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Tor Before VPN Broken - Qubes-Whonix - Whonix Forum</title>
    <meta name="description" content="I‚Äôm having issues with Tor before VPN using the separate VPN gateway configuration. 
I‚Äôve configured a VPN using TCP and have verified that it works using sys-firewall as the net vm. I then switch the net vm to sys-whoni&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="13475.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Tor Before VPN Broken&#39;" href="13475.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/tor-before-vpn-broken/13475" />
<meta name="twitter:url" content="https://forums.whonix.org/t/tor-before-vpn-broken/13475" />
<meta property="og:title" content="Tor Before VPN Broken" />
<meta name="twitter:title" content="Tor Before VPN Broken" />
<meta property="og:description" content="I‚Äôm having issues with Tor before VPN using the separate VPN gateway configuration.  I‚Äôve configured a VPN using TCP and have verified that it works using sys-firewall as the net vm. I then switch the net vm to sys-whonix and the initial VPN connection works but after that I get 100% packet loss. I‚Äôve monitored eth0 and can see a consistent stream of outgoing ARP requests asking for the MAC address associated with the remote VPN server IP. This is very strange as the correct routes exist for the..." />
<meta name="twitter:description" content="I‚Äôm having issues with Tor before VPN using the separate VPN gateway configuration.  I‚Äôve configured a VPN using TCP and have verified that it works using sys-firewall as the net vm. I then switch the net vm to sys-whonix and the initial VPN connection works but after that I get 100% packet loss. I‚Äôve monitored eth0 and can see a consistent stream of outgoing ARP requests asking for the MAC address associated with the remote VPN server IP. This is very strange as the correct routes exist for the..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ‚ù§" />
<meta property="article:published_time" content="2022-03-21T05:20:50+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="13475.html">Tor Before VPN Broken</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/qubes-whonix/12.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #63a0ff'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Qubes-Whonix</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/engineerhorn'><span itemprop='name'>engineerhorn</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="13475.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-03-21T05:20:50Z' class='post-time'>
                March 21, 2022,  5:20am
              </time>
              <meta itemprop='dateModified' content='2022-03-21T08:30:34Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I‚Äôm having issues with Tor before VPN using the separate VPN gateway configuration.</p>
<p>I‚Äôve configured a VPN using TCP and have verified that it works using sys-firewall as the net vm. I then switch the net vm to sys-whonix and the initial VPN connection works but after that I get 100% packet loss. I‚Äôve monitored eth0 and can see a consistent stream of outgoing ARP requests asking for the MAC address associated with the remote VPN server IP. This is very strange as the correct routes exist for the remote VPN server (VPN server IP via 10.137.0.9 dev eth0) and for sys-whonix (10.137.0.9 dev eth0 scope host onlink).  I have verified that the routes are the same when connected to sys-whonix as when connected to sys-firewall, with the IPs adjusted of course).</p>
<p>I‚Äôm using qubes 4.1, whonix-gw-16. The last working configuration I had for tor before vpn was with qubes 4.0 whonix-gw-15. I‚Äôve used the exact same configuration for both. OpenVPN version is 2.5.1. This is all inside a debian-11 vm.</p>
<p>I was certain this was an OpenVPN bug until I confirmed it only occurs when connected to sys-whonix. I have no idea how to even begin to move forward.</p>
        </div>

        <meta itemprop='headline' content='Tor Before VPN Broken'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="13475.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-03-21T08:37:05Z' class='post-time'>
                March 21, 2022,  8:37am
              </time>
              <meta itemprop='dateModified' content='2022-03-21T08:37:05Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Generic_Bug_Reproduction">Generic Bug Reproduction</a></p>
<aside class="onebox allowlistedgeneric" data-onebox-src="../../../external.html?link=https://www.whonix.org/wiki/Qubes/Troubleshooting">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/w/images/a/a4/Whonix-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="../../../external.html?link=https://www.whonix.org/wiki/Qubes/Troubleshooting" target="_blank" rel="noopener" title="09:50AM - 09 March 2022">Whonix ‚Äì 9 Mar 22</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:640/480;"><img src="../../../external.html?link=https://www.whonix.org/w/images/6/61/Torconnectivitytroubleshoot.png" class="thumbnail" width="640" height="480"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Qubes/Troubleshooting" target="_blank" rel="noopener">Qubes-Whonix ‚Ñ¢ Tor Connectivity and sdwdate Troubleshooting</a></h3>

  <p>Troubleshooting Tor, Network and sdwdate Issues with Whonix ‚Ñ¢</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Tor Before VPN Broken'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/engineerhorn'><span itemprop='name'>engineerhorn</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="13475.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-03-21T21:51:58Z' class='post-time'>
                March 21, 2022,  9:51pm
              </time>
              <meta itemprop='dateModified' content='2022-03-22T22:31:20Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>It appears that many others have been experiencing this issue for quite some time. Crazy to me that Qubes would go ahead and release a ‚Äúfinal‚Äù version of 4.1 with such ridiculous issues.</p>
<p>For those who stumble across this post I am currently having success by doing:<br>
arp -s REMOTE-VPN-SERVER-IP -i eth0 fe:ff:ff:ff:ff:ff</p>
<p>I have looked into the difference between networking in Qubes 4.0 (where Tor before VPN worked perfectly) and Qubes 4.1 (where it is broken) and the thing that jumps out at me is that in 4.0 the command ‚Äúip neigh show‚Äù does not include the remote VPN server IP as a neighbor which is to be expected, whereas in Qubes 4.1 the remote VPN server IP is considered a neighbor. From my understanding of networking, this is definitely a bug in 4.1. Given that the tcpdump of eth0 in the vpn gateway is a series of ARP requests trying to resolve this ‚Äúneighbor‚Äù that should not even be considered a neighbor, I think this is definitely something that needs to be explored.</p>
<p>Hopefully someone stumbles upon this and explores further or knows how to put this in front of the correct eyes. I myself have wasted three days on this bullshit and unfortunately need to move on.</p>
        </div>

        <meta itemprop='headline' content='Tor Before VPN Broken'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="13475.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-03-22T08:16:37Z' class='post-time'>
                March 22, 2022,  8:16am
              </time>
              <meta itemprop='dateModified' content='2022-03-22T08:16:37Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>This isn‚Äôt caused by any source code by Whonix.<br>
Qubes issues.<br>
If this shall be fixed, it must be reported to Qubes directly.<br>
As per <a href="../what-to-post-in-this-qubes-whonix-forum-and-what-not/2275.html" class="inline-onebox">What to post in this Qubes-Whonix forum and what not.</a></p>
        </div>

        <meta itemprop='headline' content='Tor Before VPN Broken'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
