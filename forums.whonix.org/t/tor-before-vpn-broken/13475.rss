<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Tor Before VPN Broken</title>
    <link>http://forums.whonix.org/t/tor-before-vpn-broken/13475</link>
    <description>I&#39;m having issues with Tor before VPN using the separate VPN gateway configuration. 

I&#39;ve configured a VPN using TCP and have verified that it works using sys-firewall as the net vm. I then switch the net vm to sys-whonix and the initial VPN connection works but after that I get 100% packet loss. I&#39;ve monitored eth0 and can see a consistent stream of outgoing ARP requests asking for the MAC address associated with the remote VPN server IP. This is very strange as the correct routes exist for the remote VPN server (VPN server IP via 10.137.0.9 dev eth0) and for sys-whonix (10.137.0.9 dev eth0 scope host onlink).  I have verified that the routes are the same when connected to sys-whonix as when connected to sys-firewall, with the IPs adjusted of course). 

I&#39;m using qubes 4.1, whonix-gw-16. The last working configuration I had for tor before vpn was with qubes 4.0 whonix-gw-15. I&#39;ve used the exact same configuration for both. OpenVPN version is 2.5.1. This is all inside a debian-11 vm. 

I was certain this was an OpenVPN bug until I confirmed it only occurs when connected to sys-whonix. I have no idea how to even begin to move forward.</description>
    <language>en</language>
    <lastBuildDate>Tue, 22 Mar 2022 08:16:37 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/tor-before-vpn-broken/13475.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Tor Before VPN Broken</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This isn’t caused by any source code by Whonix.<br>
Qubes issues.<br>
If this shall be fixed, it must be reported to Qubes directly.<br>
As per <a href="https://forums.whonix.org/t/what-to-post-in-this-qubes-whonix-forum-and-what-not/2275" class="inline-onebox">What to post in this Qubes-Whonix forum and what not.</a></p>
          <p><a href="http://forums.whonix.org/t/tor-before-vpn-broken/13475/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-before-vpn-broken/13475/4</link>
        <pubDate>Tue, 22 Mar 2022 08:16:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13475-4</guid>
        <source url="http://forums.whonix.org/t/tor-before-vpn-broken/13475.rss">Tor Before VPN Broken</source>
      </item>
      <item>
        <title>Tor Before VPN Broken</title>
        <dc:creator><![CDATA[engineerhorn]]></dc:creator>
        <description><![CDATA[
            <p>It appears that many others have been experiencing this issue for quite some time. Crazy to me that Qubes would go ahead and release a “final” version of 4.1 with such ridiculous issues.</p>
<p>For those who stumble across this post I am currently having success by doing:<br>
arp -s REMOTE-VPN-SERVER-IP -i eth0 fe:ff:ff:ff:ff:ff</p>
<p>I have looked into the difference between networking in Qubes 4.0 (where Tor before VPN worked perfectly) and Qubes 4.1 (where it is broken) and the thing that jumps out at me is that in 4.0 the command “ip neigh show” does not include the remote VPN server IP as a neighbor which is to be expected, whereas in Qubes 4.1 the remote VPN server IP is considered a neighbor. From my understanding of networking, this is definitely a bug in 4.1. Given that the tcpdump of eth0 in the vpn gateway is a series of ARP requests trying to resolve this “neighbor” that should not even be considered a neighbor, I think this is definitely something that needs to be explored.</p>
<p>Hopefully someone stumbles upon this and explores further or knows how to put this in front of the correct eyes. I myself have wasted three days on this bullshit and unfortunately need to move on.</p>
          <p><a href="http://forums.whonix.org/t/tor-before-vpn-broken/13475/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-before-vpn-broken/13475/3</link>
        <pubDate>Mon, 21 Mar 2022 21:51:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13475-3</guid>
        <source url="http://forums.whonix.org/t/tor-before-vpn-broken/13475.rss">Tor Before VPN Broken</source>
      </item>
      <item>
        <title>Tor Before VPN Broken</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://www.whonix.org/wiki/Reporting_Bugs#Generic_Bug_Reproduction">Generic Bug Reproduction</a></p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.whonix.org/wiki/Qubes/Troubleshooting">
  <header class="source">
      <img src="https://www.whonix.org/w/images/a/a4/Whonix-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="https://www.whonix.org/wiki/Qubes/Troubleshooting" target="_blank" rel="noopener" title="09:50AM - 09 March 2022">Whonix – 9 Mar 22</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:640/480;"><img src="https://www.whonix.org/w/images/6/61/Torconnectivitytroubleshoot.png" class="thumbnail" width="640" height="480"></div>

<h3><a href="https://www.whonix.org/wiki/Qubes/Troubleshooting" target="_blank" rel="noopener">Qubes-Whonix ™ Tor Connectivity and sdwdate Troubleshooting</a></h3>

  <p>Troubleshooting Tor, Network and sdwdate Issues with Whonix ™</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/tor-before-vpn-broken/13475/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-before-vpn-broken/13475/2</link>
        <pubDate>Mon, 21 Mar 2022 08:37:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13475-2</guid>
        <source url="http://forums.whonix.org/t/tor-before-vpn-broken/13475.rss">Tor Before VPN Broken</source>
      </item>
      <item>
        <title>Tor Before VPN Broken</title>
        <dc:creator><![CDATA[engineerhorn]]></dc:creator>
        <description><![CDATA[
            <p>I’m having issues with Tor before VPN using the separate VPN gateway configuration.</p>
<p>I’ve configured a VPN using TCP and have verified that it works using sys-firewall as the net vm. I then switch the net vm to sys-whonix and the initial VPN connection works but after that I get 100% packet loss. I’ve monitored eth0 and can see a consistent stream of outgoing ARP requests asking for the MAC address associated with the remote VPN server IP. This is very strange as the correct routes exist for the remote VPN server (VPN server IP via 10.137.0.9 dev eth0) and for sys-whonix (10.137.0.9 dev eth0 scope host onlink).  I have verified that the routes are the same when connected to sys-whonix as when connected to sys-firewall, with the IPs adjusted of course).</p>
<p>I’m using qubes 4.1, whonix-gw-16. The last working configuration I had for tor before vpn was with qubes 4.0 whonix-gw-15. I’ve used the exact same configuration for both. OpenVPN version is 2.5.1. This is all inside a debian-11 vm.</p>
<p>I was certain this was an OpenVPN bug until I confirmed it only occurs when connected to sys-whonix. I have no idea how to even begin to move forward.</p>
          <p><a href="http://forums.whonix.org/t/tor-before-vpn-broken/13475/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-before-vpn-broken/13475/1</link>
        <pubDate>Mon, 21 Mar 2022 05:20:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13475-1</guid>
        <source url="http://forums.whonix.org/t/tor-before-vpn-broken/13475.rss">Tor Before VPN Broken</source>
      </item>
  </channel>
</rss>
