<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Whonix-13-Workstation VPN-Firewall - Development - Whonix Forum</title>
    <meta name="description" content="Instructions tested and working (with vpn-specific required modifications to openvpn.conf): https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Setup_Tor_before_a_VPN_.28User_-.3E_Tor_-.3E_VPN_-.3E_Interne&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="2465.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Whonix-13-Workstation VPN-Firewall&#39;" href="2465.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/whonix-13-workstation-vpn-firewall/2465" />
<meta name="twitter:url" content="https://forums.whonix.org/t/whonix-13-workstation-vpn-firewall/2465" />
<meta property="og:title" content="Whonix-13-Workstation VPN-Firewall" />
<meta name="twitter:title" content="Whonix-13-Workstation VPN-Firewall" />
<meta property="og:description" content="Instructions tested and working (with vpn-specific required modifications to openvpn.conf): https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Setup_Tor_before_a_VPN_.28User_-.3E_Tor_-.3E_VPN_-.3E_Internet.29  Fail-closed tests with:  WORKSTATION_FIREWALL=1 TUNNEL_FIREWALL_ENABLE=true  | TransPort | TUNNEL_FIREWALL_ALLOW_LOCAL_NET | |  traffic  |      true      |     false      | |___________|________________|________________| |           |                |                | |  VP..." />
<meta name="twitter:description" content="Instructions tested and working (with vpn-specific required modifications to openvpn.conf): https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Setup_Tor_before_a_VPN_.28User_-.3E_Tor_-.3E_VPN_-.3E_Internet.29  Fail-closed tests with:  WORKSTATION_FIREWALL=1 TUNNEL_FIREWALL_ENABLE=true  | TransPort | TUNNEL_FIREWALL_ALLOW_LOCAL_NET | |  traffic  |      true      |     false      | |___________|________________|________________| |           |                |                | |  VP..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ‚ù§" />
<meta property="article:published_time" content="2016-05-19T06:17:13+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="2465.html">Whonix-13-Workstation VPN-Firewall</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-19T06:17:13Z' class='post-time'>
                May 19, 2016,  6:17am
              </time>
              <meta itemprop='dateModified' content='2016-05-21T19:24:08Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Instructions tested and working (with vpn-specific required modifications to openvpn.conf): <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Setup_Tor_before_a_VPN_.28User_-.3E_Tor_-.3E_VPN_-.3E_Internet.29">https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Setup_Tor_before_a_VPN_.28User_-.3E_Tor_-.3E_VPN_-.3E_Internet.29</a></p>
<p>Fail-closed tests with:</p>
<pre><code>WORKSTATION_FIREWALL=1
TUNNEL_FIREWALL_ENABLE=true

| TransPort | TUNNEL_FIREWALL_ALLOW_LOCAL_NET |
|  traffic  |      true      |     false      |
|___________|________________|________________|
|           |                |                |
|  VPN Up   |    allowed     |    allowed     |
|           |                |                |
|  VPN Down |    blocked     |    blocked     |
|___________|________________|________________|


| SocksPort | TUNNEL_FIREWALL_ALLOW_LOCAL_NET |
|  traffic  |      true      |     false      |
|___________|________________|________________|
|           |                |                |
|  VPN Up   |    allowed     |    blocked     |
|           |                |                |
|  VPN Down |    allowed     |    blocked     |
|___________|________________|________________|
</code></pre>
<p>Working as expected (by me anyway).</p>
<p>Notes:</p>
<ul>
<li>
<p>Not sure why VPN_FIREWALL= is still in conf file. Would like confirmation that it is obsolete and replaced by TUNNEL_FIREWALL_ENABLE?</p>
</li>
<li>
<p>With all the changes to root filesystem, really need bind-directories functionality for this (in Qubes). (as noted in wiki) (Not interested in standalone vm‚Äôs)</p>
</li>
<li>
<p>As a temporary workaround, would like to keep openvpn files in ~/openvpn/ and launch manually (not use systemd).<br>
With my limited linux knowledge, can‚Äôt figure out why:</p>
<h1>su tunnel<br>
sudo openvpn openvpn.conf</h1>
<p>ROUTE_GATEWAY 10.137.2.1<br>
TUN/TAP device tun0 opened</p>
</li>
</ul>
<p>works but</p>
<pre><code>sudo -u tunnel openvpn openvpn.conf
=
ROUTE_GATEWAY 10.137.2.1
ERROR: Cannot ioctl TUNSETIFF tun: Operation not permitted (errno=1)
Exiting due to fatal error
</code></pre>
<p>fails to create tun device.</p>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-19T13:53:13Z' class='post-time'>
                May 19, 2016,  1:53pm
              </time>
              <meta itemprop='dateModified' content='2016-05-19T13:53:13Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thank you a lot for testing this!</p>
<aside class="quote" data-post="1" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>Not sure why VPN_FIREWALL= is still in conf file. Would like confirmation that it is obsolete and replaced by TUNNEL_FIREWALL_ENABLE?</p>
</blockquote>
</aside>
<p>Yes, very much the same.</p>
<ul>
<li><a href="../../../external.html?link=https://github.com/Whonix/whonix-ws-firewall/blob/d065fab590b4793791d6ee0424f40d6e6d2321ea/etc/whonix_firewall.d/30_default.conf#L30-L39">https://github.com/Whonix/whonix-ws-firewall/blob/d065fab590b4793791d6ee0424f40d6e6d2321ea/etc/whonix_firewall.d/30_default.conf#L30-L39</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/whonix-ws-firewall/blob/d065fab590b4793791d6ee0424f40d6e6d2321ea/usr/bin/whonix_firewall#L24-L26">https://github.com/Whonix/whonix-ws-firewall/blob/d065fab590b4793791d6ee0424f40d6e6d2321ea/usr/bin/whonix_firewall#L24-L26</a></li>
</ul>
<p>The config file comments should be cleaned up for next release indeed. My motivation was to keep the old config variable name to avoid confusing existing users. [On the gateway, and then copy pasted this legacy to the workstation.] Are you interested to send a git pull request improving that?</p>
<aside class="quote" data-post="1" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>With all the changes to root filesystem, really need bind-directories functionality for this (in Qubes). (as noted in wiki) (Not interested in standalone vm‚Äôs)</p>
</blockquote>
</aside>
<p>Yes.</p>
<p>I have changed /etc/whonix_firewall.d/50_user.conf to /rw/config/whonix_firewall.d/50_user.conf so at least that does not require bind-dirs.</p>
<p>Please test and confirm it works.</p>
<pre><code>sudo mv /etc/whonix_firewall.d/50_user.conf /rw/config/whonix_firewall.d/50_user.conf
</code></pre>
<aside class="quote" data-post="1" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>ERROR: Cannot ioctl TUNSETIFF tun: Operation not permitted (errno=1)</p>
</blockquote>
</aside>
<p>It is very hairy indeed to make openvpn run under a user account.</p>
<p>‚ÄúYou need to emulate <a href="../../../external.html?link=https://github.com/Whonix/usability-misc/blob/master/lib/systemd/system/openvpn%40openvpn.service.d/50_unpriv.conf">https://github.com/Whonix/usability-misc/blob/master/lib/systemd/system/openvpn%40openvpn.service.d/50_unpriv.conf</a> then.‚Äù</p>
<pre><code>sudo /usr/sbin/openvpn --rmtun --dev tun0
sudo /usr/sbin/openvpn --mktun --dev tun0 --dev-type tun --user tunnel --group tunnel
cd /etc/openvpn
sudo -u tunnel openvpn openvpn.conf
</code></pre>
<hr>
<p>off-topic, you might also be interested in:<br>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../external.html?link=https://www.whonix.org/wiki/VPN-Firewall" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:640/357;"><img src="../../../external.html?link=https://www.whonix.org/w/images/1/1e/Vpnfirewall-29940640.png" class="thumbnail"></div>

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/VPN-Firewall" target="_blank" rel="nofollow noopener">VPN-Firewall</a></h3>

<p>Instructions on how to use VPN-Firewall. A Fail Closed Mechanism for VPNs. Prevent leaks when using VPNs. Force all connections through VPNs. Prevents...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../standalone-vpn-firewall-new-tunnel-firewall/2476.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../standalone-vpn-firewall-new-tunnel-firewall/2476.html'>
                      <span itemprop='name'>Standalone VPN-Firewall (new Tunnel Firewall)</span>
                    </a>
                    <meta itemprop='position' content='5'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-20T06:11:49Z' class='post-time'>
                May 20, 2016,  6:11am
              </time>
              <meta itemprop='dateModified' content='2016-05-20T06:11:49Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="2" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I have changed /etc/whonix_firewall.d/50_user.conf to /rw/config/whonix_firewall.d/50_user.conf so at least that does not require bind-dirs.</p>
<p>Please test and confirm it works.</p>
</blockquote>
</aside>
<p>Works!</p>
<aside class="quote" data-post="2" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>My motivation was to keep the old config variable name to avoid confusing existing users.</p>
</blockquote>
</aside>
<p>If there is no plan to permanently replace usage of VPN_FIREWALL with TUNNEL_FIREWALL_ENABLE, probably makes sense to keep TUNNEL_FIREWALL_ENABLE hidden. Advantages to using VPN_FIREWALL: 1) legacy benefits 2) consistency with gateway-vpn-firewall.</p>
<p>Also, for consistency, configurable booleans should all be 0/1 or all true/false‚Ä¶</p>
<hr>
<p><a href="../../../external.html?link=https://github.com/Whonix/whonix-ws-firewall/blob/master/usr/bin/whonix_firewall#L28" class="onebox" target="_blank">https://github.com/Whonix/whonix-ws-firewall/blob/master/usr/bin/whonix_firewall#L28</a></p>
<p>VPN-Firewall can function with WORKSTATION_FIREWALL=0! This seems counterintuitive since VPN-Firewall is a feature / subset of the Workstation Firewall? And is behaving as if WORKSTATION_FIREWALL=1 anyway.</p>
<hr>
<p>In both Gateway &amp; Workstation /usr/bin/whonix_firewall:</p>
<p>When defining local network ranges, it‚Äôs written as:</p>
<p>A: ‚Äúxx.xx.xx.0-xx.xx.xx.24‚Äù</p>
<p><aside class="onebox githubblob">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/whonix-firewall/blob/master/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../external.html?link=https://github.com/Whonix/whonix-firewall/blob/master/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">Whonix/whonix-firewall/blob/master/usr/bin/whonix_firewall</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2017 - 2018 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

set -e

if [ -f "/var/run/qubes/this-is-templatevm" ]; then
   /usr/bin/whonix-workstation-firewall
elif [ -f "/usr/share/anon-gw-base-files/gateway" ]; then
   /usr/bin/whonix-gateway-firewall
elif [ -f "/usr/share/anon-ws-base-files/workstation" ]; then
   /usr/bin/whonix-workstation-firewall
else
   echo "ERROR: Neither file /usr/share/anon-gw-base-files/gateway nor file /usr/share/anon-ws-base-files/workstation exists! If this is a Whonix-Gateway, package anon-gw-base-files needs to be installed. If this is a Whonix-Workstation, package anon-ws-base-files needs to be installed." &gt;&amp;2
   exit 1
fi
</code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
<a href="../../../external.html?link=https://github.com/Whonix/whonix-ws-firewall/blob/master/usr/bin/whonix_firewall#L148-L171" class="onebox" target="_blank">https://github.com/Whonix/whonix-ws-firewall/blob/master/usr/bin/whonix_firewall#L148-L171</a></p>
<p>In Whonix 11 these same ranges were defined as:</p>
<p>B: ‚Äúxx.xx.xx.0/24‚Äù</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/whonix-firewall/blob/Whonix11/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../external.html?link=https://github.com/Whonix/whonix-firewall/blob/Whonix11/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">Whonix/whonix-firewall/blob/Whonix11/usr/bin/whonix_firewall</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2012 - 2014 Patrick Schleizer &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

###########################
## debugging
###########################

#set -x

###########################
## error_handler
###########################

set -o pipefail

error_handler() {
  echo "##################################################"
  echo "Whonix firewall script failed!"
</code></pre>

  This file has been truncated. <a href="../../../external.html?link=https://github.com/Whonix/whonix-firewall/blob/Whonix11/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Since A != B, shouldn‚Äôt A be written as:</p>
<p>A: ‚Äúxx.xx.xx.0-xx.xx.xx.255‚Äù ?</p>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-20T06:14:30Z' class='post-time'>
                May 20, 2016,  6:14am
              </time>
              <meta itemprop='dateModified' content='2016-05-20T06:14:30Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="2" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>The config file comments should be cleaned up for next release indeed.<br>
Are you interested to send a git pull request improving that?</p>
</blockquote>
</aside>
<pre><code>#########################################
## VPN-Firewall Settings (WORKSTATION) ##
#########################################

## VPN-Firewall enforces more leak-resistant firewall rules while connected 
## to VPNs. It also acts as a fail-closed mechanism should the VPN lose its
## connection.
##
## ENABLE(1) to require all traffic to be tunneled through your VPN upon 
## exiting the Tor network.
##     user -&gt; tor -&gt; vpn -&gt; destination
## Should the VPN lose its connection, all traffic will be halted.
## A 3rd Party VPN Provider is REQUIRED to enable this option.
##
## DISABLE(0) (Default) to route traffic through the VPN when possible.
## Traffic will continue to flow through Tor even if the VPN connection
## is unavailable.
## 
VPN_FIREWALL=0

## VPN-Firewall OPTIONAL Settings to BYPASS VPN
##   (These settings only take effect when VPN_FIREWALL is ENABLED above)
##   WARNING: These settings can result in network traffic through Tor
##            even when VPN connectivity is disabled! Use Caution!
## 
## Allow connections to LOCAL_NET (see Advanced Options below)
## Many Whonix applications are pre-configured to access the Tor network
## directly and ignore any user configured proxies, including VPN, Socks, etc.
##     user -&gt; tor -&gt; destination
## These include Tor Browser, curl, wget, git and others. They require
## direct access to the Local Network to communicate.
##
## This setting is DISABLED(false) by Default meaning all pre-configured
## applications will cease working while VPN-Firewall is enabled, unless 
## they are manually re-configured.
##
## ENABLE(true) this setting if you wish for these applications to remain
## functional regardless of the state of the VPN connection. WARNING: These
## applications will continue to route traffic over Tor even when the
## VPN is disconnected!
##
TUNNEL_FIREWALL_ALLOW_LOCAL_NET=false

## Allow additional programs to BYPASS the VPN
## DISABLED(false) by Default. Since these programs require direct connections 
## to the Tor network, they will not function at all while VPN-Firewall 
## is enabled.
## ENABLE(true) this setting to allow these programs to access the Tor network
## and continue to do so regardless of the status of the VPN.
##     user -&gt; Tor -&gt; destination
## 
## Sdwdate user:
TUNNEL_FIREWALL_ALLOW_SDWDATE_USER=false
## Whonixcheck:
TUNNEL_FIREWALL_ALLOW_WHONIXCHECK=false
## Tor Browser Downloader
TUNNEL_FIREWALL_ALLOW_TB_UPDATER=false

#####################
## ADVANCED OPTIONS
## Defaults will work for most users. Only change if certain.

## VPN Interfaces
## OpenVPN: use tun0
##
#VPN_INTERFACE=tun0

## Destinations you do not want routed through the VPN.
## Qubes-Whonix Defaults:
##
#    LOCAL_NET="\
#         127.0.0.0-127.0.0.255 \
#         10.137.0.0-10.138.255.255 \
    "

## Non-Qubes-Whonix defaults:
##
#    LOCAL_NET="\
#         127.0.0.0-127.0.0.255 \
#         192.168.0.0-192.168.0.255 \
#         192.168.1.0-192.168.1.255 \
#         10.152.152.0-10.152.152.255 \
#         10.0.2.2-10.0.2.255 \
#   "</code></pre>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-20T14:59:49Z' class='post-time'>
                May 20, 2016,  2:59pm
              </time>
              <meta itemprop='dateModified' content='2016-05-20T14:59:49Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="3" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>If there is no plan to permanently replace usage of VPN_FIREWALL with TUNNEL_FIREWALL_ENABLE, probably makes sense to keep TUNNEL_FIREWALL_ENABLE hidden. Advantages to using VPN_FIREWALL: 1) legacy benefits 2) consistency with gateway-vpn-firewall.</p>
</blockquote>
</aside>
<p>The name VPN_FIREWALL is in Whonix 13 plain wrong. Limiting. It is a TUNNEL_FIREWALL. Works for any kind of tunneling software in similar ways.</p>
<p>VPN_FIREWALL will stay a synonym for TUNNEL_FIREWALL_ENABLE for legacy reasons.</p>
<aside class="quote" data-post="3" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>Also, for consistency, configurable booleans should all be 0/1 or all true/false‚Ä¶</p>
</blockquote>
</aside>
<p>Ideally yes, but difficult to do for legacy reasons. Changing this could lead to unexpected results for users who upgrade.</p>
<aside class="quote" data-post="3" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>VPN-Firewall can function with WORKSTATION_FIREWALL=0! This seems counterintuitive since VPN-Firewall is a feature / subset of the Workstation Firewall? And is behaving as if WORKSTATION_FIREWALL=1 anyway.</p>
</blockquote>
</aside>
<p>Intuitions are different. I was more on the side of users assuming TUNNEL_FIREWALL_ENABLE alone is sufficient. And this way it fails closed.</p>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-20T19:49:47Z' class='post-time'>
                May 20, 2016,  7:49pm
              </time>
              <meta itemprop='dateModified' content='2016-05-20T20:06:06Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="2" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It is very hairy indeed to make openvpn run under a user account.</p>
</blockquote>
</aside>
<p>Thanks. Just now learned what <code>sudo -u</code> actually means. <img src="../../images/emoji/twitter/confusedae52.png?v=5" title=":confused:" class="emoji" alt=":confused:"> All working now.</p>
<aside class="quote" data-post="5" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>The name VPN_FIREWALL is in Whonix 13 plain wrong.</p>
</blockquote>
</aside>
<p>Updated draft.</p>
<aside class="quote" data-post="5" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>TUNNEL_FIREWALL_ENABLE alone is sufficient.</p>
</blockquote>
</aside>
<p>This is confusing, especially since instructions explicitly state to set WORKSTATION_FIREWALL=1. Easy fix:</p>
<pre><code>## Setting TUNNEL_FIREWALL_ENABLE=true automatically enables WORKSTATION_FIREWALL=1 and
## overrides any previous setting.
</code></pre>
<hr>
<p>Anticipating issues that users may have with the instructions:</p>
<p><strong>VPN Credentials</strong><br>
The riseup vpn example illustrates password authentication. Many vpn providers issue client keys with 600 permissions. User ‚Äòtunnel‚Äô can‚Äôt read.<br>
Best option is probably <code>chown tunnel:tunnel client.key</code><br>
or for embedded keys: <code>chown tunnel:tunnel client.ovpn</code></p>
<p><strong>Auto-DNS Configuration</strong><br>
add to /etc/openvpn/openvpn.conf:</p>
<pre><code>script-security 2
up update-dns.sh
down update-dns.sh
</code></pre>
<p>in konsole:</p>
<pre><code>sudo touch /etc/resolv.conf.qubes
sudo chown tunnel:tunnel /etc/resolv.conf.anondist
sudo chown tunnel:tunnel /etc/resolv.conf.qubes
</code></pre>
<p>Slightly edited version of script circulated on qubes-users (credit: Olivier M√©doc), which is itself based on update-resolv-conf.<br>
add to /etc/openvpn/update-dns.sh:</p>
<pre><code>#!/bin/bash

## Modified version of vpn-setup.sh released on qubes-users mailing list. 
## Credit: Olivier M√©doc
## Modified to work with Whonix 13 VPN Firewall

## For use with VPNs running under Unprivileged User : tunnel
## Initial setup requires:
##   sudo touch /etc/resolv.conf.qubes
##   sudo chown tunnel:tunnel /etc/resolv.conf
##   sudo chown tunnel:tunnel /etc/resolv.conf.qubes

## To call from openvpn configuration file
##   script-security 2
##   up update-dns.sh
##   down update-dns.sh

## Script will stop working if file permissions are reset/changed
## Repeat setup procedure.

case $script_type in

up)
        # Parses DHCP options from openvpn to update resolv.conf
        # To use set as 'up' and 'down' script in your openvpn *.conf:
        # up /etc/openvpn/update-resolv-conf
        # down /etc/openvpn/update-resolv-conf
        #
        # Used snippets of resolvconf script by Thomas Hood &lt;jdthood@yahoo.co.uk&gt;
        # and Chris Hanson
        # Licensed under the GNU GPL.  See /usr/share/common-licenses/GPL.
        # 07/2013 colin@daedrum.net Fixed intet name
        # 05/2006 chlauber@bnc.ch
        #
        # Example envs set from openvpn:
        # foreign_option_1='dhcp-option DNS 193.43.27.132'
        # foreign_option_2='dhcp-option DNS 193.43.27.133'
        # foreign_option_3='dhcp-option DOMAIN be.bnc.ch'
        # foreign_option_4='dhcp-option DOMAIN-SEARCH bnc.local'

        # Retrieve DNS related foreign DHCP variable
        for optionname in ${!foreign_option_*} ; do
                option="${!optionname}"
                echo "Parsing DHCP option: $option"
                part1=$(echo "$option" | cut -d " " -f 1)
                if [ "$part1" == "dhcp-option" ] ; then
                        part2=$(echo "$option" | cut -d " " -f 2)
                        part3=$(echo "$option" | cut -d " " -f 3)
                        if [ "$part2" == "DNS" ] ; then
                                IF_DNS_NAMESERVERS="$IF_DNS_NAMESERVERS $part3"
                        elif [[ "$part2" == "DOMAIN" || "$part2" == "DOMAIN-SEARCH" ]] ; then
                                IF_DNS_SEARCH="$IF_DNS_SEARCH $part3"
                        fi
                fi
        done

        # Create new resolv.conf content
        if [[ -n "$IF_DNS_SEARCH" || -n "$IF_DNS_NAMESERVERS" ]] ; then
                # Backup resolv.conf
                cp /etc/resolv.conf /etc/resolv.conf.qubes

                # Clear resolv.conf
                echo -n "" &gt; /etc/resolv.conf

                if [ "$IF_DNS_SEARCH" ]; then
                        R="search "
                        for DS in $IF_DNS_SEARCH ; do
                                R="${R} $DS"
                        done
                        echo "$R" &gt;&gt; /etc/resolv.conf
                fi

                for NS in $IF_DNS_NAMESERVERS ; do
                        R="nameserver $NS"
                        echo "$R" &gt;&gt; /etc/resolv.conf
                done

                # Reinit Qubes DNS nat rules
                # Has no effect in Whonix 13. Safe to leave
                /etc/dhclient.d/qubes-setup-dnat-to-ns.sh

        fi
        ;;
down)

        if [ -f /etc/resolv.conf.qubes ] ; then
                # Restore resolv.conf
                cp /etc/resolv.conf.qubes /etc/resolv.conf

                # Reinit Qubes DNS nat rules
                # Has no effect in Whonix 13. Safe to leave
                /etc/dhclient.d/qubes-setup-dnat-to-ns.sh
        fi
        ;;
esac
</code></pre>
<p>EDIT: file permssions will be overwritten by updates <img src="../../images/emoji/twitter/frowningae52.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"></p>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-22T18:13:33Z' class='post-time'>
                May 22, 2016,  6:13pm
              </time>
              <meta itemprop='dateModified' content='2016-05-22T18:13:33Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="6" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>Updated draft.</p>
</blockquote>
</aside>
<p>Still using <code>VPN_FIREWALL</code> two times.</p>
<aside class="quote" data-post="6" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>VPN CredentialsThe riseup vpn example illustrates password authentication. Many vpn providers issue client keys with 600 permissions. User ‚Äòtunnel‚Äô can‚Äôt read. Best option is probably chown tunnel:tunnel client.keyor for embedded keys: chown tunnel:tunnel client.ovpn</p>
</blockquote>
</aside>
<p>But the guide is using this already, no?<br>
<code>sudo chown -R tunnel:tunnel /etc/openvpn</code><br>
( <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Configuration_Folder_Permissions">https://www.whonix.org/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Configuration_Folder_Permissions</a> )</p>
<aside class="quote" data-post="6" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>Auto-DNS Configuration</p>
</blockquote>
</aside>
<p>The point, advantage of this would be that the user no longer needs to do manual DNS configuration?</p>
<p>That would be nice. In that case we should add that script to the usability-misc package. (And with a different name to the vpn-firewall package [so these can still be co-installed].)</p>
<aside class="quote" data-post="6" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>/etc/resolv.conf.qubes</p>
</blockquote>
</aside>
<p>The file name should not be needlessly Qubes specific.</p>
<aside class="quote" data-post="6" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>Initial setup requires:</p>
</blockquote>
</aside>
<p>Maybe not. The whole  <code>/etc/openvpn/update-dns.sh</code> could get a sudoers exception. Then call the script as root so it can do all of that for the user.</p>
<blockquote>
<p>down update-dns.sh</p>
</blockquote>
<p>So it will be set back to original DNS settings when the VPN is shut down. Not necessarily bad. Can you please test if with original DNS settings (pointing to Whonix-Gateway)</p>
<aside class="quote" data-post="6" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>/etc/dhclient.d/qubes-setup-dnat-to-ns.sh</p>
</blockquote>
</aside>
<p>Please check if that file is executable beforehand.</p>
<aside class="quote" data-post="6" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>EDIT: file permssions will be overwritten by updates <img src="../../images/emoji/twitter/frowningae52.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"></p>
</blockquote>
</aside>
<p>Which updates?</p>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2465.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2016-05-22T18:19:49Z' class='post-time'>
                May 22, 2016,  6:19pm
              </time>
              <meta itemprop='dateModified' content='2016-05-22T18:19:49Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="7" data-topic="2465">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Still using VPN_FIREWALL two times.</p>
</blockquote>
</aside>
<p>Haven‚Äôt uploaded new draft yet! Ok, now I see why git is useful - couple pulls and my head is spinning. I‚Äôll move all my forum spam over there.</p>
<p>All your points noted!</p>
        </div>

        <meta itemprop='headline' content='Whonix-13-Workstation VPN-Firewall'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
