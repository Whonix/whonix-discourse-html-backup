<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
    <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016</link>
    <description>Hello, I ran into the problem of updating my Qube AppVm via Tor. My task is to hide the use of Qubes.

I have configured updates of all TemplateVM and dom0 through Tor.
My actions:
1) Qube Manager → System → Global Settings → Dom0 UpdateVM: sys-whonix → OK
2) Replaced the standard repositories with the onion service for all TemplateVM. All lines from (deb) yum.qubes-os.org are commented out. Uncommented all the lines yum.qubesosfasa4zl44o4tws22di6kepyzfeqv3tg4e3ztknltfxqrymdad.onion
I was also convinced that in /etc/qubes-rpc/policy/qubes.UpdatesProxy the first construct is without comment. ($ type: TemplateVM $ default permission, target = sys-whonix)

The problem is that when I try to update the AppVm or Standalone template, since Appvm is connected via clearnet, and the DNS server cannot recognize the Dns request, I get an error. It also creates a DNS leak when trying to update or install a program; DNS call for (deb) yum.qubesosfasa4zl44o4tws22di6kepyzfeqv3tg4e3ztknltfxqrymdad. Analyzed through Wireshark. And therefore, the update itself can no longer work, since the home AppVm is not connected to Sys-whonix.

Yes, TemplateVm is updated normally, there are no errors or leaks in DNS, as I understand it, this is because TemplateVm does not have a network, and updates go through Tor using qubes-rpc-policy.

I will be happy with any help, as well as instructions on how to get the regular AppVM for updating and installing applications through Tor. And also, to avoid DNS leaks, so that only the update and installation traffic completely passes through Tor.

There is a question on a similar topic.
1) Does Qube update request verification pass through Tor? If not, how can I check for updates via Tor. My problem here is mainly that when I uncheck (check for updates) in the settings of global qubes and install (disable checking for updates of all qubes) after a certain time, I still get a notification about the update of a specific qube.</description>
    <language>en</language>
    <lastBuildDate>Fri, 28 Feb 2020 12:18:22 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>kelman via Whonix Forum:</p>
<blockquote>
<p>I am not trying to hide the use of Tor, but only the use of Qubes.</p>
</blockquote>
<p>Good luck. I guess unless you don’t contribute to Qubes towards that<br>
goal, it won’t e happening. While my above reference isn’t on topic<br>
indeed it shows how difficult similar endeavors are.</p>
<p>Other issues for hiding Qubes from the top of my head:</p>
<ul>
<li>Fedora phone home issue already mentioned</li>
<li>Qubes time sync (which likely differs from NTP on plain (non-Qubes)<br>
Debian host operating systems perhaps at least wrt when how/often it is<br>
being run)</li>
<li>Qubes update check as you already mentioned - even if torified, the<br>
timing mint hint at Qubes.</li>
<li>Not sure what else. Best to ask on Qubes mailing list and/or traffic<br>
analysis.</li>
</ul>
          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/8</link>
        <pubDate>Fri, 28 Feb 2020 12:18:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-8</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>kelman via Whonix Forum:</p>
<blockquote>
<p>The problem is that when I try to update the AppVm or Standalone template, since Appvm is connected via clearnet, and the DNS server cannot recognize the Dns request, I get an error. It also creates a DNS leak when trying to update or install a program; DNS call for (deb) yum.qubesosfasa4zl44o4tws22di6kepyzfeqv3tg4e3ztknltfxqrymdad. Analyzed through Wireshark. And therefore, the update itself can no longer work, since the home AppVm is not connected to Sys-whonix.</p>
</blockquote>
<p>Not using sys-whonix… Doesn’t sound alike an issue caused by Whonix<br>
then. This isn’t a general Qubes support forum. See:</p>
<aside class="quote quote-modified" data-post="1" data-topic="2275">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="https://forums.whonix.org/t/what-to-post-in-this-qubes-whonix-forum-and-what-not/2275">What to post in this Qubes-Whonix forum and what not.</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/qubes-whonix"><span class="badge-category-bg" style="background-color: #63a0ff;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Everything specific to Qubes-Whonix. (devs)">Qubes-Whonix</span></a>
  </div>
  <blockquote>
    As a rule of thumb: 

Everything that happens “inside” the virtual machines is Qubes-Whonix and belongs into this sub forum.
Everything that happens “outside” the virtual machine is Qubes and the <a href="https://www.qubes-os.org/help/" rel="nofollow noopener">Qubes help</a> should be consulted.


Some examples: 

EFI -&gt; <a href="https://www.qubes-os.org/support/" rel="nofollow noopener">Qubes support</a>

Errors by by Qubes VM Manager (QVMM) -&gt; <a href="https://www.qubes-os.org/support/" rel="nofollow noopener">Qubes support</a>

libvirtError -&gt; <a href="https://www.qubes-os.org/support/" rel="nofollow noopener">Qubes support</a>

Issues that also apply to Debian based VMs. -&gt; <a href="https://www.qubes-os.org/support/" rel="nofollow noopener">Qubes support</a>


error: Failed to save domain whonix-ws-dvm to /var/lib/qubes/appvms/whonix-ws-dvm/…
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/7</link>
        <pubDate>Fri, 28 Feb 2020 12:02:33 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-7</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[kelman]]></dc:creator>
        <description><![CDATA[
            <p>This ticket does not apply to my problem. I know Fedora is trying to call home.<br>
I need to receive updates and installation of applications in AppVM and TemplateVM through Tor.<br>
In TemplateVM, this is easy by setting UpdateVM to Sys-whonix. But AppVM will not be updated via Tor. I will be glad of any help.</p>
          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/6</link>
        <pubDate>Thu, 27 Feb 2020 20:14:36 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-6</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[kelman]]></dc:creator>
        <description><![CDATA[
            <p>I am not trying to hide the use of Tor, but only the use of Qubes.</p>
          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/5</link>
        <pubDate>Thu, 27 Feb 2020 20:08:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-5</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[Patrick_mobile]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/QubesOS/qubes-issues/issues/1814" target="_blank">github.com/QubesOS/qubes-issues</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/QubesOS/qubes-issues/issues/1814" target="_blank">sys-net phones home to fedoraproject.org for captive portal detection</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2016-03-06" data-time="12:44:44" data-timezone="UTC">12:44PM - 06 Mar 16 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2019-04-01" data-time="04:10:03" data-timezone="UTC">04:10AM - 01 Apr 19 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/hdevalence" target="_blank">
          <img alt="hdevalence" src="https://avatars2.githubusercontent.com/u/44879?v=4" class="onebox-avatar-inline" width="20" height="20">
          hdevalence
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">When connecting to some WiFi networks, e.g., open networks, sys-net phones home to fedoraproject.org:
sys-net NetworkManager[551]: &lt;info&gt; connectivity: check for uri 'http://fedoraproject.org/static/hotspot.txt'...</p>
</div>

<div class="labels">
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">C: Fedora</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">C: templates</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">P: minor</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">R: not our bug</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">T: bug</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>says closed but when you read the ticket it’s not actually fixed.</p>
          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/4</link>
        <pubDate>Thu, 27 Feb 2020 19:36:15 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-4</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[Patrick_mobile]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Hide_Tor_from_your_Internet_Service_Provider" target="_blank" title="12:38AM - 01 November 2019">whonix.org – 1 Nov 19</a>
  </header>
  <article class="onebox-body">
    <img src="https://www.whonix.org/w/images/c/c4/Cat-1040815640.jpg" class="thumbnail" width="" height="">

<h3><a href="https://www.whonix.org/wiki/Hide_Tor_from_your_Internet_Service_Provider" target="_blank">Hide Tor use from the Internet Service Provider - Whonix</a></h3>

<p>Prevent the Internet Service Provider from discovering you are a Tor user.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/3</link>
        <pubDate>Thu, 27 Feb 2020 19:30:54 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-3</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[kelman]]></dc:creator>
        <description><![CDATA[
            <p>Maybe I need to configure updates through a proxy.<br>
Acquire :: http :: Proxy “<a href="http://127.0.0.1:8082/" rel="nofollow noopener">http://127.0.0.1:8082/</a>”;<br>
Acquire :: tor :: proxy “<a href="http://127.0.0.1:8082/" rel="nofollow noopener">http://127.0.0.1:8082/</a>”;</p>
<p>But I did not find good documentation.</p>
          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/2</link>
        <pubDate>Thu, 27 Feb 2020 17:35:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-2</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
      <item>
        <title>Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</title>
        <dc:creator><![CDATA[kelman]]></dc:creator>
        <description><![CDATA[
            <p>Hello, I ran into the problem of updating my Qube AppVm via Tor. My task is to hide the use of Qubes.</p>
<p>I have configured updates of all TemplateVM and dom0 through Tor.<br>
My actions:</p>
<ol>
<li>Qube Manager → System → Global Settings → Dom0 UpdateVM: sys-whonix → OK</li>
<li>Replaced the standard repositories with the onion service for all TemplateVM. All lines from (deb) <a href="http://yum.qubes-os.org" rel="nofollow noopener">yum.qubes-os.org</a> are commented out. Uncommented all the lines yum.qubesosfasa4zl44o4tws22di6kepyzfeqv3tg4e3ztknltfxqrymdad.onion<br>
I was also convinced that in /etc/qubes-rpc/policy/qubes.UpdatesProxy the first construct is without comment. ($ type: TemplateVM $ default permission, target = sys-whonix)</li>
</ol>
<p>The problem is that when I try to update the AppVm or Standalone template, since Appvm is connected via clearnet, and the DNS server cannot recognize the Dns request, I get an error. It also creates a DNS leak when trying to update or install a program; DNS call for (deb) yum.qubesosfasa4zl44o4tws22di6kepyzfeqv3tg4e3ztknltfxqrymdad. Analyzed through Wireshark. And therefore, the update itself can no longer work, since the home AppVm is not connected to Sys-whonix.</p>
<p>Yes, TemplateVm is updated normally, there are no errors or leaks in DNS, as I understand it, this is because TemplateVm does not have a network, and updates go through Tor using qubes-rpc-policy.</p>
<p>I will be happy with any help, as well as instructions on how to get the regular AppVM for updating and installing applications through Tor. And also, to avoid DNS leaks, so that only the update and installation traffic completely passes through Tor.</p>
<p>There is a question on a similar topic.</p>
<ol>
<li>Does Qube update request verification pass through Tor? If not, how can I check for updates via Tor. My problem here is mainly that when I uncheck (check for updates) in the settings of global qubes and install (disable checking for updates of all qubes) after a certain time, I still get a notification about the update of a specific qube.</li>
</ol>
          <p><a href="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016/1</link>
        <pubDate>Thu, 27 Feb 2020 17:07:41 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9016-1</guid>
        <source url="http://forums.whonix.org/t/update-templatevm-dom0-over-tor-torify-all-of-qubes-traffic/9016.rss">Update (TemplateVM, dom0) over Tor / torify all of Qubes traffic</source>
      </item>
  </channel>
</rss>
