<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</title>
    <link>http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650</link>
    <description>root issue:

https://github.com/QubesOS/qubes-issues/issues/3118

impact:

Users who clone whonix-gw or whonix-ws, will quite likely either not know they have to edit `/etc/qubes-rpc/policy/qubes.UpdateProxy` or forget about it.

workaround:

I am not sure what @marmarek will decide wrt https://github.com/QubesOS/qubes-issues/issues/3118 and when the solution flows into Qubes.

Meanwhile I would like to add a workaround. Please check the implementation.

https://github.com/Whonix/qubes-whonix/blob/0fd147dcf5db91d678a7e4ac5fa0b1b4eb1a9424/etc/uwt.d/40_qubes.conf</description>
    <language>en</language>
    <lastBuildDate>Sat, 23 Dec 2017 13:36:43 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <ul>
<li><a href="https://github.com/marmarek/qubes-mgmt-salt-dom0-virtual-machines/commit/ca27a33b0ec59f5ea2d4b334973eaa837f11ffc4">https://github.com/marmarek/qubes-mgmt-salt-dom0-virtual-machines/commit/ca27a33b0ec59f5ea2d4b334973eaa837f11ffc4</a></li>
<li><a href="https://github.com/QubesOS/qubes-issues/issues/3118#issuecomment-353726217">https://github.com/QubesOS/qubes-issues/issues/3118#issuecomment-353726217</a></li>
</ul>
          <p><a href="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/5</link>
        <pubDate>Sat, 23 Dec 2017 13:36:43 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4650-5</guid>
        <source url="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650.rss">preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</source>
      </item>
      <item>
        <title>preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="3" data-topic="4650" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>A safer workaround would be a Qubes-Whonix TemplateVM firewall that block access to Qubes updates proxy.</p>
<p>(<a href="https://github.com/Whonix/qubes-whonix/blob/master/usr/lib/qubes-whonix/init/torified-updates-proxy-check">https://github.com/Whonix/qubes-whonix/blob/master/usr/lib/qubes-whonix/init/torified-updates-proxy-check</a> would have to run under a special user that may circumvent the firewall.)</p>
</blockquote>
</aside>
<p>All of this is done. Qubes TemplateVMs <code>whonix-gw</code> and <code>whonix-ws</code> will now use Whonix-Workstation firewall. (whonix-gw template will use it as well since the whonix-gw template is “actually more like a workstation”)</p>
<p><code>whonix-gw-firewall</code> / <code>whonix-ws-firewall</code> package got merged into a single package <code>whonix-friewall</code>. Tons of commits.</p>
<ul>
<li><a href="https://github.com/Whonix/whonix-ws-firewall/commits/master">https://github.com/Whonix/whonix-ws-firewall/commits/master</a></li>
<li><a href="https://github.com/Whonix/whonix-gw-firewall/commits/master">https://github.com/Whonix/whonix-gw-firewall/commits/master</a></li>
<li><a href="https://github.com/Whonix/whonix-firewall/commits/master">https://github.com/Whonix/whonix-firewall/commits/master</a></li>
<li><a href="https://github.com/Whonix/qubes-whonix/commits/master">https://github.com/Whonix/qubes-whonix/commits/master</a></li>
<li><a href="https://github.com/Whonix/anon-shared-helper-scripts/commits/master">https://github.com/Whonix/anon-shared-helper-scripts/commits/master</a></li>
</ul>
<p>So now even if <a href="https://github.com/QubesOS/qubes-issues/issues/3118">https://github.com/QubesOS/qubes-issues/issues/3118</a> does not get implemented or not so soon, it got much harder to update over clearnet. It is still possible to update over clearnet with manual reconfiguration, and good that this flexibility and freedom exists.</p>
          <p><a href="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/4</link>
        <pubDate>Fri, 22 Dec 2017 02:35:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4650-4</guid>
        <source url="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650.rss">preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</source>
      </item>
      <item>
        <title>preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>A safer workaround would be a Qubes-Whonix TemplateVM firewall that block access to Qubes updates proxy.</p>
<p>(<a href="https://github.com/Whonix/qubes-whonix/blob/master/usr/lib/qubes-whonix/init/torified-updates-proxy-check">https://github.com/Whonix/qubes-whonix/blob/master/usr/lib/qubes-whonix/init/torified-updates-proxy-check</a> would have to run under a special user that may circumvent the firewall.)</p>
          <p><a href="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/3</link>
        <pubDate>Thu, 21 Dec 2017 17:14:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4650-3</guid>
        <source url="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650.rss">preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</source>
      </item>
      <item>
        <title>preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Latest <code>/etc/uwt.d/40_qubes.conf</code> (just small changes, refactoring, output).</p>
<p><a href="https://github.com/Whonix/qubes-whonix/blob/master/etc/uwt.d/40_qubes.conf">https://github.com/Whonix/qubes-whonix/blob/master/etc/uwt.d/40_qubes.conf</a></p>
          <p><a href="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/2</link>
        <pubDate>Thu, 21 Dec 2017 16:23:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4650-2</guid>
        <source url="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650.rss">preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</source>
      </item>
      <item>
        <title>preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>root issue:</p>
<p><a href="https://github.com/QubesOS/qubes-issues/issues/3118" class="onebox" target="_blank" rel="nofollow noopener">https://github.com/QubesOS/qubes-issues/issues/3118</a></p>
<p>impact:</p>
<p>Users who clone whonix-gw or whonix-ws, will quite likely either not know they have to edit <code>/etc/qubes-rpc/policy/qubes.UpdateProxy</code> or forget about it.</p>
<p>workaround:</p>
<p>I am not sure what <a class="mention" href="http://forums.whonix.org/u/marmarek">@marmarek</a> will decide wrt <a href="https://github.com/QubesOS/qubes-issues/issues/3118" rel="nofollow noopener">https://github.com/QubesOS/qubes-issues/issues/3118</a> and when the solution flows into Qubes.</p>
<p>Meanwhile I would like to add a workaround. Please check the implementation.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/qubes-whonix/blob/0fd147dcf5db91d678a7e4ac5fa0b1b4eb1a9424/etc/uwt.d/40_qubes.conf" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/qubes-whonix/blob/0fd147dcf5db91d678a7e4ac5fa0b1b4eb1a9424/etc/uwt.d/40_qubes.conf" target="_blank" rel="nofollow noopener">Whonix/qubes-whonix/blob/0fd147dcf5db91d678a7e4ac5fa0b1b4eb1a9424/etc/uwt.d/40_qubes.conf</a></h4>
<pre><code class="lang-conf">#!/bin/bash

## Copyright (C) 2012 - 2017 Patrick Schleizer &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

if [ "$torified_check" = "skip" ]; then
   ## Allow testing this script from command line.
   ## 'return 0 2&gt;/dev/null || true' to exit from `source`ing this script.
   return 0 2&gt;/dev/null || true
   ## 'exit 0' to exit when run from command line.
   exit 0
fi

if [ "$uwtwrapper_parent" == "/usr/bin/apt-get" ] || [ "$uwtwrapper_parent" == "/usr/bin/aptitude-curses" ]; then
   torified_check=true
fi

if [ ! "$torified_check" = "true" ]; then
   return 0 2&gt;/dev/null || true
   exit 0
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/qubes-whonix/blob/0fd147dcf5db91d678a7e4ac5fa0b1b4eb1a9424/etc/uwt.d/40_qubes.conf" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650/1</link>
        <pubDate>Thu, 21 Dec 2017 16:09:14 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4650-1</guid>
        <source url="http://forums.whonix.org/t/preventing-qubes-whonix-updates-through-clearnet-on-qubes-r4-ensuring-torified-updates/4650.rss">preventing Qubes-Whonix updates through clearnet on Qubes R4 / ensuring torified updates</source>
      </item>
  </channel>
</rss>
