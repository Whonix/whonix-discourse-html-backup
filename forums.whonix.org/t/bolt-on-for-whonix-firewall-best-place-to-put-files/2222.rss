<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Bolt on for whonix_firewall - best place to put files?</title>
    <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222</link>
    <description>I am working on a bolt on to whonix_firewall.

I am trying be consistent, and follow the whonix convention in /etc/whonix_firewall.d.

There are number of files possible, just like in /etc/whonix_firewall.d.

What would be whonix&#39;s preference / convention be:

(1) Create /etc/whonix_firewall-post.d (or ... suggestion?) and put files in there.

(2) Create files in /etc/whonix_firewall.d, but append &#39;-post&quot; (or ... suggestion?) to the files, with an eye towards eventually modifying whonix_firewall to skip such files in its own processing?</description>
    <language>en</language>
    <lastBuildDate>Tue, 29 Mar 2016 14:36:58 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="25" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>Time to move this/these to new thread(s)?</p>
</blockquote>
</aside>
<p>Was just hinting that a related ticket/discussion has been created.</p>
<aside class="quote" data-post="25" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>I can’t tell from phabricator if phabricator link is a discussion or a go.</p>
</blockquote>
</aside>
<p>A discussion because the title ends with a question mark. But even if there wasn’t a question mark, if someone has a better idea…</p>
<aside class="quote" data-post="25" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>And it’s unclear whether this would negate the need for an iptables-dump diff’er.</p>
</blockquote>
</aside>
<p>Not at all, because it’s an orthogonal issue.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/26">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/26</link>
        <pubDate>Tue, 29 Mar 2016 14:36:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-26</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="24" data-topic="2222" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>port to netfilter-persistent?:<a href="https://phabricator.whonix.org/T487" rel="nofollow noopener">https://phabricator.whonix.org/T487</a></p>
</blockquote>
</aside>
<p>Time to move this/these to new thread(s)?</p>
<p>e.g. I can’t tell from phabricator if phabricator link is a discussion or a go. And it’s unclear whether this would negate the need for an iptables-dump diff’er.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/25">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/25</link>
        <pubDate>Tue, 29 Mar 2016 01:21:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-25</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><code>port to netfilter-persistent?</code>:<br>
<a href="https://phabricator.whonix.org/T487" class="onebox" target="_blank">https://phabricator.whonix.org/T487</a></p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/24">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/24</link>
        <pubDate>Mon, 28 Mar 2016 13:36:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-24</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Just create a new forum thread for that. And link that from here.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/23">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/23</link>
        <pubDate>Tue, 15 Mar 2016 21:14:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-23</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="20" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Anyhow. It’s a separate discussion that deserves a separate topic. For refactoring whonix firewall script (move to functions or similar), Dev/Firewall Refactoring really is enough.</p>
</blockquote>
</aside>
<aside class="quote" data-post="21" data-topic="2222" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Not sure I am following. Wiki page showing use of what? Anyhow. I guess you can have any new wiki page if it helps. Tell me the link and I’ll create it.</p>
</blockquote>
</aside>
<p>Herein / this (forum) thread, has been a discussion. You note, “It’s a separate discussion”, and “Dev/Firewall Refactoring really is enough”. (And I don’t disagree.)</p>
<p>Thus my “I still don’t fathom a wiki page (sans talk pages) serving such a purpose.” If you have a wiki page link where such a discussion takes place, I expect it will help me understand how you mean the wiki page is enough.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/22">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/22</link>
        <pubDate>Tue, 15 Mar 2016 21:06:39 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-22</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Not sure I am following. Wiki page showing use of what? Anyhow. I guess you can have any new wiki page if it helps. Tell me the link and I’ll create it.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/21">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/21</link>
        <pubDate>Tue, 15 Mar 2016 20:55:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-21</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="19" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Anyhow. It’s a separate discussion that deserves a separate topic. For refactoring whonix firewall script (move to functions or similar), Dev/Firewall Refactoring really is enough.</p>
</blockquote>
</aside>
<p>OK. Thank you.</p>
<p>Except … I still don’t fathom a wiki page (sans talk pages) serving such a purpose. Is there a wiki page around that shows such use?</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/20">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/20</link>
        <pubDate>Tue, 15 Mar 2016 19:47:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-20</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>It could be part of the build process by policy. I.e. running a test suite, which we don’t have. But not part of the image build script, because it runs in chroot and we don’t want to modify the build system iptables rules.</p>
<p>Anyhow. It’s a separate discussion that deserves a separate topic. For refactoring whonix firewall script (move to functions or similar), Dev/Firewall Refactoring really is enough.</p>
<p>Also whonixcheck (which is somewhat a replacement for the lack of test suite) could indeed be useful to check if the loaded iptables rules match a hardcoded iptables dump. Yes, with additional firewalll add-ons that would be hard. Then these firewall add-ons could ship a dump that also gets verified. (iptables-dumps.d folder checked by whonixcheck or so.) But then multiple firewall add-ons gets hard. Mutliple firewall add-ons and dumping, that kind of flexibility might be stretching what the Whonix project may be able to implement. That is more like an iptables super flexibility project. Lots of work to do. Also deserves additional thread.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/19">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/19</link>
        <pubDate>Tue, 15 Mar 2016 15:35:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-19</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="17" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It’s a lot simpler process than you might think.</p>
</blockquote>
</aside>
<p>I take your point, but I’m not so sure.</p>
<p>[At the least, presumably one would want to call such as part of the build process. iptables rule changes possibly inadvertently killing connectivity isn’t something you want to leave to ‘hope the developer ran this check’. Oops, they forgot.]</p>
<p>Many things post-installation can munge on iptables, deliberately such as ufw, pgl, or any other firewall, or inadvertently (and hidden) by accident or nefariousness. Since, for example, I don’t run qubes, I have no way to check qubes impact. One after installation insertion of -j ACCEPT would seriously endanger ones objective in choosing whonix.</p>
<p>In any case, where to plug in any results? The wiki item, then transform / transmit to {destination} when such becomes apparent?</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/18">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/18</link>
        <pubDate>Tue, 15 Mar 2016 15:20:54 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-18</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Dev/Firewall Refactoring does not need to go into whonixcheck. It’s a lot simpler process than you might think.</p>
<ol>
<li>developer stores an iptables rules dump</li>
<li>developer does some refactoring in the firewall script</li>
<li>developer stores another iptables rules dump</li>
<li>diff the dumps</li>
</ol>
<p>Or…</p>
<ol>
<li>developer stores an iptables rules dump of Whonix 12</li>
<li>developer stores another iptables rules dump of Whonix 13</li>
<li>diff the dumps</li>
</ol>
<p>It’s so simple it may even go without saying as an implicit expectation when making changes.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/17">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/17</link>
        <pubDate>Tue, 15 Mar 2016 15:07:20 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-17</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:4, topic:2222, full:true”]<br>
I have been wondering for some time now if the firewall script should be split. A lot sections are being used by multiple packages, whonix-gw-firewall, whonix-ws-firewall and vpn-firewall.[/quote]</p>
<p>I was startled some while back when I realized that, e.g. whonix-gw-firewall and whonix-ws-firewall, did not ‘source’ a common bit of code across both.</p>
<p>From comments here, it seems that such is desirable. How to go about getting from current to there?</p>
<aside class="quote">
<blockquote>
<p>Eventually further in future (corridor-gateway to be created one day)…</p>
<p>error_handler<br>
source config folder<br>
IPv4 DEFAULTS<br>
IPv4 PREPARATIONS<br>
IPv4 DROP INVALID INCOMING PACKAGES<br>
IPv4 FORWARD<br>
IPv6<br>
more minor stuff (iptables_cmd, ip6tables_cmd)</p>
<p>Converted to shell functions. And added to anon-shared-helper-scripts.[/quote]</p>
<p>I believe I can see your point. I believe I can put time in to produce some individual bits. I know I have no clue as to how to design this whole, nor how to structure it. i.e. Don’t know which bit to do, nor where to plug it in. Don’t even know where to begin.</p>
<p>[quote]The risk of changing firewall rules while refactoring is minimal because it can be verified:</p>
<pre><code>  www.whonix.org
</code></pre>
<p>Dev/Firewall Refactoring</p>
<p>How to refactor Whonix’s firewall.</p>
</blockquote>
</aside>
<p>So, the article is really just expressing the desire for a iptables sanity check process.</p>
<p>I expect I can come up with such - I’ve already gone almost blind trying to sanity check scripts, and verify pre- and post- script iptables impact.</p>
<p>However, I’ve no idea where / how to plug the right things to the right places in the whonix git. i.e. Inherently, it feels like such a facility would get incorporated into whonixcheck (much like the extra / unwanted package checks). However, if one chooses to use an ‘addon’, ‘good’ [Warn?Diff:NotDiff] becomes a moving target I don’t see how to incorporate. Never mind where/how to incorporate such into whonixcheck at all, and a default inclination to keep my sticky fingers out of it entirely.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/16">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/16</link>
        <pubDate>Tue, 15 Mar 2016 15:00:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-16</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>Ah. OK, I get you now - initial sourcing picks up function definitions (but not execution thereof) at that time.</p>
<p>However, this feels overly complex. I’m not saying unnecessarily so, I wouldn’t know - the more I look the more I realize how many larger concerns are in play (e.g. qubes vs whonix, poking at the packages you noted, debian + lintian), the more expensive it appears gazing into the contributing room from the doorway. And the less inclined I am to cross that threshold. (No doubt, after several years of contributing, looking back on that comment will feel very newbie and wasn’t really something all that intimidating. Not so much so, today, though.)</p>
<p>Here, in this complexity, not doing as you suggest feels like it brings: prove {this} out {fini}, next then prove {that} out {fini}. vs the complexity, inserting many little bits in many places, and having to prove the whole out every time. i.e. Every time one turns around there’s another new entire ecosystem to grok before one can begin to think about where they’re trying to go. (I’m not saying this isn’t inherent / inevitable, merely daunting.)</p>
<aside class="quote" data-post="14" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>if [ “$(type -t whonix_firewall_input_hook_end)” = “function” ]; then<br>
whonix_firewall_input_hook_end<br>
fi</p>
</blockquote>
</aside>
<p>Hmmm. This doesn’t handle the case of multiple addons. Unless it is the responsibility of each function declarer to chain to the next. Or leads to what essentially become callbacks.</p>
<p>Arrays, instead?</p>
<p>func mypostcallstuff() {<br>
mystuff;<br>
}</p>
<p>hook_end_funcs += mypostcallstuff();</p>
<p>foreach hook_end_funcs call hook_end_funcs(@);</p>
<p>[Pardon the really bad pseudo-code.]</p>
<ul>
<li>problem, something developed later wants to insert itself earlier in the chain, the running of which breaks something developed earlier but now called later. (Perhaps this is an inevitable Catch 22.)</li>
</ul>
<p>Is there a separate forum / wiki / phabircator (?) area where this discussion should be moved to / is already ongoing?</p>
<p>In the mean time, see next messages, trying to keep discussion points / threads here separate.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/15</link>
        <pubDate>Tue, 15 Mar 2016 14:40:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-15</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="13" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>No. Only the last / restricting / kill all other traffic, rule.</p>
</blockquote>
</aside>
<p>In that case I would have a simpler and more readable implementation in mind. Before the reject iptables rule… If function <code>whonix_firewall_input_hook_end</code> exists, execute it. (Open for better function name.)</p>
<pre><code class="lang-auto">if [ "$(type -t whonix_firewall_input_hook_end)" = "function" ]; then
   whonix_firewall_input_hook_end
fi
</code></pre>
<p>That way you could ship a file <code>/etc/whonix_firewall.d/40_something.conf</code>:</p>
<pre><code class="lang-auto">whonix_firewall_input_hook_end() {
   ... your stuff ...
}
</code></pre>
<blockquote>
<p>allow overwriting with a .d folder that gets sourced</p>
</blockquote>
<ul>
<li>“To source a <code>.d</code> folder”: <a href="https://github.com/Whonix/whonix-gw-firewall/blob/d6c1e0bc95257c81d8c2bcd3d0959b37e53211dd/usr/bin/whonix_firewall#L28-L44">https://github.com/Whonix/whonix-gw-firewall/blob/d6c1e0bc95257c81d8c2bcd3d0959b37e53211dd/usr/bin/whonix_firewall#L28-L44</a>
</li>
<li>“overwriting a function”: In the script, first on top function main() etc. gets declared and after doing that, the <code>.d</code> folder gets <code>source</code>ed. That way you can have function main() etc. clearheaded in the <code>.d</code> config folder and overwrite the default script function.</li>
</ul>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/14</link>
        <pubDate>Mon, 14 Mar 2016 20:37:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-14</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="12" data-topic="2222" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>You are suggesting…</p>
<p>set all rules as env vars first[/quote]</p>
<p>No. Only the last / restricting / kill all other traffic, rule.</p>
<p>If something wants to munge iptables, keeping all the good stuff there in place, and not have to insert before specific (moving target rule number / perpetual maintenance issue), one needs to nix the drop rule, append the desired, then reapply the drop rule. So only the last rule.</p>
<aside class="quote">
<blockquote>
<p> allow overwriting with a .d folder that gets sourced</p>
</blockquote>
</aside>
<p>No / not following.</p>
<p>[quote]I guess that would be super difficult to read if we did that for each and every time executing $iptables_cmd.</p>
</blockquote>
</aside>
<p>AGREED. And not something I would want to suggest. Simpler is better. (Mind you, I find whonix_firewall pretty easy to read as it stands now. So not sure about others looking for simpler. But I do take your points of multiple callers, and the value of functions().)</p>
<p>The idea of a bolt on (addon?), optionally chosen / added functionality, is to leave the base strictly alone / completely transparent to those who didn’t take specific steps to enable that functionality. While enabling those who do choose to choose the option, to be able to do so.</p>
<p>Unfortunately, inherent to such a facility is being able to leverage the good stuff that is already there (e.g. env. vars like INT_IF), and hooks for calls to such if present. Which is to say, changes to current scripts. (That null out if the option not chosen.)</p>
<p>Thus, I take your point, and agree, that a separate .d directory is the correct answer, rather that inserting changes into current, to segregate such off, and have the least impact upon base, possible.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/13</link>
        <pubDate>Mon, 14 Mar 2016 19:36:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-13</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>You are suggesting…</p>
<ul>
<li>set all rules as env vars first</li>
<li>allow overwriting with a .d folder that gets sourced</li>
<li>$env_var_1, $env_var_2 (more pretty names) etc. below?</li>
</ul>
<p>I guess that would be super difficult to read if we did that for each and every time executing $iptables_cmd.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/12</link>
        <pubDate>Mon, 14 Mar 2016 19:21:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-12</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:8, topic:2222”]<br>
If this is still too unclear, I can try implementing a pseudo example script called “super-flexible” which shows as far as I can imagine how far hooking can go.[/quote]</p>
<p>No, by including the example you did, I get a glimpse of what you’re saying - and can appreciate it. Refinement / specifics can come if/should such be considered for acceptance.</p>
<aside class="quote">
<blockquote>
<p>The other question with firewall code injection, pre/post hooks is when to dispatch them? When you want to dispatch them depends on what you actually want to implement.</p>
</blockquote>
</aside>
<p>Yep. Thus the next step after the file location would be a whonix_firewall change to call them (at the end).</p>
<aside class="quote">
<blockquote>
<p>For example obviously running the hook after $iptables_cmd -A INPUT -j DROP would not allow you to modify the input chain. (Unless doing trickery that would look awful.) On the other hand, do you want your hook dispatched before or after $iptables_cmd -t nat -A PREROUTING -i “$int_if_item” -p udp --dport 53 -j REDIRECT --to-ports “$DNS_PORT_WORKSTATION”? Again it depends on what you want to implement.</p>
</blockquote>
</aside>
<p>Yep. That’s why I expect to propose whonix_firewall changes to set such rules in env. vars.</p>
<p>e.g.<br>
IPT_FILT_INP_LASTRULE=‘INPUT -j DROP’<br>
$iptables_cmd -A $IPT_FILT_INP_LASTRULE</p>
<p>And scripts can:<br>
$iptables_cmd -D $IPT_FILT_INP_LASTRULE<br>
$iptables_cmd -A {other good stuff}<br>
$iptables_cmd -A $IPT_FILT_INP_LASTRULE</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/11</link>
        <pubDate>Mon, 14 Mar 2016 19:14:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-11</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://www.whonix.org/wiki/Dev/Firewall_Refactoring">https://www.whonix.org/wiki/Dev/Firewall_Refactoring</a> purpose is only a description on how to ease development.</p>
<p>Let’s say the line was</p>
<pre><code>$iptables_cmd -A INPUT -j DROP;
</code></pre>
<p>And I want to change it to.</p>
<pre><code>$iptables_cmd -A INPUT -j DROP
</code></pre>
<p>Or the whole thing gets converted into a shell function. (Just a demonstrative example.)</p>
<p>Then the intent of the firewall script change was not to change actual iptables rules. It was code refactoring only. And to make sure it was only code refactoring and no actual iptables chain change, the above instructions should work. So when adding some new hook code theoretically or when splitting the firewall script into multiple files or whatever it is easy to verify, that only the layout was changed, not the actual iptables chain. It does not go beyond that. No leak testing etc. However, it’s sane to have an iptables dump of Whonix 12 and then compare it with Whonix 13 etc.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/10</link>
        <pubDate>Mon, 14 Mar 2016 19:10:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-10</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="4" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>However, the goal is to make the firewall scripts easier to read. Not more difficult to audit. I am not sure which style (all in one file vs split) makes it simpler at this point.</p>
</blockquote>
</aside>
<p>It feels easy enough, for example, to split out env. var setting within whonix_firewall to something like /etc/whonix_firewall.d/10_setenvvars, but I don’t grok enough of whonix to be confident that doing so is appropriate / consistent / desired. e.g. The multiple scripts you note would need to understand that pinned down filename.</p>
<p>Let alone, each script would have to duplicate that a var exists / is set. Each var dev. change would need reflection in each script dependent upon the file.</p>
<p>I can work on this if desired, but these feel like global whonix environment settings, of which the whonix_firewall particulars are but a subset. Is this even a reasonable mechanism to perpetuate?</p>
<p>(Again, I’m not arguing, nor arguing one way or another. I don’t profess to know.)</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/9</link>
        <pubDate>Mon, 14 Mar 2016 19:05:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-9</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I would source them. Not call as separate scripts. Easier with shared variables.</p>
<aside class="quote" data-post="6" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>In the mean time, what would be preferred - modifying whonix_firewall to ignore files suffixed with ‘-post’?</p>
</blockquote>
</aside>
<p>We should not mix up the config folder /etc/whonix_firewall.d with other possible future folders for dispatching pre or post hooks. That would be non-standard. We being the only ones doing that.</p>
<hr>
<p>The following gives maximum ability to add pre/post hooks everywhere.</p>
<pre><code class="lang-auto">funct1() {
...
}
funct2() {
...
}
funct3() {
...
}
main() {
   funct1
   funct2
   funct3
}

...source some .d folder(s)...

main "$@"
</code></pre>
<p>When sourcing of a <code>.d</code> folder is done early, it allows to overwrite any shell function. Including the main function to change ordering what is run and when.</p>
<p>genmkfile has a mechanism to automatically run funcname_pre and functname_post functions - if they have been declared in a <code>.d</code> folder. So you can have pre and/or post actions for any shell function that is run anyhow. And if that is not enough, you can also re-implement / overwrite the whole default shell function.</p>
<p><a href="https://github.com/Whonix/genmkfile/blob/bbe8e989a29f1620a71e13b2ed6717ceb09d8825/usr/share/genmkfile/make-helper.bsh#L1086">https://github.com/Whonix/genmkfile/blob/bbe8e989a29f1620a71e13b2ed6717ceb09d8825/usr/share/genmkfile/make-helper.bsh#L1086</a></p>
<p>If this is still too unclear, I can try implementing a pseudo example script called “super-flexible” which shows as far as I can imagine how far hooking can go.</p>
<hr>
<p>The other question with firewall code injection, pre/post hooks is when to dispatch them? When you want to dispatch them depends on what you actually want to implement.</p>
<p>For example obviously running the hook after <code>$iptables_cmd -A INPUT -j DROP</code> would not allow you to modify the input chain. (Unless doing trickery that would look awful.) On the other hand, do you want your hook dispatched before or after <code>$iptables_cmd -t nat -A PREROUTING -i "$int_if_item" -p udp --dport 53 -j REDIRECT --to-ports "$DNS_PORT_WORKSTATION"</code>? Again it depends on what you want to implement.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/8</link>
        <pubDate>Mon, 14 Mar 2016 19:05:20 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-8</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:4, topic:2222”]<br>
The risk of changing firewall rules while refactoring is minimal because it can be verified:[/quote]</p>
<p>Not so sure that’s true - at development time, yes. At run time, most anything could get their fingers in there. Isn’t this really suggesting some form of iptables intended / current diff run called by whonixcheck?</p>
<p>[quote]<br>
<a href="http://www.whonix.org" rel="nofollow noopener">www.whonix.org</a></p>
<p>Dev/Firewall Refactoring</p>
<p>How to refactor Whonix’s firewall.[/quote]</p>
<p>I don’t think I’m well following that article / its intent.</p>
<p>It reads more like a iptable verification process than a refactoring. Am I missing something?<br>
(never mind, why not just use iptables-save | cut {something or other}. In either case a post-run munging to minimize diff hits is going to be needed.)</p>
<p>Does ‘Dev/Firewall Refactoring’ need to itself be refactored to individually thread the items (you so excellently) note?</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/7</link>
        <pubDate>Mon, 14 Mar 2016 18:54:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-7</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="4" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>However, the goal is to make the firewall scripts easier to read. Not more difficult to audit. I am not sure which style (all in one file vs split) makes it simpler at this point.</p>
</blockquote>
</aside>
<p>Hmmm.</p>
<p>Let alone, split as separate scripts, or as separate files sourced by separate scripts.</p>
<p>Moreover, what is really being talked about is system configuration values. (And are environment variables really the best way to declare them - since even exporting them would only impact in line calls. Programs needing those values outside of that chain don’t get them.) [Not professing one or the other here, merely noting that I see the conundrum.]</p>
<p>In the mean time, what would be preferred - modifying whonix_firewall to ignore files suffixed with ‘-post’?</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/6</link>
        <pubDate>Mon, 14 Mar 2016 18:36:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-6</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>//cc <a class="mention" href="http://forums.whonix.org/u/marmarek">@marmarek</a></p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/5</link>
        <pubDate>Mon, 14 Mar 2016 18:29:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-5</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I have been wondering for some time now if the firewall script should be split. A lot sections are being used by multiple packages, <a href="https://github.com/Whonix/whonix-gw-firewall">whonix-gw-firewall</a>, <a href="https://github.com/Whonix/whonix-ws-firewall">whonix-ws-firewall</a> and <a href="https://github.com/adrelanos/VPN-Firewall">vpn-firewall</a>. Eventually further in future (<a href="https://github.com/rustybird/corridor">corridor</a>-gateway to be created one day)…</p>
<ul>
<li>error_handler</li>
<li>source config folder</li>
<li>IPv4 DEFAULTS</li>
<li>IPv4 PREPARATIONS</li>
<li>IPv4 DROP INVALID INCOMING PACKAGES</li>
<li>IPv4 FORWARD</li>
<li>IPv6</li>
<li>more minor stuff (iptables_cmd, ip6tables_cmd)</li>
</ul>
<p>Converted to shell functions. And added to <a href="https://github.com/Whonix/anon-shared-helper-scripts">anon-shared-helper-scripts</a>.</p>
<p>The risk of changing firewall rules while refactoring is minimal because it can be verified:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Dev/Firewall_Refactoring" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/362;"><img src="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail"></div>

<h3><a href="https://www.whonix.org/wiki/Dev/Firewall_Refactoring" target="_blank" rel="nofollow noopener">Dev/Firewall Refactoring</a></h3>

<p>How to refactor Whonix's firewall.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>However, the goal is to make the firewall scripts easier to read. Not more difficult to audit. I am not sure which style (all in one file vs split) makes it simpler at this point.</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/4</link>
        <pubDate>Mon, 14 Mar 2016 18:26:35 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-4</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="2" data-topic="2222">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Non-Qubes-Whonix:</p>
<p>We are currently using an /etc/network/if-pre-up.d/ hook.</p>
<p><a href="https://github.com/Whonix/whonix-gw-firewall/blob/master/etc/network/if-pre-up.d/30_whonix_firewall" rel="nofollow noopener">https://github.com/Whonix/whonix-gw-firewall/blob/master/etc/network/if-pre-up.d/30_whonix_firewall</a></p>
<p>So any pre and post scripts could also be added to /etc/network/if-pre-up.d/?</p>
</blockquote>
</aside>
<p>I don’t expect that to be the case, as the files/rules will need the env. vars that whonix_firewall sets up. Thus it seems simplest to have whonix_firewall ultimately source the files, as it does so currently for the contents of whonix_firewall.d. (Thus my question of preference, different .d directory, or differentiating filenames within the current .d directory.)</p>
<p>I can see your point, though. However, I don’t expect there’s interest in splitting out whonix_firewall to call something like whonix_firewall_setenv.</p>
<p>Without such, any bolt on would break at a whonix_firewall change, creating a perpetual maintenance cycle.</p>
<p>[The intent is to impact the current iptables rules to the least extent possible - there is serious protection and thinking behind them to be leveraged.]</p>
<p>Suggestions?</p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/3</link>
        <pubDate>Mon, 14 Mar 2016 18:12:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-3</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
      <item>
        <title>Bolt on for whonix_firewall - best place to put files?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Non-Qubes-Whonix:</p>
<p>We are currently using an <code>/etc/network/if-pre-up.d/</code> hook.</p>
<p><a href="https://github.com/Whonix/whonix-gw-firewall/blob/master/etc/network/if-pre-up.d/30_whonix_firewall">https://github.com/Whonix/whonix-gw-firewall/blob/master/etc/network/if-pre-up.d/30_whonix_firewall</a></p>
<p>So any pre and post scripts could also be added to <code>/etc/network/if-pre-up.d/</code>?</p>
<hr>
<p>Qubes-Whonix:</p>
<p>As of Whonix 12 uses <a href="https://github.com/Whonix/qubes-whonix/blob/master/lib/systemd/system/qubes-whonix-firewall.service">https://github.com/Whonix/qubes-whonix/blob/master/lib/systemd/system/qubes-whonix-firewall.service</a>. Could be extended with usual systemd drop-in (.d) files, ExecStartPre or ExecStartPost.</p>
<hr>
<p>Future firewall loading:</p>
<p>Not that much related, but a bit… For Qubes generally I suggested to use netfilter-persistent. That may be perfectly suitable for distributions which would also allow chaining of iptables rules, pre and post.</p>
<p><a href="https://github.com/QubesOS/qubes-issues/issues/1067#issuecomment-174226511">https://github.com/QubesOS/qubes-issues/issues/1067#issuecomment-174226511</a></p>
<p>Although I recommended against using iptables-persistent as a distribution. That may be more appropriate for sysadmins. But caused an issue for distributions (<a href="https://github.com/QubesOS/qubes-core-agent-linux/pull/2">https://github.com/QubesOS/qubes-core-agent-linux/pull/2</a>).</p>
<p>This would make the setups more uniform and chaining iptables rules with pre and post scripts would be simpler.</p>
<hr>
<p>//cc <a class="mention" href="http://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
          <p><a href="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222/2</link>
        <pubDate>Mon, 14 Mar 2016 17:42:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2222-2</guid>
        <source url="http://forums.whonix.org/t/bolt-on-for-whonix-firewall-best-place-to-put-files/2222.rss">Bolt on for whonix_firewall - best place to put files?</source>
      </item>
  </channel>
</rss>
