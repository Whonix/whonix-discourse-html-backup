<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Fixing Whonix boot issue after securing Qubes root auth</title>
    <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155</link>
    <description>Using the vpn-sudo doc, I&#39;ve been experimenting with securing root access in my Qubes templates. This works OK for Debian, but Whonix templates apparently run some boot scripts as regular user interspersed with a few &#39;sudo&#39; commands. The result is that Whonix VMs don&#39;t start cleanly because the Qubes auth prompt pops up a few times.

Instead of relying entirely on an access control tool like apparmor (which I&#39;m also using in Whonix now) I think it would be best to secure the root user as well. So I&#39;d like to propose that we track down and eliminate the use of &#39;sudo&#39; in the Whonix-specific startup scripts.

Chris</description>
    <language>en</language>
    <lastBuildDate>Fri, 18 Nov 2016 16:22:00 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Please check when Whonix 14 testers-only versions are released if any<br>
sudoers entries are missing so these can find their way into the stable<br>
version of Whonix 14.</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/9</link>
        <pubDate>Fri, 18 Nov 2016 16:22:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-9</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[tasket]]></dc:creator>
        <description><![CDATA[
            <p>I had one remaining prompt in sys-whonix that didn’t show up when starting the template itself. To resolve it, /etc/sudoers.d/zz99 now contains both these lines:</p>
<p>ALL ALL=NOPASSWD: /usr/sbin/virt-what<br>
ALL ALL=NOPASSWD: /usr/sbin/service whonixcheck *</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/8</link>
        <pubDate>Fri, 18 Nov 2016 15:01:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-8</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[tasket]]></dc:creator>
        <description><![CDATA[
            <p>Looking at Marek’s response a second time, I feel like the concern over root is still being short-changed.</p>
<ol>
<li>
<p>No obstacle to root means that malware can persist far more easily after a vulnerability has been patched. This makes Qubes VMs ‘juicy targets’ and negates some of the security bonus that read-only templates provide.</p>
</li>
<li>
<p>Even if the root prompt isn’t perfect from a psychological standpoint, there are more ways to grant access. It may even be best to set the default to ‘deny’ while setting template VMs to ‘allow’.</p>
</li>
<li>
<p>The root prompt shouldn’t come up in normal use anyway. Displaying strong language and having “NO” as the default action when hitting Enter should be a substantial improvement in security.</p>
</li>
</ol>
<p>I’ll bring these points up in a new thread on a Qubes list.</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/7</link>
        <pubDate>Fri, 18 Nov 2016 14:58:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-7</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[entr0py]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="3" data-topic="3155">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/t/6bbea6/40.png" class="avatar"> tasket:</div>
<blockquote>
<p>So the hypervisor-only philosophy of Qubes security is wearing thin. If one is going to use a guest OS with all its features and peculiarities, the least one can do is keep its security scheme intact.</p>
</blockquote>
</aside>
<p>Chris, I made some of these points in this back-and-forth that starts here: <a href="https://forums.whonix.org/t/if-not-going-to-change-the-password/2873/3">If not going to change the password?</a></p>
<p>But I thought Marek’s <a href="https://groups.google.com/d/msg/qubes-users/KW4rWE2SC6g/1GFgD2yCBgAJ">reply on qubes-users</a> was quite convincing:</p>
<pre><code>The point is _if_ someone is able to run arbitrary code as user, he/she
can easily run it also as root, because of tremendous attack surface of
linux kernel and all the services running as root. In the worst case one
needs some patience and simply wait for you to authorize some command to
be ran as root (regardless of authorization method - password, qrexec
confirmation as described on https://www.qubes-os.org/doc/vm-sudo/ or
anything else).  In the simplest case one may alias 'sudo' to for
example 'sudo /tmp/my-evil-script'.

On the other hand, making it harder to execute arbitrary code in the VM
(reducing attack surface) makes sense. Things like SELinux, AppArmor,
seecomp filters etc.
</code></pre>
<p>Certainly, there’s a psychological comfort in clicking off root authorizations. Feels like I’m in control… maybe that peace of mind is worth it even if the security posture is largely unchanged. Guess as long as that comfort doesn’t lead to more risky behavior, no harm done.</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/6</link>
        <pubDate>Fri, 18 Nov 2016 06:26:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-6</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Tasket:</p>
<blockquote>
<p>I’m interested in this because Qubes security is based on the rationale:</p>
<pre><code># Because, really, if somebody could find and exploit a bug in the Xen
# hypervisor -- so far there has been only one (!) publicly disclosed
# exploitable bug in the Xen hypervisor from a VM, found in 2008,
</code></pre>
<p>(From /etc/sudoers.d/qubes)</p>
<p>Many more than one XSA has washed under the bridge since then, and there are no less than <strong>eight</strong> coming out on Tuesday!</p>
<p>ITL also ignores the real possibility of having many VMs where less-skilled attackers are running amok and launching attacks on other targets–even if they are contained.</p>
<p>So the hypervisor-only philosophy of Qubes security is wearing thin. If one is going to use a guest OS with all its features and peculiarities, the least one can do is keep its security scheme intact.</p>
</blockquote>
<p>Please bring this up at Qubes.</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/5</link>
        <pubDate>Fri, 18 Nov 2016 01:11:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-5</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[tasket]]></dc:creator>
        <description><![CDATA[
            <p>BTW, the simplest solution in the near-term is to execute:</p>
<p>cp -a /etc/sudoers.d/power-savings-disable-in-vms /etc/sudoers.d/zz99</p>
<p>…which makes the rule for virt-what command come last.</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/4</link>
        <pubDate>Fri, 18 Nov 2016 00:07:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-4</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[tasket]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for the link.</p>
<p>I’m interested in this because Qubes security is based on the rationale:</p>
<pre><code># Because, really, if somebody could find and exploit a bug in the Xen
# hypervisor -- so far there has been only one (!) publicly disclosed
# exploitable bug in the Xen hypervisor from a VM, found in 2008,
</code></pre>
<p>(From /etc/sudoers.d/qubes)</p>
<p>Many more than one XSA has washed under the bridge since then, and there are no less than <strong>eight</strong> coming out on Tuesday!</p>
<p>ITL also ignores the real possibility of having many VMs where less-skilled attackers are running amok and launching attacks on other targets–even if they are contained.</p>
<p>So the hypervisor-only philosophy of Qubes security is wearing thin. If one is going to use a guest OS with all its features and peculiarities, the least one can do is keep its security scheme intact.</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/3</link>
        <pubDate>Thu, 17 Nov 2016 21:35:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-3</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://www.whonix.org/wiki/Unsupported">Unsupported</a>. See my comment here:</p>
<p><a href="https://github.com/QubesOS/qubes-doc/pull/176#issuecomment-242894132">https://github.com/QubesOS/qubes-doc/pull/176#issuecomment-242894132</a></p>
<p>That ticket may also contain information to actually answer your question and someone else who got this solved (I guess) as well.</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/2</link>
        <pubDate>Thu, 17 Nov 2016 16:28:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-2</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
      <item>
        <title>Fixing Whonix boot issue after securing Qubes root auth</title>
        <dc:creator><![CDATA[tasket]]></dc:creator>
        <description><![CDATA[
            <p>Using the vpn-sudo doc, I’ve been experimenting with securing root access in my Qubes templates. This works OK for Debian, but Whonix templates apparently run some boot scripts as regular user interspersed with a few ‘sudo’ commands. The result is that Whonix VMs don’t start cleanly because the Qubes auth prompt pops up a few times.</p>
<p>Instead of relying entirely on an access control tool like apparmor (which I’m also using in Whonix now) I think it would be best to secure the root user as well. So I’d like to propose that we track down and eliminate the use of ‘sudo’ in the Whonix-specific startup scripts.</p>
<p>Chris</p>
          <p><a href="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155/1</link>
        <pubDate>Thu, 17 Nov 2016 10:53:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3155-1</guid>
        <source url="http://forums.whonix.org/t/fixing-whonix-boot-issue-after-securing-qubes-root-auth/3155.rss">Fixing Whonix boot issue after securing Qubes root auth</source>
      </item>
  </channel>
</rss>
