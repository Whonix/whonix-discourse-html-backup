<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Stackable Wrappers - #7 by madaidan - Development - Whonix Forum</title>
    <meta name="description" content="Ex Debian dev Michael Stapelberg discusses package install hooks and triggers and how they complicate the package manager and potentially slow down the install process. An exciting development he mentions is “hermetic pa&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../7944.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Stackable Wrappers&#39;" href="../7944.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/stackable-wrappers/7944/7" />
<meta name="twitter:url" content="https://forums.whonix.org/t/stackable-wrappers/7944/7" />
<meta property="og:title" content="Stackable Wrappers" />
<meta name="twitter:title" content="Stackable Wrappers" />
<meta property="og:description" content="An implementation of what I said above would be the following.  Create a file called /usr/bin/stackable-wrapper and add:  #!/bin/bash  sw_dir=&quot;/etc/wrapper.d&quot; program_name=&quot;$(basename $0)&quot;  if [ -f &quot;${sw_dir}/${program_name}.conf&quot; ]; then   . &quot;${sw_dir}/${program_name}.conf&quot; else   echo &quot;ERROR: File ${sw_dir}/${program_name}.conf doesn&#39;t exist!&quot;   exit 1 fi  # So we don&#39;t execute ourselves. PATH=&quot;$(echo ${PATH} | sed -e &#39;s/\/usr\/local\/bin\://g&#39;)&quot;  ${wrapper_pre} ${program_name} ${wrapper_post}..." />
<meta name="twitter:description" content="An implementation of what I said above would be the following.  Create a file called /usr/bin/stackable-wrapper and add:  #!/bin/bash  sw_dir=&quot;/etc/wrapper.d&quot; program_name=&quot;$(basename $0)&quot;  if [ -f &quot;${sw_dir}/${program_name}.conf&quot; ]; then   . &quot;${sw_dir}/${program_name}.conf&quot; else   echo &quot;ERROR: File ${sw_dir}/${program_name}.conf doesn&#39;t exist!&quot;   exit 1 fi  # So we don&#39;t execute ourselves. PATH=&quot;$(echo ${PATH} | sed -e &#39;s/\/usr\/local\/bin\://g&#39;)&quot;  ${wrapper_pre} ${program_name} ${wrapper_post}..." />
<meta property="article:published_time" content="2020-02-29T18:12:06+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7944.html">Stackable Wrappers</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../../tag/status_open_issue_todo.html' class='discourse-tag' rel="tag">status_open_issue_todo</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-24T20:08:32Z' class='post-time'>
                August 24, 2019,  8:08pm
              </time>
              <meta itemprop='dateModified' content='2020-02-29T11:13:15Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Ex Debian dev Michael Stapelberg discusses package install hooks and triggers and how they complicate the package manager and potentially slow down the install process. An exciting development he mentions is “hermetic packages” which is discussed briefly under the heading “Implemented in an interpreted language”. This seems to be a framework for defining wrappers in a compiled language instead of bash. Worth reaching out and discussing his views and work which can help with the stacked wrappers proposal.</p>
<p><a href="../../../../external.html?link=https://michael.stapelberg.ch/posts/2019-07-20-hooks-and-triggers/" class="onebox" target="_blank">https://michael.stapelberg.ch/posts/2019-07-20-hooks-and-triggers/</a></p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>
          <meta itemprop='keywords' content='component_security, status_open_issue_todo'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../system-wide-sandboxing-framework-sandbox-app-launcher/9008/23.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../system-wide-sandboxing-framework-sandbox-app-launcher/9008/23.html'>
                      <span itemprop='name'>System-wide sandboxing framework - sandbox-app-launcher</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-25T09:11:47Z' class='post-time'>
                August 25, 2019,  9:11am
              </time>
              <meta itemprop='dateModified' content='2019-08-25T09:11:47Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>He had an excellent talk on the subject of package manager speed. German language. Not sure automated translation will be good enough.</p>
<p><a href="../../../../external.html?link=https://www.youtube.com/watch?v=TdfEF0zRIL4" rel="nofollow noopener">https://www.youtube.com/watch?v=TdfEF0zRIL4</a></p>
<hr>
<p>Contacted.</p>
<p><code>stackable wrapper, .d configuration drop-in folders</code>:<br>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2019-August/001423.html" class="onebox" target="_blank" rel="nofollow noopener">https://www.whonix.org/pipermail/whonix-devel/2019-August/001423.html</a></p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T11:08:30Z' class='post-time'>
                February 29, 2020, 11:08am
              </time>
              <meta itemprop='dateModified' content='2020-02-29T11:08:30Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Could you please provide feedback for this stackable wrappers proposal?</p>
<ul>
<li><a href="../../../../external.html?link=https://github.com/Whonix/proposals/blob/master/634-stackable-wrappers.txt">https://github.com/Whonix/proposals/blob/master/634-stackable-wrappers.txt</a></li>
<li><a href="../../../../external.html?link=https://phabricator.whonix.org/T634">https://phabricator.whonix.org/T634</a></li>
</ul>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T11:12:59Z' class='post-time'>
                February 29, 2020, 11:12am
              </time>
              <meta itemprop='dateModified' content='2020-02-29T11:12:59Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>There wasn’t much feedback on stackable wrappers from Michael Stapelberg.</p>
<ul>
<li>inquiry: <a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2019-August/001423.html">https://www.whonix.org/pipermail/whonix-devel/2019-August/001423.html</a>
</li>
<li>reply: <a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2019-August/001424.html">https://www.whonix.org/pipermail/whonix-devel/2019-August/001424.html</a>
</li>
</ul>
<p>Other stackable wrappers resources:</p>
<ul>
<li><a href="../../../../external.html?link=https://github.com/netblue30/firejail/issues/3257">https://github.com/netblue30/firejail/issues/3257</a></li>
<li><a href="../../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=822693">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=822693</a></li>
<li><a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2020-February/001519.html">https://www.whonix.org/pipermail/whonix-devel/2020-February/001519.html</a></li>
</ul>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T19:48:24Z' class='post-time'>
                February 29, 2020,  7:48pm
              </time>
              <meta itemprop='dateModified' content='2020-02-29T19:48:24Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Some suggestions for the config language you can potentially use. I am not technically apt in this space so excuse any simplistic suggestions.</p>
<blockquote>
<ul>
<li>How the wrappers would be specified in the config language is yet to be invented, which will be done if this implementation path looks favorable.</li>
</ul>
</blockquote>
<ul>
<li>
<p>You would invoke the master wrapper script by specifying “–mwrap” in a program’s cli command. mwrap is short for mega wrapper.</p>
</li>
<li>
<p>Somehow preserve the use of mwrap with software across their updates.</p>
</li>
<li>
<p>mwrap would assume a default “wrapper.d” dir is present in the programs “etc” subfolder. This can be extended however to add other arbitrary dirs for it to look into and to chain wrappers contained therein in lexical order as you suggested.</p>
</li>
<li>
<p>The default wrapper.d  location should be overridable in case it is a portable program or one installed in the home folder like TBB or /opt.</p>
</li>
<li>
<p>The order of custom wrapper folders should be interpreted according to how they are fed to the command.</p>
</li>
<li>
<p>If a duplicate wrapper script is found in two different folders, mwrap should exit with an error telling the user to change the file name before it can be applied.</p>
</li>
<li>
<p>It should be designed to run different instances per each program that uses it to avoid situations of privilege escalation. Think a malicious program in home folder can feed the mwrap instance running under sudo with arbitrary scripts if it is already used by a binary with folders in /etc/</p>
</li>
</ul>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T13:16:30Z' class='post-time'>
                February 29, 2020,  1:16pm
              </time>
              <meta itemprop='dateModified' content='2020-02-29T13:16:30Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="9008">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>How would an application by started by default using the sandbox wrapper without needing to prepend on command line? The good old problem of non-existence of stackable wrappers.</p>
<ul>
<li><a href="../../../../external.html?link=https://phabricator.whonix.org/T634">https://phabricator.whonix.org/T634</a></li>
<li><a href="../../../../external.html?link=https://github.com/Whonix/proposals/blob/master/634-stackable-wrappers.txt">https://github.com/Whonix/proposals/blob/master/634-stackable-wrappers.txt</a></li>
</ul>
</blockquote>
</aside>
<p>Can’t we implement this ourselves without requiring upstream?</p>
<p>Create a wrapper that reads from <code>/etc/wrapper.d/</code> and have <code>wrapper_pre</code> (for commands to be added before the actual program) and <code>wrapper_post</code> (for commands to be added after) variables based on the contents of the files there so you have:</p>
<pre><code>${wrapper_pre}${program_name}${wrapper_post}
</code></pre>
<p>Create symlinks to run the program with our stackable wrapper by default and configure the program via <code>wrapper.d</code>.</p>
<p>So the program has one, configurable wrapper that wraps the program with other wrappers.</p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../system-wide-sandboxing-framework-sandbox-app-launcher/9008/4.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../system-wide-sandboxing-framework-sandbox-app-launcher/9008/4.html'>
                      <span itemprop='name'>System-wide sandboxing framework - sandbox-app-launcher</span>
                    </a>
                    <meta itemprop='position' content='1'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T18:12:06Z' class='post-time'>
                February 29, 2020,  6:12pm
              </time>
              <meta itemprop='dateModified' content='2020-02-29T18:22:09Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>An implementation of what I said above would be the following.</p>
<p>Create a file called <code>/usr/bin/stackable-wrapper</code> and add:</p>
<pre><code class="lang-auto">#!/bin/bash

sw_dir="/etc/wrapper.d"
program_name="$(basename $0)"

if [ -f "${sw_dir}/${program_name}.conf" ]; then
  . "${sw_dir}/${program_name}.conf"
else
  echo "ERROR: File ${sw_dir}/${program_name}.conf doesn't exist!"
  exit 1
fi

# So we don't execute ourselves.
PATH="$(echo ${PATH} | sed -e 's/\/usr\/local\/bin\://g')"

${wrapper_pre} ${program_name} ${wrapper_post}
</code></pre>
<p>Then create the config file e.g. <code>/etc/wrapper.d/gpg.conf</code>:</p>
<pre><code class="lang-auto">wrapper_pre="torsocks firejail"
wrapper_post="--example"
</code></pre>
<p>Then symlink it:</p>
<pre><code class="lang-auto">ln -s /usr/bin/stackable-wrapper /usr/local/bin/gpg
</code></pre>
<p>Should work fine.</p>
<p>We don’t have to use /usr/local/bin/. We can create our own directory for this and modify $PATH to check it first.</p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../system-wide-sandboxing-framework-sandbox-app-launcher/9008/5.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../system-wide-sandboxing-framework-sandbox-app-launcher/9008/5.html'>
                      <span itemprop='name'>System-wide sandboxing framework - sandbox-app-launcher</span>
                    </a>
                    <meta itemprop='position' content='1'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-01T09:34:00Z' class='post-time'>
                March 1, 2020,  9:34am
              </time>
              <meta itemprop='dateModified' content='2020-03-01T09:34:00Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="madaidan" data-post="6" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Can’t we implement this ourselves without requiring upstream?</p>
</blockquote>
</aside>
<p>For sure possible but then more likely not a solid, sustainable, long term maintainable solution. By asking upstream(s) for input we can avoid running into later one hard to fix issues. Also if we’d manage to make others use this too, then they won’t be inventing their own custom wrappers which then would be incompatible with other wrappers / our wrappers.</p>
<aside class="quote no-group" data-username="madaidan" data-post="7" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We don’t have to use /usr/local/bin/. We can create our own directory for this and modify $PATH to check it first.</p>
</blockquote>
</aside>
<p><a href="../../../../external.html?link=https://github.com/Whonix/proposals/blob/master/634-stackable-wrappers.txt">https://github.com/Whonix/proposals/blob/master/634-stackable-wrappers.txt</a> on subject of $PATH currently mentions:</p>
<blockquote>
<ul>
<li>amend PATH environment variable …<br>
** …<br>
** Does not work for services started by init / systemd.</li>
</ul>
</blockquote>
<p>It’s not easy to change environment variables (PATH) globally in all cases. Such cases include login in virtual console, X, run by systemd services (root), run by systemd services (user), run by cron, and whatnot. Though, that may be possible.</p>
<p>Changing PATH may also cause AppArmor issues? Dunno yet. Needs investigation. “Ideally” stackable wrappers won’t break existing MAC confinements.</p>
<p>Related:</p>
<ul>
<li><a href="../../../../external.html?link=https://www.freedesktop.org/software/systemd/man/environment.d.html">https://www.freedesktop.org/software/systemd/man/environment.d.html</a></li>
<li><a href="../../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=704054#25">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=704054#25</a></li>
</ul>
<aside class="quote no-group" data-username="madaidan" data-post="7" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>${wrapper_pre} ${program_name} ${wrapper_post}</p>
</blockquote>
</aside>
<p>Needs more than a single <code>${wrapper_pre}</code>. Needs to be stackable.</p>
<blockquote>
<p>Here are some examples of commands to prepend:</p>
<ul>
<li>firejail firefox</li>
<li>torsocks gpg</li>
<li>LD_PRELOAD="$LD_PRELOAD":libeatmydata.so rsync [ld preload hardened malloc]</li>
<li>bindp, timeprivacy and probably a lot more</li>
<li>probably quite some dpkg diversions used for that purpose</li>
</ul>
</blockquote>
<p>Newer examples:</p>
<ul>
<li>hardend kernel apt (hkapt)</li>
<li>rapt (restricted apt)</li>
</ul>
<blockquote>
<p>Here are some examples of commands to append:</p>
<ul>
<li>for ZeroNet it would be useful to always automatically append for example --tor always</li>
</ul>
</blockquote>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>You would invoke the master wrapper script by specifying “–mwrap” in a program’s cli command. mwrap is short for mega wrapper.</p>
</blockquote>
</aside>
<p>I don’t understand.<br>
For now, the idea was the wrappers to be transparent. Adding functionality (such as stream isolation, MAC confinement, etc.) but not requiring laymen user to be aware of it.</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Somehow preserve the use of mwrap with software across their updates.</p>
</blockquote>
</aside>
<p>For sure. Wrappers absolutely must survive upgrades of applications these are wrapping. Needs to be added to proposal or maybe separate discussion summary document as a defined goal.</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>mwrap would assume a default “wrapper.d” dir is present in the programs “etc” subfolder.</p>
</blockquote>
</aside>
<p>Could use the same folders as systemd config usually uses.</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>This can be extended however to add other arbitrary dirs for it to look into and to chain wrappers contained therein in lexical order as you suggested.</p>
</blockquote>
</aside>
<p>A config option to expand which folders will be parsed? That’s extra complexity. Not sure what would that be useful for?</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>The default wrapper.d location should be overridable in case it is a portable program or one installed in the home folder like TBB or /opt.</p>
</blockquote>
</aside>
<p>/opt (and other uncommon PATHs) is a good point. If we go for PATH variable modification to implement this then all folders should be covered. It however will probably not be possible to wrap direct calls to /opt/pkg-name/binary-name. But that should be OK. Wrappers will probably only be shipped for select applications where we know where these are installed.</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>If a duplicate wrapper script is found in two different folders, mwrap should exit with an error telling the user to change the file name before it can be applied.</p>
</blockquote>
</aside>
<p>Duplicate detection is hard. Two different config files that both want to prepend torsocks or something? Very few applications guard against messed up configs. The ones who ship wrapper configs need to know what they are doing.</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>It should be designed to run different instances per each program that uses it to avoid situations of privilege escalation. Think a malicious program in home folder can feed the mwrap instance running under sudo with arbitrary scripts if it is already used by a binary with folders in /etc/</p>
</blockquote>
</aside>
<p>Not sure I fully understood that threat model.<br>
However, yes, binaries in /home are another interesting question.<br>
I guess stackable wrappers could parse <code>$HOME/.stackable-wrappers.d</code> or something if that exists.</p>
<ul>
<li>if run with sudo: then all bets of off anyhow. A compromised home folder would mean having failed already anyhow.</li>
<li>if not without sudo: then there’s no privilege escalation. <code>$HOME/.stackable-wrappers.d</code> would not execute anything that the user could not execute manually anyhow.</li>
<li>if run by root: it would parse <code>/root/.stackable-wrappers.d</code> (if exists) which would be safe too</li>
<li>if run by systemd / cron: there’s probably in most cases no <code>$HOME</code> and if there was it should not be writeable by those system users having no business there</li>
</ul>
<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Think a malicious program in home folder</p>
</blockquote>
</aside>
<p>Well, “malicious program in home folder” + sudo = fail anyhow?</p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-01T14:30:19Z' class='post-time'>
                March 1, 2020,  2:30pm
              </time>
              <meta itemprop='dateModified' content='2020-03-01T14:38:52Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="8" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Changing PATH may also cause AppArmor issues?</p>
</blockquote>
</aside>
<p>I don’t see why it would cause apparmor issues.</p>
<aside class="quote no-group" data-username="Patrick" data-post="8" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Needs more than a single <code>${wrapper_pre}</code> . Needs to be stackable.</p>
</blockquote>
</aside>
<p>No, you can stack commands with a single <code>${wrapper_pre}</code>. See the example above in which <code>torsocks</code> and <code>firejail</code> are both used for <code>gpg</code>.</p>
<p>If you want multiple drop-in config files, we can modify the script to source <code>${sw_dir}/${program_name}_*.conf</code>. So for example, to stack <code>torsocks</code> and <code>firejail</code> using multiple config files you can create <code>/etc/wrapper.d/gpg_torsocks.conf</code> and add:</p>
<pre><code class="lang-auto">wrapper_pre+="torsocks"
</code></pre>
<p>then create <code>/etc/wrapper.d/gpg_firejail.conf</code> and add</p>
<pre><code class="lang-auto">wrapper_pre+="firejail"
</code></pre>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-02T11:21:40Z' class='post-time'>
                March 2, 2020, 11:21am
              </time>
              <meta itemprop='dateModified' content='2020-03-02T11:21:40Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>The modified PATH would also need to apply for invocations through <code>sudo</code>. Fortunately <code>sudo</code> has a setting <code>secure_path</code>.</p>
<p>madaidan via Whonix Forum:</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="8" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Changing PATH may also cause AppArmor issues?</p>
</blockquote>
</aside>
<p>I don’t see why it would cause apparmor issues.</p>
</blockquote>
<p>Suppose git internally used gpg. Using standard PATH search to find the gpg binary. git simply calling “gpg” not “/usr/bin/gpg”. Then later an apparmor profile is added for git. By modifying the PATH variable and having gpg in any other path then the default “/usr/bin/gpg” could result in an apparmor violation.</p>
<p>Or perhaps Tor Browser or Firefox would call other binaries. Dunno yet any specific examples.</p>
<p>Perhaps an AppArmor <code>/etc/apparmor.d/tunables/...</code> or so drop-in configuration snippet could solve that.</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="8" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Needs more than a single <code>${wrapper_pre}</code> . Needs to be stackable.</p>
</blockquote>
</aside>
<p>No, you can stack commands with a single <code>${wrapper_pre}</code>. See the example above in which <code>torsocks</code> and <code>firejail</code> are both used for <code>gpg</code>.</p>
<p>If you want multiple drop-in config files,</p>
</blockquote>
<p>Yes. For sure.</p>
<p>Each application that provides a wrapper would provide a configuration snippet. Otherwise it would be very inflexible - not using any component (for testing, Kicksecure, alternatives, whatever) no longer possible - at least not without separate user changes to wrapper configs which is bad usability.</p>
<blockquote>
<p>we can modify the script to source <code>${sw_dir}/${program_name}_{0..9}.conf</code>. So for example, to stack <code>torsocks</code> and <code>firejail</code> using multiple config files you can create <code>/etc/wrapper.d/gpg_0.conf</code> and add:</p>
<pre><code class="lang-auto">wrapper_pre+="torsocks"
</code></pre>
</blockquote>
<p>Maybe needs to add a space before or behind.</p>
<p>This might be good enough for an initial implementation but would break on more complex inputs perhaps including single quotes, double quotes or command line parameters that contain spaces.</p>
<p>Instead of setting variables directly with <code>wrapper_pre+=</code> perhaps better to use a shell function because then constructing the actual variable could be done in a shell function (later fixes for white spaces etc) and wouldn’t require later config file changes.</p>
<p><code>/usr/lib/pbuilder/pdebuild-checkparams</code> uses</p>
<p>DEBBUILDOPTS="${2:+$DEBBUILDOPTS $2}";<br>
EXTRA_CONFIGFILE[${<span class="hashtag">#EXTRA_CONFIGFILE</span>[@]}]="$2";</p>
<p><code>/usr/lib/pbuilder/pbuilder-modules</code></p>
<pre><code class="lang-auto">function get_source_options() {
    local source_options
    local arg
    # Split and de-escape DEBBUILDOPTS. Can't iterate over it before
    # de-escaping, as word splitting does not take quotes in the variable into
    # account. Need eval as $(echo $DEBBUILDOPTS) on its own doesn't perform
    # quote expansion, since quote expansion operates on the *original* word.
    eval local args=($DEBBUILDOPTS)
    for arg in "${args[@]}"; do
</code></pre>
<p>Not sure yet but proper handling for quotes, any special characters and white spaces will probably require a bash array. I don’t know any bash scripts as role models from top of my head.</p>
<blockquote>
<p>then create <code>/etc/wrapper.d/gpg_1.conf</code> and add</p>
</blockquote>
<p>I am not sure yet if the name of the program to be wrapped should be part of the configuration file name. Might work. What is the advantage of this? What would be the disadvantage of having the name or path of the to be wrapped application defined in the config file?</p>
<p>What do you think about uwt (<code>/etc/uwt.d/30_uwt_default.conf</code>) syntax</p>
<pre><code>uwtwrapper["/usr/bin/git"]="1"
</code></pre>
<p>?</p>
<p><code>/etc/wrapper.d/gpg_1.conf</code> would mean the first thing that would be run if someone used Debian standard PATH and would execute <code>gpg</code>? Dunno if /path/to/uncommon/location should be supported.</p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-02T17:09:31Z' class='post-time'>
                March 2, 2020,  5:09pm
              </time>
              <meta itemprop='dateModified' content='2020-03-02T17:09:31Z'>
          <span itemprop='position'>#11</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="10" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What is the advantage of this? What would be the disadvantage of having the name or path of the to be wrapped application defined in the config file?</p>
</blockquote>
</aside>
<p>There’s no specific reason. Having the file path in the config file does sound like a better approach.</p>
<aside class="quote no-group" data-username="Patrick" data-post="10" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What do you think about uwt ( <code>/etc/uwt.d/30_uwt_default.conf</code> ) syntax</p>
<pre><code class="lang-auto">uwtwrapper["/usr/bin/git"]="1"
</code></pre>
<p>?</p>
</blockquote>
</aside>
<p>Looks better.</p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7944.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-05-30T23:40:19Z' class='post-time'>
                May 30, 2020, 11:40pm
              </time>
              <meta itemprop='dateModified' content='2020-05-30T23:40:19Z'>
          <span itemprop='position'>#12</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="10" data-topic="7944">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What would be the disadvantage of having the name or path of the to be wrapped application defined in the config file?</p>
</blockquote>
</aside>
<p>How would both the pre and post wrappers be parsed correctly? Seems more complicated.</p>
        </div>

        <meta itemprop='headline' content='Stackable Wrappers'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
