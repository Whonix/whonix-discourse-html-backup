<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>crypttab is ignored by update-initramfs</title>
    <link>http://forums.whonix.org/t/crypttab-is-ignored-by-update-initramfs/15868</link>
    <description>I encrypted the disk using
 `cryptsetup reencrypt --encrypt /dev/sdXY`
my /etc/crypttab:
`root_crypt UUID=ccfd2c14-0148-4679-9e2c-626e6e044d08 none luks`
my /etc/fstab:
`/dev/mapper/root_crypt  /  ext4    defaults 0   1`
I also tried to change /etc/default/grub like this:
`GRUB_CMDLINE_LINUX=&quot;cryptdevice=UUID=ccfd2c14-0148-4679-9e2c-626e6e044d08:root_crypt  root=/dev/mapper/root_crypt  &quot;`
After these files edited i used:
```
update-grub
grub-install /dev/sda
update-initramfs -u -k all
```
initramfs does not mount luks partition automatically after booting.
i should do it manually via 
`cryptsetup open /dev/sda1 cryptroot`
then it does not mount manually using
`mount /dev/mapper/cryptroot /root`
but works for 
`/init`
and system starts successfully after double
`exec switch_root /root /sbin/init`
do you have any advice? what am i doing wrong?

I am unable to attach screenshots or links, so these are console recognized listing:
```
GRUB loading . .
Welcome to GRUB?
Attempting to decrypt master key...
Enter passphrase for hd0,msdosl (ccfd2cl4014846799e2c626e6e044d08):
```

```
Gaue up waiting for root file system deuice. Common problems:
- Boot args (cat zproczcmdline)
- Check rootdelay= (did the system wait long enough?)
- Missing modules (cat zproczmodules; Is zdeu)
ALERT? UUID=26ada0c0-1165-4O98-884d-aafd2220c2c6 does not exist. Dropping to a shell?
BusyBox ul.30.1 (Debian 1:1.30.l-6+b3) built-in shell (ash)
Enter &#39;help&#39; for a list of built-in commands.
(initramfs) blkid
zdeuzsdal: UUID=&quot;ccfd2cl4-0148-4679-9e2c-626e6e044d08&#39;’ TYPE=”crypto_LUKS” PARTUUID=&quot;41414141-01 (initramfs) Is
bin	cryptroot	etc	lib	proc	run	scripts	tmp	uar
conf	deu	in it	1ib64	root	sbin	sys	usr
(initramfs) Is cryptrootz
crypttab
(initramfs) cat zcryptrootzcrypttab
(initramfs) mount
none on z type rootfs (rw)
sysfs on zsys type sysfs (rw,nosuid,nodeu,noexec,relatime)
proc on zproc type proc (rw,nosuid,nodeu,noexec,relatime)
udeu on zdeu type deutmpfs (rw,nosuid,relatime,size=996060k,nr_inodes=248015,mode=755)
deupts on zdeuzpts type deupts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=O00) tmpfs on zrun type tmpfs (rw,nosuid,nodeu,noexec,relatime,size=203056k,mode=755) 
(initramfs)
```

```
Gaue up waiting for root file system deuice. Common problems:
- Boot args (cat zproczcmd1ine)
- Check rootdelay= (did the system wait long enough?)
- Mi ssing modules (cat zproczmodules; Is zdeu)
ALERT! UUID=Z6ada0c0-1165-4098-884d-aafdZZZ0cZc6 does not exist. Dropping to a shell?
BusyBox ul.30.1 (Debian 1:1.30.l-6*b3) built-in shell (ash) Enter &#39;help* for a list of built-in commands.
(initramfs) cryptsetup open zdeuzsdal cryptroot
Enter passphrase for zdeuzsdal:
(initramfs) mount zdeuzmapperzcryptroot zroot
mount: mounting zdeuzmapperzcryptroot on zroot failed: No such file or directory (initramfs) zinit
mount: mounting sysfs on zsys failed: Deuice or resource busy mount: mounting udeu on zdeu failed: Deuice or resource busy mkdir: can&#39;t create directory &#39;zdeuzpts&#39;: File exists BusyBox ul.30.1 (Debian 1:1.30.l-6*b3) multi-call binary.
Usage: run-init t-d CAP,CAP...] (-nJ (-c CONSOLE.DEU] NEU_ROOT NEU_INIT [ARGS]
Free initramfs and switch to another root fs: chroot to NEU_ROOT, delete all in z, moue NEU_ROOT to z, execute NEU_INIT. PID must be 1. NEU_ROOT must be a mountpoint.
—c DEU Reopen stdio to DEU after switch
-d CAPS Drop capabilities
-n Dry run (initramfs) mount none on z type rootfs (rw) sysfs on zrootzsys type sysfs (rw,nosuid,nodeu,noexec,relatime) proc on zproc type proc (rw,nosuid,nodeu,noexec,relatime)
udeu on zrootzdeu type deutmpfs (rw,nosuid,relatime,size=996O60k,nr_inodes=Z49015,mode=755) deupts on zrootzdeuzpts type deupts (rw,nosuid,noexec,relatime,gid=5,mode=6Z0,ptmxmode=000) tmpfs on zrun type tmpfs (rw,nosuid,nodeu,noexec,relatime,size=Z03056k,mode=755) proc on zrootzproc type proc (rw,nosuid,nodeu,noexec,re 1atime)
deupts on zrootzdeuzpts type deupts (rw,nosuid,noexec,relatime,gid=5,mode=6Z0,ptmxmode=000) tmpfs on zrootzrun type tmpfs (rw,nosuid,nodeu,noexec,re 1atime,size=Z03056k,mode=755) zdeuzmapperzcryptroot on zroot type ext4 (ro,relatime) 
(initramfs)
```</description>
    <language>en</language>
    <lastBuildDate>Tue, 25 Oct 2022 17:29:44 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="http://forums.whonix.org/t/crypttab-is-ignored-by-update-initramfs/15868.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>crypttab is ignored by update-initramfs</title>
        <dc:creator><![CDATA[noname01]]></dc:creator>
        <description><![CDATA[
            <p>I encrypted the disk using<br>
<code>cryptsetup reencrypt --encrypt /dev/sdXY</code><br>
my /etc/crypttab:<br>
<code>root_crypt UUID=ccfd2c14-0148-4679-9e2c-626e6e044d08 none luks</code><br>
my /etc/fstab:<br>
<code>/dev/mapper/root_crypt  /  ext4    defaults 0   1</code><br>
I also tried to change /etc/default/grub like this:<br>
<code>GRUB_CMDLINE_LINUX="cryptdevice=UUID=ccfd2c14-0148-4679-9e2c-626e6e044d08:root_crypt  root=/dev/mapper/root_crypt  "</code><br>
After these files edited i used:</p>
<pre><code class="lang-auto">update-grub
grub-install /dev/sda
update-initramfs -u -k all
</code></pre>
<p>initramfs does not mount luks partition automatically after booting.<br>
i should do it manually via<br>
<code>cryptsetup open /dev/sda1 cryptroot</code><br>
then it does not mount manually using<br>
<code>mount /dev/mapper/cryptroot /root</code><br>
but works for<br>
<code>/init</code><br>
and system starts successfully after double<br>
<code>exec switch_root /root /sbin/init</code><br>
do you have any advice? what am i doing wrong?</p>
<p>I am unable to attach screenshots or links, so these are console recognized listing:</p>
<pre><code class="lang-auto">GRUB loading . .
Welcome to GRUB?
Attempting to decrypt master key...
Enter passphrase for hd0,msdosl (ccfd2cl4014846799e2c626e6e044d08):
</code></pre>
<pre><code class="lang-auto">Gaue up waiting for root file system deuice. Common problems:
- Boot args (cat zproczcmdline)
- Check rootdelay= (did the system wait long enough?)
- Missing modules (cat zproczmodules; Is zdeu)
ALERT? UUID=26ada0c0-1165-4O98-884d-aafd2220c2c6 does not exist. Dropping to a shell?
BusyBox ul.30.1 (Debian 1:1.30.l-6+b3) built-in shell (ash)
Enter 'help' for a list of built-in commands.
(initramfs) blkid
zdeuzsdal: UUID="ccfd2cl4-0148-4679-9e2c-626e6e044d08'’ TYPE=”crypto_LUKS” PARTUUID="41414141-01 (initramfs) Is
bin	cryptroot	etc	lib	proc	run	scripts	tmp	uar
conf	deu	in it	1ib64	root	sbin	sys	usr
(initramfs) Is cryptrootz
crypttab
(initramfs) cat zcryptrootzcrypttab
(initramfs) mount
none on z type rootfs (rw)
sysfs on zsys type sysfs (rw,nosuid,nodeu,noexec,relatime)
proc on zproc type proc (rw,nosuid,nodeu,noexec,relatime)
udeu on zdeu type deutmpfs (rw,nosuid,relatime,size=996060k,nr_inodes=248015,mode=755)
deupts on zdeuzpts type deupts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=O00) tmpfs on zrun type tmpfs (rw,nosuid,nodeu,noexec,relatime,size=203056k,mode=755) 
(initramfs)
</code></pre>
<pre><code class="lang-auto">Gaue up waiting for root file system deuice. Common problems:
- Boot args (cat zproczcmd1ine)
- Check rootdelay= (did the system wait long enough?)
- Mi ssing modules (cat zproczmodules; Is zdeu)
ALERT! UUID=Z6ada0c0-1165-4098-884d-aafdZZZ0cZc6 does not exist. Dropping to a shell?
BusyBox ul.30.1 (Debian 1:1.30.l-6*b3) built-in shell (ash) Enter 'help* for a list of built-in commands.
(initramfs) cryptsetup open zdeuzsdal cryptroot
Enter passphrase for zdeuzsdal:
(initramfs) mount zdeuzmapperzcryptroot zroot
mount: mounting zdeuzmapperzcryptroot on zroot failed: No such file or directory (initramfs) zinit
mount: mounting sysfs on zsys failed: Deuice or resource busy mount: mounting udeu on zdeu failed: Deuice or resource busy mkdir: can't create directory 'zdeuzpts': File exists BusyBox ul.30.1 (Debian 1:1.30.l-6*b3) multi-call binary.
Usage: run-init t-d CAP,CAP...] (-nJ (-c CONSOLE.DEU] NEU_ROOT NEU_INIT [ARGS]
Free initramfs and switch to another root fs: chroot to NEU_ROOT, delete all in z, moue NEU_ROOT to z, execute NEU_INIT. PID must be 1. NEU_ROOT must be a mountpoint.
—c DEU Reopen stdio to DEU after switch
-d CAPS Drop capabilities
-n Dry run (initramfs) mount none on z type rootfs (rw) sysfs on zrootzsys type sysfs (rw,nosuid,nodeu,noexec,relatime) proc on zproc type proc (rw,nosuid,nodeu,noexec,relatime)
udeu on zrootzdeu type deutmpfs (rw,nosuid,relatime,size=996O60k,nr_inodes=Z49015,mode=755) deupts on zrootzdeuzpts type deupts (rw,nosuid,noexec,relatime,gid=5,mode=6Z0,ptmxmode=000) tmpfs on zrun type tmpfs (rw,nosuid,nodeu,noexec,relatime,size=Z03056k,mode=755) proc on zrootzproc type proc (rw,nosuid,nodeu,noexec,re 1atime)
deupts on zrootzdeuzpts type deupts (rw,nosuid,noexec,relatime,gid=5,mode=6Z0,ptmxmode=000) tmpfs on zrootzrun type tmpfs (rw,nosuid,nodeu,noexec,re 1atime,size=Z03056k,mode=755) zdeuzmapperzcryptroot on zroot type ext4 (ro,relatime) 
(initramfs)
</code></pre>
          <p><a href="http://forums.whonix.org/t/crypttab-is-ignored-by-update-initramfs/15868/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/crypttab-is-ignored-by-update-initramfs/15868/1</link>
        <pubDate>Tue, 25 Oct 2022 17:29:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15868-1</guid>
        <source url="http://forums.whonix.org/t/crypttab-is-ignored-by-update-initramfs/15868.rss">crypttab is ignored by update-initramfs</source>
      </item>
  </channel>
</rss>
