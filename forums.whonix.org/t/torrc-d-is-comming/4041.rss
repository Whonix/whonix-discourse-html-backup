<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>torrc.d is comming</title>
    <link>http://forums.whonix.org/t/torrc-d-is-comming/4041</link>
    <description>[quote=&quot;Patrick, post:243, topic:650, full:true&quot;]
torrc.d coming.

https://trac.torproject.org/projects/tor/ticket/1922
[/quote]

cypherpunks said in the ticket:
&gt;  The first released tor version with this feature is 0.3.1.1-alpha.
&gt; As usual there will be alpha packages on deb.torproject.org

&gt; If you want this feature _now_ you can use the nightly builds:
&gt; ​https://deb.torproject.org/torproject.org/dists/tor-nightly-master-stretch

A detailed instruction has been written in the new /etc/tor/torrc file (in Whonix, the path is `/etc/tor/torrc.anondist-orig`) shipped with the Tor nightly:

    ## Configuration options can be imported from files or folders using the %include
    ## option with the value being a path. If the path is a file, the options from the
    ## file will be parsed as if they were written where the %include option is. If
    ## the path is a folder, all files on that folder will be parsed following lexical
    ## order. Files starting with a dot are ignored. Files on subfolders are ignored.
    ## The %include option can be used recursively.
    #%include /etc/torrc.d/
    #%include /etc/torrc.custom

TODO:

- update [related](http://www.kkkkkkkkkk63ava6.onion/wiki/Dev/Tor) Whonix wiki

Questions:

- Should we change a way to organize the tor configuration files in Whonix?
- if so, we probably also need to do minor changes on other related/influenced part, eg. the command line used to restart/reload Tor?


ps. It seems updating to Tor nightly in Whonix will not update the /etc/tor/torrc file automatically. I will investigate on this and post the findings below :slight_smile:</description>
    <language>en</language>
    <lastBuildDate>Thu, 05 Mar 2020 13:50:58 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>These fixes are now in the testers repository.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/77">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/77</link>
        <pubDate>Thu, 05 Mar 2020 13:50:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-77</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>anon-verify fixes and torrc.d improvements:</p>
<p><a href="https://github.com/Whonix/anon-gw-anonymizer-config/compare/40c48fc0414828f48c5ff9465d839458c8b35b25...6c9644c5e2ba88414e76f7f319baba5201b68439">https://github.com/Whonix/anon-gw-anonymizer-config/compare/40c48fc0414828f48c5ff9465d839458c8b35b25...6c9644c5e2ba88414e76f7f319baba5201b68439</a></p>
<p>anon-connection-wizard vs torrc.d fixes:</p>
<p><a href="https://github.com/Whonix/anon-connection-wizard/compare/5381f910ad2a669cae65e984c2f7eb05d1267dfd...ae730db23057a8a2bd8588e78f8a88fca61b1d84">https://github.com/Whonix/anon-connection-wizard/compare/5381f910ad2a669cae65e984c2f7eb05d1267dfd...ae730db23057a8a2bd8588e78f8a88fca61b1d84</a></p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/76">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/76</link>
        <pubDate>Thu, 05 Mar 2020 13:49:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-76</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="1" data-topic="8994">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"><a href="//forums.whonix.org/t/whonix-virtualbox-15-0-0-8-9-point-release-vanguards-tcp-isn-leak-protection-extensive-hardening/8994/1">Whonix VirtualBox 15.0.0.8.9 - Point Release! - vanguards; TCP ISN Leak Protection; Extensive Hardening! <img src="//forums.whonix.org/images/emoji/twitter/fire.png?v=9" title="fire" alt="fire" class="emoji"></a>
</div>
<blockquote>
<p>full <code>/etc/torrc.d/*.conf</code> <a href="https://www.whonix.org/wiki/Configuration_Files">configuration</a> snippet drop-in folder support</p>
<ul>
<li><a href="https://forums.whonix.org/t/torrc-d-is-comming/4041/72">torrc.d cleaner</a></li>
</ul>
</blockquote>
</aside>
<p><code>/etc/torrc.d/*.conf</code> / <code>/usr/local/etc/torrc.d/*.conf</code> support might be causing issues.</p>
<aside class="quote no-group" data-username="Patrick" data-post="12" data-topic="9042">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"><a href="//forums.whonix.org/t/configuring-onion-service/9042/12">Configuring Onion Service</a>
</div>
<blockquote>
<p>There might be an extraneous file in folder <code>/usr/local/etc/torrc.d</code> such as <code>/usr/local/etc/torrc.d/50_user.conf~</code> (trailing tilde symbol) which was created by an editor as a backup file.</p>
</blockquote>
</aside>
<p>If that is the case it can be solved by adding to documentation to manually run torrc-d-cleaner before restarting Tor or perhaps a usability tool which does both (run torrc-d-cleaner + restart Tor).</p>
<p>On top of that <a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/man/anon-verify.8.ronn">anon-verify</a> has a bug and does not show all config files which makes debugging for users harder. I am working on it.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/75">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/75</link>
        <pubDate>Mon, 02 Mar 2020 20:36:35 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-75</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/commit/3a6b47c6b9c23fceb4ea4d75b78d88e9f4f8ba4b" target="_blank">github.com/Whonix/anon-gw-anonymizer-config</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/commit/3a6b47c6b9c23fceb4ea4d75b78d88e9f4f8ba4b" target="_blank">run torrc.d cleaner on Tor reload</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-01-13" data-time="09:41:11" data-timezone="UTC">09:41AM - 13 Jan 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 15 additions and 0 deletions">
        <a href="https://github.com/Whonix/anon-gw-anonymizer-config/commit/3a6b47c6b9c23fceb4ea4d75b78d88e9f4f8ba4b" target="_blank">
          <span class="added">+15</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/commit/702dc5191fbc85933b576e64105513c983f0b5e1" target="_blank">github.com/Whonix/anon-gw-anonymizer-config</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/commit/702dc5191fbc85933b576e64105513c983f0b5e1" target="_blank">torrc.d cleaner: improve error handler and output</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-01-13" data-time="09:42:54" data-timezone="UTC">09:42AM - 13 Jan 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 10 additions and 0 deletions">
        <a href="https://github.com/Whonix/anon-gw-anonymizer-config/commit/702dc5191fbc85933b576e64105513c983f0b5e1" target="_blank">
          <span class="added">+10</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/74">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/74</link>
        <pubDate>Mon, 13 Jan 2020 09:43:30 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-74</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This was implemented in testers repository. In essence:</p>
<p><code>/etc/tor/torrc</code> :</p>
<pre><code>%include /etc/torrc.d/
</code></pre>
<p><code>/etc/torrc.d/95_whonix.conf </code> :</p>
<pre><code>%include /usr/local/etc/torrc.d/
</code></pre>
<p><code>/usr/local/etc/torrc.d/</code> folder:</p>
<blockquote>
<p>40_tor_control_panel.conf  50_user.conf</p>
</blockquote>
<hr>
<ul>
<li><a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/share/tor/tor-service-defaults-torrc.anondist">https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/share/tor/tor-service-defaults-torrc.anondist</a></li>
<li><a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/tor/torrc.anondist">https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/tor/torrc.anondist</a></li>
<li><a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/torrc.d/95_whonix.conf">https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/torrc.d/95_whonix.conf</a></li>
</ul>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/73">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/73</link>
        <pubDate>Sat, 11 Jan 2020 16:27:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-73</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="71" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Since still not done I am considering to create a script that runs before Tor which would move any files not ending with <code>*.conf</code> out of the way.</p>
</blockquote>
</aside>
<p>Implemented in git master.</p>
<ul>
<li><a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/lib/anon-gw-anonymizer-config/torrc-d-cleaner">https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/lib/anon-gw-anonymizer-config/torrc-d-cleaner</a></li>
<li><a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/lib/systemd/system/anon-gw-anonymizer-config.service">https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/lib/systemd/system/anon-gw-anonymizer-config.service</a></li>
</ul>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/72">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/72</link>
        <pubDate>Sun, 22 Dec 2019 09:04:29 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-72</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick_mobile]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="69" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/c5a1d2/40.png" class="avatar"> iry:</div>
<blockquote>
<p><a href="https://trac.torproject.org/projects/tor/ticket/25140" rel="nofollow noopener">https://trac.torproject.org/projects/tor/ticket/25140</a></p>
</blockquote>
</aside>
<p>Since still not done I am considering to create a script that runs before Tor which would move any files not ending with <code>*.conf</code> out of the way. May be possible to start using systemd drop-in ExecStartPre.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/71">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/71</link>
        <pubDate>Thu, 12 Dec 2019 09:56:02 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-71</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Debian likes neither:</p>
<ul>
<li>/etc/torrc.d/</li>
<li>/usr/local/etc/torrc.d/</li>
</ul>
<p>Source:<br>
<code>Apparmor profile whitelist /etc/torrc.d/ and /usr/local/etc/torrc.d/</code><br>
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=910017" class="onebox" target="_blank">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=910017</a></p>
<p>Maybe it will be <code>/etc/tor/torrc.d/</code> but it’s not yet finally decided.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/70">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/70</link>
        <pubDate>Mon, 01 Oct 2018 21:38:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-70</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="68" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would %include /etc/torrc.d/*.conf work now?</p>
</blockquote>
</aside>
<p>I tried the latest uploaded Tor. No, it doesn’t work.</p>
<p>I’ve been keeping an eye on the ticket and the status is still <code>needs_revision</code>. Jigsaw52 has not been working on it after the review by ahf:</p>
<p><a href="https://trac.torproject.org/projects/tor/ticket/25140#ticket" class="onebox" target="_blank">https://trac.torproject.org/projects/tor/ticket/25140#ticket</a></p>
<hr>
<aside class="quote" data-post="68" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If so, could you make the pull request please?</p>
</blockquote>
</aside>
<p>I will keep an eye on it and do a PR whenever the feature is ready.</p>
<p>Note: anon-verify also needs to be changed to simulate new parsing rule when it’s ready.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/69">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/69</link>
        <pubDate>Wed, 20 Jun 2018 08:40:43 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-69</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Whonix 14 repository Tor package was upgraded. Just now uploaded.</p>
<pre><code>user@host:~$ anon-info
INFO: version of the 'tor' package: 0.3.3.7-1~d90.stretch+1
</code></pre>
<p>Would <code>%include /etc/torrc.d/*.conf</code> work now? If so, could you make the pull request please?</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/68">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/68</link>
        <pubDate>Tue, 19 Jun 2018 23:06:21 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-68</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/11" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-gw-anonymizer-config</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/pgerber" target="_blank" rel="nofollow noopener">
    <img alt="pgerber" src="//forums.whonix.org/uploads/default/original/2X/5/58d152b6b2993ec8851383d02b6a24c073e47e37.png" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/11" target="_blank" rel="nofollow noopener">torrc: %include torrc.d directories rather than single files in them</a>
</h4>

<div class="date">
  by <a href="https://github.com/pgerber" target="_blank" rel="nofollow noopener">pgerber</a>
  on <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/11" target="_blank" rel="nofollow noopener">04:32PM - 31 May 18 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>1 commits</strong>
  changed <strong>2 files</strong>
  with <strong>3 additions</strong>
  and <strong>3 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/67">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/67</link>
        <pubDate>Fri, 01 Jun 2018 03:41:08 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-67</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="65" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/i/c5a1d2/40.png" class="avatar"> iry:</div>
<blockquote>
<p>Expected behavior: systemctl restart tor@default.service will run anon-gw-anonymizer-config.service which will grantee /usr/local/etc/torrc.d and the two files in it.</p>
</blockquote>
</aside>
<p>Works as expected by me. It only works after boot. (And this is important because that helps our torrc.d implementation also also creating the files in time for first boot and even in Qubes-Whonix.) It is to cover the Whonix specific implementation (which is not simple with Qubes vs persistence of TemplateBased VMs) so we can provide a config file for acw and user-modified-only. I think this is sufficient. (Deleting /usr/local/etc and then rebooting works as well.)</p>
<p>The case that the user deletes files and user restarts Tor is not covered.</p>
<ul>
<li>Are there other systemd unit files where once you restart them, also another systemd unit gets restarted automatically beforehand?</li>
<li>Are there any other daemons that file to start if their config file is missing?</li>
<li>Are there any other daemons where missing config files in /etc (root required!) will be automagically created if missing?</li>
<li>If the user starts deleting files, it’s up to the user to fix?</li>
</ul>
<p>(We could even do the opposite. Doing this creation of files only at first boot and not again.)</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/66">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/66</link>
        <pubDate>Thu, 22 Feb 2018 12:15:36 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-66</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="64" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could you please review my latest additions?</p>
</blockquote>
</aside>
<p>Hi Patrick!</p>
<p>For unknown reason, the latest <code>tor@default.service</code> does not work as expected:</p>
<p><code>sudo rm -r /usr/local/etc</code></p>
<p>Expected behavior: <code>systemctl restart tor@default.service</code> will run <code>anon-gw-anonymizer-config.service</code> which will grantee <code>/usr/local/etc/torrc.d</code> and the two files in it.<br>
Actually, <code>anon-gw-anonymizer-config.service</code> will not be run, causing the Tor fail to start due to the missing torrc files. Running <code>systemctl restart anon-gw-anonymizer-config.service</code> manually will works fine though.</p>
<p>I tried to debug it by removing several additional commit but I did not figure out the reason.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/65">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/65</link>
        <pubDate>Thu, 22 Feb 2018 03:47:43 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-65</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>All merged, thanks! <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Some commits on top.</p>
<p>WantedBy… Not easy to explain. I learned this mostly by looking at other systemd unit files.<br>
<a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html" class="onebox" target="_blank">https://www.freedesktop.org/software/systemd/man/systemd.unit.html</a></p>
<p>Could you please review my latest additions?</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/64">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/64</link>
        <pubDate>Thu, 22 Feb 2018 01:41:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-64</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Systemd units running as root is the systemd default. I doubt any of the<br>
units in /lib/systemd/system/ use User=root. So this can be dropped.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/63">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/63</link>
        <pubDate>Thu, 22 Feb 2018 01:19:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-63</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/Whonix/anon-connection-wizard/pull/19" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-connection-wizard</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">
    <img alt="irykoon" src="//forums.whonix.org/uploads/default/original/2X/9/98aa778e974fcee1a884c4cddba27799ebb68f59.png" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/Whonix/anon-connection-wizard/pull/19" target="_blank" rel="nofollow noopener"> /etc/torrc.d -&gt; /etc/torrc.d/95_whonix.conf</a>
</h4>

<div class="date">
  by <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">irykoon</a>
  on <a href="https://github.com/Whonix/anon-connection-wizard/pull/19" target="_blank" rel="nofollow noopener">11:43PM - 21 Feb 18 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>6 commits</strong>
  changed <strong>3 files</strong>
  with <strong>18 additions</strong>
  and <strong>14 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/62">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/62</link>
        <pubDate>Wed, 21 Feb 2018 23:45:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-62</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <p>We should avoid any <code>%include directory</code> for now.</p>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/9/commits/17c3df9b7eb4d2ec496df8a262573fb85bb59379" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-gw-anonymizer-config</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">
    <img alt="irykoon" src="//forums.whonix.org/uploads/default/original/2X/9/98aa778e974fcee1a884c4cddba27799ebb68f59.png" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/9" target="_blank" rel="nofollow noopener">Control Port workaround &amp; Make sure torrc files exist before starting Tor</a>
</h4>

<div class="date">
  by <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">irykoon</a>
  on <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/9" target="_blank" rel="nofollow noopener">08:48PM - 04 Feb 18 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>8 commits</strong>
  changed <strong>10 files</strong>
  with <strong>45 additions</strong>
  and <strong>4 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/61">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/61</link>
        <pubDate>Wed, 21 Feb 2018 23:20:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-61</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <p>Again, thank your very much for your instructions, Patrick!</p>
<p>Done:</p>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/9" target="_blank" rel="nofollow noopener">github.com/Whonix/anon-gw-anonymizer-config</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">
    <img alt="irykoon" src="//forums.whonix.org/uploads/default/original/2X/9/98aa778e974fcee1a884c4cddba27799ebb68f59.png" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/9" target="_blank" rel="nofollow noopener">Control Port workaround &amp; Make sure torrc files exist before starting Tor</a>
</h4>

<div class="date">
  by <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">irykoon</a>
  on <a href="https://github.com/Whonix/anon-gw-anonymizer-config/pull/9" target="_blank" rel="nofollow noopener">08:48PM - 04 Feb 18 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>8 commits</strong>
  changed <strong>10 files</strong>
  with <strong>45 additions</strong>
  and <strong>4 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-post="55" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>This might be fixable using User= or so, but we shouldn’t do it. Too</p>
<p>intrusive since not our service. Could lead to bugs.</p>
</blockquote>
</aside>
<p>I set <code>User=root</code> in <code>/lib/systemd/system/anon-gw-anonymizer-config.service</code>. Otherwise, I do not know how to write to <code>/use/local</code>.</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/60">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/60</link>
        <pubDate>Wed, 21 Feb 2018 22:44:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-60</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/qubes-whonix/commit/10dea23f89507dcc222a93aa7cff8b162d9c54a3" target="_blank" rel="nofollow noopener">github.com/Whonix/qubes-whonix</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="//forums.whonix.org/uploads/default/original/2X/5/567709cd4b873e59936246faf52ef8293c7793cd.jpg" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/Whonix/qubes-whonix/commit/10dea23f89507dcc222a93aa7cff8b162d9c54a3" target="_blank" rel="nofollow noopener">remove 'mkdir -p /usr/local/etc/torrc.d'</a>
</h4>

  <pre class="message" style="white-space: normal;">will be done by systemd unit file anon-gw-anonymizer-config.service</pre>

<div class="date">
  by <a href="https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="https://github.com/Whonix/qubes-whonix/commit/10dea23f89507dcc222a93aa7cff8b162d9c54a3" target="_blank" rel="nofollow noopener">04:16PM - 20 Feb 18 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>0 additions</strong>
  and <strong>2 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/59">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/59</link>
        <pubDate>Tue, 20 Feb 2018 16:17:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-59</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/qubes-whonix/commit/8ee0b893357b2cba90466d0b8ccbc1b9139c7921" target="_blank" rel="nofollow noopener">github.com/Whonix/qubes-whonix</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="//forums.whonix.org/uploads/default/original/2X/5/567709cd4b873e59936246faf52ef8293c7793cd.jpg" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/Whonix/qubes-whonix/commit/8ee0b893357b2cba90466d0b8ccbc1b9139c7921" target="_blank" rel="nofollow noopener">remove /etc/tor from bind dirs</a>
</h4>

  <pre class="message" style="white-space: normal;">since we have torrc.d now</pre>

<div class="date">
  by <a href="https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="https://github.com/Whonix/qubes-whonix/commit/8ee0b893357b2cba90466d0b8ccbc1b9139c7921" target="_blank" rel="nofollow noopener">04:14PM - 20 Feb 18 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>0 additions</strong>
  and <strong>1 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/58">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/58</link>
        <pubDate>Tue, 20 Feb 2018 16:16:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-58</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Qubes-Whonix<br>
Now, that we no longer have to modify file <code>/etc/tor/torrc</code>, folder <code>/etc/tor</code> can and should be removed from bind-dirs?</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/qubes-whonix/blob/dcda4a24d2dba03a3677726db5dcbb7e7a443cc5/usr/lib/qubes-bind-dirs.d/40_qubes-whonix.conf#L12" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/qubes-whonix/blob/dcda4a24d2dba03a3677726db5dcbb7e7a443cc5/usr/lib/qubes-bind-dirs.d/40_qubes-whonix.conf#L12" target="_blank" rel="nofollow noopener">Whonix/qubes-whonix/blob/dcda4a24d2dba03a3677726db5dcbb7e7a443cc5/usr/lib/qubes-bind-dirs.d/40_qubes-whonix.conf#L12</a></h4>
<pre class="onebox"><code class="lang-conf"><ol class="start lines" start="2" style="counter-reset: li-counter 1 ;">
<li>## Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;</li>
<li>## See the file COPYING for copying conditions.</li>
<li>
</li>
<li>binds+=( '/var/lib/tor' )</li>
<li>binds+=( '/var/lib/whonix' )</li>
<li>binds+=( '/var/lib/whonixcheck' )</li>
<li>binds+=( '/var/cache/whonix-setup-wizard' )</li>
<li>binds+=( '/var/cache/anon-base-files' )</li>
<li>binds+=( '/var/cache/qubes-whonix' )</li>
<li>binds+=( '/var/cache/tb-updater' )</li>
<li class="selected">binds+=( '/etc/tor' )</li>
<li>
</li>
<li>mkdir -p /usr/local/etc/torrc.d</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>bind-dirs reference:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="//forums.whonix.org/uploads/default/original/2X/f/f674195f5ac81cdee482084cfe34cb6918b6dc9b.png" class="site-icon" width="500" height="500">
      <a href="https://www.qubes-os.org/doc/bind-dirs/" target="_blank" rel="nofollow noopener">Qubes OS</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/362;"><img src="//forums.whonix.org/uploads/default/original/2X/f/f9dbba66fcd8e930f39601ac1345e04b18d538f5.png" class="thumbnail"></div>

<h3><a href="https://www.qubes-os.org/doc/bind-dirs/" target="_blank" rel="nofollow noopener">How to make any file in a TemplateBasedVM persistent using bind-dirs</a></h3>

<p>How to make any file in a TemplateBasedVM persistent using bind-dirs What are bind-dirs? With bind-dirs any arbitrary files or folders can be made persistent in TemplateBasedVMs. What is it useful for? In a TemplateBasedVM all of the file system...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/57">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/57</link>
        <pubDate>Tue, 20 Feb 2018 15:20:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-57</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <p>Patrick Schleizer:</p>
<blockquote>
<p>Could implement that please?</p>
</blockquote>
<p>Yes, definitely! I consider it as a great learning opportunity. Thank<br>
you so much for your instructions, Patrick!</p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/56">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/56</link>
        <pubDate>Mon, 19 Feb 2018 23:44:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-56</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>iry:</p>
<blockquote>
<aside class="quote" data-post="51" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What about ExecStartPre running a script that checks if /usr/local/etc/torrc.d/50_user.conf is non-existing and if so, populates it with some content from a template file from /usr/share/anon-gw-anonymizer-configuser_torrc_template.conf (or so)?</p>
</blockquote>
</aside>
<p>I tried the approach as follows, but it does not work as expected:<br>
<a href="https://github.com/irykoon/anon-gw-anonymizer-config/commit/ae80ee09df893f0226b879002b2c04cd9da41c4e">https://github.com/irykoon/anon-gw-anonymizer-config/commit/ae80ee09df893f0226b879002b2c04cd9da41c4e</a></p>
<p>There are two problems:</p>
<ol>
<li>The script needs root, but systemd does not run it with root privilege</li>
</ol>
</blockquote>
<p>This might be fixable using <code>User=</code> or so, but we shouldn’t do it. Too<br>
intrusive since not our service. Could lead to bugs.</p>
<blockquote>
<ol start="2">
<li>The extended <code>ExecStartPre</code> in <code>/lib/systemd/system/tor@default.service.d/40_torrcd-workaround.conf</code> will only be executed after all the <code>ExecStartPre</code> in <code>/lib/systemd/system/tor@default.service</code> have been done. However, in <code>/lib/systemd/system/tor@default.service</code>, there is a line to check if Tor will work or not: <code>ExecStartPre=/usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0 --verify-config</code>, and it will be executed (and then fail) before the script is executed.</li>
</ol>
</blockquote>
<p>I see. I doubt that can be solved directly.</p>
<p>So we need our own systemd unit file that uses systemd directive<br>
<code>Before=tor.service</code> that runs <code>make-sure-torrc-exist</code>.</p>
<p><code>/lib/systemd/system/anon-gw-anonymizer-config.service</code> or so.</p>
<p>(Or even <code>Before=tor@default.service</code> - only if that is required.)</p>
<p>Could you please move /usr/bin/make-sure-torrc-exist to<br>
/usr/lib/anon-gw-anonymizer-config/make-sure-torrc-exist?</p>
<p>Otherwise we’d have to create and ship a man page (otherwise lintian<br>
warning). And users wouldn’t run this command so be safe all this effort<br>
by moving it to a more appropriate directory.</p>
<p>Could implement that please?</p>
<p>Hints for new systemd unit file packaging implementation:</p>
<ul>
<li>In <code>debian/control</code> add to <code>Build-Depends:</code> <code>dh-systemd</code>.</li>
<li>In <code>debian/rules</code>, change <code>dh $@</code> to <code>dh $@ --with systemd</code>.</li>
<li>There are quite a few systemd unit files in Whonix source code as<br>
examples.</li>
</ul>
<p><code>myfind . | grep systemd | grep \.service | grep --invert-match \\.d | grep --invert-match \\.in</code></p>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/55">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/55</link>
        <pubDate>Mon, 19 Feb 2018 21:39:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-55</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-post="51" data-topic="4041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What about ExecStartPre running a script that checks if /usr/local/etc/torrc.d/50_user.conf is non-existing and if so, populates it with some content from a template file from /usr/share/anon-gw-anonymizer-configuser_torrc_template.conf (or so)?</p>
</blockquote>
</aside>
<p>I tried the approach as follows, but it does not work as expected:<br>
</p><aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/irykoon/anon-gw-anonymizer-config/commit/ae80ee09df893f0226b879002b2c04cd9da41c4e" target="_blank" rel="nofollow noopener">github.com/irykoon/anon-gw-anonymizer-config</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">
    <img alt="irykoon" src="//forums.whonix.org/uploads/default/original/2X/9/98aa778e974fcee1a884c4cddba27799ebb68f59.png" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/irykoon/anon-gw-anonymizer-config/commit/ae80ee09df893f0226b879002b2c04cd9da41c4e" target="_blank" rel="nofollow noopener">Attempt to make sure all torrc files exist</a>
</h4>

  <pre class="message" style="white-space: normal;">However, this does not work as epected. This commit is only for demonstration purpose.</pre>

<div class="date">
  by <a href="https://github.com/irykoon" target="_blank" rel="nofollow noopener">irykoon</a>
  on <a href="https://github.com/irykoon/anon-gw-anonymizer-config/commit/ae80ee09df893f0226b879002b2c04cd9da41c4e" target="_blank" rel="nofollow noopener">06:59PM - 19 Feb 18 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>4 files</strong>
  with <strong>24 additions</strong>
  and <strong>0 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>There are two problems:</p>
<ol>
<li>The script needs root, but systemd does not run it with root privilege</li>
<li>The extended <code>ExecStartPre</code> in <code>/lib/systemd/system/tor@default.service.d/40_torrcd-workaround.conf</code> will only be executed after all the <code>ExecStartPre</code> in <code>/lib/systemd/system/tor@default.service</code> have been done. However, in <code>/lib/systemd/system/tor@default.service</code>, there is a line to check if Tor will work or not: <code>ExecStartPre=/usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0 --verify-config</code>, and it will be executed (and then fail) before the script is executed.</li>
</ol>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/54">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/54</link>
        <pubDate>Mon, 19 Feb 2018 19:13:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-54</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
      <item>
        <title>torrc.d is comming</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>(Somehow my reply by e-mail was truncated.)</p>
<pre><code class="lang-auto">## Tor user specific configuration file
##
## Add user modifications below this line:
##########
</code></pre>
          <p><a href="http://forums.whonix.org/t/torrc-d-is-comming/4041/53">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/torrc-d-is-comming/4041/53</link>
        <pubDate>Mon, 19 Feb 2018 18:11:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-4041-53</guid>
        <source url="http://forums.whonix.org/t/torrc-d-is-comming/4041.rss">torrc.d is comming</source>
      </item>
  </channel>
</rss>
