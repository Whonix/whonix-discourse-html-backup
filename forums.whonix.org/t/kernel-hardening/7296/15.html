<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Kernel Hardening - #15 by HulaHoop - Development - Whonix Forum</title>
    <meta name="description" content="Whonix should implement more kernel hardening. All of these settings add no or a very minimal performance decrease. 
Setting “kernel.kptr_restrict=1” makes kernel symbols in /proc/kallsyms only accessible to root which c&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../7296.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Kernel Hardening&#39;" href="../7296.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/kernel-hardening/7296/15" />
<meta name="twitter:url" content="https://forums.whonix.org/t/kernel-hardening/7296/15" />
<meta property="og:title" content="Kernel Hardening" />
<meta name="twitter:title" content="Kernel Hardening" />
<meta property="og:description" content="Both of these are Grsec features ported by KSPP to the mainline kernel and they seem very useful for mitigating memory corruption:  https://tails.boum.org/contribute/design/kernel_hardening/   If you can document how to disable it for debugging purposes then sure." />
<meta name="twitter:description" content="Both of these are Grsec features ported by KSPP to the mainline kernel and they seem very useful for mitigating memory corruption:  https://tails.boum.org/contribute/design/kernel_hardening/   If you can document how to disable it for debugging purposes then sure." />
<meta property="article:published_time" content="2019-05-05T19:08:03+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="next" href="../72964658.html?page=2">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7296.html">Kernel Hardening</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-03T17:18:34Z' class='post-time'>
                May 3, 2019,  5:18pm
              </time>
              <meta itemprop='dateModified' content='2019-05-04T12:41:25Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Also, one problem with "kernel.dmesg_restrict=1” is that the kernel logs can still be read out by journalctl if the user is part of the systemd-journal, adm or wheel groups. The ordinary user in Whonix is part of the adm group so the kernel logs can still easily be read by an attacker. Maybe there is a way to somehow restrict this even further?</p>
<p>Disabling journald altogether could prevent this but it shouldn’t be done as it’s very useful in debugging errors.</p>
<p>Another way would be to change the permissions for /var/log/journal, /run/log/journal and /bin/journalctl so only root can use it. I don’t know how useful this would be though.</p>
<p>There is an issue on the linux-hardened github repo about this.</p>
<aside class="onebox githubissue">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/anthraxx/linux-hardened/issues/6" target="_blank" rel="nofollow noopener">github.com/anthraxx/linux-hardened</a>
  </header>
  <article class="onebox-body">
    <a href="../../../../external.html?link=https://github.com/evict" rel="nofollow noopener">
<img src="../../../../external.html?link=https://avatars1.githubusercontent.com/u/7238650?v=2&amp;s=96" class="thumbnail onebox-avatar" width="96" height="96">
</a>

<h4><a href="../../../../external.html?link=https://github.com/anthraxx/linux-hardened/issues/6" target="_blank" rel="nofollow noopener">Issue: `kernel.dmesg_restrict` not working with `journalctl`</a></h4>

<div class="date" style="margin-top:10px;">
	<div class="user" style="margin-top:10px;">
	opened by <a href="../../../../external.html?link=https://github.com/evict" target="_blank" rel="nofollow noopener">evict</a>
	on <a href="../../../../external.html?link=https://github.com/anthraxx/linux-hardened/issues/6" target="_blank" rel="nofollow noopener">2019-04-25</a>
	</div>
	<div class="user">
	</div>
</div>

<pre class="content" style="white-space: pre-wrap;">Version: 5.0.7.a-2-hardened
When running dmesg, the following occurs when attempting to read the kernel buffer:
Ʋ dmesg INSERT
dmesg: read kernel buffer failed: Operation...</pre>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>For some reason it doesn’t allow me to send the actual link. (Edit by Patrick: link fixed)</p>
<p>Edit: It seems I needed to get the basic badge to send links which I just got.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-04T12:55:10Z' class='post-time'>
                May 4, 2019, 12:55pm
              </time>
              <meta itemprop='dateModified' content='2019-05-04T12:55:10Z'>
          <span itemprop='position'>#11</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Since Tails is using most if not all of these configuration changes, shipping these in Whonix <strong>might</strong> be <a href="../../usability-popularity-vs-security-freedom-software-purism/7311.html">sustainble</a> (not breaking too many things than current development manpower allows to triage, fix and user support).</p>
<p><a href="../../../../external.html?link=https://www.whonix.org/wiki/FAQ#Patches_are_Welcome" rel="nofollow noopener">Patches are Welcome</a>!</p>
<p>The <a href="../../../../external.html?link=https://github.com/Whonix/security-misc" rel="nofollow noopener">https://github.com/Whonix/security-misc</a> package looks like the right place to add these.</p>
<p>/etc/sysctl.d configs could be dropped here (maybe copy over from Tails verbatim as much as makes sense): <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/tree/master/etc/sysctl.d" rel="nofollow noopener">https://github.com/Whonix/security-misc/tree/master/etc/sysctl.d</a></p>
<p>kernel boot parameters could be modified by shipping a configuration snippet similar to <a href="../../../../external.html?link=https://github.com/Whonix/grub-enable-apparmor/blob/master/etc/default/grub.d/30_apparmor.cfg" rel="nofollow noopener">https://github.com/Whonix/grub-enable-apparmor/blob/master/etc/default/grub.d/30_apparmor.cfg</a> (perhaps simpler) could be dropped into security-misc too. (One kernel boot parameter per one line if good.)</p>
<aside class="quote no-group" data-post="1" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>It may also be good to look into using the linux-hardened kernel.<br>
Would it be possible to use this for Whonix?</p>
</blockquote>
</aside>
<p>Users might manually do this as per <a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation" rel="nofollow noopener">https://www.whonix.org/wiki/Documentation</a> but I don’t think this is sustainable for default installation in Whonix with current developer manpower since the package is not available from <a href="../../../../external.html?link=http://packages.debian.org/" rel="nofollow noopener">packages.debian.org</a>, see also:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Default_Application_Policy" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:104/55;"><img src="../../../../external.html?link=https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail"></div>

<h3><a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Default_Application_Policy" target="_blank" rel="nofollow noopener">Dev/Default Application Policy</a></h3>

<p>Design Documentation - How to decide which apps come with Whonix ™?</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>(Kernel is not an “app” but stuff written there applies here too.)</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-04T22:28:22Z' class='post-time'>
                May 4, 2019, 10:28pm
              </time>
              <meta itemprop='dateModified' content='2019-05-04T22:28:22Z'>
          <span itemprop='position'>#12</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Will I create a pull request for these or something else?</p>
<p>How would hidepid be added if at all?</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T06:00:00Z' class='post-time'>
                May 5, 2019,  6:00am
              </time>
              <meta itemprop='dateModified' content='2019-05-05T06:00:00Z'>
          <span itemprop='position'>#13</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<p>Will I create a pull request for these or something else?</p>
</blockquote>
<p>Yes, please.</p>
<p>For /etc/sysctl.d and /etc/default/grub.d (and perhaps /etc/modprobe.d<br>
if needed).</p>
<blockquote>
<p>How would hidepid be added if at all?</p>
</blockquote>
<p>Please test if it works. If yes, we can take it too.</p>
<p>Which platforms could you test?</p>
<p>virtualbox-guest-additions in Whonix VirtualBox shouldn’t break by this.<br>
(Then things would get more complex - another package or if/else code if<br>
possible required.)</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T14:51:51Z' class='post-time'>
                May 5, 2019,  2:51pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T14:51:51Z'>
          <span itemprop='position'>#14</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I’ve created the pull request.</p>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/pull/5" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/madaidan" target="_blank" rel="nofollow noopener">
    <img alt="madaidan" src="../../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/pull/5" target="_blank" rel="nofollow noopener">More kernel hardening</a>
</h4>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/madaidan" target="_blank" rel="nofollow noopener">madaidan</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/security-misc/pull/5" target="_blank" rel="nofollow noopener">02:44PM - 05 May 19 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>4 commits</strong>
  changed <strong>4 files</strong>
  with <strong>10 additions</strong>
  and <strong>0 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>I’m not sure if I should add the other boot parameters like page_poison=1 and slub_debug=FZP. What do you think of these? The tails kernel hardening page goes over these.</p>
<aside class="quote no-group" data-post="13" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Which platforms could you test?</p>
</blockquote>
</aside>
<p>I can test on Virtualbox and virt-manager (KVM).</p>
<p>Also, regarding the journalctl thing, I’ve made a simple bash script and systemd service that restricts everything to root at boot. It works well and I haven’t gotten any errors yet. Do you think it’d be good to add this to Whonix?</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T19:08:03Z' class='post-time'>
                May 5, 2019,  7:08pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T19:08:03Z'>
          <span itemprop='position'>#15</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="14" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I’m not sure if I should add the other boot parameters like page_poison=1 and slub_debug=FZP. What do you think of these? The tails kernel hardening page goes over these.</p>
</blockquote>
</aside>
<p>Both of these are Grsec features ported by KSPP to the mainline kernel and they seem very useful for mitigating memory corruption:</p>
<p><a href="../../../../external.html?link=https://tails.boum.org/contribute/design/kernel_hardening/" class="onebox" target="_blank" rel="nofollow noopener">https://tails.boum.org/contribute/design/kernel_hardening/</a></p>
<aside class="quote no-group" data-post="14" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>It works well and I haven’t gotten any errors yet. Do you think it’d be good to add this to Whonix?</p>
</blockquote>
</aside>
<p>If you can document how to disable it for debugging purposes then sure.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../vms-do-no-start-until-the-cpu-configuration-is-set-to-copy-host-cpu-configuration/7917/5.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../vms-do-no-start-until-the-cpu-configuration-is-set-to-copy-host-cpu-configuration/7917/5.html'>
                      <span itemprop='name'>VMs do no start until the CPU configuration is set to “Copy host CPU configuration”</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T20:39:01Z' class='post-time'>
                May 5, 2019,  8:39pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T20:39:01Z'>
          <span itemprop='position'>#16</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="14" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I’ve created the pull request.</p>
</blockquote>
</aside>
<p>Looks really good at first! Will probably be merged soon.</p>
<aside class="quote no-group" data-post="14" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I’m not sure if I should add the other boot parameters like page_poison=1 and slub_debug=FZP. What do you think of these? The tails kernel hardening page goes over these.</p>
</blockquote>
</aside>
<p>Haven’t seen anything negative about these. Why not. Yes, please add.</p>
<aside class="quote no-group" data-post="14" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I can test on Virtualbox and virt-manager (KVM).</p>
</blockquote>
</aside>
<p>Awesome, that helps a lot! I’ll test in Qubes first.</p>
<aside class="quote no-group" data-post="14" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Also, regarding the journalctl thing, I’ve made a simple bash script and systemd service that restricts everything to root at boot. It works well and I haven’t gotten any errors yet. Do you think it’d be good to add this to Whonix?</p>
</blockquote>
</aside>
<p>Can be considered but I am not sure that would be a clean implementation. Rather, I would like to possibly fix the original cause of these issues. Will answer more soon.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T20:50:31Z' class='post-time'>
                May 5, 2019,  8:50pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T20:50:31Z'>
          <span itemprop='position'>#17</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="10" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Also, one problem with "kernel.dmesg_restrict=1” is that the kernel logs can still be read out by journalctl if the user is part of the systemd-journal, adm or wheel groups. The ordinary user in Whonix is part of the adm group so the kernel logs can still easily be read by an attacker. Maybe there is a way to somehow restrict this even further?</p>
</blockquote>
</aside>
<p>group <code>adm</code> is from here: <a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/blob/master/debian/anon-base-files.postinst#L67" rel="nofollow noopener">https://github.com/Whonix/anon-base-files/blob/master/debian/anon-base-files.postinst#L67</a></p>
<p>That code was carried around probably from the early TorBOX script version and never been questioned unfortunately.</p>
<pre><code>usermod --append --groups adm,cdrom,audio,dip,sudo,plugdev user || true
</code></pre>
<p>Maybe that has to be reworked. Should we remove some user groups, we can modify that for existing users to in whonix-legacy package (using the “do only once” style).</p>
<p>Could you please try removing user <code>user</code> from <code>adm</code> (and whatever else seems to make sense) and see how that works generally?</p>
<p>What’s next? Suggest removal of user <code>user</code> being in group <code>sudo</code> by default? <img src="../../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p><a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Permissions" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/Permissions</a> i.e. how well can linux protect from root privileged escalation after user <code>user</code> account was compromised (by a remote code execution vulnerability).</p>
<aside class="quote no-group" data-post="10" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Another way would be to change the permissions for /var/log/journal, /run/log/journal and /bin/journalctl so only root can use it. I don’t know how useful this would be though.</p>
</blockquote>
</aside>
<p>If we must yes. But fixing the original issue above is better. (Since this solution is more fragile - overriding config of with [systemd or whatever that will be in future or ports] tmpfiles.d mechanism.)</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T20:57:33Z' class='post-time'>
                May 5, 2019,  8:57pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T20:57:33Z'>
          <span itemprop='position'>#18</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I’ve added the other kernel parameters. They seem to work well with Whonix. I haven’t had any problems.</p>
<aside class="quote no-group" data-post="15" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>If you can document how to disable it for debugging purposes then sure.</p>
</blockquote>
</aside>
<p>You just need to disable/mask the systemd service and revert the files to back the original permissions.</p>
<pre><code>systemctl mask restrict-journalctl.service   
chmod 2755 /run/log/journal 
chmod 2750 /run/log/journal/* 
chmod 640 /run/log/journal/*/*
chmod 755 $(which journalctl)
</code></pre>
<aside class="quote no-group" data-post="17" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could you please try removing user <code>user</code> from <code>adm</code> (and whatever else seems to make sense) and see how that works generally?</p>
</blockquote>
</aside>
<p>I’ll test that now on the Gateway and Workstation. I’m not sure what purpose adm has except for the journal.</p>
<aside class="quote no-group" data-post="17" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What’s next? Suggest removal of user <code>user</code> being in group <code>sudo</code> by default?</p>
</blockquote>
</aside>
<p>Well for a completely locked down system, that would actually be good. Just make a systemd service for updating at boot. It’d be incredibly difficult to use properly though.</p>
<aside class="quote no-group" data-post="17" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If we must yes. But fixing the original issue above is better.</p>
</blockquote>
</aside>
<p>I agree. My way would probably break a lot of things.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T21:00:38Z' class='post-time'>
                May 5, 2019,  9:00pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T21:00:38Z'>
          <span itemprop='position'>#19</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>It seems the adm group is only used for viewing log files. Removing this shouldn’t cause problems.</p>
<aside class="onebox stackexchange">
  <header class="source">
      <a href="../../../../external.html?link=https://superuser.com/questions/86347/whats-difference-between-group-admin-and-adm" target="_blank" rel="nofollow noopener">superuser.com</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://superuser.com/users/19926/xiè-jìléi" target="_blank" rel="nofollow noopener">
    <img alt="Xi&amp;#232; J&amp;#236;l&amp;#233;i" src="../../../../external.html?link=https://www.gravatar.com/avatar/3fa72de6de2b201c28aa19d7594df884?s=128&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="../../../../external.html?link=https://superuser.com/questions/86347/whats-difference-between-group-admin-and-adm" target="_blank" rel="nofollow noopener">What's difference between group admin and adm?</a>
</h4>

<div class="tags">
  <strong>linux, ubuntu, user-accounts</strong>
</div>

<div class="date">
  asked by
  
  <a href="../../../../external.html?link=https://superuser.com/users/19926/xiè-jìléi" target="_blank" rel="nofollow noopener">
    Xi&amp;#232; J&amp;#236;l&amp;#233;i
  </a>
  on <a href="../../../../external.html?link=https://superuser.com/questions/86347/whats-difference-between-group-admin-and-adm" target="_blank" rel="nofollow noopener">03:23AM - 22 Dec 09 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T21:05:36Z' class='post-time'>
                May 5, 2019,  9:05pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T21:05:36Z'>
          <span itemprop='position'>#20</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Removing the user from the adm group works perfectly. I get an error when running <code>journalctl</code> and I can’t view the log files manually. There are no other errors.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T21:14:16Z' class='post-time'>
                May 5, 2019,  9:14pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T21:14:16Z'>
          <span itemprop='position'>#21</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><code>adm</code> removal (I will research that too but also speculate pretty sure it will not cause issues - why would it be “standard to be expected” that a linux user is in that group) - If you like please send pull requests:</p>
<ul>
<li><a href="../../../../external.html?link=https://github.com/Whonix/anon-base-files/blob/master/debian/anon-base-files.postinst#L67" rel="nofollow noopener">https://github.com/Whonix/anon-base-files/blob/master/debian/anon-base-files.postinst#L67</a></li>
<li><a href="../../../../external.html?link=https://github.com/Whonix/whonix-legacy/blob/master/debian/whonix-legacy.preinst" rel="nofollow noopener">https://github.com/Whonix/whonix-legacy/blob/master/debian/whonix-legacy.preinst</a></li>
</ul>
<aside class="quote no-group" data-post="20" data-topic="7296" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Removing the user from the adm group works perfectly. I get an error when running <code>journalctl</code> and I can’t view the log files manually. There are no other errors.</p>
</blockquote>
</aside>
<p>Running journalctl as with root/sudo is fine. No need to run as user <code>user</code>.</p>
<aside class="quote no-group" data-post="18" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>systemctl mask restrict-journalctl.service</p>
</blockquote>
</aside>
<p>That might be a typo?</p>
<aside class="quote no-group" data-post="18" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Well for a completely locked down system, that would actually be good.</p>
</blockquote>
</aside>
<p>Please create a separate forum thread for that.<br>
Ideally, address for added motivation:</p>
<ul>
<li><a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Permissions" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/Permissions</a></li>
<li><a href="../../../../external.html?link=https://blog.invisiblethings.org/2011/04/23/linux-security-circus-on-gui-isolation.html" rel="nofollow noopener">https://blog.invisiblethings.org/2011/04/23/linux-security-circus-on-gui-isolation.html</a></li>
<li><a href="../../../../external.html?link=https://www.qubes-os.org/doc/vm-sudo/" rel="nofollow noopener">https://www.qubes-os.org/doc/vm-sudo/</a></li>
</ul>
<p>Some or even all of above could get invalid with the inception of wayland and/or not apply for CLI or non-gui linux users such as user <code>sdwdate</code>.</p>
<aside class="quote no-group" data-post="18" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Just make a systemd service for updating at boot.</p>
</blockquote>
</aside>
<p>Updating, you mean <code>apt-get dist-upgrade</code>?</p>
<aside class="quote no-group" data-post="18" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>It’d be incredibly difficult to use properly though.</p>
</blockquote>
</aside>
<p>I am not sure I understand that one. Difficult to use since one would require another login session to run commands as root (indeed) or use <code>su</code> or something like that?</p>
<p>This would also kinda be a prerequisite for something I am sometimes briefly wondering about:<br>
<a href="../../walled-garden-firewall-whitelisting-application-whitelisting-sudo-lockdown-superuser-mode-protected-mode/5725.html" class="inline-onebox">walled garden, firewall whitelisting, application whitelisting, sudo lockdown, superuser mode, protected mode</a> - in essence: can a VM be restricted to be running “a single application and nothing else let alone sudo”?</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T21:30:00Z' class='post-time'>
                May 5, 2019,  9:30pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T21:30:00Z'>
          <span itemprop='position'>#22</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="21" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><code>adm</code> removal (I will research that too but also speculate pretty sure it will not cause issues - why would it be “standard to be expected” that a linux user is in that group) - If you like please send pull requests:</p>
</blockquote>
</aside>
<p>I’ll create a pull request now.</p>
<aside class="quote no-group" data-post="21" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>That might be a typo?</p>
</blockquote>
</aside>
<p>No, my way would have used a systemd service to restrict the permissions at boot. They get “overrided” as there are new files created at each boot. “mask” prevents the service from ever being started again unless you unmask it.</p>
<aside class="quote no-group" data-post="21" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Updating, you mean <code>apt-get dist-upgrade</code> ?</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group" data-post="21" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I am not sure I understand that one. Difficult to use since one would require another login session to run commands as root (indeed) or use <code>su</code> or something like that?</p>
</blockquote>
</aside>
<p>Well, I was thinking that <code>su</code> and logging in as root would be restricted as well. You can prevent logging in as root from a tty by clearing /etc/securetty and <code>su</code> can be restricted to the sudo group by changing a few permissions. This way root is impossible to get without a root exploit.</p>
<aside class="quote no-group" data-post="21" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>in essence: can a VM be restricted to be running “a single application and nothing else let alone sudo”?</p>
</blockquote>
</aside>
<p>That would be interesting but it would be a massive drain on resources and you’d need pretty good hardware if you want to run a lot of apps at the same time.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T22:13:47Z' class='post-time'>
                May 5, 2019, 10:13pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T22:13:47Z'>
          <span itemprop='position'>#23</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I managed to get hidepid working.</p>
<p>In /etc/fstab, add</p>
<pre><code>proc /proc proc    nosuid,nodev,noexec,hidepid=2,gid=proc 0 0
</code></pre>
<p>Make /etc/systemd/system/systemd-logind.service.d/hidepid.conf and add</p>
<pre><code>[Service]
SupplementaryGroups=proc
</code></pre>
<p>Now create the ‘proc’ group by running</p>
<pre><code>groupadd proc 
</code></pre>
<p>systemd-logind works fine and I haven’t got any errors so far.</p>
<p>The problem last time was that I didn’t create the ‘proc’ group.</p>
<p>What package could this be added to?</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T22:49:35Z' class='post-time'>
                May 5, 2019, 10:49pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T22:49:35Z'>
          <span itemprop='position'>#24</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="23" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Make /etc/systemd/system/systemd-logind.service.d/hidepid.conf and add</p>
</blockquote>
</aside>
<p>The nitpick first before addressing the actual real and hard question:</p>
<p>should be <code>/lib/systemd/system/</code> instead as per<br>
<a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/About_Debian_Packaging#Modifying_Default_Configuration_of_Third_Party_Packages" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/About_Debian_Packaging#Modifying_Default_Configuration_of_Third_Party_Packages</a></p>
<aside class="quote no-group" data-post="23" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>What package could this be added to?</p>
</blockquote>
</aside>
<p>Good question, next question.</p>
<p>Non-Qubes-Whonix: file owned by nobody, created by grml-debootstrap at image creation and then left alone.</p>
<p>Qubes-Whonix: as per Qubes default:</p>
<pre><code>dpkg -S /etc/fstab
</code></pre>
<blockquote>
<p>qubes-core-agent: /etc/fstab</p>
</blockquote>
<p>The Qubes version is much different.</p>
<p>So this would require a new package which get installed in Non-Qubes-Whonix only to avoid package conflict. (And Qubes would require a separate issue and pull request [which is optional].) We don’t have such a package yet.</p>
<p>I am not sure if by introducing such a package we might break user customization for people who modified /etc/fstab but probably not and for Whonix 15 upgrade this is ok (and still in time).</p>
<p>Any naming suggestion for such a package? It’s not just <code>hidepid</code>, perhaps later other fstab hardening? It’s general security also, not hardcoded for Whonix.</p>
<p>Can we use <code>/etc/fstab.d</code> rather than <code>/etc/fstab</code> while we are at it? <code>/etc/fstab</code> would be really bad since it has to be complete which then might make it (Whonix|hardended debian) VM specific.</p>
<p><code>/etc/fstab.d</code> would be super helpful if we could just harden/reconfigure <code>/proc</code> rather than shipping a complete <code>/etc/fstab</code>. (Then probably even Qubes compatible.) In that case we could even add this to <code>security-misc</code> package too.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T23:04:49Z' class='post-time'>
                May 5, 2019, 11:04pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T23:04:49Z'>
          <span itemprop='position'>#25</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="24" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>should be <code>/lib/systemd/system/</code> instead as per<br>
<a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/About_Debian_Packaging#Modifying_Default_Configuration_of_Third_Party_Packages" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/About_Debian_Packaging#Modifying_Default_Configuration_of_Third_Party_Packages</a></p>
</blockquote>
</aside>
<p>I don’t think this really matters. Both should work fine.</p>
<aside class="quote no-group" data-post="24" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Any naming suggestion for such a package? It’s not just <code>hidepid</code> , perhaps later other fstab hardening? It’s general security also, not hardcoded for Whonix.</p>
</blockquote>
</aside>
<p>fstab hardening would be a good name for it. It could also be used to set different mount options for different file systems like nosuid, nodev or noexec.</p>
<aside class="quote no-group" data-post="24" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Can we use <code>/etc/fstab.d</code> rather than <code>/etc/fstab</code> while we are at it? <code>/etc/fstab</code> would be really bad since it has to be complete which then might make it (Whonix|hardended debian) VM specific.</p>
</blockquote>
</aside>
<p>I haven’t ever heard of a /etc/fstab.d. It seems that support for it was abandoned.</p>
<p><a href="../../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=663623" class="onebox" target="_blank" rel="nofollow noopener">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=663623</a></p>
<p>Maybe we could ask them to see if they’ll ever bring support for it back?</p>
<p>A quick and dirty method would be</p>
<pre><code>sed -i 's/proc/#proc/' /etc/fstab; echo "proc /proc proc    nosuid,nodev,noexec,hidepid=2,gid=proc 0 0" &gt;&gt; /etc/fstab 
</code></pre>
<p>This is terrible though and should only be used as a last resort.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T23:18:23Z' class='post-time'>
                May 5, 2019, 11:18pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T23:18:23Z'>
          <span itemprop='position'>#26</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="25" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Maybe we could ask them to see if they’ll ever bring support for it back?</p>
</blockquote>
</aside>
<p>Yes, please.</p>
<aside class="quote no-group" data-post="25" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>This is terrible though and should only be used as a last resort.</p>
</blockquote>
</aside>
<p>Indeed. (There is also config-package-dev transform but only slightly less terrible, I guess.)</p>
<p>Alternative much better idea in theory <span class="hashtag">#1:</span><br>
systemd unit file (that runs very early after fstab processing) which uses mount (remount) on /proc if that is possible? That could be part of security-misc package. Only remounts /proc for start (perhaps later more). Name of systemd unit file: <code>security-misc-early.service</code>? Automatically Qubes compatible / working in Qubes too, working on all supported platforms actually.</p>
<p>Alternative much better idea in theory <span class="hashtag">#2:</span><br>
Also a search for <code>systemd fstab</code> looks like systemd does a lot related to fstab. If above does not work, perhaps there would be any useful hook to overwrite what is written in /etc/fstab so we don’t have to touch that file.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-05T23:39:35Z' class='post-time'>
                May 5, 2019, 11:39pm
              </time>
              <meta itemprop='dateModified' content='2019-05-05T23:44:15Z'>
          <span itemprop='position'>#27</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="26" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Yes, please.</p>
</blockquote>
</aside>
<p>Will I file a bug report?</p>
<aside class="quote no-group" data-post="26" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Alternative much better idea in theory <span class="hashtag">#1:</span><br>
systemd unit file (that runs very early after fstab processing) which uses mount (remount) on /proc if that is possible? That could be part of security-misc package. Only remounts /proc for start (perhaps later more). Name of systemd unit file: <code>security-misc-early.service</code> ? Automatically Qubes compatible / working in Qubes too, working on all supported platforms actually.</p>
</blockquote>
</aside>
<p>That sounds not too bad. We could make it run a bash script that can even configure other directories. It could be confusing for people trying to change their mount options though.</p>
<aside class="quote no-group" data-post="26" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Alternative much better idea in theory <span class="hashtag">#2:</span><br>
Also a search for <code>systemd fstab</code> looks like systemd does a lot related to fstab. If above does not work, perhaps there would be any useful hook to overwrite what is written in /etc/fstab so we don’t have to touch that file.</p>
</blockquote>
</aside>
<p>I’ll look into this and see what I can find.</p>
<p>Alternative much better idea in theory <span class="hashtag">#3:</span><br>
Use a systemd .mount file. You seem to configure it just like a systemd service. Configure /proc and add <code>Options=nosuid,nodev,noexec,hidepid=2,gid=proc</code>. I don’t know much about these though. See:</p>
<p><a href="../../../../external.html?link=https://www.freedesktop.org/software/systemd/man/systemd.mount.html" class="onebox" target="_blank" rel="nofollow noopener">https://www.freedesktop.org/software/systemd/man/systemd.mount.html</a></p>
<p>Edit: This seems like a good guide for <span class="hashtag">#3</span></p>
<p><a href="../../../../external.html?link=https://oguya.ch/posts/2015-09-01-systemd-mount-partition/" class="onebox" target="_blank" rel="nofollow noopener">https://oguya.ch/posts/2015-09-01-systemd-mount-partition/</a></p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-06T00:45:31Z' class='post-time'>
                May 6, 2019, 12:45am
              </time>
              <meta itemprop='dateModified' content='2019-05-06T00:45:31Z'>
          <span itemprop='position'>#28</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Also, there are more sysctl changes that’d be good to add.</p>
<p>Setting “kernel.kexec_load_disabled=1” will disable kexec which can be used to replace the running kernel.</p>
<p>Setting “net.ipv4.tcp_rfc1337=1” protects against time-wait assassination. It drops RST packets for sockets in the time-wait state.</p>
<p>Setting "net.ipv4.conf.default.rp_filter=1 and “net.ipv4.conf.all.rp_filter=1” enables source validation of packets and protects against IP spoofing methods in which an attacker can send a packet with a fake IP address.</p>
<p>Setting</p>
<pre><code>net.ipv4.conf.all.accept_redirects=0
net.ipv4.conf.default.accept_redirects=0
net.ipv4.conf.all.secure_redirects=0
net.ipv4.conf.default.secure_redirects=0
net.ipv6.conf.all.accept_redirects=0
net.ipv6.conf.default.accept_redirects=0  
</code></pre>
<p>disables ICMP redirect acceptance. If these aren’t set then an attacker can redirect an ICMP request to wherever they want.</p>
<p>Setting “net.ipv4.conf.all.send_redirects=0” and “net.ipv4.conf.default.send_redirects=0” disable ICMP redirect sending.</p>
<p>Setting “net.ipv4.icmp_echo_ignore_all=1” makes your system ignore ICMP requests.</p>
<p>Setting “kernel.yama.ptrace_scope=2” restricts the use of ptrace to root. Ptrace allows a program to alter and inspect a running process.</p>
<p>Should I add these to the pull request?</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7296.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-05-06T02:15:48Z' class='post-time'>
                May 6, 2019,  2:15am
              </time>
              <meta itemprop='dateModified' content='2019-05-06T02:15:48Z'>
          <span itemprop='position'>#29</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="27" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Will I file a bug report?</p>
</blockquote>
</aside>
<p>Yes, that would be great!</p>
<aside class="quote no-group" data-post="27" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>That sounds not too bad. We could make it run a bash script that can even configure other directories. It could be confusing for people trying to change their mount options though.</p>
</blockquote>
</aside>
<p>Indeed and it could even be made configurable.</p>
<aside class="quote no-group" data-post="27" data-topic="7296">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Alternative much better idea in theory <span class="hashtag">#3:</span></p>
</blockquote>
</aside>
<p>If that works, that would be the most appropriate tool for the task. Ideally (and quite likely supported by systemd), a drop-in configuration snippet.</p>
        </div>

        <meta itemprop='headline' content='Kernel Hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><b><a rel="next" itemprop="url" href="../72964658.html?page=2">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
