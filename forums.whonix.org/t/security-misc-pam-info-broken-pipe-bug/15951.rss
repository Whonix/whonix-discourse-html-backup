<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>security-misc pam-info broken pipe bug</title>
    <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951</link>
    <description>Clean Kicksecure morphed to Debian, on the login screen I see:

`/usr/libexec/security-misc/pam-info: line 91: echo: write error: Broken pipe`.

Happens when closing the lid without locking the screen first.

https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L78
https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L91</description>
    <language>en</language>
    <lastBuildDate>Wed, 16 Nov 2022 14:29:52 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>(But there have been a number of commits. Not only that one.)</p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/11</link>
        <pubDate>Wed, 16 Nov 2022 14:29:52 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-11</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Yes.</p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/10</link>
        <pubDate>Wed, 16 Nov 2022 14:29:21 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-10</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[grass]]></dc:creator>
        <description><![CDATA[
            <p>Is this the last commit from 7h ago?<br>
<a href="https://github.com/Kicksecure/security-misc/commit/09e6af5c080f776d56d7e2390f88c4ae7e01bdb7" rel="noopener nofollow ugc">09e6af5c080f776d56d7e2390f88c4ae7e01bdb7</a></p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/9</link>
        <pubDate>Wed, 16 Nov 2022 14:04:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-9</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I cannot reproduce this bash error when I copy/paste that. Perhaps some invisible character such as a tab.</p>
<p>However that might be, I refactored above script. Using a different method to get the first line now. Could you try please?</p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/8</link>
        <pubDate>Wed, 16 Nov 2022 13:59:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-8</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[grass]]></dc:creator>
        <description><![CDATA[
            <pre><code class="lang-auto">++ grep accessfile=/etc/security/access-security-misc.conf /etc/pam.d/common-acc
ount
+ grep_result=
+ '[' '!' '' = '' ']'
++ id -u
+ '[' '!' 0 = 0 ']'
++ faillock --user user
+ pam_faillock_output='user:
When                Type  Source                                           Valid
'
+ '[' 'user:
When                Type  Source                                           Valid
' = '' ']'
++ head -1
++ echo 'user:
When                Type  Source                                           Valid
'
/usr/libexec/security-misc/pam-info: line 97: echo: write error: Broken pipe
+ pam_faillock_output_first_line=user:
++ LANG=C
++ str_replace : ''
++ echo user:
+ user_name=user
++ echo 'user:
When                Type  Source                                           Valid'
++ wc -l
+ pam_faillock_output_count=2
+ failed_login_counter=0
+ '[' '!' user = user ']'
+ '[' 0 = 0 ']'
+ true '/usr/libexec/security-misc/pam-info: INFO: Failed login counter is 0, ok.'
+ exit 0
</code></pre>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/7</link>
        <pubDate>Tue, 15 Nov 2022 20:45:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-7</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Added a debug option to the script just now:</p>
<aside class="onebox githubblob" data-onebox-src="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info" target="_blank" rel="noopener">Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info</a></h4>


      <pre><code class="lang-">#!/bin/bash

## Copyright (C) 2019 - 2022 ENCRYPTED SUPPORT LP &lt;adrelanos@whonix.org&gt;
## See the file COPYING for copying conditions.

## To enable debug log, run:
## /etc/pam-info-debug
##
## Debug log if enabled can be found in file:
## /root/pam-info-debug.txt

true "$0: START PHASE 1"

if test -f /etc/pam-info-debug || test -f /usr/local/etc/pam-info-debug ; then
   set -x
   exec 5&gt;&amp;1 1&gt;&gt; ~/pam-info-debug.txt
   exec 6&gt;&amp;2 2&gt;&gt; ~/pam-info-debug.txt
fi

true "$0: START PHASE 2"
</code></pre>



  This file has been truncated. <a href="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info" target="_blank" rel="noopener">show original</a>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<hr>
<p>May or may not be related:</p>
<aside class="quote" data-post="1" data-topic="15950">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/b19c9b/40.png" class="avatar">
    <a href="https://forums.whonix.org/t/line-78-faillock-command-not-found-anyone-got-any-ideas/15950">"line 78 faillock: command not found" anyone got any ideas?</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/support/5"><span class="badge-category-bg" style="background-color: #8C6238;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="User support for the Whonix operating system. (devs)">Support</span></a>
  </div>
  <blockquote>
    I upgraded whonix from terminal and now I can not start the workstation. 
Gateway starts fine, but workstation starts with username and password (which it has never asked for before). 
Any ideas on how to fix this would be greatly appreciated. 
I have tried user and changeme, but it does not seem to work. 
See picture here:
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/6</link>
        <pubDate>Tue, 15 Nov 2022 17:43:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-6</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Iâ€™ll be adding more debug information to the script.</p>
<aside class="quote no-group" data-username="grass" data-post="3" data-topic="15951">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/g/96bed5/40.png" class="avatar"> grass:</div>
<blockquote>
<p>Solely <code>kicksecure-cli-host</code></p>
</blockquote>
</aside>
<p>Ok.</p>
<aside class="quote no-group" data-username="grass" data-post="3" data-topic="15951">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/g/96bed5/40.png" class="avatar"> grass:</div>
<blockquote>
<p>Perhaps <code>kicksecure-xfce-host</code> is required?</p>
</blockquote>
</aside>
<p>Nope. If it was, that would be confusing and a bug.</p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/5</link>
        <pubDate>Tue, 15 Nov 2022 16:59:14 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-5</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[grass]]></dc:creator>
        <description><![CDATA[
            <p>please change name from <code>pip</code> to <code>pipe</code> for search reasons.<br>
Canâ€™t edit anymore.</p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/4</link>
        <pubDate>Tue, 15 Nov 2022 16:34:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-4</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[grass]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="15951">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>The only bad effect so far is the textual output (which is considered a bug)?<br>
But login otherwise functional?</p>
</blockquote>
</aside>
<p>Yes and yes.</p>
<aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="15951">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Is faillock installed? To check:</p>
</blockquote>
</aside>
<p>Yes, installed.</p>
<p>/usr/sbin/faillock.</p>
<aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="15951">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Which Kicksecure meta package did you install?</p>
</blockquote>
</aside>
<p>Solely <code>kicksecure-cli-host</code></p>
<p>Perhaps <code>kicksecure-xfce-host</code> is required?</p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/3</link>
        <pubDate>Tue, 15 Nov 2022 15:46:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-3</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>The only bad effect so far is the textual output (which is considered a bug)?<br>
But login otherwise functional?</p>
<p>I wonder how this can happen.</p>
<p>Is faillock installed? To check:</p>
<pre><code>sudo which faillock
</code></pre>
<aside class="quote no-group" data-username="grass" data-post="1" data-topic="15951">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/g/96bed5/40.png" class="avatar"> grass:</div>
<blockquote>
<p>Clean Kicksecure morphed to Debian,</p>
</blockquote>
</aside>
<p>Which Kicksecure meta package did you install?</p>
          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/2</link>
        <pubDate>Tue, 15 Nov 2022 15:39:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-2</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
      <item>
        <title>security-misc pam-info broken pipe bug</title>
        <dc:creator><![CDATA[grass]]></dc:creator>
        <description><![CDATA[
            <p>Clean Kicksecure morphed to Debian, on the login screen I see:</p>
<p><code>/usr/libexec/security-misc/pam-info: line 91: echo: write error: Broken pipe</code>.</p>
<p>Happens when closing the lid without locking the screen first.</p>
<aside class="onebox githubblob" data-onebox-src="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L78">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L78" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L78" target="_blank" rel="noopener nofollow ugc">Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L78</a></h4>



    <pre class="onebox">      <code class="lang-">
        <ol class="start lines" start="68" style="counter-reset: li-counter 67 ;">
            <li>#          echo "$0: ERROR: This is because /etc/securetty is empty." &gt;&amp;2</li>
            <li>#          echo "$0: See also:" &gt;&amp;2</li>
            <li>#          echo "https://www.kicksecure.com/wiki/root#login" &gt;&amp;2</li>
            <li>#          echo "" &gt;&amp;2</li>
            <li>#          exit 0</li>
            <li>#       fi</li>
            <li>#    fi</li>
            <li># fi</li>
            <li>
            </li><li>## Using || true to not break read-only disk boot without ro-mode-init or grub-live.</li>
            <li class="selected">pam_faillock_output="$(faillock --user "$PAM_USER")" || true</li>
            <li>
            </li><li>if [ "$pam_faillock_output" = "" ]; then</li>
            <li>   true "$0: no failed login"</li>
            <li>   exit 0</li>
            <li>fi</li>
            <li>
            </li><li>## Example:</li>
            <li>## user:</li>
            <li>## When                Type  Source                                           Valid</li>
            <li>## 2021-08-10 16:26:33 RHOST                                                      V</li>
        </ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<aside class="onebox githubblob" data-onebox-src="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L91">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L91" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L91" target="_blank" rel="noopener nofollow ugc">Kicksecure/security-misc/blob/master/usr/libexec/security-misc/pam-info#L91</a></h4>



    <pre class="onebox">      <code class="lang-">
        <ol class="start lines" start="81" style="counter-reset: li-counter 80 ;">
            <li>   true "$0: no failed login"</li>
            <li>   exit 0</li>
            <li>fi</li>
            <li>
            </li><li>## Example:</li>
            <li>## user:</li>
            <li>## When                Type  Source                                           Valid</li>
            <li>## 2021-08-10 16:26:33 RHOST                                                      V</li>
            <li>## 2021-08-10 16:26:54 RHOST                                                      V</li>
            <li>
            </li><li class="selected">pam_faillock_output_first_line="$(echo "$pam_faillock_output" | head -1)"</li>
            <li>user_name="$(echo "$pam_faillock_output_first_line" | LANG=C str_replace ":" "")"</li>
            <li>
            </li><li>pam_faillock_output_count="$(echo "$pam_faillock_output" | wc -l)"</li>
            <li>
            </li><li>failed_login_counter=$(( pam_faillock_output_count - 2 ))</li>
            <li>
            </li><li>if [ ! "$PAM_USER" = "$user_name" ]; then</li>
            <li>   echo "$0: ERROR: PAM_USER: '$PAM_USER' does not equal user_name: '$user_name'." &gt;&amp;2</li>
            <li>   echo "$0: ERROR: Please report this bug." &gt;&amp;2</li>
            <li>   echo "" &gt;&amp;2</li>
        </ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951/1</link>
        <pubDate>Mon, 14 Nov 2022 12:03:12 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15951-1</guid>
        <source url="http://forums.whonix.org/t/security-misc-pam-info-broken-pipe-bug/15951.rss">security-misc pam-info broken pipe bug</source>
      </item>
  </channel>
</rss>
