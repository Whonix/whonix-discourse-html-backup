<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
    <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787</link>
    <description>If /home is mounted with noexec in the future, the Tor Browser will not be able to run as the files are stored in /home/user/.tb/.

Because of this, there needs to be a new place for it to go.

See
https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/

----

Edit by Patrick:

This is solved.

https://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/23</description>
    <language>en</language>
    <lastBuildDate>Sat, 07 Dec 2019 07:45:22 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://github.com/Whonix/apparmor-profile-everything">apparmor-profile-everything</a> can give fine-grained execute permissions and already does for /home. It only allows the user to execute <code>/home/*/.tb/tor-browser/Browser/{,start-tor-browser,firefox}</code> and write permission for <code>.tb/tor-browser/</code> is denied (so an attacker can’t overwrite those files).</p>
<p>Any other things TB needs to execute is handled by apparmor-profile-torbrowser (which is a dependency).</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/23">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/23</link>
        <pubDate>Fri, 06 Dec 2019 19:25:28 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-23</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Since <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/18" class="inline-onebox">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> was recently implemented… (And after the recent firejail controversy in thread <a href="https://forums.whonix.org/t/tor-browser-hardening-hardened-malloc-firejail-apparmor-vs-web-fingerprint/7851" class="inline-onebox">Tor Browser Hardening (hardened malloc, firejail, apparmor) vs Web Fingerprint</a> …) Any idea ideas for this issue?</p>
<p>Remounting <code>/home/user/.tb</code> with <code>exec</code> (rather than <code>noexec</code>) for Tor Browser is possible. I am experimenting successfully wit that in Qubes-Whonix DispVM already. But remounting <code>/home/user/.tb</code> with <code>exec</code> or “don’t use Tor Browser anymore”, i.e. pick one "<code>noexec</code> or Tor Browser" isn’t a great solution.</p>
<p>That threat model I am having in mind here is an attacker who reached local code execution who would be blocked from exploiting from user to root or kernel thanks to <code>noexec</code>. This currently can be circumvented in a target attack:<br>
(A script, not program, but easily reproducible to make the point.)</p>
<p>file <code>/home/user/.tb/evil-program</code></p>
<pre><code>#!/bin/bash
echo "evil program"
</code></pre>
<p><code>chmod +x /home/user/.tb/evil-program</code></p>
<p>run</p>
<pre><code>/home/user/.tb/evil-program
</code></pre>
<p>I would like to somehow restrict that not "all of user <code>user</code>" can create and run executable in folder <code>/home/user/.tb</code>.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/22">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/22</link>
        <pubDate>Fri, 06 Dec 2019 18:09:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-22</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[iamwho]]></dc:creator>
        <description><![CDATA[
            <p>Firejail can make something noexec but it shouldn’t be able to make something exec again*. Which means Browser must start off exec. Should it be read-only before login, or is it enough to be read-only to the sandboxed Browser itself?</p>
<p>*Except it can. Just playing around, with noexec bind mount on browser/data,</p>
<pre><code class="lang-auto">user@host:~$ ./browser/data/ok
bash: ./browser/data/ok: Permission denied
user@host:~$ firejail --quiet --overlay-tmpfs ./browser/data/ok
ok</code></pre>
<p>The filesystem is sandboxed now but firejail --overlay-tmpfs ignores the bind mounts completely. Actually it ignores regular mounts too. I guess it does something like a bind mount on / instead of an rbind. (It also doesn’t stack, which may be an issue if one sandboxed application wants to launch another one.)</p>
<p>Maybe Tor Browser could be run normally with a disposable overlay, whitelisting Downloads etc.<br>
If you’re running in the default private mode then maybe you don’t want anything else to stick around anyway.<br>
Unfortunately user settings changed through the browser are stored in prefs.js, along with other settings. But they can be manually pulled out and set in user.js, and probably not changed much. But this might be too much for a normal user.<br>
Bookmarks unfortunately are in places.sqlite which is rather opaque. They might be rewritten into tracking redirects or proxies with typo or homographic domains. Apparently browser.places.importBookmarksHTML and browser.bookmarks.autoExportHTML allow usage of plain html but I haven’t tried.<br>
Search engines are in a mozlz4 file to prevent tampering by malware, ironically making it very difficult for a user to detect tampering.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/21">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/21</link>
        <pubDate>Fri, 13 Sep 2019 10:14:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-21</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick_mobile]]></dc:creator>
        <description><![CDATA[
            <p>Perhaps just different command line switches?</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/20">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/20</link>
        <pubDate>Thu, 12 Sep 2019 04:58:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-20</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="18" data-topic="7787" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Firejail is cool but for firejail setting readonly we’d need two different fir jail profiles. One without Tor Browser internal updater allowed and one with.</p>
</blockquote>
</aside>
<p>I don’t see why that would be much of a problem.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/19">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/19</link>
        <pubDate>Wed, 11 Sep 2019 19:52:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-19</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick_mobile]]></dc:creator>
        <description><![CDATA[
            <p>Firejail is cool but for firejail setting readonly we’d need two different firejail profiles. One without Tor Browser internal updater allowed and one with.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/18">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/18</link>
        <pubDate>Wed, 11 Sep 2019 19:40:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-18</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>Instead of messing with our own mounts, why not use Firejail’s <code>noexec</code> option?</p>
<p>As per <a href="https://firejail.wordpress.com/features-3/man-firejail-profile/" rel="nofollow noopener">https://firejail.wordpress.com/features-3/man-firejail-profile/</a></p>
<blockquote>
<pre><code>noexec file_or_directory
          Remount the file or the directory noexec, nodev and nosuid.
</code></pre>
</blockquote>
<p>Mounting files read-only can be done with the <code>read-only</code> option.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/17">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/17</link>
        <pubDate>Wed, 11 Sep 2019 19:20:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-17</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="15" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>I mean running two profiles with separate identities at the same time without having to copy the entire Browser directory, only profile.</p>
</blockquote>
</aside>
<p>Changing any folders can break MAC (apparmor, firejail).</p>
<aside class="quote no-group" data-post="15" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Are you intending them both to be used on the same boot?</p>
</blockquote>
</aside>
<p>Possibly most users would do that, yes.</p>
<p>Tor Browser started  security restricted ([A] with ro,nosuid,nodev executable files and rw browser profile) -&gt; get exploited -&gt; MAC confines it into its folder -&gt; modified firefox binary -&gt; terminated -&gt; later restarted using [B] (internal updater allowed) -&gt; browser updated, still compromised. Gained little except nosuid,nodev. Maybe breaking some malware requiring exec inside browser binary folder.</p>
<p>Maybe before starting the browser using [A] it could run <a href="https://www.whonix.org/wiki/Dev/VirusForget" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/VirusForget</a> to checksum the browser binary folder. On any startup, all changes to any files in browser binary folder are undone and only changes in user profile folder are kept. That would make exploits harder. Malware could no longer persist in browser binary folder. But malware could persist in browser profile folder perhaps as a malicious browser add-on.</p>
<p>A <a href="https://www.whonix.org/wiki/Dev/VirusForget" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/VirusForget</a> checksum mechanism might also set the browser binary folder immutable. That’s no <code>noexec</code> but the same result as <code>noexec</code>. Perhaps don’t care so much about <code>noexec</code> for Tor Browser folder but just make it non-writeable (as good as <code>noexec</code> - no new binaries since no write access). And the browser profile folder can be <code>noexec</code>. Should be as good as complete <code>noexec</code>.</p>
<aside class="quote no-group" data-post="15" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>(2) Update with no (untrusted) user data and persistent system -&gt; [B] as admin</p>
</blockquote>
</aside>
<p>Sounds nice in theory but in practice can’t work since Tor Browser mixes application data and browser data folder. I.e. some anonymity related settings reside in browser profile folder and need to be updated as well. So by updating while moving the untrusted profile folder out of the way, the update may result in a different web fingerprint.</p>
<aside class="quote no-group" data-post="15" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>A decision for where the Tor Browser folder should be placed.</p>
</blockquote>
</aside>
<p>Folder should stay stay as is unless a strong rationale is provided.<br>
Splitting the folder seems fragile on Tor Browser updates.<br>
Moving to other folders breaks MAC.</p>
<aside class="quote no-group" data-post="15" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>*Important to think about: even if the Browser directory is read-only, if it lives in user home the whole directory may be replaced by malicious user, and then gain exec.</p>
</blockquote>
</aside>
<p>Maybe higher security may be possible for users who are ok to purge their browser profile on each upgrade. I.e. install a new Tor Browser version using tb-updater (should be renamed to tb-downloader) rather than updating using Tor Browser internal updater.</p>
<p>I don’t see any better solution unless things are improved upstream.</p>
<p>We could also say that VMs using Tor Browser shouldn’t be used for anything else due to this mess vs noexec. Always results in lower security level.</p>
<aside class="quote no-group quote-modified" data-post="15" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<blockquote>
<p>[1] Next step: <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> needs to be sorted. Help welcome.</p>
</blockquote>
<p>This thread is based on noexec everything under user control. To be honest I’m not sure what the end result is, since startup scripts, user .desktop files etc are not affected by noexec.</p>
</blockquote>
</aside>
<p>Just the one thing. One thing at a time. <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/" class="inline-onebox">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> is about changing proc-hidepid.service into a more generalized service that gets all mount options enhanced.</p>
<p>startup scripts, user .desktop files are for later work -&gt; <a href="https://www.whonix.org/wiki/Dev/VirusForget" rel="nofollow noopener">https://www.whonix.org/wiki/Dev/VirusForget</a></p>
<p>Not sure yet about <code>noexec</code>.<br>
Since noexec does not block scripts execution… See also<br>
<a href="https://chromium.googlesource.com/chromiumos/docs/+/master/security/noexec_shell_scripts.md" rel="nofollow noopener">https://chromium.googlesource.com/chromiumos/docs/+/master/security/noexec_shell_scripts.md</a><br>
I was considering to contact apparmor / firejail developers to ask if we can get that under control somehow. noexec is also worth its own forum thread.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/16">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/16</link>
        <pubDate>Wed, 11 Sep 2019 18:53:20 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-16</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[iamwho]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="14" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Concurrent use by same user? This works anyhow? Not sure what I am missing?</p>
</blockquote>
</aside>
<p>I mean running two profiles with separate identities at the same time without having to copy the entire Browser directory, only profile.<br>
I am thinking about how to create multiple views of the same directory except with one subdirectory replaced by user data.<br>
I can do it as a regular user on Ubuntu with user namespaces (unshare -m -r bash, mount …) but I guess Whonix is more restrictive.<br>
Maybe it can be done with firejail (it can also unshare mount namespace) but I don’t know much about it yet.<br>
None of this would be necessary if Tor Browser worked with profiles the same way Firefox does, so that would be the ideal solution. Everything else is workaround.</p>
<aside class="quote no-group" data-post="14" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<ul>
<li>[A] Tor Browser (security restricted)</li>
<li>[B] Tor Browser (internal updater allowed)</li>
</ul>
</blockquote>
</aside>
<p>Are you intending them both to be used on the same boot?<br>
The use cases I have in mind are exclusive:<br>
(1) Run normally with persistent user data (separate virtual disk or shared folder) and immutable system -&gt; [A] as user<br>
(2) Update with no (untrusted) user data and persistent system -&gt; [B] as admin<br>
Goal: no persistent compromise.<br>
A separate user makes the difference more obvious and prevents accidental contamination.<br>
But the difference can be enforced by a wrapper on the host that disables one disk before making the other writable.<br>
So updating (2) can be done as the same user as (1) if you are careful and can assume (2) always has clean user (not just root).</p>
<p>I think of files as:<br>
(A) System files the user can’t touch. Persistent changes only in case (2)<br>
(B) Trusted user files (.bashrc, .local/share/applications/*.desktop, browser profile, etc). Can be modified by user but not persist in case (1).<br>
(C ) Persistent untrusted files only visible in case (1).<br>
(D) Everything else, do not exist on boot, never persist.<br>
On a single user machine, particularly something like Whonix, maybe there is not much difference between (A) and (B).<br>
Malicious (B) can compromise user by design, so they must be trusted by user but not root.<br>
Malicious (C ) should require an unpatched vulnerability to cause problems as long as it remains untrusted (an important question is how much software can be trusted to not trust untrusted files). They were copied from somewhere unsafe or might have been created by (hopefully temporary) malware.</p>
<p>Trying to stay on topic here:</p>
<aside class="quote no-group" data-post="14" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What are the different options being proposed? Decision for what?</p>
</blockquote>
</aside>
<p>A decision for where the Tor Browser folder should be placed.<br>
Since Whonix is intended as a single user system, home makes sense. But need to be careful about updating it as user.<br>
*Important to think about: even if the Browser directory is read-only, if it lives in user home the whole directory may be replaced by malicious user, and then gain exec.</p>
<aside class="quote no-group" data-post="14" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><code>remount</code> is required in some situations such as when previous mounted.</p>
</blockquote>
</aside>
<p>It sounds like this old thing<br>
<a href="http://lkml.iu.edu/hypermail/linux/kernel/0110.1/1712.html" class="onebox" target="_blank" rel="nofollow noopener">http://lkml.iu.edu/hypermail/linux/kernel/0110.1/1712.html</a><br>
Kernel dependent? On my Whonix 14 a second mount is required:</p>
<pre><code class="lang-auto">root@host:~# mount -o bind,noexec test test
root@host:~# ./test/ok 
ok
root@host:~# mount -o remount,noexec test test
root@host:~# ./test/ok
-bash: ./test/ok: Permission denied</code></pre>
<aside class="quote no-group" data-post="14" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would you like to contribute this? Great!</p>
</blockquote>
</aside>
<p>There’s a big difference between getting something to work and doing it right. I have experience with the former. Just vague ideas for the latter.</p>
<aside class="quote no-group quote-modified" data-post="12" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>[1] Next step: <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> needs to be sorted. Help welcome.</p>
</blockquote>
</aside>
<p>This thread is based on noexec everything under user control. To be honest I’m not sure what the end result is, since startup scripts, user .desktop files etc are not affected by noexec.</p>
<aside class="quote no-group quote-modified" data-post="12" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>[2] Over next step: /usr/bin/torbrowser remounting Tor Browser folder. This could even be protected by a lxsudo prompt.</p>
</blockquote>
</aside>
<p>I don’t know. See note* above about user control. Also bind mounts are subtle.</p>
<pre><code class="lang-auto">user@host:~$ ./ok
ok
root@host:~# mount -o bind,noexec ~user/ ~user/
user@host:~$ ./ok
ok
user@host:~$ cd
user@host:~$ ./ok
bash: ./ok: Permission denied
user@host:~$</code></pre>
<p>Race conditions to think about too.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/15</link>
        <pubDate>Wed, 11 Sep 2019 13:24:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-15</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Interesting!</p>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>concurrent use</p>
</blockquote>
</aside>
<p>Concurrent use by same user? This works anyhow? Not sure what I am missing?</p>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>a few (harmless?) errors</p>
</blockquote>
</aside>
<p>Hard to say without seeing the errors. I guess generally we shouldn’t do things which make Tor Browser produce errors which Tor Browser otherwise would not produce.</p>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>but it would still access the default profile directory ./Browser/TorBrowser/Data/Browser/profile.default for some reason I never discovered (I think the Torbutton extension).</p>
</blockquote>
</aside>
<p>Upstream bug report?</p>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Then the browser could live in a system directory with a profile in $HOME.</p>
</blockquote>
</aside>
<p>Sounds like fragile when Tor Browser Internal Updater runs. Consult upstream?</p>
<hr>
<p>[idea] There could be two different desktop starters.</p>
<ul>
<li>[A] Tor Browser (security restricted)</li>
<li>[B] Tor Browser (internal updater allowed)</li>
</ul>
<p>Tor Browser folder would come with restrictive mount options by default.</p>
<ul>
<li>application folder, generally: <code>ro,nosuid,nodev</code>
</li>
<li>browser profile folder: <code>rw,nosuid,nodev,noexec</code>
</li>
</ul>
<p>[A] Would just start Tor Browser manually. (And run a script that re-enforced restrictive mount options. That could have a /etc/sudoers.d exception so no user password entry is required.)<br>
[B] Would Mount the application folder <code>ro,nosuid,nodev</code> so internal updater can work. (This would require entering sudo password. [X])</p>
<p>I don’t think we’d need to manipulate Tor Browser folder structure that way? No need to move (<code>mv</code>) folders around`?</p>
<p>What do you think?</p>
<hr>
<p>[X]</p>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>I’m not a fan of sudo in general because even without X sniffing, if the user may be compromised how do I know I’m not running a pseudo sudo?</p>
</blockquote>
</aside>
<p>This is unrelated here.<br>
This is also documented here: [Y] <a href="https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password" rel="nofollow noopener">https://www.whonix.org/wiki/Root#Prevent_Malware_from_Sniffing_the_Root_Password</a></p>
<p>My above [idea] should implement this.</p>
<p>Your sudo related concerns  are valid, but unrelated here and well covered by [Y]? You could still use [Y] to start [B] (Tor Browser (internal updater allowed)).</p>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Better would be a user mount namespace (unshare -f -m -p -U -r)? It might be more complicated but it can be done completely as an unprivileged user.</p>
</blockquote>
</aside>
<p>Don’t know. Didn’t use yet. Still required with my [idea]?</p>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>Strangely the noexec bind mount is system dependent?</p>
</blockquote>
</aside>
<p><code>remount</code> is required in some situations such as when previous mounted.</p>
<hr>
<aside class="quote no-group" data-post="13" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/i/0ea827/40.png" class="avatar"> iamwho:</div>
<blockquote>
<p>I can’t tell if there was a decision made here.</p>
</blockquote>
</aside>
<p>What are the different options being proposed? Decision for what?</p>
<p>Would you like to contribute this? Great!</p>
<p>As per my last post…</p>
<aside class="quote no-group quote-modified" data-post="12" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>[1] Next step: <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> needs to be sorted. Help welcome.</p>
<p>[2] Over next step: /usr/bin/torbrowser remounting Tor Browser folder. This could even be protected by a lxsudo prompt.</p>
</blockquote>
</aside>
<p>Sounds like a good way forward?</p>
<p>Could you start with [1] please and then perhaps [2] if you like to contribute?</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/14</link>
        <pubDate>Wed, 11 Sep 2019 08:18:41 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-14</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[iamwho]]></dc:creator>
        <description><![CDATA[
            <p>I can’t tell if there was a decision made here.</p>
<p>I wrote a script once that would make a copy of a clean profile with settings for using system tor and disabling updates (to allow concurrent use) and run TB with -profile pointing to the new profile.<br>
It seemed to work with a few (harmless?) errors, but it would still access the default profile directory ./Browser/TorBrowser/Data/Browser/profile.default for some reason I never discovered (I think the Torbutton extension).<br>
I could try again with the ./Browser directory itself unwritable by user.<br>
Normally the bundle appears to modify only in directories<br>
Browser/TorBrowser/UpdateInfo (ok with updates off?)<br>
Browser/TorBrowser/Data/Tor/ (ok with system tor?)<br>
Browser/TorBrowser/Data/Browser/profile.default/ (ok with new profile?)<br>
Making that work properly would be ideal (but a job for upstream).<br>
Then the browser could live in a system directory with a profile in $HOME. It would check for updates but they’d be installed by admin.<br>
It would also be convenient to be able to do a quick search in a new profile without having to restart or make a complete copy of TB.</p>
<p>In the mean time, less likely to break anything: bind mount the system browser directory into user home, and then the user settings under that.<br>
I think this allows multiple profiles simultaneously, and the browser shouldn’t notice.</p>
<pre><code class="lang-auto">root@host:~# mount -o bind test ~user/browser1
root@host:~# mount -o bind ~user/data1/ ~user/browser1/data/
root@host:~# mount -o bind test ~user/browser2
root@host:~# mount -o bind ~user/data2/ ~user/browser2/data/
root@host:~# ls -l ~user/browser1
total 4
drwxr-xr-x 2 user user 4096 Sep 11 07:24 data
-rw-r--r-- 1 root root    0 Sep 11 07:23 systemdir
root@host:~# ls -l ~user/browser1/data
total 0
-rw-r--r-- 1 user user 0 Sep 11 07:24 userdata1
root@host:~# ls ~user/browser2
data  systemdir
root@host:~# ls ~user/browser2/data
userdata2
root@host:~#</code></pre>
<p>But you have to mount them in the correct order. If you mount browser2 before data1 both data end up being userdata2. Also browser2/data must be unmounted before browser1 can be unmounted.<br>
It would work best with a fixed set of profiles being mounted somehow on login. I’m not a fan of sudo in general because even without X sniffing, if the user may be compromised how do I know I’m not running a pseudo sudo? It would have to be a specific sudoer rule.<br>
Better would be a user mount namespace (unshare -f -m -p -U -r)? It might be more complicated but it can be done completely as an unprivileged user. (Edit: Operation not permitted on Whonix. Guess not.)</p>
<p>If you want everything owned by user, how about mounting ./Browser read-only and then ./Browser/TorBrowser/Data rw,noexec<br>
Maybe simpler if ./Browser/TorBrowser/Data is a symlink to …/…/$data, so there is only one mount.</p>
<p>Strangely the noexec bind mount is system dependent? On another machine:</p>
<pre><code class="lang-auto">root@host:~# mount -o bind,noexec test test
root@host:~# ./test/ok
ok</code></pre>
<p>But on another this seems to work</p>
<pre><code class="lang-auto">root@host:~# mkdir -p test/rw
root@host:~# mount -o bind,ro test test
root@host:~# mount -o bind,rw,noexec test/rw test/rw
root@host:~# touch test/ok
touch: cannot touch 'test/ok': Read-only file system
root@host:~# echo -e "#\!/bin/bash\necho ok" &gt; test/rw/ok
root@host:~# chmod a+x test/rw/ok
root@host:~# ./test/rw/ok
bash: ./test/rw/ok: Permission denied
root@host:~# umount test/rw
root@host:~# ./test/rw/ok
ok
root@host:~#</code></pre>
<p>The idea is to make every directory writable by user noexec?<br>
Edit: better ideas</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/13</link>
        <pubDate>Wed, 11 Sep 2019 05:26:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-13</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Not an issue at all with our without exec option, I think. Since we can mount a folder on itself at that point we can redefine mount options.</p>
<p>Next step: <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/" class="inline-onebox">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> needs to be sorted. Help welcome.</p>
<p>Over next step: /usr/bin/torbrowser remounting Tor Browser folder. This could even be protected by a lxsudo prompt.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/12</link>
        <pubDate>Fri, 19 Jul 2019 16:04:12 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-12</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="10" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Is there an <code>exec</code> mount option?</p>
</blockquote>
</aside>
<p>There is.</p>
<p><a href="https://linux.die.net/man/8/mount" class="onebox" target="_blank" rel="nofollow noopener">https://linux.die.net/man/8/mount</a></p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/11</link>
        <pubDate>Fri, 19 Jul 2019 15:38:08 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-11</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="8" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But couldn’t make firejail work when Tor Browser was in that folder.</p>
</blockquote>
</aside>
<p>That could be easily fixed with a custom profile.</p>
<aside class="quote no-group" data-post="8" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Maybe we can mount mount /home with noexec but just the Tor Browser folder without noexec?</p>
</blockquote>
</aside>
<p>Is there an <code>exec</code> mount option? If so, we could use that for the Tor Browser folder while mounting the rest of /home with <code>noexec</code>.</p>
<aside class="quote no-group" data-post="9" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Seems not a big deal about Tor Browser then since we can remount to remove noexec when needed?</p>
</blockquote>
</aside>
<p>That sounds good.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/10</link>
        <pubDate>Fri, 19 Jul 2019 15:35:52 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-10</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="8" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Maybe we can mount mount /home with noexec but just the Tor Browser folder without noexec?</p>
</blockquote>
</aside>
<p>Looks not too hard. One can mount a folder onto itself!</p>
<pre><code>sudo mount --bind /home/user/folder-name /home/user/folder-name -o noexec
</code></pre>
<p>Seems not a big deal about Tor Browser then since we can remount to remove noexec when needed?</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/9</link>
        <pubDate>Fri, 19 Jul 2019 15:30:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-9</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Disadvantage of such a non-standard folder: likely mandatory access control frameworks like firejail. Tried to execute Tor Browser from /var/cache/tb-binary in Qubes DispVMs (for non-security reason: so no need to copy to home folder to save startup time). But couldn’t make firejail work when Tor Browser was in that folder. Used <code>mount --bind</code> instead which works with both AppArmor (Qubes using that for years now) and firejail.</p>
<p>Maybe we can mount mount /home with noexec but just the Tor Browser folder without noexec?</p>
<p>(So at some point, there could be a VM config with/without Tor Browser. Those without Tor Browser, more hardened.)</p>
<aside class="quote no-group" data-post="7" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>It’s more likely for something to try to execute malware in the user’s home folder than in the tor browser folder.</p>
</blockquote>
</aside>
<p>We could again get rid of off-the-shelf malware.</p>
<aside class="quote no-group" data-post="7" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Maybe even mount parts of /usr/bin/tor-browser with noexec e.g. /usr/bin/tor-browser/Browser/Downloads.</p>
</blockquote>
</aside>
<p>That sounds good.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/8</link>
        <pubDate>Fri, 19 Jul 2019 15:28:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-8</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="6" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>With or without sub folder?</p>
</blockquote>
</aside>
<p>A sub folder would be best.</p>
<aside class="quote no-group" data-post="6" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>And would we gain actual security benefits? User could not store files in /home/user anymore and make executable (noexec mount option) but then user could write files into <code>/usr/bin/tor-browser</code> folder, make them executable.</p>
</blockquote>
</aside>
<p>It’s more likely for something to try to execute malware in the user’s home folder than in the tor browser folder.</p>
<aside class="quote no-group" data-post="6" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Or can making executable be prevented?</p>
</blockquote>
</aside>
<p>We could probably do some filesystem permissions magic to make that work.</p>
<p>Maybe even mount parts of /usr/bin/tor-browser with noexec e.g. /usr/bin/tor-browser/Browser/Downloads.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/7</link>
        <pubDate>Fri, 19 Jul 2019 15:19:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-7</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="5" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Maybe put everything in /usr/bin? /usr/bin wouldn’t be mounted with noexec anyway.</p>
</blockquote>
</aside>
<p>With or without sub folder?</p>
<p>Contents of tor-browser folder currently are:</p>
<ul>
<li>Browser</li>
<li>start-tor-browser.desktop</li>
</ul>
<p>but these might expand vastly in future if Tor Project restructures.</p>
<p>With sub folder it could be <code>/usr/bin/tor-browser</code> folder(!). I.e. : <code>/usr/bin/torbrowser/start-tor-browser.desktop</code></p>
<p>But that would not be in PATH. But no big deal since users can/should start it using the wrapper <code>/usr/bin/torbrowser</code> anyhow.</p>
<p>Then folder <code>/usr/bin/tor-browser</code> should be owned by user <code>user</code> and profile data would also be stored there?</p>
<p>It would break multi user systems. But likely a sacrifice we could make.</p>
<p>And would we gain actual security benefits? User could not store files in /home/user anymore and make executable (noexec mount option) but then user could write files into <code>/usr/bin/tor-browser</code> folder, make them executable.</p>
<p>Or can making executable be prevented? Maybe. But then that also could break future Tor Browser updates (might ship new executable such as plugin container and whatnot).</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/6</link>
        <pubDate>Fri, 19 Jul 2019 15:11:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-6</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>Oh. So probably not a good idea then.</p>
<p>Maybe put everything in /usr/bin? /usr/bin wouldn’t be mounted with noexec anyway.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/5</link>
        <pubDate>Fri, 19 Jul 2019 15:03:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-5</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="3" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Maybe we could separate the folder into different parts? Like the config files would go into one folder (with noexec) and the executables would go into another (without noexec). I’m not sure if this would break anything though.</p>
</blockquote>
</aside>
<p>It’s fragile since it breaks on folder structure changes by upstream (which happen a lot in past). No prior notification and hard to follow upstream development (limitation of resources). And time of upgrades is also up to upstream only.</p>
<p>Also possibly breaking the updater unless using more trickery (modifying files inside the browser folder).</p>
<p>The root cause of this mess is always the absence of a <code>deb</code> package of Tor Browser.</p>
<ul>
<li><a href="https://trac.torproject.org/projects/tor/ticket/3994" rel="nofollow noopener">https://trac.torproject.org/projects/tor/ticket/3994</a></li>
<li><a href="https://trac.torproject.org/projects/tor/ticket/5236" rel="nofollow noopener">https://trac.torproject.org/projects/tor/ticket/5236</a></li>
</ul>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/4</link>
        <pubDate>Fri, 19 Jul 2019 15:01:25 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-4</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="2" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But then /usr/share needs to be mounted without <code>noexec</code> ?</p>
</blockquote>
</aside>
<p>Maybe we could separate the folder into different parts? Like the config files would go into one folder (with noexec) and the executables would go into another (without noexec). I’m not sure if this would break anything though.</p>
<aside class="quote no-group" data-post="2" data-topic="7787">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Should the folder in /usr/share be owned by a non-root user?</p>
</blockquote>
</aside>
<p>Yes.</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/3</link>
        <pubDate>Fri, 19 Jul 2019 14:57:33 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-3</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="5" data-topic="7707">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"><a href="//forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/5">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a>
</div>
<blockquote>
<p>Maybe /usr/share? I’ll create a new thread.</p>
</blockquote>
</aside>
<p>But then /usr/share needs to be mounted without <code>noexec</code>? Non-ideal? Or not matter since only root can write there?</p>
<p>Note: Tor Browser by upstream (The Tor Project) default mixes executable and user profile data folders into the same folder on the disk. It needs to be owned by a non-root user. Should the folder in /usr/share be owned by a non-root user?</p>
          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/2</link>
        <pubDate>Fri, 19 Jul 2019 14:53:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-2</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
      <item>
        <title>Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>If /home is mounted with noexec in the future, the Tor Browser will not be able to run as the files are stored in /home/user/.tb/.</p>
<p>Because of this, there needs to be a new place for it to go.</p>
<p>See<br>
</p><aside class="quote quote-modified" data-post="1" data-topic="7707">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="https://forums.whonix.org/t/re-mount-home-and-other-with-noexec-and-nosuid-among-other-useful-mount-options-for-better-security/7707/">(re-)mount home [and other?] with noexec (and nosuid [among other useful mount options]) for better security?</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    Could we gain security by mounting home with noexec (and nosuid [among other useful mount options])? 
How does noexec help if one can use 

bash ./script
sh ./script
python ./script

etc.? 
EDIT: bash ./script etc. does not require ./script being executable. It will work on any file even when setting chmod -x ./script beforehand. 
noexec might make most sense when combined with all the other stuff form Related below tin this post? 
lynis even recommended to prevent access to compilers such as gc…
  </blockquote>
</aside>
<p></p>
<hr>
<p>Edit by Patrick:</p>
<p>This is solved.</p>
<aside class="quote" data-post="23" data-topic="7787">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar">
    <a href="https://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/23">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    <a href="https://github.com/Whonix/apparmor-profile-everything">apparmor-profile-everything</a> can give fine-grained execute permissions and already does for /home. It only allows the user to execute /home/*/.tb/tor-browser/Browser/{,start-tor-browser,firefox} and write permission for .tb/tor-browser/ is denied (so an attacker can’t overwrite those files). 
Any other things TB needs to execute is handled by apparmor-profile-torbrowser (which is a dependency).
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787/1</link>
        <pubDate>Fri, 19 Jul 2019 14:45:08 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7787-1</guid>
        <source url="http://forums.whonix.org/t/tor-browser-vs-noexec-where-should-the-tor-browser-folder-be-placed/7787.rss">Tor Browser vs NOEXEC - Where should the Tor Browser folder be placed?</source>
      </item>
  </channel>
</rss>
