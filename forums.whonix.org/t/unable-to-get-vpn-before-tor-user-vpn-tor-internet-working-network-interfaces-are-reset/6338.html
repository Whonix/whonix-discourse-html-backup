<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset - Support - Whonix Forum</title>
    <meta name="description" content="Hello everyone. 
I have some slight trouble getting Whonix with ‚ÄúVPN Before Tor‚Äù (User -&amp;gt; VPN -&amp;gt; Tor -&amp;gt; Internet) working. 
I have followed this guide https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor ex&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="6338.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset&#39;" href="6338.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/unable-to-get-vpn-before-tor-user-vpn-tor-internet-working-network-interfaces-are-reset/6338" />
<meta name="twitter:url" content="https://forums.whonix.org/t/unable-to-get-vpn-before-tor-user-vpn-tor-internet-working-network-interfaces-are-reset/6338" />
<meta property="og:title" content="Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset" />
<meta name="twitter:title" content="Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset" />
<meta property="og:description" content="Hello everyone.  I have some slight trouble getting Whonix with ‚ÄúVPN Before Tor‚Äù (User -&gt; VPN -&gt; Tor -&gt; Internet) working.  I have followed this guide https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor exactly.  My setup is:  Whonix workstation -&gt; Whonix gateway -&gt; Internet.  I am using TUNNEL_FIREWALL inside the Whonix gateway.  And it works.  However, not for long.  The Whonix gateway starts up and I can see from ifconfig it creates the tun0 interface, gets an IP, there are no ..." />
<meta name="twitter:description" content="Hello everyone.  I have some slight trouble getting Whonix with ‚ÄúVPN Before Tor‚Äù (User -&gt; VPN -&gt; Tor -&gt; Internet) working.  I have followed this guide https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor exactly.  My setup is:  Whonix workstation -&gt; Whonix gateway -&gt; Internet.  I am using TUNNEL_FIREWALL inside the Whonix gateway.  And it works.  However, not for long.  The Whonix gateway starts up and I can see from ifconfig it creates the tun0 interface, gets an IP, there are no ..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="16 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="26 ‚ù§" />
<meta property="article:published_time" content="2018-11-17T08:34:26+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="next" href="63384658.html?page=2">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="6338.html">Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/support/5.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #8C6238'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Support</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-17T08:34:26Z' class='post-time'>
                November 17, 2018,  8:34am
              </time>
              <meta itemprop='dateModified' content='2018-11-17T09:12:10Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hello everyone.</p>
<p>I have some slight trouble getting Whonix with ‚ÄúVPN Before Tor‚Äù (User -&gt; VPN -&gt; Tor -&gt; Internet) working.</p>
<p>I have followed this guide <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor" rel="nofollow noopener">https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor</a> exactly.</p>
<p>My setup is:</p>
<p>Whonix workstation -&gt; Whonix gateway -&gt; Internet.</p>
<p>I am using TUNNEL_FIREWALL inside the Whonix gateway.<br>
And it works.</p>
<p>However, not for long.</p>
<p>The Whonix gateway starts up and I can see from ifconfig it creates the tun0 interface, gets an IP, there are no errors, this uses the openvpn@openvpn service.</p>
<p>It then connects to Tor with the tor@default service, again this is fine, no errors.</p>
<p>However then, after perhaps 120 to 240 seconds, I can see this:</p>
<p>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>When I see this, at the exact same time, the connection on the Whonix workstation goes down.</p>
<p>The above messages (pcnet32 ‚Ä¶) seem to be similar to what would happen, if you unplugged the network cable and plugged it back in.</p>
<p>However I cannot find any errors, not in the openvpn log, not in the tor log, not in dmesg, ifconfig also seems fine.</p>
<p>I mean, I can see that it can no longer connect in journalctl -xe, both openvpn and tor are unable to connect. But there is nothing in the logs to indicate why the problem occurred, why was the network on eth0 and eth1 reset?</p>
<p>Doing systemctl restart tor@default and systemctl restart openvpn@openvpn restores the connection, but it doesn‚Äôt take long before this happens again, that the connection dies. So it is not usable as it is now.</p>
<p>I am at a loss for what I should do about this. I have tried reinstalling. I am following the guide exactly.</p>
<p>I‚Äôm using Virtualbox, and I have several other virtual machines that have no network problems.</p>
<p>Any help in debugging this?</p>
<p>Addition:</p>
<p>I did some debugging myself. Still no solution, but perhaps an experienced Whonix user can pinpoint the problem?</p>
<p>If I let it boot, and then immediately run whonixcheck, it tries to do timesync, which it reports as:<br>
‚ÄúTimesync status: not done‚Äù</p>
<p>This repeats, for around 120 seconds, and then just as it says ‚ÄúWhonixcheck gave up waiting‚Äù, the network interfaces are reset, as mentioned above.</p>
<p>The curious part is, that from the Whonix workstation, as I mentioned, everything works fine.</p>
<p>Can I just disable sdwdate? Is that safe? What should I do?</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/0brand'><span itemprop='name'>0brand</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-17T11:16:59Z' class='post-time'>
                November 17, 2018, 11:16am
              </time>
              <meta itemprop='dateModified' content='2018-11-17T11:16:59Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hi <code>rob75</code></p>
<p>I‚Äôm not sure this is a Whonix issue.</p>
<p>Could you please configure your VPN in a Debina virtual machine. Do you have problems with the same issue? (<a href="../../../external.html?link=https://whonix.org/wiki/Troubleshooting#Whonix_Network_Connectivity_Problems">Rational</a>)</p>
<aside class="quote no-group" data-post="1" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>Can I just disable sdwdate? Is that safe? What should I do?</p>
</blockquote>
</aside>
<p>No. <a href="../../../external.html?link=https://whonix.org/wiki/Sdwdate">sdwdate</a> is very important for keeping time.</p>
<p>Its likely sdwdate is not able to time sync because of the connection issue. In other words ,VPN issue is not because of sdwdate.On another note, I don‚Äôt think this is the problem but it would be a good idea just to check if your system keeps the correct time.</p>
<p><a href="../../../external.html?link=https://whonix.orgwiki/Troubleshooting#Clock_Fix">https://whonix.orgwiki/Troubleshooting#Clock_Fix</a></p>
<p>You can use this site for the accurate time</p>
<p><a href="../../../external.html?link=https://timeanddate.com/worldclock/timezone/utc">https://timeanddate.com/worldclock/timezone/utc</a></p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-17T11:55:57Z' class='post-time'>
                November 17, 2018, 11:55am
              </time>
              <meta itemprop='dateModified' content='2018-11-17T11:55:57Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks for the help.</p>
<p>Yes, the VPN works fine, both on the host machine and in a different Debian virtual machine.</p>
<p>I believe this is a Whonix issue.</p>
<p>As I said I do have a functional Internet connection on the Whonix gateway, in the sense that it can route traffic from the Whonix workstation onto the Internet. I get a Tor IP, if VPN goes down, everything goes down. TUNNEL_FIREWALL seems to works as it should.</p>
<p>But then, just because sdwdate fails to run, the Whonix gateway decides to cycle both eth0 and eth1 such that the Internet connection is broken.</p>
<p>This is done by whonixcheck. If I disable both sdwdate AND whonixcheck, it works. This is probably not safe, so I would like a better solution.</p>
<p>How is this related to the VPN?</p>
<p>The clock is accurate. This is not the issue. If it wasn‚Äôt correct I can just set it myself, manually?</p>
<p>As an aside, why isn‚Äôt:</p>
<p>systemctl disable whonixcheck.service sufficient to disable whonixcheck.service?</p>
<p>When I do systemctl status whonixcheck.service right after disabling it, it is still enabled!</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/0brand'><span itemprop='name'>0brand</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-17T22:42:28Z' class='post-time'>
                November 17, 2018, 10:42pm
              </time>
              <meta itemprop='dateModified' content='2018-11-17T22:42:28Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="3" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>systemctl disable whonixcheck.service sufficient to disable whonixcheck.service?</p>
</blockquote>
</aside>
<p>No. To prevent whonixcheck from autostarting.</p>
<p><code>sudo systemctl mask whonixcheck</code></p>
<p><a href="../../../external.html?link=https://whonix.org/wiki/Whonixcheck_Hardening">https://whonix.org/wiki/Whonixcheck_Hardening</a></p>
<p>You can also disable the whonixcheck script .</p>
<p><code>sudo chmod -x /usr/bin/whonixcheck</code></p>
<hr>
<p>Keep in mind sdwdate and whonixcheck are separate from each other. whonixcheck <strong>only</strong> checks system status. It would not be causing your issue.</p>
<p>See: <a href="../../../external.html?link=https://whonix.org/wiki/Whonixcheck#Introduction">https://whonix.org/wiki/Whonixcheck#Introduction</a></p>
<p>You can take a look at sdwdate logs to see if there is anything relevent.</p>
<p><code>tail -f /var/log/sdwdate.log</code></p>
<p>Something else to try is configuring Tor to wait for OpenVPN (end of instructions)? If not already done, can you try that.</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-18T06:42:39Z' class='post-time'>
                November 18, 2018,  6:42am
              </time>
              <meta itemprop='dateModified' content='2018-11-18T06:42:39Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Ok, if I look at the log using tail -f, it waits for:</p>
<p>sdwdate - INFO - Running sdwdate fetch loop. iteration: 1<br>
sdwdate - INFO - Requested URLs {some onion URL}</p>
<p>It waits here for a while.</p>
<p>Then suddenly, there is a lot more in the log as it tries another URL (some other onion URL).</p>
<p>Because then it seems to actually get a connection as it lists times and time_diff, etc.</p>
<p>Then at the end, it reports:</p>
<p>INFO - Success. Sleeping for ‚Ä¶</p>
<p>But then I see this:</p>
<p>/usr/bin/whonix-gateway-firewall - OK: Skipping firewall mode detection since already set to ‚Äòfull‚Äô.<br>
/usr/bin/whonix-gateway-firewall - OK: (Full torified network access allowed.)<br>
/usr/bin/whonix-gateway-firewall - OK: Whonix firewall loaded.<br>
pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>Note that this happens JUST as my Internet connection on the Whonix workstation goes down.</p>
<p>There is probably something about these commands:</p>
<p>/usr/bin/whonix-gateway-firewall<br>
/usr/bin/whonix-gateway-firewall<br>
/usr/bin/whonix-gateway-firewall</p>
<p>They mess up the connection somehow.</p>
<p>It seems to me that sdwdate is broken in a VPN + Tor setup. Because everything works fine without it.</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/0brand'><span itemprop='name'>0brand</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-19T03:08:16Z' class='post-time'>
                November 19, 2018,  3:08am
              </time>
              <meta itemprop='dateModified' content='2018-11-19T03:08:16Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hi <code>rob75</code></p>
<p>I set up a VPN in Whonix-Gateway and had no issues. I used a ‚Äúvanilla‚Äù Gateway with no modifications except for what was needed for VPN setup.</p>
<p>Are you using AppArmor by chance?</p>
<p>I see 2 other threads with <em>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex</em> and they are sdwdate/apparmor related.</p>
<p>Could you try configuring your VPN in a vanilla Whonix-gateway and see if that makes any difference. (if your not already using one)</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-19T03:14:02Z' class='post-time'>
                November 19, 2018,  3:14am
              </time>
              <meta itemprop='dateModified' content='2018-11-19T03:14:02Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I had it running before without the VPN setup just for testing, no issues then.</p>
<p>It seems to be using AppArmor by default. I tried disabling it by systemctl mask, but it doesn‚Äôt change anything.</p>
<p>I guess I can try a vanilla setup without VPN, again. But I didn‚Äôt do anything beyond following the guide <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor" rel="nofollow noopener">https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor</a></p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-19T05:48:14Z' class='post-time'>
                November 19, 2018,  5:48am
              </time>
              <meta itemprop='dateModified' content='2018-11-19T05:48:14Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I can confirm now that if I disable VPN, the problem does not happen.</p>
<p>I disable VPN by setting VPN_FIREWALL=0 and masking the openvpn@openvpn service.</p>
<p>I know what you‚Äôre thinking, that this is then because there is something wrong with the VPN. But let me assure you this is not the case. There is nothing wrong with the VPN itself. It works fine on other computers, same configuration. It even works on the Whonix gateway.</p>
<p>Keep in mind that everything works fine as long as I systemctl disable sdwdate.</p>
<p>sdwdate does something, either directly or indirectly, with the network connections and/or iptables.</p>
<p>This is pretty obvious, since I get:</p>
<p>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>AFTER sdwdate has run.</p>
<p>So just to recap:</p>
<p>If I run <strong>without</strong> sdwdate:</p>
<p>dmesg |grep eth[0,1]</p>
<p>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>If I run <strong>with</strong> sdwdate:</p>
<p>dmesg |grep eth[0,1]</p>
<p>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>Notice that I get these two a second time then. That second time happens after sdwdate has run its course.</p>
<p>Again I believe this is related to this:</p>
<p>/usr/bin/whonix-gateway-firewall - OK: Skipping firewall mode detection since already set to ‚Äòfull‚Äô.<br>
/usr/bin/whonix-gateway-firewall - OK: (Full torified network access allowed.)<br>
/usr/bin/whonix-gateway-firewall - OK: Whonix firewall loaded.</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/0brand'><span itemprop='name'>0brand</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-19T11:16:34Z' class='post-time'>
                November 19, 2018, 11:16am
              </time>
              <meta itemprop='dateModified' content='2018-11-19T11:16:34Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="8" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>/usr/bin/whonix-gateway-firewall - OK: Skipping firewall mode detection since already set to ‚Äòfull‚Äô.<br>
/usr/bin/whonix-gateway-firewall - OK: (Full torified network access allowed.)<br>
/usr/bin/whonix-gateway-firewall - OK: Whonix firewall loaded.</p>
</blockquote>
</aside>
<p>This is normal behavior.  Networking for all but Tor and sdwdate should be locked until time-sync is successful. One time-sync is complete, network access is allowed for <code>apt-get</code> etc. Since VPN is already connected I‚Äôm don‚Äôt think this is the culprit. I get the same messages.</p>
<p>I‚Äôm was thinking it could be something like AppArmor. You can enable Apparmor notification to see if anything relevant is in the logs.</p>
<p><a href="../../../external.html?link=https://whonix.org/wiki/AppArmor#Inspecting_and_Disabling_AppArmor_Notifications">https://whonix.org/wiki/AppArmor#Inspecting_and_Disabling_AppArmor_Notifications</a></p>
<p>Could you also please post the output of the last command. Preferably when VPN connnects, and disconnects. Make sure all sensitive information is redacted. <strong>note:</strong> While this is a pain in the but it will be very helpfull. Its good to have a second set of eyes to take a look.</p>
<pre><code class="lang-auto">sudo /usr/sbin/openvpn --rmtun --dev tun0
sudo /usr/sbin/openvpn --mktun --dev tun0 --dev-type tun --user tunnel --group tunnel
cd /etc/openvpn/
sudo -u tunnel openvpn /etc/openvpn/openvpn.conf
</code></pre>
<p>Also please post relevant Tor logs. (Tor bootstap success, any network failures, <strong>any</strong> errors) Redact any sensitive info.<br>
<code>cat /var/run/tor/log</code></p>
<p>One other thing to clarify. You said the Tor connects in Whonix-Gateway <strong>and</strong> Whonix-Workstation then connection drops? Are you able to use any networked applications in Whonix-Workstation before connection in Gateway goes down?</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-20T03:06:47Z' class='post-time'>
                November 20, 2018,  3:06am
              </time>
              <meta itemprop='dateModified' content='2018-11-20T03:08:11Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I will clarify what happens:</p>
<p>The Whonix gateway starts, connects to the VPN successfully, no errors, the Tor service waits for VPN to finish (I‚Äôm using After=openvpn.service), it then starts, again with no errors.</p>
<p>Everything is great. Everything works.</p>
<p>However, in the meantime, sdwdate has been started and is now running in the background.</p>
<p>Everything still works. I can use the Whonix gateway to do apt-get update, I can use the Whonix workstation to browse. I can verify that I have a Tor IP.</p>
<p>But then, suddenly, just as sdwdate finishes, I get the dmesg messages I mentioned before (printed in tty1):</p>
<p>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>Then, nothing works. Tor cannot connect. The VPN is still up, however.</p>
<p>I have reviewed /var/log/audit/audit.log</p>
<p>I have two DENIED entries for /usr/lib/onion-grater for some PCI device.</p>
<p>I‚Äôm not sure what the purpose is of the test you suggest, keep in mind that both openvpn and the Tor service run without errors if I don‚Äôt let sdwdate start.</p>
<p>So if this test should make any sense, wouldn‚Äôt I also need to (manually) run sdwdate?</p>
<p>What exactly should I do? Keep tty1 running openvpn, tty2 running Tor manually, and tty3 running sdwdate? I would of course start them in the right order.</p>
<p>I don‚Äôt have logs for you yet, I will need to run these commands, write the output to some files, transfer them somehow off of the gateway, redact the information, and post it here. For now, all I have is just my own eyes looking at it.</p>
<p>Doesn‚Äôt it seem reasonable that there is just some simple mistake that causes this? I‚Äôm sure many people successfully use VPN + Tor on Whonix.</p>
<p>Anyway, if I perform the test as I suggested above, this is what happens:</p>
<p>No errors, warnings, or other failures when starting openvpn. I grep for these things with grep -i, and also look at anything suspicious.</p>
<p>No errors, warnings, or other failures when starting Tor. I grep for these things with grep -i, and also look at anything suspicious.</p>
<p>No errors, warnings, or other failures when starting sdwdate. I grep for these things with grep -i, and also look at anything suspicious.</p>
<p>After sdwdate has run its course, I get as mentioned:</p>
<p>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>Now I can no longer run apt-get update (on the gateway) or browse with Firefox (workstation).</p>
<p>And now, as I keep watching the output of openvpn and tor, I see openvpn getting [UNDEF] Inactivity timeout (‚Äìping-restart), restarting), but it is unable to connect to the VPN server.</p>
<p>Tor also cannot connect (of course):</p>
<p>Tried for 120 seconds to get a connection to [scrubbed]:42. Giving up. (waiting for circuit).<br>
Tried for 120 seconds to get a connection to [scrubbed]:42. Giving up. (waiting for circuit).<br>
Tried for 120 seconds to get a connection to [scrubbed]:42. Giving up. (waiting for circuit).<br>
etc.</p>
<p>I don‚Äôt think looking more carefully at the logs from before sdwdate runs makes any sense. Because, keep in mind, if sdwdate never runs, the VPN connection stays up forever, same with Tor. No problems at all.</p>
<p>But I will try to get the logs anyway ‚Ä¶</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-20T12:00:12Z' class='post-time'>
                November 20, 2018, 12:00pm
              </time>
              <meta itemprop='dateModified' content='2018-11-20T12:00:12Z'>
          <span itemprop='position'>#11</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I forgot to mention that I needed to make two modifications to get openvpn to work at all.</p>
<p>I get:</p>
<p>ERROR: Cannot ioctl TUNSETIFF tun: Operation not permitted (errno=1)</p>
<p>Setting tun to tun0 doesn‚Äôt affect the error.</p>
<p>To solve this I had to do setcap cap_net_admin=epi /usr/sbin/openvpn</p>
<p>I don‚Äôt know if this is safe, but even if it is not, I don‚Äôt see how it is related to the problem at hand.</p>
<p>It seems like Whonix + VPN is very unstable in general. I‚Äôve tried reinstalling Whonix several times now, following very painstakingly the guide <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor#Inside_Whonix-Gateway" rel="nofollow noopener">https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor#Inside_Whonix-Gateway</a></p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/0brand'><span itemprop='name'>0brand</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-21T00:14:42Z' class='post-time'>
                November 21, 2018, 12:14am
              </time>
              <meta itemprop='dateModified' content='2018-11-21T00:14:42Z'>
          <span itemprop='position'>#12</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="10" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>I have two DENIED entries for /usr/lib/onion-grater for some PCI device.</p>
</blockquote>
</aside>
<p>Nothing to worry about.(<a href="../../../external.html?link=https://whonix.org/wiki/Dev/Control_Port_Filter_Proxy">Tor control port filter proxy</a>)</p>
<aside class="quote no-group" data-post="10" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>‚Äôm not sure what the purpose is of the test you suggest, keep in mind that both openvpn and the Tor service run without errors if I don‚Äôt let sdwdate start.</p>
<p>So if this test should make any sense, wouldn‚Äôt I also need to (manually) run sdwdate?</p>
</blockquote>
</aside>
<p>You already posted sdwdate.log when connection was reinstated (pcnet32). Wanted to also see VPN and Tor logs. But posting logs  {vpn,sdwate,Tor} from when system starts (connects) and when connection goes down would be the most helpful.</p>
<p><code>cat /var/run/tor/log</code><br>
<code>cat /var/log/sdwdate.log</code></p>
<pre><code class="lang-auto">sudo /usr/sbin/openvpn --rmtun --dev tun0
sudo /usr/sbin/openvpn --mktun --dev tun0 --dev-type tun --user tunnel --group tunnel
cd /etc/openvpn/
sudo -u tunnel openvpn /etc/openvpn/openvpn.conf
</code></pre>
<aside class="quote no-group" data-post="10" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>Doesn‚Äôt it seem reasonable that there is just some simple mistake that causes this? I‚Äôm sure many people successfully use VPN + Tor on Whonix.</p>
</blockquote>
</aside>
<p>Yes, reasonable.</p>
<aside class="quote no-group" data-post="10" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>I don‚Äôt think looking more carefully at the logs from before sdwdate runs makes any sense. Because, keep in mind, if sdwdate never runs, the VPN connection stays up forever, same with Tor. No problems at all.</p>
</blockquote>
</aside>
<p>I‚Äôm looking for any clues that could point to why the connection is dropping when sdwdate is used. I don‚Äôt have the luxury of having your box sitting in front of me. Log analysis is the only way this will be solved whether its by you, me or someone else. Its something I should have asked for in the beginning. Nothing of relevance in the logs is relevant.</p>
<p>Its very odd that there are 2 sets of:</p>
<p><code>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex</code></p>
<p>It looks like something is triggering the interface when sdwdate is used. Not necessarily a sdwdate specific issue. If there are duplicate outputs in any logs that could point to the source of issue.</p>
<aside class="quote no-group" data-post="11" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>Setting tun to tun0 doesn‚Äôt affect the error.</p>
</blockquote>
</aside>
<p>What are you using in openvpn.conf  tun0  or tun?</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-21T03:16:34Z' class='post-time'>
                November 21, 2018,  3:16am
              </time>
              <meta itemprop='dateModified' content='2018-11-21T03:16:34Z'>
          <span itemprop='position'>#13</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I‚Äôm using tun0, but there is no difference between tun and tun0.</p>
<p>I just reinstalled, again.</p>
<p>I have two problems that I have solved without following the guide (two, including the one I mentioned already, so one new). I‚Äôm sorry for not mentioning this before. Perhaps my issue with eth0 and eth1 being reset is somehow related to that, although I doubt it:</p>
<p>Issue 1: ERROR: Cannot ioctl TUNSETIFF tun: Operation not permitted (errno=1)</p>
<p>My solution to 1: tun -&gt; tun1 doesn‚Äôt help, so I did setcap cap_net_admin=eip /usr/sbin/openvpn</p>
<p>Issue 2: Unable to send UDP packets when running openvpn.</p>
<p>My solution to 2: setcap cap_net_admin=eip /bin/ip</p>
<p>I‚Äôm still working on getting logs‚Ä¶</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-21T06:31:24Z' class='post-time'>
                November 21, 2018,  6:31am
              </time>
              <meta itemprop='dateModified' content='2018-11-21T06:31:24Z'>
          <span itemprop='position'>#14</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>There seems to be several mistakes in the Whonix wiki for setting this up. I will write a different post for this when I finally have it gone, in order to hopefully improve it and help other users. Once I have figured out how much I‚Äôm doing wrong (if anything) and how much is wrong with the wiki (if anything).</p>
<p>Not only do I need to add CAP_NET_ADMIN to both openvpn and ip, but I also need to add:</p>
<p>User=tunnel<br>
Group=tunnel</p>
<p>to my /lib/systemd/system/openvpn@openvpn.service file. Otherwise openvpn doesn‚Äôt start as tunnel.</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/0brand'><span itemprop='name'>0brand</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-21T10:42:26Z' class='post-time'>
                November 21, 2018, 10:42am
              </time>
              <meta itemprop='dateModified' content='2018-11-21T11:31:28Z'>
          <span itemprop='position'>#15</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="13" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>I have two problems that I have solved without following the guide (two, including the one I mentioned already, so one new). I‚Äôm sorry for not mentioning this before. Perhaps my issue with eth0 and eth1 being reset is somehow related to that, although I doubt it:</p>
</blockquote>
</aside>
<aside class="quote no-group" data-post="1" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>I have followed this guide <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor">https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor </a> <strong>exactly</strong>.</p>
</blockquote>
</aside>
<p>When you say exactly‚Ä¶</p>
<p>The modifications are likely what caused this this particular issue.</p>
<p>Edit: We appreciate when users debug on there own. You also have to look at this from the point of the person helping you. Its important that he/she has all the information. Even if you think its not important. For ~ 95% of the users with Whonix/VPN issues, its because they didn‚Äôt follow the instructions as written. Thats were log come into play.</p>
<p>I have to say its great to see someone who is will to keep at it until a solution is found. So I‚Äôd would be more than happy to continue.</p>
<p>Did you add any VPN options to your openvpn.conf that was not in your providers .ovpn file?</p>
<p>Did you follow all steps <strong>exactly</strong> as written aside from what was already mentioned? The reason I ask is  your should not have to manually add:</p>
<blockquote>
<p>User=tunnel<br>
Group=tunnel</p>
<p>to my /lib/systemd/system/openvpn@openvpn.service file.</p>
</blockquote>
<p>If you can improve the VPN documentation that would be awesome. <img src="../../images/emoji/twitter/wink1bce.png?v=6" title=":wink:" class="emoji" alt=":wink:"> Keep in mind that these steps work for me with no issues. And work for other users as well.</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-21T12:53:53Z' class='post-time'>
                November 21, 2018, 12:53pm
              </time>
              <meta itemprop='dateModified' content='2018-11-21T12:54:20Z'>
          <span itemprop='position'>#16</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I will now reinstall once more, follow the guide step by step, and post where I encounter a problem.</p>
<p>Thanks for the help, and sorry for not pointing out those setopt modifications I did before this late.</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-22T05:13:04Z' class='post-time'>
                November 22, 2018,  5:13am
              </time>
              <meta itemprop='dateModified' content='2018-11-22T13:20:14Z'>
          <span itemprop='position'>#17</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>So this is what happens, from the very scratch:</p>
<p>I import the image Whonix-Gateway-14.0.0.7.4.ova in VirtualBox, I use default settings, leave everything as is. Start the new imported box.</p>
<p>The GUI starts up. I select ‚ÄúConnect‚Äù. Next. It connects to Tor successfully. Finish.</p>
<p>whonixcheck starts up, checking the Tor connection, etc.</p>
<p>It gets to around 75% and hangs.</p>
<p>Eventually I get:</p>
<p>"WARNING: Debian Package Update Check Result: Could not check for software updates! (Timeout reached.) (apt-get code 124)</p>
<p>I run the suggested commands (apt-get update &amp;&amp; apt-get dist-upgrade).</p>
<p>The commands run fine. Downloads, updates. No problem.</p>
<p>The commands finish with no errors.</p>
<p>Then whoixcheck pops up again with an error:</p>
<p>"ERROR: Tor Pid Check Result:<br>
Tor not running.(tor_pid_message: Pid file /var/run/tor/tor.pid does not exist.)</p>
<p>etc."</p>
<p>Perhaps related to the dist upgrade, I reboot.</p>
<p>I manually run whonixcheck from the menu after it boots up again.</p>
<p>This time whonixcheck finishes with no errors.</p>
<p>I power off the machine and boot it again after setting RAM to 256, to force it into console only. I don‚Äôt do this until now, because dist-upgrade can fail when there is that little memory.</p>
<p>After booting, I run whonixcheck first.</p>
<p>Again I get:</p>
<p>[WARNING] [whonixcheck] Debian Package Update Check Result: Could not check for software updates! (apt-get code: 100)<br>
Please manually check:<br>
‚Ä¶</p>
<p>I run apt-get update &amp;&amp; apt-get dist-upgrade manually.</p>
<p>This runs fine.</p>
<p>I run apt autoremove as it is listed as possible.</p>
<p>Now I start following the Tor + VPN guide.</p>
<p>Again I‚Äôm using: User -&gt; VPN -&gt; Tor -&gt; Internet</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor#Inside_Whonix-Gateway" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <img src="../../../external.html?link=https://www.whonix.org/w/images/b/bb/City-427640640.jpg" class="thumbnail onebox-avatar" width="500" height="500">

<h3><a href="../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor#Inside_Whonix-Gateway" target="_blank" rel="nofollow noopener">Tunnels/Connecting to a VPN before Tor</a></h3>

<p>Instructions on how to connect to a VPN before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet)</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>I edit: /etc/whonix_firewall.d/50_user.conf</p>
<p>And I add VPN_FIREWALL=1</p>
<p>Note that the file /etc/whonix_firewall.d/50_user.conf doesn‚Äôt exist from before, it gets created.</p>
<p>I reload the firewall: whonix_firewall</p>
<p>No errors.</p>
<p>I edit: /etc/sudoers.d/tunnel_unpriv</p>
<p>Comment in:</p>
<p>tunnel ALL=(ALL) NOPASSWD: /bin/ip<br>
tunnel ALL=(ALL) NOPASSWD: /usr/sbin/openvpn *<br>
Defaults: tunnel !requiretty</p>
<p>Now we get to the VPN setup.</p>
<p>The guide attempts to explain how to get a certificate and credentials. I‚Äôm just using a .ovpn file from my VPN provider. This .ovpn file I can usually just load using ‚Äúopenvpn openvpn.ovpn‚Äù, and it works fine (from e.g. Ubuntu, Debian, whatever). The .ovpn includes credentials, IP of the remote VPN server, certificate, etc.</p>
<p>So I skip:</p>
<p>Get VPN Certificate: Skip.<br>
VPN Credentials: Skip.<br>
VPN IP Address: Skip.</p>
<p>However, VPN Configuration File I cannot skip.</p>
<p>I need to add this to the .ovpn file.</p>
<p>script-security 2<br>
user tunnel<br>
iproute /usr/bin/ip_unpriv</p>
<p>OK, I add that, and I place the final file at /etc/openvpn/openvpn.conf</p>
<p>Note that in this file I now have:</p>
<p>client<br>
dev tun0<br>
proto udp<br>
remote [redacted]<br>
resolv-retry infinite<br>
nobind<br>
persist-key<br>
persist-tun<br>
script-security 2<br>
user tunnel<br>
iproute /usr/bin/ip_unpriv<br>
remote-cert-tls-server<br>
cipher AES-256-CBC<br>
comp-lzo no<br>
route-delay 5<br>
verb 3<br>
explicit-exit-notify 5<br>
Then there is a bunch of stuff about certificates and keys.</p>
<p>It has everything else it needs to connect, the IP of the VPN server, certificate (in the same file), etc.</p>
<p>Configuration Folder Permissions:</p>
<p>I fix the permissions:</p>
<p>chown -R tunnel:tunnel /etc/openvpn<br>
chown -R tunnel:tunnel /var/run/openvpn</p>
<p>systemd setup:</p>
<p>I create the systemd service file:</p>
<p>cp /lib/systemd/system/openvpn@.service /lib/systemd/system/openvpn@openvpn.service<br>
systemctl enable openvpn@openvpn<br>
systemctl start openvpn@openvpn<br>
systemctl status openvpn@openvpn</p>
<p>I get:</p>
<p>‚Äúactive (running)‚Äù</p>
<p>I do:</p>
<p>ifconfig, and see tun0 is up and has an IP.</p>
<p>I run: whonixsetup</p>
<p>Connect to tor, it gets successfully enabled, and whonixcheck starts up.</p>
<p>whonixcheck fails with:</p>
<p>/usr/lib/whonixcheck/cleanup.bsh: line 215: cd: ‚Ä¶: Permission denied</p>
<p>I attempt to ignore this and just move on:</p>
<p>The guide asks for you to edit:</p>
<p>/etc/systemd/system/tor.service.d/50_user.conf</p>
<p>But this file doesn‚Äôt exist.</p>
<p>I assume they mean:</p>
<p>/etc/systemd/system/multi-user.target.wants/tor.service</p>
<p>I add:</p>
<p>After=openvpn.service</p>
<p>Under [Unit].</p>
<p>I reboot the Gateway.</p>
<p>Now I get the:</p>
<p>pcnet32 0000:00:03.0 eth0: link up, 100Mbps, full-duplex<br>
pcnet32 0000:00:08.0 eth1: link up, 100Mbps, full-duplex</p>
<p>And we‚Äôre back to my opening post.</p>
<p>Edits:</p>
<p>I realize now that I didn‚Äôt have to do any setopt hack to get it working (well, it isn‚Äôt working, but to get this far, openvpn runs ‚Ä¶), and I have no idea why!</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-22T06:04:22Z' class='post-time'>
                November 22, 2018,  6:04am
              </time>
              <meta itemprop='dateModified' content='2018-11-22T06:04:22Z'>
          <span itemprop='position'>#19</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Yeah, that is an option if you have the ability to do that, thanks for the suggestion.</p>
<p>I want to get this to work though, especially since I spent so much time on it.</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/rob75'><span itemprop='name'>rob75</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-22T08:58:44Z' class='post-time'>
                November 22, 2018,  8:58am
              </time>
              <meta itemprop='dateModified' content='2018-11-22T08:58:44Z'>
          <span itemprop='position'>#20</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I will now work on obtaining the requested logs.</p>
<p>Is the following test setup adequate?</p>
<p>I disable with systemctl mask openvpn@openvpn, tor, and sdwdate. I reboot.</p>
<p>Then, I run openvpn manually, and redirect all output to a log file.</p>
<p>Once openvpn is up and running I run tor manually, again I redirect all output to a log file.</p>
<p>I then run sdwdate manually, and redirect all output to a log file.</p>
<p>I allow the network to fail once sdwdate finishes and allow it to log for some time more into all three log files.</p>
<p>Then I will redact sensitive information and post it here. Will that work?</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/0brand'><span itemprop='name'>0brand</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="6338.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-22T11:05:22Z' class='post-time'>
                November 22, 2018, 11:05am
              </time>
              <meta itemprop='dateModified' content='2018-11-22T11:05:22Z'>
          <span itemprop='position'>#21</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hi <code>rob75</code></p>
<p>You might not have seen <a href="../../../external.html?link=https://whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor#Firewall_Settings">Firewall settings</a> ‚ÄúHit Expand‚Äù</p>
<p>This is most likely your problem.</p>
<p><code>sudo nano /etc/whonix_firewall.d/50_user.conf</code></p>
<p>Add</p>
<p><code>VPN_FIREWALL=1</code></p>
<aside class="quote no-group" data-post="17" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>Comment out:</p>
<p>tunnel ALL=(ALL) NOPASSWD: /bin/ip<br>
tunnel ALL=(ALL) NOPASSWD: /usr/sbin/openvpn *<br>
Defaults: tunnel !requiretty</p>
</blockquote>
</aside>
<p>Comment <strong>in</strong>.  As long as the comment ‚Äú#‚Äù is removed your OK. Which It  look likes you have done.</p>
<hr>
<p>You might not have seen <a href="../../../external.html?link=https://whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor#Firewall_Settings">Firewall settings</a> ‚ÄúHit Expand‚Äù</p>
<p><code>sudo nano /etc/whonix_firewall.d/50_user.conf</code></p>
<p>Add.</p>
<p><code>VPN_FIREWALL=1</code></p>
<aside class="quote no-group" data-post="17" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>The guide asks for you to edit:</p>
<p>/etc/systemd/system/tor.service.d/50_user.conf</p>
</blockquote>
</aside>
<p>You didn‚Äôt press on ‚ÄúExpand on the right‚Äù</p>
<h4>Additional Tweaks / Recommendations / Troubleshooting</h4>
<p><strong>If having problems with the connection / Tor is not fully bootstrapped</strong></p>
<p>please press on -&gt; <strong>Expand on the right</strong></p>
<blockquote>
<p>Create a folder /etc/systemd/system/tor.service.d.</p>
</blockquote>
<p><code>sudo mkdir /etc/systemd/system/tor.service.d</code></p>
<blockquote>
<p>Create a file /etc/systemd/system/tor.service.d/50_user.conf.</p>
</blockquote>
<p><code>sudo nano /etc/systemd/system/tor.service.d/50_user.conf</code></p>
<p>Add the following content.</p>
<p><code>[Unit] After=openvpn.service</code></p>
<p>Save.</p>
<p>Let me know if that works.</p>
<aside class="quote no-group" data-post="20" data-topic="6338">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/r/d6d6ee/40.png" class="avatar"> rob75:</div>
<blockquote>
<p>will now work on obtaining the requested logs.</p>
<p>Is the following test setup adequate?</p>
</blockquote>
</aside>
<p>Looks good to me. Only needed if the previous info does not remedy the problem.</p>
<p>BTW I‚Äôve missed a few thing my self i.e. not hitting expand</p>
        </div>

        <meta itemprop='headline' content='Unable to get VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet) working, network interfaces are reset'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><b><a rel="next" itemprop="url" href="63384658.html?page=2">next page ‚Üí</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
