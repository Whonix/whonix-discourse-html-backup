<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
    <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541</link>
    <description>I suspect it is this:

* Tor Browser is running on one machine and talking to Tor on another machine.
* When time is changed using `date` on another machine, Tor Browser starts to use 100% CPU.

Still not &quot;really&quot; a Whonix issue. Also not &quot;really&quot; an sdwdate issue. It still needs to be reproduced without mentioning Whonix / sdwdate as a general bug and then reported against Tor Project trac component Tor Browser.

Help welcome.

Originally reported here with lots of discussion:
 https://github.com/QubesOS/qubes-issues/issues/4969</description>
    <language>en</language>
    <lastBuildDate>Tue, 25 Aug 2020 16:15:49 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://gitlab.com/assets/favicon-7901bd695fb93edb07975966062049829afb56cf11511236e61bcf425070e36e.png" class="site-icon" width="16" height="16">
      <a href="https://gitlab.com/whonix/onion-grater/-/commit/a5e4983296960fb051cee4988efd952ae19df920" target="_blank">GitLab</a>
  </header>
  <article class="onebox-body">
    <img src="https://assets.gitlab-static.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png" class="thumbnail onebox-avatar" width="128" height="128">

<h3><a href="https://gitlab.com/whonix/onion-grater/-/commit/a5e4983296960fb051cee4988efd952ae19df920" target="_blank">comment (a5e49832) · Commits · Whonix / onion-grater</a></h3>

<p>GitLab.com</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://gitlab.com/assets/favicon-7901bd695fb93edb07975966062049829afb56cf11511236e61bcf425070e36e.png" class="site-icon" width="16" height="16">
      <a href="https://gitlab.com/whonix/onion-grater/-/commit/2c9c95760692e3b5af55d198fe14ef7fdee6bc03" target="_blank">GitLab</a>
  </header>
  <article class="onebox-body">
    <img src="https://assets.gitlab-static.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png" class="thumbnail onebox-avatar" width="128" height="128">

<h3><a href="https://gitlab.com/whonix/onion-grater/-/commit/2c9c95760692e3b5af55d198fe14ef7fdee6bc03" target="_blank">RestartSec=60 (2c9c9576) · Commits · Whonix / onion-grater</a></h3>

<p>GitLab.com</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Seems good enough.</p>
<p>Socket activation is nice but seems more difficult/complex to implement. Since <a href="https://www.whonix.org/wiki/Dev/Control_Port_Filter_Proxy#onion-grater_by_Tails_forked_by_Whonix_.E2.84.A2">onion-grater by Tails forked by Whonix ™</a> is forked from <a href="https://www.whonix.org/wiki/Dev/Control_Port_Filter_Proxy#onion-grater_by_Tails">onion-grater by Tails</a>, I would like to keep the changes/delta minimal.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/23">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/23</link>
        <pubDate>Tue, 25 Aug 2020 16:15:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-23</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://gitlab.com/assets/favicon-7901bd695fb93edb07975966062049829afb56cf11511236e61bcf425070e36e.png" class="site-icon" width="16" height="16">
      <a href="https://gitlab.com/whonix/whonix-firewall/-/commit/390a47b68f97336952e6afc092c2c66f4cf948a7" target="_blank">GitLab</a>
  </header>
  <article class="onebox-body">
    <img src="https://assets.gitlab-static.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png" class="thumbnail onebox-avatar" width="128" height="128">

<h3><a href="https://gitlab.com/whonix/whonix-firewall/-/commit/390a47b68f97336952e6afc092c2c66f4cf948a7" target="_blank">remove auto restart feature if networking did not come up (390a47b6) · Commits...</a></h3>

<p>remove /lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf fixes https://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/15 fixes...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/22">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/22</link>
        <pubDate>Tue, 25 Aug 2020 15:08:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-22</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="ak88" data-post="20" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>It could also introduce fingerprintability. I doubt it would in this instance, but generally.</p>
</blockquote>
</aside>
<p>Indeed.</p>
<aside class="quote no-group" data-username="ak88" data-post="20" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>For AppVMs it’s easy and effective. It should be possible in DispVM templates, though it would require extracting possibly running Tor Browser in the DispVM template.</p>
</blockquote>
</aside>
<ul>
<li><a href="https://www.whonix.org/wiki/Tor_Browser/Advanced_Users#DVM_Template_Customization">https://www.whonix.org/wiki/Tor_Browser/Advanced_Users#DVM_Template_Customization</a></li>
<li><a href="https://www.whonix.org/wiki/Qubes/DisposableVM#Tor_Browser_in_DVM_Template">https://www.whonix.org/wiki/Qubes/DisposableVM#Tor_Browser_in_DVM_Template</a></li>
</ul>
<p>Modified <code>Option 2: cd /var/cache/tb-binary/.tb/tor-browser/Browser Method</code> should work nicely. It’s already extracted there. One could make changes in that folder. Documentation might be a bit unclear. It doesn’t survive <code>update-torbrowser</code> in TemplateVM though.</p>
<p>Also modified <code>Option 1: /etc/torbrowser.d/ Settings Method</code> might be interesting. It basically gives full scripting support before starting Tor Browser. Could do stuff such as “if DispVM”, “do X”.</p>
<aside class="quote no-group" data-username="ak88" data-post="20" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>The bigger issue is discoverability.</p>
</blockquote>
</aside>
<p>Indeed.</p>
<aside class="quote no-group" data-username="ak88" data-post="20" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>I added it to the wiki,</p>
</blockquote>
</aside>
<p>Thanks.</p>
<p><a href="https://www.whonix.org/wiki/Tor_Browser#Tor_Browser_Consumes_100.25_CPU_after_Clock_Sync_or_Suspend.2FResume">https://www.whonix.org/wiki/Tor_Browser#Tor_Browser_Consumes_100.25_CPU_after_Clock_Sync_or_Suspend.2FResume</a></p>
<p>We’ve added some stylistic enhancements on top (but these wouldn’t have happened without your initiative).</p>
<aside class="quote no-group" data-username="ak88" data-post="20" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>Fortunately, this workaround is really not even necessary in the future if we can sync the clock without breaking the control connection, as discussed earlier. It would also be unnecessary when and if the upstream bug is fixed.</p>
</blockquote>
</aside>
<p>Indeed. That’s next.</p>
<aside class="quote no-group" data-username="ak88" data-post="20" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>BTW, thanks for your support. I probably wouldn’t have pursued the issue any further if this thread had gone unreplied.</p>
</blockquote>
</aside>
<p>Sure thing. Under the right conditions which were given here (time, knowledge available), happy to help.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/21">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/21</link>
        <pubDate>Mon, 10 Aug 2020 12:43:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-21</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="19" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Two disadvantages with inside browser data folder modifications by Whonix</p>
</blockquote>
</aside>
<p>I understand completely.</p>
<p>It could also introduce fingerprintability. I doubt it would in this instance, but generally.</p>
<aside class="quote no-group" data-username="Patrick" data-post="19" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Probably great if users manually apply that workaround.</p>
</blockquote>
</aside>
<p>For AppVMs it’s easy and effective. It should be possible in DispVM templates, though it would require extracting possibly running Tor Browser in the DispVM template.</p>
<p>The bigger issue is discoverability. I added it to the wiki, but the majority of affected users may not know what to look for or where.</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/index.php/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/w/index.php?title=Tor_Browser&amp;stable=0" target="_blank" rel="nofollow noopener" title="03:42PM - 09 August 2020">Whonix – 9 Aug 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:666/500;"><img src="https://www.whonix.org/w/images/1/19/Torbrowser.png" class="thumbnail" width="666" height="500"></div>

<h3><a href="https://www.whonix.org/w/index.php?title=Tor_Browser&amp;stable=0" target="_blank" rel="nofollow noopener">Tor Browser Basics</a></h3>

<p>Using Tor Browser in Whonix ™. Anonymity vs Pseudonymity, HTTPS Everywhere, Torbutton, Protection against dangerous JavaScript, NoScript, Tips, Update Tor Browser, Browser Plugins, Change Language</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-username="Patrick" data-post="19" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But I cannot make that the default</p>
</blockquote>
</aside>
<p>Fortunately, this workaround is really not even necessary in the future if we can sync the clock without breaking the control connection, as discussed earlier. It would also be unnecessary when and if the upstream bug is fixed.</p>
<p><a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a> BTW, thanks for your support. I probably wouldn’t have pursued the issue any further if this thread had gone unreplied.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/20">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/20</link>
        <pubDate>Sun, 09 Aug 2020 16:01:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-20</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="ak88" data-post="18" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>Maybe we could distribute a fix the same way the security level confirmation dialog box works?</p>
</blockquote>
</aside>
<p>That doesn’t exist anymore.<br>
<a href="https://forums.whonix.org/t/add-tor-browser-first-startup-popup-to-ask-whether-security-slider-should-be-set-to-safest/7591/23" class="inline-onebox">add Tor Browser first startup popup to ask whether security slider should be set to safest</a></p>
<p>Two disadvantages with inside browser data folder modifications by Whonix</p>
<ul>
<li>breaks easily</li>
<li>most Tor Browser issues are blamed on it whatsoever</li>
</ul>
<p>Therefore not sustainable.</p>
<aside class="quote no-group" data-username="ak88" data-post="18" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p><code>extensions.torbutton.display_circuit</code> to <code>false</code></p>
</blockquote>
</aside>
<p>Great find. Probably great if users manually apply that workaround. But I cannot make that the default due to above issue unfortunately.</p>
<aside class="quote no-group" data-username="ak88" data-post="18" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>It should be fine to disable that since the circuit display isn’t supposed to work anyway on Whonix.</p>
</blockquote>
</aside>
<p>Btw we actually want to make it work but with most information redacted.</p>
<ul>
<li><a href="https://www.whonix.org/wiki/Contribute#Regular_Expression_RegEx">https://www.whonix.org/wiki/Contribute#Regular_Expression_RegEx</a></li>
<li><a href="https://www.whonix.org/wiki/Dev/onion-grater">https://www.whonix.org/wiki/Dev/onion-grater</a></li>
</ul>
<p>For purposes of not confusing Tor Launcher / Tor Browser.</p>
<p>This might be breaking Tor onion v3 authentication from inside Tor Browser. Reference:<br>
<a href="https://phabricator.whonix.org/T996" class="onebox" target="_blank">https://phabricator.whonix.org/T996</a></p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/19">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/19</link>
        <pubDate>Sun, 09 Aug 2020 11:47:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-19</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <p>Still waiting for my <a href="http://gitlab.torproject.org" rel="nofollow noopener">gitlab.torproject.org</a> account to be approved. (The new walled garden approach is doing them a big favor isn’t it?) However, when I was poking around, believe it or not, I found this was already reported to Tor Project over a year ago. Man, things are much easier to find when you’re not looking for them.<br>
.<br>
It’s much higher level than I thought. They found out it’s in JS code related to the circuit display feature in Tor Launcher. I overlooked that, because about:performance kept saying everything was fine when it wasn’t, but Tor Launcher apparently doesn’t show up there even when it’s running. According to the thread, disabling the circuit display feature in about:config gets rid of the bug. I gave it a try and it seems to work like a charm. It should be fine to disable that since the circuit display isn’t supposed to work anyway on Whonix. Maybe we could distribute a fix the same way the security level confirmation dialog box works? Just brainstorming at the moment.</p>
<p><code>extensions.torbutton.display_circuit</code> to <code>false</code></p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://gitlab.torproject.org/uploads/-/system/appearance/favicon/1/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://gitlab.torproject.org/tpo/applications/tor-browser/-/issues/29497" target="_blank" rel="nofollow noopener">GitLab</a>
  </header>
  <article class="onebox-body">
    <img src="https://gitlab.torproject.org/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png" class="thumbnail onebox-avatar" width="128" height="128">

<h3><a href="https://gitlab.torproject.org/tpo/applications/tor-browser/-/issues/29497" target="_blank" rel="nofollow noopener">After tor crash, firefox.exe (tor browser) shoots up to 50+% cpu usage and...</a></h3>

<p>re: Tor Browser 8.0.6 (and also 8.0.3) Have noticed since 8.0.3 to 8.0.6 that, every time tor crashes, firefox.exe (tor browser) shoots up to 50-60% cpu usage and stays there...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/18">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/18</link>
        <pubDate>Fri, 07 Aug 2020 20:47:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-18</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Good options to explore.</p>
<p>The Linux OOM killer kills processes at random. If Linux is trying to rescue the system by killing the Tor process, it’s awful if the system crashes anyhow because Firefox starts 100% CPU bug.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/17">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/17</link>
        <pubDate>Fri, 07 Aug 2020 12:55:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-17</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="15" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>sdwdate: The idea is when you restart it from sdwdate-gui it should instantly fix the clock. Otherwise if restarted by systemd unit it might just be during an upgrade and then clock jumps would be undesireable, hence gradually adjust clock using sclockadj. And after boot: set clock using date (to account for possibly required bigger fixes). Using date/instant time fix: when necessary. Using sclockadj: whenever sensible.</p>
</blockquote>
</aside>
<p>That explanation makes sense, but I’m not sure it exactly matches what I observed. Specifically, I did observe it invoking <code>date</code> after a systemctl restart, under certain conditions. However, as long as we’re in agreement that sclockadj vs. date is irrelevant, I’m not going wrack my brain over it.</p>
<aside class="quote no-group" data-username="Patrick" data-post="15" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Can we implement the functionality of <code>/lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf</code> any other way?</p>
</blockquote>
</aside>
<ul>
<li>Maybe make onion-grater exclusively socket activated? That way it will never be requested to activate if the interface doesn’t exist.</li>
<li>Change to <code>Requires=network.target After=network.target</code>? Usually a firewall does not add or delete any interfaces, so I don’t think it makes sense for onion-grater to depend on it in this case.</li>
<li>And/or: add <code>Restart=on-failure</code> <code>RestartSec=10s</code>, or something like that?</li>
</ul>
<aside class="quote no-group" data-username="Patrick" data-post="15" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could you report this upstream at The Tor Project please?</p>
</blockquote>
</aside>
<p>I intend to, probably today. I was just waiting until I collected as much information as possible.</p>
<p>As long as we can conceivably come up with a workaround, I won’t mention Whonix or sdwdate. On the other hand if we’re relying on upstream for a fix, I think it’s in our best interest to demonstrate a real-world, recurring problem case. Otherwise they’ll likely say “well normally the control connection should never die while the browser is still connected so this is a low priority bug.”</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/16">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/16</link>
        <pubDate>Fri, 07 Aug 2020 11:59:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-16</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><code>date</code> vs <code>onion-grater</code>: <code>date</code> was used to reproduce this on Non-Qubes-Whonix. There might be two different bugs. Maybe it “fixed itself” meanwhile. I cannot reproduce this any longer. Let’s concentrate on the onion-grater related issue then.</p>
<hr>
<p>To also cut out sdwdate-gui from the issue most likely what’s happening… sdwdate-gui is actually calling this:</p>
<pre><code>/usr/lib/sdwdate/restart_fresh
</code></pre>
<hr>
<pre><code>sudo bash -x /usr/lib/sdwdate/restart_fresh
</code></pre>
<pre><code class="lang-auto">+ set -e
+ sudo --non-interactive rm --force /run/sdwdate/first_success
+ sudo --non-interactive -u sdwdate touch /run/sdwdate/clock_jump_do_once
+ sudo --non-interactive systemctl --no-pager --no-block restart sdwdate
</code></pre>
<p>If you <a href="https://www.whonix.org/wiki/Dev/git#grep_Whonix_.E2.84.A2_source_code">grep Whonix source code</a> for <code>first_success</code> you’ll see <code>/usr/lib/whonix-firewall/firewall-restarter</code>. It restarts whonix-firewall systemd service.</p>
<p>Maybe deleting <code>/run/sdwdate/first_success</code> is unnecessary and wrong. Seems non-perfect anyhow.</p>
<p>sdwdate: The idea is when you restart it from sdwdate-gui it should instantly fix the clock. Otherwise if restarted by systemd unit it might just be during an upgrade and then clock jumps would be undesireable, hence gradually adjust clock using sclockadj. And after boot: set clock using date (to account for possibly required bigger fixes). Using date/instant time fix: when necessary. Using sclockadj: whenever sensible.</p>
<p>One of these might be causing onion-grater to restart when whonix-firewall systemd service is restarting:</p>
<ul>
<li><code>/lib/systemd/system/qubes-whonix-network.service</code></li>
<li><code>/lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf</code></li>
</ul>
<p>Since my sys-whonix is based on whonix-gw-15 TemplateVM it’s easy to experiment. Deleting some files in root file system which will be back after reboot. After doing this…</p>
<pre><code>sudo rm /lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf
sudo systemctl daemon-reload 
sudo systemctl restart whonix-firewall
</code></pre>
<p>…onion-grater no longer restarts when restarting whonix-firewall.</p>
<p>Can we implement the functionality of <code>/lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf</code> any other way?</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/whonix-firewall/blob/master/lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/whonix-firewall/blob/master/lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf" target="_blank">Whonix/whonix-firewall/blob/master/lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf</a></h4>
<pre><code class="lang-conf">## Copyright (C) 2012 - 2020 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

[Unit]

#### meta start
#### project Whonix
#### category tor-control and firewall
#### description
## Start onion-grater
##
## Workaround:
## onion-grater fails if it cannot bind on the network interface.
## This is the case when networking did not come up, which is the case when
## whonix-firewall.service failed. To make onion-grater
## automatically start after lets says Whonix firewall config was fixed and the
## whonix-firewall.service was restarted.
After=whonix-firewall.service
Requires=whonix-firewall.service

</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/whonix-firewall/blob/master/lib/systemd/system/onion-grater.service.d/30_whonix_cpfpy.conf" target="_blank">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>I’ll guess I’ll just delete that file. It’s nice to have but not too important after all. Perhaps replace it with onion-grater trying at infinity to restart every 1 minute or so (not faster to not spam systemd log too much - even every 1 minute is awful systemd log spam).</p>
<aside class="quote no-group" data-username="ak88" data-post="14" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>What <strong>does</strong> trigger the bug:</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="ak88" data-post="14" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>Or, basically, anything that breaks connection chain from the browser to the control port.</p>
</blockquote>
</aside>
<p>Great analysis! Probably correct.</p>
<p>Could you report this upstream at The Tor Project please? I recommend to not mention sdwdate / onion-grater since that would add confusion. The bug in Tor Browser here is spinning up 100% CPU once Tor or control port connection dies.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/15</link>
        <pubDate>Thu, 06 Aug 2020 10:21:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-15</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="13" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Perhaps it can be triggered by restarting onion-grater only?</p>
</blockquote>
</aside>
<p>Good thinking. I just tried it and yes, it does.</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="13" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<aside class="quote no-group" data-username="ak88" data-post="11" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>This part might be Whonix-specific, because when sdwdate restarts in sys-whonix it causes a bunch of other services to restart, including onion-grater</p>
</blockquote>
</aside>
<p>Can’t reproduce this.</p>
<p>If I <code>sudo systemctl restart sdwdate</code> in sys-whonix I don’t see onion-grater restarting. It shouldn’t. I wouldn’t know why.</p>
</blockquote>
</aside>
<p>Hmm, you’re right, it doesn’t seem to happen with <code>systemctl restart sdwdate</code></p>
<pre><code>Aug 05 23:12:06 host sudo[19359]:     user : TTY=pts/1 ; PWD=/home/user ; USER=root ; COMMAND=/usr/bin/systemctl restart sdwdate
Aug 05 23:12:06 host audit[19359]: USER_CMD pid=19359 uid=1000 auid=4294967295 ses=4294967295 msg='cwd="/home/user" cmd=73797374656D63746C20726573746172742073647764617465 terminal=pts/1 res=success'
Aug 05 23:12:06 host sudo[19359]: pam_unix(sudo:session): session opened for user root by (uid=0)
Aug 05 23:12:06 host audit[19359]: CRED_REFR pid=19359 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 05 23:12:06 host audit[19359]: USER_START pid=19359 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_open grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 05 23:12:06 host systemd[1]: Starting Secure Distributed Web Date...
Aug 05 23:12:07 host systemd[1]: Started Secure Distributed Web Date.
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - sdwdate started. PID: 19362
Aug 05 23:12:07 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=sdwdate comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - create temp_dir: /tmp/tmp.0lO2YpDfPN
Aug 05 23:12:07 host audit[19359]: USER_END pid=19359 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_close grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 05 23:12:07 host audit[19359]: CRED_DISP pid=19359 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/1 res=success'
Aug 05 23:12:07 host sudo[19359]: pam_unix(sudo:session): session closed for user root
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Tor socks host: 127.0.0.1 Tor socks port: 9108
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Running sdwdate main loop. iteration: 1 / 10000
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Prerequisite check: The clock is sane.
Aug 05 23:12:07 host sdwdate[19362]: Within build timestamp Fri 11 Oct 2019 12:55:17 AM UTC and expiration timestamp Tue 17 May 2033 10:00:00 AM UTC.
Aug 05 23:12:07 host sdwdate[19362]: Clock within consensus parameters consensus/valid-after 2020-08-05 21:00:00 and consensus/valid-until 2020-08-06 00:00:00.
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Prerequisite check: Tor fully bootstrapped.
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Start fetching remote times.
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Time fetching in progress...
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Running sdwdate fetch loop. iteration: 1
Aug 05 23:12:07 host sdwdate[19362]: 2020-08-05 23:12:07 - sdwdate - INFO - Requested urls ['gmg7jl25ony5g7ws.onion', 'ak2uqfavwgmjrvtu.onion', 'tinhat233xymse34.onion']
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Returned urls "['gmg7jl25ony5g7ws.onion', 'ak2uqfavwgmjrvtu.onion', 'tinhat233xymse34.onion']"
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - remote 0: gmg7jl25ony5g7ws.onion
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * comment: Gizmodo Media Group        https://specialprojectsdesk.com/securedrop/        https://web.archive.org/web/20170215221547/https://specialprojectsdesk.com/securedrop/
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_unixtime: 1596669146
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * consensus/valid-after: 2020-08-05 21:00:00
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_time          : 2020-08-05 23:12:26
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * consensus/valid-until: 2020-08-06 00:00:00
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * time_diff: 10 second(s)
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * timesanitycheck: sane
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_status: True
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - remote 1: ak2uqfavwgmjrvtu.onion
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * comment: MagyarLeaks        2013        Investigative Journalism        https://atlatszo.hu/magyarleaks/        Hungary        https://web.archive.org/web/20170128142348/https://atlatszo.hu/magyarleaks/
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_unixtime: 1596669145
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * consensus/valid-after: 2020-08-05 21:00:00
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_time          : 2020-08-05 23:12:25
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * consensus/valid-until: 2020-08-06 00:00:00
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * time_diff: 9 second(s)
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * timesanitycheck: sane
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_status: True
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - remote 2: tinhat233xymse34.onion
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * comment: https://thetinhat.com        https://web.archive.org/web/20170421233308/https://thetinhat.com
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_unixtime: 1596669150
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * consensus/valid-after: 2020-08-05 21:00:00
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_time          : 2020-08-05 23:12:30
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * consensus/valid-until: 2020-08-06 00:00:00
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * time_diff: 14 second(s)
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * timesanitycheck: sane
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - * remote_status: True
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Pool 1: gmg7jl25ony5g7ws.onion, web unixtime: 1596669146, web time: Wed Aug 05 23:12:26 UTC 2020, diff: 10 seconds
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Pool 2: ak2uqfavwgmjrvtu.onion, web unixtime: 1596669145, web time: Wed Aug 05 23:12:25 UTC 2020, diff: 9 seconds
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Pool 3: tinhat233xymse34.onion, web unixtime: 1596669150, web time: Wed Aug 05 23:12:30 UTC 2020, diff: 14 seconds
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - End fetching remote times.
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Pool differences, sorted: [9, 10, 14]
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Median time difference: +10.000000000
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - randomize             : -0.722118940
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - New time difference   : +9.277881060
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Old unixttime: 1596669136.589626789
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - New unixtime : 1596669145.867507935
Aug 05 23:12:16 host sdwdate[19362]: 2020-08-05 23:12:16 - sdwdate - INFO - Instantly setting the time by using command: /bin/date --set "@1596669145.867507935"
Aug 05 23:12:25 host sdwdate[19362]: 2020-08-05 23:12:25 - sdwdate - INFO - /bin/date output: Wed 05 Aug 2020 11:12:25 PM UTC
Aug 05 23:12:25 host sdwdate[19362]:  
Aug 05 23:12:25 host sdwdate[19362]: 2020-08-05 23:12:25 - sdwdate - INFO - Success. Sleeping for 139.73333333333332 minutes.
Aug 05 23:12:25 host sdwdate[19362]: 2020-08-05 23:12:25 - sdwdate - INFO - Running command: sleep 8384.255885362
</code></pre>
<p>But I just tried it again with the gui applet by choosing “sys-whonix -&gt; Restart sdwdate”, and it happens like before. Here’s the log (in -x format for readability):</p>
<pre><code>Aug 05 22:34:28 host systemd[1]: sdwdate.service: Succeeded.
-- Subject: Unit succeeded
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- The unit sdwdate.service has successfully entered the 'dead' state.
Aug 05 22:34:28 host systemd[1]: Stopped Secure Distributed Web Date.
-- Subject: A stop job for unit sdwdate.service has finished
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A stop job for unit sdwdate.service has finished.
-- 
-- The job identifier is 2309 and the job result is done.
Aug 05 22:34:28 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=sdwdate comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:28 host systemd[1]: Starting Secure Distributed Web Date...
-- Subject: A start job for unit sdwdate.service has begun execution
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit sdwdate.service has begun execution.
-- 
-- The job identifier is 2309.
Aug 05 22:34:28 host systemd[1]: Started Secure Distributed Web Date.
-- Subject: A start job for unit sdwdate.service has finished successfully
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit sdwdate.service has finished successfully.
-- 
-- The job identifier is 2309.
Aug 05 22:34:28 host sdwdate[18010]: 2020-08-05 22:34:28 - sdwdate - INFO - sdwdate started. PID: 18010
Aug 05 22:34:28 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=sdwdate comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:28 host sdwdate[18010]: 2020-08-05 22:34:28 - sdwdate - INFO - create temp_dir: /tmp/tmp.5jSUnsnxFj
Aug 05 22:34:28 host sdwdate[18010]: 2020-08-05 22:34:28 - sdwdate - INFO - Tor socks host: 127.0.0.1 Tor socks port: 9108
Aug 05 22:34:28 host sdwdate[18010]: 2020-08-05 22:34:28 - sdwdate - INFO - Running sdwdate main loop. iteration: 1 / 10000
Aug 05 22:34:29 host sdwdate[18010]: 2020-08-05 22:34:29 - sdwdate - INFO - Prerequisite check: The clock is sane.
Aug 05 22:34:29 host sdwdate[18010]: Within build timestamp Fri 11 Oct 2019 12:55:17 AM UTC and expiration timestamp Tue 17 May 2033 10:00:00 AM UTC.
Aug 05 22:34:29 host sdwdate[18010]: Clock within consensus parameters consensus/valid-after 2020-08-05 21:00:00 and consensus/valid-until 2020-08-06 00:00:00.
Aug 05 22:34:29 host sdwdate[18010]: 2020-08-05 22:34:29 - sdwdate - INFO - Prerequisite check: Tor fully bootstrapped.
Aug 05 22:34:29 host sdwdate[18010]: 2020-08-05 22:34:29 - sdwdate - INFO - Start fetching remote times.
Aug 05 22:34:29 host sdwdate[18010]: 2020-08-05 22:34:29 - sdwdate - INFO - Initial time fetching in progress...
Aug 05 22:34:29 host sdwdate[18010]: 2020-08-05 22:34:29 - sdwdate - INFO - Running sdwdate fetch loop. iteration: 1
Aug 05 22:34:29 host sdwdate[18010]: 2020-08-05 22:34:29 - sdwdate - INFO - Requested urls ['33y6fjyhs3phzfjj.onion', 'bvhfrslkkdbncdhv.onion', 'yuxv6qujajqvmypv.onion']
Aug 05 22:34:49 host audit[18063]: USER_ACCT pid=18063 uid=1000 auid=4294967295 ses=4294967295 msg='op=PAM:accounting grantors=pam_tally2,pam_permit acct="user" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:49 host sudo[18063]:     user : TTY=unknown ; PWD=/ ; USER=whonixcheck ; COMMAND=/usr/lib/whonixcheck/whonixcheck --daemon --gui --cli
Aug 05 22:34:49 host sudo[18063]: pam_unix(sudo:session): session opened for user whonixcheck by (uid=0)
Aug 05 22:34:49 host audit[18063]: USER_CMD pid=18063 uid=1000 auid=4294967295 ses=4294967295 msg='cwd="/" cmd=2F7573722F6C69622F77686F6E6978636865636B2F77686F6E6978636865636B202D2D6461656D6F6E202D2D677569202D2D636C69 terminal=? res=success'
Aug 05 22:34:49 host audit[18063]: CRED_REFR pid=18063 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="whonixcheck" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:49 host audit[18063]: USER_START pid=18063 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_open grantors=pam_permit,pam_unix acct="whonixcheck" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:49 host audit[18116]: USER_ACCT pid=18116 uid=110 auid=4294967295 ses=4294967295 msg='op=PAM:accounting grantors=pam_tally2,pam_permit acct="whonixcheck" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:49 host sudo[18116]: whonixcheck : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/systemd-detect-virt
Aug 05 22:34:49 host sudo[18116]: pam_unix(sudo:session): session opened for user root by (uid=0)
Aug 05 22:34:49 host audit[18116]: USER_CMD pid=18116 uid=110 auid=4294967295 ses=4294967295 msg='cwd="/" cmd="systemd-detect-virt" terminal=? res=success'
Aug 05 22:34:49 host audit[18116]: CRED_REFR pid=18116 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:49 host audit[18116]: USER_START pid=18116 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_open grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:49 host sudo[18116]: pam_unix(sudo:session): session closed for user root
Aug 05 22:34:49 host audit[18116]: USER_END pid=18116 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_close grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:49 host audit[18116]: CRED_DISP pid=18116 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:54 host sudo[18769]:     user : TTY=unknown ; PWD=/home/user ; USER=root ; ENV=msgdisptacher_username=whonixcheck msgdispatcher_identifier=whonixcheck msgdispatcher_appendix=messagex_done ; COMMAND=/usr/lib/msgcollector/msgdispatcher_delete_wrapper
Aug 05 22:34:54 host audit[18769]: USER_ACCT pid=18769 uid=1000 auid=4294967295 ses=4294967295 msg='op=PAM:accounting grantors=pam_tally2,pam_permit acct="user" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:54 host audit[18769]: USER_CMD pid=18769 uid=1000 auid=4294967295 ses=4294967295 msg='cwd="/home/user" cmd="/usr/lib/msgcollector/msgdispatcher_delete_wrapper" terminal=? res=success'
Aug 05 22:34:54 host audit[18769]: CRED_REFR pid=18769 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:54 host sudo[18769]: pam_unix(sudo:session): session opened for user root by (uid=0)
Aug 05 22:34:54 host audit[18769]: USER_START pid=18769 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_open grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:54 host sudo[18769]: pam_unix(sudo:session): session closed for user root
Aug 05 22:34:54 host audit[18769]: USER_END pid=18769 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_close grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:54 host audit[18769]: CRED_DISP pid=18769 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:54 host sudo[18063]: pam_unix(sudo:session): session closed for user whonixcheck
Aug 05 22:34:54 host audit[18063]: USER_END pid=18063 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_close grantors=pam_permit,pam_unix acct="whonixcheck" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:34:54 host audit[18063]: CRED_DISP pid=18063 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="whonixcheck" exe="/usr/bin/sudo" hostname=? addr=? terminal=? res=success'
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - Returned urls "['33y6fjyhs3phzfjj.onion', 'bvhfrslkkdbncdhv.onion', 'yuxv6qujajqvmypv.onion']"
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - remote 0: 33y6fjyhs3phzfjj.onion
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * comment: The Guardian        https://securedrop.theguardian.com        https://web.archive.org/web/20170408213324/https://securedrop.theguardian.com
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * remote_unixtime: 1596666884
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * consensus/valid-after: 2020-08-05 21:00:00
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * remote_time          : 2020-08-05 22:34:44
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * consensus/valid-until: 2020-08-06 00:00:00
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * time_diff: -35 second(s)
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * timesanitycheck: sane
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * remote_status: True
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - remote 1: bvhfrslkkdbncdhv.onion
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * comment: Canal Etico                http://denuncias.bufetecarrasco.net
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * status: False
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * value: Timeout
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - remote 2: yuxv6qujajqvmypv.onion
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * comment: https://anonguide.cyberguerrilla.org        https://web.archive.org/web/20170421233304/https://anonguide.cyberguerrilla.org
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * status: False
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - * value: Timeout
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - Pool 1: 33y6fjyhs3phzfjj.onion, web unixtime: 1596666884, web time: Wed Aug 05 22:34:44 UTC 2020, diff: -35 seconds
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - Running sdwdate fetch loop. iteration: 2
Aug 05 22:35:19 host sdwdate[18010]: 2020-08-05 22:35:19 - sdwdate - INFO - Requested urls ['ltcpool5brio2gaj.onion', 'h2qkxasmmqdmyiov.onion']
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - Returned urls "['ltcpool5brio2gaj.onion', 'h2qkxasmmqdmyiov.onion']"
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - remote 0: ltcpool5brio2gaj.onion
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * comment: https://www.litecoinpool.org/help        https://web.archive.org/web/20161114095946/https://www.litecoinpool.org/help
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * remote_unixtime: 1596666950
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * consensus/valid-after: 2020-08-05 21:00:00
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * remote_time          : 2020-08-05 22:35:50
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * consensus/valid-until: 2020-08-06 00:00:00
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * time_diff: 11 second(s)
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * timesanitycheck: sane
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * remote_status: True
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - remote 1: h2qkxasmmqdmyiov.onion
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * comment: mail.systemli.org        https://www.systemli.org/en/service/mail.html        https://web.archive.org/web/20161105061658/https://www.systemli.org/en/service/mail.html
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * remote_unixtime: 1596666937
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * consensus/valid-after: 2020-08-05 21:00:00
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * remote_time          : 2020-08-05 22:35:37
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * consensus/valid-until: 2020-08-06 00:00:00
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * time_diff: -2 second(s)
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * timesanitycheck: sane
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - * remote_status: True
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - Pool 2: ltcpool5brio2gaj.onion, web unixtime: 1596666950, web time: Wed Aug 05 22:35:50 UTC 2020, diff: 11 seconds
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - Pool 3: h2qkxasmmqdmyiov.onion, web unixtime: 1596666937, web time: Wed Aug 05 22:35:37 UTC 2020, diff: -2 seconds
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - End fetching remote times.
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - Pool differences, sorted: [-35, -2, 11]
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - Median time difference: -2.000000000
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - randomize             : -0.983622351
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - New time difference   : -2.983622351
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - Old unixttime: 1596666939.935923100
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - New unixtime : 1596666936.952300787
Aug 05 22:35:39 host sdwdate[18010]: 2020-08-05 22:35:39 - sdwdate - INFO - Instantly setting the time by using command: /bin/date --set "@1596666936.952300787"
Aug 05 22:35:36 host sdwdate[18010]: 2020-08-05 22:35:36 - sdwdate - INFO - /bin/date output: Wed 05 Aug 2020 10:35:36 PM UTC
Aug 05 22:35:36 host sdwdate[18010]:  
Aug 05 22:35:36 host firewall-restarter[721]: + '[' /run/sdwdate/first_success = /run/sdwdate/first_success ']'
Aug 05 22:35:36 host firewall-restarter[721]: + systemctl --no-pager --no-block status whonix-firewall
Aug 05 22:35:36 host sdwdate[18010]: 2020-08-05 22:35:36 - sdwdate - INFO - Success. Sleeping for 157.9 minutes.
Aug 05 22:35:36 host sdwdate[18010]: 2020-08-05 22:35:36 - sdwdate - INFO - Running command: sleep 9474.600957450
Aug 05 22:35:36 host firewall-restarter[721]: ● whonix-firewall.service - Whonix firewall loader
Aug 05 22:35:36 host firewall-restarter[721]:    Loaded: loaded (/lib/systemd/system/whonix-firewall.service; enabled; vendor preset: enabled)
Aug 05 22:35:36 host firewall-restarter[721]:    Active: active (exited) since Wed 2020-08-05 22:29:06 UTC; 6min ago
Aug 05 22:35:36 host firewall-restarter[721]:      Docs: https://www.whonix.org/wiki/Whonix_Firewall
Aug 05 22:35:36 host firewall-restarter[721]:   Process: 17727 ExecStart=/usr/lib/whonix-firewall/enable-firewall (code=exited, status=0/SUCCESS)
Aug 05 22:35:36 host firewall-restarter[721]:  Main PID: 17727 (code=exited, status=0/SUCCESS)
Aug 05 22:35:36 host firewall-restarter[721]: Aug 05 22:29:06 host systemd[1]: Starting Whonix firewall loader...
Aug 05 22:35:36 host firewall-restarter[721]: Aug 05 22:29:06 host enable-firewall[17727]: 2020-08-05 22:29:06 - /usr/bin/whonix-gateway-firewall - OK: Loading Whonix firewall...
Aug 05 22:35:36 host firewall-restarter[721]: Aug 05 22:29:06 host enable-firewall[17727]: 2020-08-05 22:29:06 - /usr/bin/whonix-gateway-firewall - OK: Skipping firewall mode detection since already set to 'full'.
Aug 05 22:35:36 host firewall-restarter[721]: Aug 05 22:29:06 host enable-firewall[17727]: 2020-08-05 22:29:06 - /usr/bin/whonix-gateway-firewall - OK: (Full torified network access allowed.)
Aug 05 22:35:36 host firewall-restarter[721]: Aug 05 22:29:06 host enable-firewall[17727]: 2020-08-05 22:29:06 - /usr/bin/whonix-gateway-firewall - OK: Whonix firewall loaded.
Aug 05 22:35:36 host firewall-restarter[721]: Aug 05 22:29:06 host systemd[1]: Started Whonix firewall loader.
Aug 05 22:35:36 host firewall-restarter[721]: + systemctl --no-pager --no-block restart whonix-firewall
Aug 05 22:35:36 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=qubes-whonix-network comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 22:35:36 host systemd[1]: qubes-whonix-network.service: Succeeded.
-- Subject: Unit succeeded
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- The unit qubes-whonix-network.service has successfully entered the 'dead' state.
Aug 05 22:35:36 host systemd[1]: Stopped sets up Qubes-Whonix-Gateway external and internal network interface.
-- Subject: A stop job for unit qubes-whonix-network.service has finished
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A stop job for unit qubes-whonix-network.service has finished.
-- 
-- The job identifier is 2437 and the job result is done.
Aug 05 22:35:36 host systemd[1]: Stopping sets up Qubes-Whonix-Gateway external and internal network interface...
-- Subject: A stop job for unit qubes-whonix-network.service has begun execution
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A stop job for unit qubes-whonix-network.service has begun execution.
-- 
-- The job identifier is 2437.
Aug 05 22:35:36 host systemd[1]: Stopping Tor control port filter proxy...
-- Subject: A stop job for unit onion-grater.service has begun execution
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A stop job for unit onion-grater.service has begun execution.
-- 
-- The job identifier is 2378.
Aug 05 22:35:36 host firewall-restarter[721]: + read file_name
Aug 05 22:35:36 host systemd[1]: onion-grater.service: Main process exited, code=killed, status=15/TERM
-- Subject: Unit process exited
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- An ExecStart= process belonging to unit onion-grater.service has exited.
-- 
-- The process' exit code is 'killed' and its exit status is 15.
Aug 05 22:35:36 host systemd[1]: onion-grater.service: Succeeded.
-- Subject: Unit succeeded
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- The unit onion-grater.service has successfully entered the 'dead' state.
Aug 05 22:35:36 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=onion-grater comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 22:35:36 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=whonix-firewall comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 22:35:36 host systemd[1]: Stopped Tor control port filter proxy.
-- Subject: A stop job for unit onion-grater.service has finished
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A stop job for unit onion-grater.service has finished.
-- 
-- The job identifier is 2378 and the job result is done.
Aug 05 22:35:36 host systemd[1]: whonix-firewall.service: Succeeded.
-- Subject: Unit succeeded
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- The unit whonix-firewall.service has successfully entered the 'dead' state.
Aug 05 22:35:36 host systemd[1]: Stopped Whonix firewall loader.
-- Subject: A stop job for unit whonix-firewall.service has finished
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A stop job for unit whonix-firewall.service has finished.
-- 
-- The job identifier is 2373 and the job result is done.
Aug 05 22:35:36 host systemd[1]: Stopping Whonix firewall loader...
-- Subject: A stop job for unit whonix-firewall.service has begun execution
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A stop job for unit whonix-firewall.service has begun execution.
-- 
-- The job identifier is 2373.
Aug 05 22:35:36 host systemd[1]: Starting Whonix firewall loader...
-- Subject: A start job for unit whonix-firewall.service has begun execution
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit whonix-firewall.service has begun execution.
-- 
-- The job identifier is 2373.
Aug 05 22:35:37 host enable-firewall[18854]: 2020-08-05 22:35:37 - /usr/bin/whonix-gateway-firewall - OK: Loading Whonix firewall...
Aug 05 22:35:37 host enable-firewall[18854]: 2020-08-05 22:35:37 - /usr/bin/whonix-gateway-firewall - OK: Skipping firewall mode detection since already set to 'full'.
Aug 05 22:35:37 host enable-firewall[18854]: 2020-08-05 22:35:37 - /usr/bin/whonix-gateway-firewall - OK: (Full torified network access allowed.)
Aug 05 22:35:37 host enable-firewall[18854]: 2020-08-05 22:35:37 - /usr/bin/whonix-gateway-firewall - OK: Whonix firewall loaded.
Aug 05 22:35:37 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=whonix-firewall comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 22:35:37 host systemd[1]: Started Whonix firewall loader.
-- Subject: A start job for unit whonix-firewall.service has finished successfully
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit whonix-firewall.service has finished successfully.
-- 
-- The job identifier is 2373.
Aug 05 22:35:37 host systemd[1]: Starting sets up Qubes-Whonix-Gateway external and internal network interface...
-- Subject: A start job for unit qubes-whonix-network.service has begun execution
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit qubes-whonix-network.service has begun execution.
-- 
-- The job identifier is 2437.
Aug 05 22:35:37 host network-proxy-setup[19008]: + source /usr/lib/qubes-whonix/utility_functions.sh
Aug 05 22:35:37 host network-proxy-setup[19008]: ++ systemctl -q is-active qubes-updates-proxy-forwarder.socket
Aug 05 22:35:37 host systemd[1]: Starting Tor control port filter proxy...
-- Subject: A start job for unit onion-grater.service has begun execution
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit onion-grater.service has begun execution.
-- 
-- The job identifier is 2378.
Aug 05 22:35:37 host network-proxy-setup[19008]: ++ PROXY_SERVER=http://10.137.255.254:8082/
Aug 05 22:35:37 host network-proxy-setup[19008]: ++ PROXY_META='&lt;meta name="application-name" content="tor proxy"/&gt;'
Aug 05 22:35:37 host network-proxy-setup[19008]: ++ qubesdb-read /qubes-vm-type
Aug 05 22:35:37 host network-proxy-setup[19008]: + qubes_vm_type=ProxyVM
Aug 05 22:35:37 host network-proxy-setup[19008]: + '[' ProxyVM = TemplateVM ']'
Aug 05 22:35:37 host network-proxy-setup[19008]: + '[' '!' -e /usr/share/anon-gw-base-files/gateway ']'
Aug 05 22:35:37 host network-proxy-setup[19008]: + /sbin/ethtool -K eth0 sg off
Aug 05 22:35:37 host network-proxy-setup[19008]: + INTERFACE=eth1
Aug 05 22:35:37 host network-proxy-setup[19008]: + ip link show eth1
Aug 05 22:35:37 host network-proxy-setup[19008]: 5: eth1: &lt;BROADCAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
Aug 05 22:35:37 host network-proxy-setup[19008]:     link/ether 7a:6d:47:53:f9:2c brd ff:ff:ff:ff:ff:ff
Aug 05 22:35:37 host network-proxy-setup[19008]: + exit 0
Aug 05 22:35:37 host systemd[1]: Started sets up Qubes-Whonix-Gateway external and internal network interface.
-- Subject: A start job for unit qubes-whonix-network.service has finished successfully
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit qubes-whonix-network.service has finished successfully.
-- 
-- The job identifier is 2437.
Aug 05 22:35:37 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=qubes-whonix-network comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 05 22:35:37 host onion-grater[19014]: Tor control port filter started, listening on 10.137.0.69:9051
Aug 05 22:35:37 host onion-grater[19014]: Serving Thread started
Aug 05 22:35:38 host systemd[1]: Started Tor control port filter proxy.
-- Subject: A start job for unit onion-grater.service has finished successfully
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- A start job for unit onion-grater.service has finished successfully.
-- 
-- The job identifier is 2378.
</code></pre>
<p>So that’s another branch to contend with.</p>
<p>Interestingly, the <code>systemctl restart sdwdate</code> method does <strong>not</strong> appear to trigger the bug in Tor Browser!</p>
<p>Note: It appears sclockadj is started when the gateway boots. If sclockadj is already running when you <code>systemctl restart sdwdate</code>, sdwdate will invoke sclockadj instead of <code>date</code>:</p>
<pre><code>sdwdate - INFO - Gradually adjusting the time by running sclockadj using command: /usr/lib/sdwdate/sclockadj "41800313641"
</code></pre>
<p>But, when sdwdate is restarted via the gui, it seems that sclockadj is killed at some point, and therefore it’s not running when sdwdate starts back up</p>
<pre><code>sdwdate - INFO - sclockadj not running, ok.
</code></pre>
<p>… which causes sdwdate to use <code>date</code> instead of <code>sclockadj</code></p>
<pre><code>sdwdate - INFO - Instantly setting the time by using command: /bin/date --set "@1596671422.487272263"
</code></pre>
<p>(In other words: any time you restart sdwdate via the gui, from then on it will use <code>date</code> instead of <code>sclockadj</code>.)</p>
<p>So that’s yet another branch to contend with.</p>
<p>Originally I thought that might be important, however from the couple of tests I did, it does <strong>not</strong> seem to matter whether sdwdate invokes <code>date</code> or <code>sclockadj</code>. In either case, <code>systemctl restart sdwdate</code> does <strong>not</strong> seem to trigger the bug for me, like it does from the gui.</p>
<p>This would suggest it’s the restart of onion-grater that’s triggering the bug. However that contradicts your results where simply running <code>date</code> in sys-whonix was enough to trigger the bug, as that shouldn’t have anything to do with onion-grater nor sdwdate, right? I’m confused now.</p>
<p>So to recap:<br>
What <strong>does</strong> trigger the bug:</p>
<ul>
<li>Killing or restarting the Tor process (even when Tor is on the same machine as the browser, as in Tor Browser Bundle).</li>
<li>Killing or restarting systemd-socket-proxyd in anon-whonix</li>
<li>Killing or restarting onion-grater in sys-whonix</li>
<li>Restarting sdwdate via the gui in sys-whonix</li>
<li>Killing the sys-whonix VM</li>
<li>Or, basically, anything that breaks connection chain from the browser to the control port.</li>
</ul>
<p>What does <strong>not</strong> trigger the bug:</p>
<ul>
<li>
<code>systemctl restart sdwdate</code> in sys-whonix, and sdwdate invokes <code>sclockadj</code>
</li>
<li>
<code>systemctl restart sdwdate</code> in sys-whonix, and sdwdate invokes <code>date</code>
</li>
</ul>
<p><a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a>: Could you try this?</p>
<ol>
<li>In sys-whonix, or anon-whonix for that matter, use <code>tor-prompt -i 10.137.x.x:9051</code> or similar to connect to onion-grater. Leave it open.</li>
<li>Trigger the bug in Tor Browser using <code>date</code> in another terminal.</li>
<li>Switch back to the tor-prompt window and type a command to see if the connection is still alive.</li>
</ol>
<p>I still can’t trigger the bug by just invoking date in sys-whonix, for example using <code>date --set @$(( $(date +%s) + 30 ))</code>. Can you clarify how you did so in more detail?</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/14</link>
        <pubDate>Thu, 06 Aug 2020 00:54:20 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-14</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Perhaps it can be triggered by restarting onion-grater only?</p>
<aside class="quote no-group" data-username="ak88" data-post="11" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>This part might be Whonix-specific, because when sdwdate restarts in sys-whonix it causes a bunch of other services to restart, including onion-grater</p>
</blockquote>
</aside>
<p>Can’t reproduce this.</p>
<p>If I <code>sudo systemctl restart sdwdate</code> in sys-whonix I don’t see onion-grater restarting. It shouldn’t. I wouldn’t know why.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/13</link>
        <pubDate>Wed, 05 Aug 2020 20:16:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-13</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Fost]]></dc:creator>
        <description><![CDATA[
            <p>Great work,</p>
<p>Would one the testing scenarios mentioned with sdwdate affect or be partial required for remote desktop access from another VM?</p>
<p>thanks,</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/12</link>
        <pubDate>Wed, 05 Aug 2020 02:42:14 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-12</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <p>Okay, I definitely took the scenic route, but I think I can rule out Whonix Workstation at least. (Gateway is up for debate.)</p>
<p>I can reproduce this in a vanilla Tor Browser using the local bundled Tor, just by killing the Tor process. Even after restarting and reconnecting Tor, the browser uses 100% CPU. Apparently whenever the control socket is closed by the other end, Tor Browser / Tor Launcher doesn’t know how to handle it and starts eating CPU. It also happens even if you just kill systemd-socket-proxyd locally in anon-whonix. You can observe using <code>tor-prompt</code> from the <code>python-stem</code> package:</p>
<pre><code>.tb/tor-browser_en-US/Browser/start-tor-browser &amp;
tor-prompt -i 10.152.152.10:9051 #or 127.0.0.1:9151
&gt;&gt;&gt; help
510 Command filtered
# in sys-whonix: suspend/resume, restart sdwdate, kill Tor, or just kill the VM
&gt;&gt;&gt; help
(y/n) control port has closed. Do you want to continue this interpreter?
# Tor Browser now eating CPU
</code></pre>
<p>When sdwdate restarts in sys-whonix, the control connection is broken; though I’m not sure if it’s Tor, onion-grater, or systemd-socket-proxyd, or something else in the chain.</p>
<pre><code>tor-prompt -i 10.152.152.10:9051
&gt;&gt;&gt; help
510 Command filtered
# restart sdwdate via gui
&gt;&gt;&gt; help
(y/n) control port has closed. Do you want to continue this interpreter?
</code></pre>
<p>I was able to reproduce it in Debian by changing about:config <code>extensions.torlauncher.control_host=10.152.152.10</code> and <code>extensions.torlauncher.control_port=9051</code>. Tor Launcher doesn’t give any indication of whether it’s connected to the control port or not until you hit “new identity,” so I didn’t realize it wasn’t it wasn’t connected to the <em>control</em> port.</p>
<p>So we definitely have an upstream bug with Tor Browser Bundle.</p>
<p>However I still have not been able to trigger it by using <code>date</code> on sys-whonix. This part might be Whonix-specific, because when sdwdate restarts in sys-whonix it causes a bunch of other services to restart, including onion-grater which breaks the control connection which would cause the aforementioned behavior. It would also explain why it only happens when sdwdate is restarted, and not every time sdwdate does a background sync while running normally (assuming that is the case). But again, I haven’t been able to trigger it with <code>date</code> myself, so I don’t know. Do you have to change the time by a certain minimum amount to trigger it? What commands did you use?</p>
<p>sys-whonix log after restarting sdwdate:</p>
<pre><code>Aug 04 20:58:45 host systemd[1]: Stopped Secure Distributed Web Date.
Aug 04 20:58:45 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=sdwdate comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 20:58:45 host systemd[1]: Starting Secure Distributed Web Date...
Aug 04 20:58:46 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=sdwdate comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 20:58:46 host systemd[1]: Started Secure Distributed Web Date.
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - sdwdate started. PID: 4141
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - create temp_dir: /tmp/tmp.bxXOtakBrq
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Tor socks host: 127.0.0.1 Tor socks port: 9108
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Running sdwdate main loop. iteration: 1 / 10000
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Prerequisite check: The clock is sane.
Aug 04 20:58:46 host sdwdate[4141]: Within build timestamp Fri 11 Oct 2019 12:55:17 AM UTC and expiration timestamp Tue 17 May 2033 10:00:00 AM UTC.
Aug 04 20:58:46 host sdwdate[4141]: Clock within consensus parameters consensus/valid-after 2020-08-04 19:00:00 and consensus/valid-until 2020-08-04 22:00:00.
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Prerequisite check: Tor fully bootstrapped.
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Start fetching remote times.
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Initial time fetching in progress...
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Running sdwdate fetch loop. iteration: 1
Aug 04 20:58:46 host sdwdate[4141]: 2020-08-04 20:58:46 - sdwdate - INFO - Requested urls ['mprt35sjunnxfa76.onion', 'gnjtzu5c2lv4zasv.onion', '2h3xkc7wmxthijqb.onion']
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Returned urls "['mprt35sjunnxfa76.onion', 'gnjtzu5c2lv4zasv.onion', '2h3xkc7wmxthijqb.onion']"
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - remote 0: mprt35sjunnxfa76.onion
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * comment: https://informant.taz.de        https://web.archive.org/web/20170329061908/https://informant.taz.de
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_unixtime: 1596574777
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * consensus/valid-after: 2020-08-04 19:00:00
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_time          : 2020-08-04 20:59:37
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * consensus/valid-until: 2020-08-04 22:00:00
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * time_diff: 30 second(s)
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * timesanitycheck: sane
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_status: True
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - remote 1: gnjtzu5c2lv4zasv.onion
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * comment: https://pgp.key-server.io        https://web.archive.org/web/20170421212020/https://pgp.key-server.io
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_unixtime: 1596574775
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * consensus/valid-after: 2020-08-04 19:00:00
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_time          : 2020-08-04 20:59:35
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * consensus/valid-until: 2020-08-04 22:00:00
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * time_diff: 28 second(s)
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * timesanitycheck: sane
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_status: True
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - remote 2: 2h3xkc7wmxthijqb.onion
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * comment: https://www.privacyfoundation.ch/de/kontakt.html        https://web.archive.org/web/20151210044252/http://www.privacyfoundation.ch/de/kontakt.html
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_unixtime: 1596574792
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * consensus/valid-after: 2020-08-04 19:00:00
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_time          : 2020-08-04 20:59:52
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * consensus/valid-until: 2020-08-04 22:00:00
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * time_diff: 45 second(s)
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * timesanitycheck: sane
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * time_consensus_sanity_check: sane
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - * remote_status: True
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Pool 1: mprt35sjunnxfa76.onion, web unixtime: 1596574777, web time: Tue Aug 04 20:59:37 UTC 2020, diff: 30 seconds
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Pool 2: gnjtzu5c2lv4zasv.onion, web unixtime: 1596574775, web time: Tue Aug 04 20:59:35 UTC 2020, diff: 28 seconds
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Pool 3: 2h3xkc7wmxthijqb.onion, web unixtime: 1596574792, web time: Tue Aug 04 20:59:52 UTC 2020, diff: 45 seconds
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - End fetching remote times.
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Pool differences, sorted: [28, 30, 45]
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Median time difference: +30.000000000
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - randomize             : -0.129371830
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - New time difference   : +29.870628170
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Old unixttime: 1596574747.067768335
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - New unixtime : 1596574776.938396454
Aug 04 20:59:07 host sdwdate[4141]: 2020-08-04 20:59:07 - sdwdate - INFO - Instantly setting the time by using command: /bin/date --set "@1596574776.938396454"
Aug 04 20:59:36 host sdwdate[4141]: 2020-08-04 20:59:36 - sdwdate - INFO - /bin/date output: Tue 04 Aug 2020 08:59:36 PM UTC
Aug 04 20:59:36 host sdwdate[4141]:  
Aug 04 20:59:36 host firewall-restarter[679]: + '[' /run/sdwdate/first_success = /run/sdwdate/first_success ']'
Aug 04 20:59:36 host firewall-restarter[679]: + systemctl --no-pager --no-block status whonix-firewall
Aug 04 20:59:36 host sdwdate[4141]: 2020-08-04 20:59:36 - sdwdate - INFO - Success. Sleeping for 105.16666666666667 minutes.
Aug 04 20:59:36 host sdwdate[4141]: 2020-08-04 20:59:36 - sdwdate - INFO - Running command: sleep 6310.216409500
Aug 04 20:59:36 host firewall-restarter[679]: ● whonix-firewall.service - Whonix firewall loader
Aug 04 20:59:36 host firewall-restarter[679]:    Loaded: loaded (/lib/systemd/system/whonix-firewall.service; enabled; vendor preset: enabled)
Aug 04 20:59:36 host firewall-restarter[679]:    Active: active (exited) since Tue 2020-08-04 20:49:01 UTC; 10min ago
Aug 04 20:59:36 host firewall-restarter[679]:      Docs: https://www.whonix.org/wiki/Whonix_Firewall
Aug 04 20:59:36 host firewall-restarter[679]:   Process: 3819 ExecStart=/usr/lib/whonix-firewall/enable-firewall (code=exited, status=0/SUCCESS)
Aug 04 20:59:36 host firewall-restarter[679]:  Main PID: 3819 (code=exited, status=0/SUCCESS)
Aug 04 20:59:36 host firewall-restarter[679]: Aug 04 20:49:00 host systemd[1]: Starting Whonix firewall loader...
Aug 04 20:59:36 host firewall-restarter[679]: Aug 04 20:49:00 host enable-firewall[3819]: 2020-08-04 20:49:00 - /usr/bin/whonix-gateway-firewall - OK: Loading Whonix firewall...
Aug 04 20:59:36 host firewall-restarter[679]: Aug 04 20:49:00 host enable-firewall[3819]: 2020-08-04 20:49:00 - /usr/bin/whonix-gateway-firewall - OK: Skipping firewall mode detection since already set to 'full'.
Aug 04 20:59:36 host firewall-restarter[679]: Aug 04 20:49:00 host enable-firewall[3819]: 2020-08-04 20:49:00 - /usr/bin/whonix-gateway-firewall - OK: (Full torified network access allowed.)
Aug 04 20:59:36 host firewall-restarter[679]: Aug 04 20:49:01 host enable-firewall[3819]: 2020-08-04 20:49:01 - /usr/bin/whonix-gateway-firewall - OK: Whonix firewall loaded.
Aug 04 20:59:36 host firewall-restarter[679]: Aug 04 20:49:01 host systemd[1]: Started Whonix firewall loader.
Aug 04 20:59:36 host firewall-restarter[679]: + systemctl --no-pager --no-block restart whonix-firewall
Aug 04 20:59:36 host systemd[1]: qubes-whonix-network.service: Succeeded.
Aug 04 20:59:36 host systemd[1]: Stopped sets up Qubes-Whonix-Gateway external and internal network interface.
Aug 04 20:59:36 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=qubes-whonix-network comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 20:59:36 host systemd[1]: Stopping sets up Qubes-Whonix-Gateway external and internal network interface...
Aug 04 20:59:36 host systemd[1]: Stopping Tor control port filter proxy...
Aug 04 20:59:36 host firewall-restarter[679]: + read file_name
Aug 04 20:59:36 host systemd[1]: onion-grater.service: Main process exited, code=killed, status=15/TERM
Aug 04 20:59:36 host systemd[1]: onion-grater.service: Succeeded.
Aug 04 20:59:36 host systemd[1]: Stopped Tor control port filter proxy.
Aug 04 20:59:36 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=onion-grater comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 20:59:36 host systemd[1]: whonix-firewall.service: Succeeded.
Aug 04 20:59:36 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=whonix-firewall comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 20:59:36 host systemd[1]: Stopped Whonix firewall loader.
Aug 04 20:59:36 host systemd[1]: Stopping Whonix firewall loader...
Aug 04 20:59:36 host systemd[1]: Starting Whonix firewall loader...
Aug 04 20:59:36 host enable-firewall[4206]: 2020-08-04 20:59:36 - /usr/bin/whonix-gateway-firewall - OK: Loading Whonix firewall...
Aug 04 20:59:36 host enable-firewall[4206]: 2020-08-04 20:59:36 - /usr/bin/whonix-gateway-firewall - OK: Skipping firewall mode detection since already set to 'full'.
Aug 04 20:59:37 host enable-firewall[4206]: 2020-08-04 20:59:37 - /usr/bin/whonix-gateway-firewall - OK: (Full torified network access allowed.)
Aug 04 20:59:37 host enable-firewall[4206]: 2020-08-04 20:59:37 - /usr/bin/whonix-gateway-firewall - OK: Whonix firewall loaded.
Aug 04 20:59:37 host systemd[1]: Started Whonix firewall loader.
Aug 04 20:59:37 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=whonix-firewall comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 20:59:37 host systemd[1]: Starting Tor control port filter proxy...
Aug 04 20:59:37 host systemd[1]: Starting sets up Qubes-Whonix-Gateway external and internal network interface...
Aug 04 20:59:37 host network-proxy-setup[4361]: + source /usr/lib/qubes-whonix/utility_functions.sh
Aug 04 20:59:37 host network-proxy-setup[4361]: ++ systemctl -q is-active qubes-updates-proxy-forwarder.socket
Aug 04 20:59:37 host network-proxy-setup[4361]: ++ PROXY_SERVER=http://10.137.255.254:8082/
Aug 04 20:59:37 host network-proxy-setup[4361]: ++ PROXY_META='&lt;meta name="application-name" content="tor proxy"/&gt;'
Aug 04 20:59:37 host network-proxy-setup[4361]: ++ qubesdb-read /qubes-vm-type
Aug 04 20:59:37 host network-proxy-setup[4361]: + qubes_vm_type=ProxyVM
Aug 04 20:59:37 host network-proxy-setup[4361]: + '[' ProxyVM = TemplateVM ']'
Aug 04 20:59:37 host network-proxy-setup[4361]: + '[' '!' -e /usr/share/anon-gw-base-files/gateway ']'
Aug 04 20:59:37 host network-proxy-setup[4361]: + /sbin/ethtool -K eth0 sg off
Aug 04 20:59:37 host network-proxy-setup[4361]: + INTERFACE=eth1
Aug 04 20:59:37 host network-proxy-setup[4361]: + ip link show eth1
Aug 04 20:59:37 host network-proxy-setup[4361]: 3: eth1: &lt;BROADCAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
Aug 04 20:59:37 host network-proxy-setup[4361]: + exit 0
Aug 04 20:59:37 host systemd[1]: Started sets up Qubes-Whonix-Gateway external and internal network interface.
Aug 04 20:59:37 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=qubes-whonix-network comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 20:59:37 host onion-grater[4366]: Tor control port filter started, listening on 10.137.0.69:9051
Aug 04 20:59:37 host onion-grater[4366]: Serving Thread started
Aug 04 20:59:38 host systemd[1]: Started Tor control port filter proxy.
Aug 04 20:59:38 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=onion-grater comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Aug 04 21:00:48 host qubes.StartApp+qubes-run-terminal-dom0[4085]: 
Aug 04 21:00:48 host qubes.StartApp+qubes-run-terminal-dom0[4085]: (xfce4-terminal:4095): Gdk-CRITICAL **: 21:00:48.868: gdk_window_get_window_type: assertion 'GDK_IS_WINDOW (window)' failed
Aug 04 21:01:09 host sudo[4127]: pam_unix(sudo:session): session closed for user root
Aug 04 21:01:09 host audit[4127]: USER_END pid=4127 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_close grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/0 res=success'
Aug 04 21:01:09 host audit[4127]: CRED_DISP pid=4127 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/0 res=success'
Aug 04 21:01:19 host audit[4378]: USER_ACCT pid=4378 uid=1000 auid=4294967295 ses=4294967295 msg='op=PAM:accounting grantors=pam_tally2,pam_permit acct="user" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/0 res=success'
Aug 04 21:01:19 host sudo[4378]:     user : TTY=pts/0 ; PWD=/home/user ; USER=root ; COMMAND=/usr/bin/journalctl -e
Aug 04 21:01:19 host sudo[4378]: pam_unix(sudo:session): session opened for user root by (uid=0)
Aug 04 21:01:19 host audit[4378]: USER_CMD pid=4378 uid=1000 auid=4294967295 ses=4294967295 msg='cwd="/home/user" cmd=6A6F75726E616C63746C202D65 terminal=pts/0 res=success'
Aug 04 21:01:19 host audit[4378]: CRED_REFR pid=4378 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:setcred grantors=pam_tally2,pam_wheel,pam_permit acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/0 res=success'
Aug 04 21:01:19 host audit[4378]: USER_START pid=4378 uid=0 auid=4294967295 ses=4294967295 msg='op=PAM:session_open grantors=pam_permit,pam_unix acct="root" exe="/usr/bin/sudo" hostname=? addr=? terminal=/dev/pts/0 res=success'</code></pre>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/11</link>
        <pubDate>Tue, 04 Aug 2020 22:47:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-11</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Excellent problem solving, debugging skills. <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/10</link>
        <pubDate>Mon, 03 Aug 2020 12:00:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-10</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="8" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I guess it would happen in Debian equally (one VM Tor Browser, another<br>
VM running Tor).</p>
</blockquote>
</aside>
<p>Well, I haven’t been able to reproduce it on Debian, even after verifying that it was in fact proxying through sys-whonix and not the local bundled Tor client. It was via the transparent proxy though. I guess it could be SOCKS-specific, so maybe I’ll try it again using the SOCKSPort.</p>
<aside class="quote no-group" data-username="ak88" data-post="7" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>probably involve rebuilding the whole Tor Browser with debugging symbols and what not.</p>
</blockquote>
</aside>
<p>It turns out, Tor project actually distributes a binary version with debugging symbols enabled. Mad props to them; they’ve really thought of everything. I just extracted it in a Whonix DispVM minutes ago, so I’ll be trying that shortly.</p>
<pre><code>https://dist.torproject.org/torbrowser/&lt;version&gt;/tor-browser-linux64-&lt;version&gt;-debug.tar.xz
</code></pre>
<aside class="quote no-group" data-username="Patrick" data-post="8" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>However, I guess there isn’t much Whonix specific here.</p>
</blockquote>
</aside>
<p>Again, I haven’t been able to reproduce it anywhere but Whonix. Even when Debian and Whonix-WS are connected to the same gateway, I can trigger the Whonix one every time just about, but never the Debian one. (I still have to try with SOCKS, though.) It doesn’t mean it’s Whonix’s fault necessarily, but it does seem Whonix-specific to me so far.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/9</link>
        <pubDate>Mon, 03 Aug 2020 11:57:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-9</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>ak88 via Whonix Forum:</p>
<blockquote>
<p>Thanks, I have a much better understanding now.</p>
<aside class="quote no-group" data-username="Patrick" data-post="6" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I managed to strip out sdwdate from reproduction already.</p>
</blockquote>
</aside>
<p>Oh, I guess I could have skipped over all that sdwdate stuff then. Meh, I’ll call it a learning exercise. I thought it was still just a hunch; I didn’t realize you actually reproduced it yet. My mistake.</p>
</blockquote>
<p>I might not have expressed that.</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="6" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Changing time by using <code>date</code> on Whonix-Gateway the<br>
triggering condition.</p>
</blockquote>
</aside>
<p>I see. So, in my testing so far, <code>date</code> was just being invoked by sdwdate instead of by the user. I’ll cut sdwdate out of the picture from now on though.</p>
<p>So at this point I guess we’re trying to figure out what’s causing the the tight loop in Tor Browser, and why it only happens on Whonix and not Debian?</p>
</blockquote>
<p>I guess it would happen in Debian equally (one VM Tor Browser, another<br>
VM running Tor).</p>
<blockquote>
<p>I’ve already exhausted all the high-level methods I can think of. One approach is straight-up debugging of course, which will probably involve rebuilding the whole Tor Browser with debugging symbols and what not.</p>
</blockquote>
<p>That would be great!</p>
<blockquote>
<p>Do you think an alternative approach would be to incrementally turn Debian into Whonix by installing packages from the Whonix repo, and try to narrow down when and where the problem first appears?</p>
</blockquote>
<p>That would be an option.</p>
<p>However, I guess there isn’t much Whonix specific here.</p>
<p>one VM Tor Browser, another VM running Tor - if you could reproduce that</p>
<ul>
<li>that might already suffice to trigger this Tor Browser bug by running<br>
<code>date</code> in the other VM (the VM running Tor).</li>
</ul>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/8</link>
        <pubDate>Mon, 03 Aug 2020 11:34:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-8</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <p>Thanks, I have a much better understanding now.</p>
<aside class="quote no-group" data-username="Patrick" data-post="6" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I managed to strip out sdwdate from reproduction already.</p>
</blockquote>
</aside>
<p>Oh, I guess I could have skipped over all that sdwdate stuff then. Meh, I’ll call it a learning exercise. I thought it was still just a hunch; I didn’t realize you actually reproduced it yet. My mistake.</p>
<aside class="quote no-group" data-username="Patrick" data-post="6" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Changing time by using <code>date</code> on Whonix-Gateway the<br>
triggering condition.</p>
</blockquote>
</aside>
<p>I see. So, in my testing so far, <code>date</code> was just being invoked by sdwdate instead of by the user. I’ll cut sdwdate out of the picture from now on though.</p>
<p>So at this point I guess we’re trying to figure out what’s causing the the tight loop in Tor Browser, and why it only happens on Whonix and not Debian?</p>
<p>I’ve already exhausted all the high-level methods I can think of. One approach is straight-up debugging of course, which will probably involve rebuilding the whole Tor Browser with debugging symbols and what not. And I can only imagine what the Firefox codebase looks like down in the weeds. I’m not looking forward to touching that hot mess.</p>
<p>Do you think an alternative approach would be to incrementally turn Debian into Whonix by installing packages from the Whonix repo, and try to narrow down when and where the problem first appears?</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/7</link>
        <pubDate>Sat, 01 Aug 2020 12:18:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-7</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>ak88 via Whonix Forum:</p>
<blockquote>
<p>I’m guessing by “one machine” you mean a whonix-ws-15 based AppVM such as anon-whonix, and by “another machine” you mean a whonix-gw-15 based AppVM such as sys-whonix?</p>
</blockquote>
<p>Yes.</p>
<p>I must use “one machine” and “another machine” because it has to be<br>
reproduced with as little Whonix-specifics as possible.</p>
<blockquote>
<p>As I understand, when sdwdate in sys-whonix is restarted, whether manually or by the suspend-post hook, it calls <code>date</code> to set the time in the sys-whonix VM. Is that correct? And you’re saying that the call to <code>date</code>, whether it’s called by sdwdate or anything else, is what causes Tor Browser in other VMs to act up?</p>
</blockquote>
<p>Yes.</p>
<blockquote>
<p>I was under the impression that sdwdate in each VM operates independently of any other VMs, except for the Tor SOCKSPort obviously.</p>
</blockquote>
<p>Correct.</p>
<blockquote>
<p>From what I can tell, sdwdate in workstation VMs continues to work even when sdwdate is not running in sys-whonix.</p>
</blockquote>
<p>Expected.</p>
<blockquote>
<p>Do the sdwdate processes interact across different VMs in some way that I don’t know about?</p>
</blockquote>
<p>No.</p>
<blockquote>
<p>So then, why are Whonix VMs the only ones affected?</p>
</blockquote>
<p>It does back to the “one VM”, “other VM” thing.</p>
<blockquote>
<p>What I don’t understand is: what does sdwdate in sys-whonix have to do<br>
with sdwdate in anon-whonix or any other VM?</p>
</blockquote>
<p>Because Tor is running on Whonix-Gateway (“other VM”). And Tor Browser<br>
(running in “one VM”) is talking to Tor which is running in the “other<br>
VM”. Tor, kernel, networking or anything changing time in the “other VM”<br>
seems to confuse Tor Browser.</p>
<p>I managed to strip out sdwdate from reproduction already. sdwdate is<br>
unrelated. Changing time by using <code>date</code> on Whonix-Gateway the<br>
triggering condition.</p>
<p>Didn’t reproduce in a “one VM”, “other VM” setup with split Tor (similar<br>
gateway / workstation) yet.</p>
<blockquote>
<p>When I ran sdwdate in debian-10 (which is not exactly trivial by the way),</p>
</blockquote>
<p>Indeed.</p>
<blockquote>
<p>but it the VM doesn’t show up in the sys-whonix tray menu (sdwdate-gui-qubes).</p>
</blockquote>
<p>That’s undocumented. Non-obvious for sure. Requires Qubes dom0 qrexec<br>
configuration.</p>
<blockquote>
<p>Based on your comment about <code>date</code>, it doesn’t sound like it would matter whether sdwdate-gui is registered with sdwdate-gui-qubes or not.</p>
</blockquote>
<p>No, the sdwdate-gui anything is completely unrelated.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/6</link>
        <pubDate>Sat, 01 Aug 2020 09:52:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-6</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <p>I’ve read over the qubes thread and sdwdate documentation several times now, and to be perfectly honest with you, I still don’t fully grasp the situation. The whole time syncronization scheme on Qubes-Whonix is utterly confusing to me.</p>
<aside class="quote no-group" data-username="Patrick" data-post="4" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>For reproduction it needs to be connected to Tor running in another VM.</p>
</blockquote>
</aside>
<p>It was, via the transproxy, with tor-launcher disabled. I verified with the onion circuits app.</p>
<aside class="quote no-group" data-username="Patrick" data-post="1" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I suspect it is this:</p>
<ul>
<li>Tor Browser is running on one machine and talking to Tor on another machine.</li>
<li>When time is changed using <code>date</code> on <em><strong>another machine</strong></em> , Tor Browser starts to use 100% CPU.</li>
</ul>
</blockquote>
</aside>
<p>I’m guessing by “one machine” you mean a whonix-ws-15 based AppVM such as anon-whonix, and by “another machine” you mean a whonix-gw-15 based AppVM such as sys-whonix?</p>
<p>As I understand, when sdwdate in sys-whonix is restarted, whether manually or by the suspend-post hook, it calls <code>date</code> to set the time in the sys-whonix VM. Is that correct? And you’re saying that the call to <code>date</code>, whether it’s called by sdwdate or anything else, is what causes Tor Browser in other VMs to act up?</p>
<p>What I don’t understand is: what does sdwdate in sys-whonix have to do with sdwdate in anon-whonix or any other VM? I was under the impression that sdwdate in each VM operates independently of any other VMs, except for the Tor SOCKSPort obviously. From what I can tell, sdwdate in workstation VMs continues to work even when sdwdate is not running in sys-whonix. Do the sdwdate processes interact across different VMs in some way that I don’t know about?</p>
<p>So then, why are Whonix VMs the only ones affected? If this is not related to the workstation’s sdwdate, then it should affect Tor Browsers equally in any VM of any template, no?</p>
<p>Here’s a summary of my findings so far:<br>
Tor Browser (AnonDist) in whonix-ws-15 with sdwdate: bad<br>
Tor Browser (AnonDist) in whonix-ws-15 without sdwdate: bad<br>
Tor Browser in whonix-ws-15 with sdwdate: bad<br>
Tor Browser in whonix-ws-15 without sdwdate: bad<br>
Tor Browser in fedora-{30,31,32} without sdwdate: ok<br>
Tor Browser in debian-10 without sdwdate: ok<br>
Tor Browser in debian-10 with sdwdate: ok<br>
Tor Browser with TOR_SKIP_LAUNCH=1 TOR_TRANSPROXY=1 in debian-10 with sdwdate: ok</p>
<p>When I ran sdwdate in debian-10 (which is not exactly trivial by the way), the appeared to sync fine and it didn’t log any errors, but it the VM doesn’t show up in the sys-whonix tray menu (sdwdate-gui-qubes). Based on your comment about <code>date</code>, it doesn’t sound like it would matter whether sdwdate-gui is registered with sdwdate-gui-qubes or not. However that’s the only remaining difference between the debian-10 test case and whonix-ws-15, that I can think of at this time.</p>
<p>I just started reading the long <a href="http://phabricator.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/T534" rel="nofollow noopener">thread</a> about how sdwdate-gui-qubes came to be. I’ll follow up on that if I find out anything useful. In the meantime, feel free to shed some light on any of the above.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/5</link>
        <pubDate>Fri, 31 Jul 2020 18:00:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-5</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="ak88" data-post="3" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>I installed vanilla Tor Browser and sdwdate in a Debian 10 VM, and so far I am unable to reproduce it there.</p>
</blockquote>
</aside>
<p>For reproduction it needs to be connected to Tor running in another VM.</p>
<aside class="quote no-group" data-username="Patrick" data-post="1" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I suspect it is this:</p>
<ul>
<li>Tor Browser is running on one machine and talking to Tor on another machine.</li>
<li>When time is changed using <code>date</code> on <em><strong>another machine</strong></em>, Tor Browser starts to use 100% CPU.</li>
</ul>
</blockquote>
</aside>
<aside class="quote no-group" data-username="ak88" data-post="3" data-topic="9541">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/ee7513/40.png" class="avatar"> ak88:</div>
<blockquote>
<p>Hopefully someone can make some sense of it, because I haven’t a clue. I guess the next step would be to attach to firefox with gdb, but I’m having a nervous breakdown just thinking about it.</p>
</blockquote>
</aside>
<p>Seems you made great progress already. So far you’re the only chance of getting this fixed for real.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/4</link>
        <pubDate>Fri, 31 Jul 2020 10:02:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-4</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for the info. Not sure how I missed that. I asked about it on qubes-users a long time ago but no one seemed to know what I was talking about.</p>
<p>I installed vanilla Tor Browser and sdwdate in a Debian 10 VM, and so far I am unable to reproduce it there. On the other hand, not suprisingly I am able to reproduce it with a vanilla Tor Browser in a whonix-ws VM.</p>
<p>In the meantime, is it actually safe to disable sdwdate in sys-whonix as suggested here? <a href="https://github.com/QubesOS/qubes-issues/issues/4969#issuecomment-609407440" rel="nofollow noopener">https://github.com/QubesOS/qubes-issues/issues/4969#issuecomment-609407440</a></p>
<p>More debugging (nothing conclusive – don’t get your hopes up):</p>
<p>I just tried stracing a freshly started Tor Browser, and the output looks largely the same, except that every so often it will poll with an indefinite timeout. Something about sdwdate causes firefox to always poll with a zero timeout (see strace in previous post). I.e., the process is not being woken up externally, it’s just never going to sleep.</p>
<p>On the other hand, looking at the individual threads (‘H’ in top), it almost seems like some kind of livelock between the main thread and socket thread:</p>
<pre><code>28192 user      20   0 2637920 204384 117264 R  43.7  10.0   2:27.87`- firefox.real            
28198 user      20   0 2637920 204384 117264 S   0.0  10.0   0:00.12`- Gecko_IOThread      
28199 user      20   0 2637920 204384 117264 S   0.0  10.0   0:00.01`- JS Watchdog         
28200 user      20   0 2637920 204384 117264 S   0.0  10.0   0:00.16`- JS Helper           
28201 user      20   0 2637920 204384 117264 S   0.0  10.0   0:00.27`- JS Helper           
28202 user      20   0 2637920 204384 117264 S   0.0  10.0   0:00.01`- Link Monitor        
28203 user      20   0 2637920 204384 117264 R  25.0  10.0   1:27.33`- Socket Thread    

$ sudo strace -p 28203 # "Socket Thread"
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=532364377}) = 0
poll([{fd=20, events=POLLIN|POLLPRI}, {fd=44, events=POLLIN|POLLPRI}], 2, -1) = 1 ([{fd=44, revents=POLLIN|POLLHUP}])
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=532940175}) = 0
write(36, "\372", 1)                    = 1
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533548644}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533617441}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533651895}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533697640}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533730541}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533763793}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533794069}) = 0
poll([{fd=20, events=POLLIN|POLLPRI}, {fd=44, events=POLLIN|POLLPRI}], 2, -1) = 2 ([{fd=20, revents=POLLIN}, {fd=44, revents=POLLIN|POLLHUP}])
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=533871943}) = 0
write(36, "\372", 1)                    = 1
read(20, "M", 2048)                     = 1
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534128569}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534153766}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534180235}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534204550}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534229797}) = 0
poll([{fd=20, events=POLLIN|POLLPRI}, {fd=44, events=POLLIN|POLLPRI}], 2, -1) = 1 ([{fd=44, revents=POLLIN|POLLHUP}])
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534299175}) = 0
write(36, "\372", 1)                    = 1
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534469161}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534496612}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534519885}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534544877}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534568715}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534594263}) = 0
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534617456}) = 0
poll([{fd=20, events=POLLIN|POLLPRI}, {fd=44, events=POLLIN|POLLPRI}], 2, -1) = 2 ([{fd=20, revents=POLLIN}, {fd=44, revents=POLLIN|POLLHUP}])
clock_gettime(CLOCK_MONOTONIC, {tv_sec=140672, tv_nsec=534679220}) = 0
write(36, "\372", 1)                    = 1
read(20, "M", 2048)                     = 1
</code></pre>
<p>So the socket thread is polling with an indefinite timeout, but it’s being woken up constantly.</p>
<pre><code>l-wx------ 1 user user 64 Jul 29 23:38 /proc/28303/fd/20 -&gt; 'pipe:[395530]'
lr-x------ 1 user user 64 Jul 29 23:38 /proc/28303/fd/44 -&gt; '/dev/shm/org.chromium.W5Sctg (deleted)'
</code></pre>
<p>Other tidbits:</p>
<pre><code>user@host:~$ tor-browser_en-US/Browser/start-tor-browser --debug --verbose
Fontconfig warning: "/home/user/tor-browser_en-US/Browser/TorBrowser/Data/fontconfig/fonts.conf", line 85: unknown element "blank"
Fontconfig warning: "/home/user/tor-browser_en-US/Browser/TorBrowser/Data/fontconfig/fonts.conf", line 85: unknown element "blank"
Fontconfig warning: "/home/user/tor-browser_en-US/Browser/TorBrowser/Data/fontconfig/fonts.conf", line 85: unknown element "blank"
Fontconfig warning: "/home/user/tor-browser_en-US/Browser/TorBrowser/Data/fontconfig/fonts.conf", line 85: unknown element "blank"
[Parent 12501, Gecko_IOThread] WARNING: pipe error (47): Connection reset by peer: file /var/tmp/build/firefox-e79ce602ddff/ipc/chromium/src/chrome/common/ipc_channel_posix.cc, line 358
[Parent 12501, Gecko_IOThread] WARNING: pipe error (96): Connection reset by peer: file /var/tmp/build/firefox-e79ce602ddff/ipc/chromium/src/chrome/common/ipc_channel_posix.cc, line 358


user@host:~$ sudo ltrace -p $(pgrep firefox.real)
pthread_mutex_lock(0x7160b93559b0, 1, 0x7160b9585a70, 0x7160b938a3a0)                                    = 0
pthread_mutex_unlock(0x7160b93559b0, 0, 0x7160a1162000, 0x7160b93f3de0)                                  = 0
pthread_mutex_lock(0x7160b93559b0, 1, 0x7160b9585a70, 0x7160b938a3a0)                                    = 0
pthread_mutex_unlock(0x7160b93559b0, 0, 0x7160a1162000, 0x7160b93f3de0)                                  = 0
pthread_mutex_lock(0x7160b93559b0, 1, 0x7ffdefabe6f0, 0x7160b61c3f20)                                    = 0
pthread_mutex_unlock(0x7160b93559b0, 1, 110, 109)                                                        = 0
clock_gettime(1, 0x7ffdefabe6a0, 0x7160b93559b0, 0)                                                      = 0
</code></pre>
<p>Hopefully someone can make some sense of it, because I haven’t a clue. I guess the next step would be to attach to firefox with gdb, but I’m having a nervous breakdown just thinking about it.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/3</link>
        <pubDate>Thu, 30 Jul 2020 00:29:06 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-3</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[ak88]]></dc:creator>
        <description><![CDATA[
            <p>Tor Browser under Whonix appears to consume high amounts of CPU after resuming from suspend. I’m on Qubes 4.0 with Whonix 15 and Tor Browser 9.5.1 from Tor-Browser-Downloader. This has been going on for about a year, since maybe TB 9.1 or something. It doesn’t happen every time; it’s much more likely when there are more than a couple of tabs open, or when the browser has been open for a long time. It happens often even with JS disabled. It doesn’t affect all instances at the same time; if I resume with two Tor Browsers open in two VMs, sometimes only one of them will have high CPU usage. Sometimes it is only about 50% (as if single threaded), but usually it is 100%; all VMs have 2 vCPUs assigned. Closing and reopening the browser brings it back to normal CPU usage, but the new identity button does not. Usually neither the browser nor other apps seem noticeably slow when this happens, unless I cap the CPU usage with Xen. It does make the fan run at full speed after a while though.</p>
<p>This does not happen with Firefox from the Fedora 30/31/32 templates, nor Firefox ESR from the Debian 10 template!</p>
<p>As I recall, it also did not seem to affect a vanilla Tor Browser bundle in a Debian 10 VM last time I tested it, although I haven’t tested this very much because it’s not a normal use-case for me.</p>
<p>In other words, it appears to be Whonix-specific, from what I can tell at this time.</p>
<p>If I attach with strace, this is what I get:<br>
strace: Process 2058 attached<br>
strace: [ Process PID=2058 runs in x32 mode. ]<br>
strace: [ Process PID=2058 runs in 64 bit mode. ]<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=310089525}) = 0<br>
write(22, “M”, 1)                       = 1<br>
futex(0x7b7821789ce8, FUTEX_WAKE_PRIVATE, 1) = 1<br>
gettimeofday({tv_sec=1595780096, tv_usec=356508}, NULL) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311125577}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311168045}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311196979}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311236352}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311263983}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311305851}) = 0<br>
recvmsg(4, {msg_namelen=0}, 0)          = -1 EAGAIN (Resource temporarily unavailable)<br>
poll([{fd=4, events=POLLIN}, {fd=5, events=POLLIN}, {fd=33, events=POLLIN}, {fd=58, events=POLLIN}, {fd=93, events=POLLIN}], 5, 0) = 1 ([{fd=33, revents=POLLIN}])<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311561976}) = 0<br>
read(33, “\372”, 1)                     = 1<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311637326}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311667442}) = 0<br>
recvmsg(4, {msg_namelen=0}, 0)          = -1 EAGAIN (Resource temporarily unavailable)<br>
poll([{fd=4, events=POLLIN}, {fd=5, events=POLLIN}, {fd=33, events=POLLIN}, {fd=58, events=POLLIN}, {fd=93, events=POLLIN}], 5, 0) = 0 (Timeout)<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311782775}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311813563}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=311838449}) = 0<br>
gettimeofday({tv_sec=1595780096, tv_usec=357368}, NULL) = 0<br>
ioctl(67, FIONREAD, [0])                = 0<br>
ioctl(67, FIONREAD, [0])                = 0<br>
recvfrom(67, “”, 0, 0, NULL, NULL)      = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=313367252}) = 0<br>
write(22, “M”, 1)                       = 1<br>
futex(0x7b7821789ce8, FUTEX_WAKE_PRIVATE, 1) = 1<br>
gettimeofday({tv_sec=1595780096, tv_usec=359566}, NULL) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=314408674}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=314687501}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=314899254}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=315282810}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=315847167}) = 0<br>
clock_gettime(CLOCK_MONOTONIC, {tv_sec=74149, tv_nsec=316099525}) = 0<br>
And it just repeats, as fast as the terminal can print.</p>
<p>This is the /proc/2058/fd directory:<br>
0 -&gt; /dev/null<br>
1 -&gt; /dev/null<br>
2 -&gt; /dev/null<br>
3 -&gt; anon_inode:inotify<br>
4 -&gt; socket:[22530]<br>
5 -&gt; anon_inode:[eventfd]<br>
6 -&gt; socket:[194424]<br>
7 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/.parentlock<br>
8 -&gt; anon_inode:[eventpoll]<br>
9 -&gt; pipe:[22534]<br>
10 -&gt; pipe:[22534]<br>
11 -&gt; pipe:[22535]<br>
12 -&gt; pipe:[22535]<br>
13 -&gt; /home/user/.tb/tor-browser/Browser/omni.ja<br>
14 -&gt; /home/user/.tb/tor-browser/Browser/browser/omni.ja<br>
15 -&gt; pipe:[22541]<br>
16 -&gt; pipe:[22541]<br>
17 -&gt; pipe:[21811]<br>
18 -&gt; pipe:[21811]<br>
19 -&gt; socket:[22542]<br>
20 -&gt; /dev/urandom<br>
21 -&gt; pipe:[22544]<br>
22 -&gt; pipe:[22544]<br>
23 -&gt; anon_inode:[eventpoll]<br>
24 -&gt; pipe:[21812]<br>
25 -&gt; pipe:[21812]<br>
26 -&gt; anon_inode:[eventpoll]<br>
27 -&gt; pipe:[22545]<br>
28 -&gt; pipe:[22545]<br>
29 -&gt; anon_inode:[eventfd]<br>
30 -&gt; socket:[21827]<br>
31 -&gt; anon_inode:[eventfd]<br>
32 -&gt; /dev/shm/org.chromium.6SweMh (deleted)<br>
33 -&gt; pipe:[21830]<br>
34 -&gt; pipe:[21830]<br>
35 -&gt; /dev/shm/org.chromium.cmk7u8 (deleted)<br>
36 -&gt; /dev/shm/org.chromium.WdgMgF (deleted)<br>
37 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/startupCache/startupCache.8.little<br>
38 -&gt; socket:[196242]<br>
39 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/cookies.sqlite<br>
40 -&gt; /dev/shm/org.chromium.Slusad (deleted)<br>
41 -&gt; /dev/shm/org.chromium.SOT9qZ (deleted)<br>
42 -&gt; /dev/shm/org.chromium.WbMSHL (deleted)<br>
43 -&gt; /dev/shm/org.chromium.2BpDYx (deleted)<br>
44 -&gt; /dev/shm/org.chromium.ytFpfk (deleted)<br>
45 -&gt; /dev/shm/org.chromium.EbCdw6 (deleted)<br>
46 -&gt; /dev/shm/org.chromium.GpGaNS (deleted)<br>
47 -&gt; /dev/shm/org.chromium.CwDe4E (deleted)<br>
48 -&gt; /dev/shm/org.chromium.4v4klr (deleted)<br>
49 -&gt; /dev/shm/org.chromium.y69sCd (deleted)<br>
50 -&gt; /dev/shm/org.chromium.cCBCTZ (deleted)<br>
51 -&gt; /dev/shm/org.chromium.A5qPaM (deleted)<br>
52 -&gt; /dev/shm/org.chromium.0dI4ry (deleted)<br>
53 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite<br>
54 -&gt; /dev/shm/org.chromium.mxFe3j (deleted)<br>
55 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite<br>
56 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite-wal<br>
57 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite-wal<br>
58 -&gt; socket:[21867]<br>
59 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/webappsstore.sqlite<br>
60 -&gt; socket:[196247]<br>
61 -&gt; /dev/shm/org.chromium.GEXWcH (deleted)<br>
62 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite<br>
63 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite-wal<br>
64 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite<br>
65 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite-wal<br>
66 -&gt; socket:[196249]<br>
67 -&gt; socket:[22275]<br>
68 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/formhistory.sqlite<br>
69 -&gt; socket:[22240]<br>
70 -&gt; socket:[22650]<br>
71 -&gt; socket:[22651]<br>
72 -&gt; socket:[21991]<br>
73 -&gt; socket:[21993]<br>
74 -&gt; socket:[22654]<br>
75 -&gt; socket:[21995]<br>
76 -&gt; pipe:[21868]<br>
77 -&gt; socket:[22737]<br>
78 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/content-prefs.sqlite<br>
79 -&gt; socket:[22739]<br>
80 -&gt; socket:[196251]<br>
81 -&gt; socket:[22741]<br>
82 -&gt; socket:[22749]<br>
83 -&gt; socket:[196056]<br>
84 -&gt; socket:[22747]<br>
85 -&gt; socket:[22748]<br>
86 -&gt; socket:[21987]<br>
87 -&gt; socket:[22751]<br>
88 -&gt; socket:[196661]<br>
89 -&gt; socket:[196998]<br>
90 -&gt; pipe:[22762]<br>
91 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/webappsstore.sqlite-wal<br>
92 -&gt; pipe:[196058]<br>
93 -&gt; socket:[25379]<br>
94 -&gt; socket:[196662]<br>
95 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/storage-sync.sqlite<br>
96 -&gt; socket:[196652]<br>
97 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/extensions/{73a6fe31-595d-460b-a920-fcc0f8843232}.xpi<br>
98 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite<br>
99 -&gt; socket:[196668]<br>
100 -&gt; socket:[22795]<br>
101 -&gt; socket:[196654]<br>
102 -&gt; socket:[196295]<br>
103 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite<br>
104 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite-wal<br>
105 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite<br>
106 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite-wal<br>
107 -&gt; socket:[201186]<br>
108 -&gt; socket:[196656]<br>
109 -&gt; socket:[23776]<br>
110 -&gt; socket:[196663]<br>
111 -&gt; socket:[196665]<br>
112 -&gt; socket:[196991]<br>
113 -&gt; socket:[196254]<br>
114 -&gt; socket:[197000]<br>
115 -&gt; pipe:[23237]<br>
116 -&gt; pipe:[196256]<br>
117 -&gt; socket:[197002]<br>
118 -&gt; socket:[197126]<br>
119 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite<br>
120 -&gt; socket:[196278]<br>
121 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/webappsstore.sqlite<br>
122 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/webappsstore.sqlite-wal<br>
123 -&gt; socket:[197958]<br>
124 -&gt; socket:[196280]<br>
125 -&gt; socket:[197217]<br>
126 -&gt; socket:[196282]<br>
127 -&gt; socket:[23714]<br>
128 -&gt; socket:[196290]<br>
129 -&gt; socket:[197219]<br>
130 -&gt; pipe:[150985]<br>
131 -&gt; socket:[196288]<br>
132 -&gt; socket:[196289]<br>
133 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite<br>
134 -&gt; socket:[196578]<br>
135 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/places.sqlite-wal<br>
136 -&gt; socket:[196292]<br>
137 -&gt; socket:[197221]<br>
138 -&gt; pipe:[196580]<br>
139 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite<br>
140 -&gt; socket:[197191]<br>
141 -&gt; socket:[151017]<br>
142 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/favicons.sqlite-wal<br>
143 -&gt; socket:[197223]<br>
144 -&gt; socket:[197193]<br>
145 -&gt; /dev/shm/org.chromium.cmk7u8 (deleted)<br>
146 -&gt; socket:[194446]<br>
147 -&gt; socket:[197195]<br>
148 -&gt; /home/user/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/cookies.sqlite-wal<br>
149 -&gt; socket:[197203]<br>
151 -&gt; socket:[197201]<br>
152 -&gt; socket:[197202]<br>
153 -&gt; pipe:[151356]<br>
154 -&gt; socket:[152581]<br>
155 -&gt; socket:[201181]<br>
156 -&gt; socket:[197205]<br>
157 -&gt; socket:[202288]<br>
158 -&gt; socket:[201188]<br>
159 -&gt; socket:[201175]<br>
160 -&gt; socket:[222114]<br>
161 -&gt; socket:[197211]<br>
162 -&gt; socket:[201190]<br>
163 -&gt; /home/user/.tb/tor-browser/Browser/.cache/event-sound-cache.tdb.b08dfa6083e7567a1921a715000001fb.x86_64-pc-linux-gnu<br>
164 -&gt; pipe:[201867]<br>
165 -&gt; socket:[202257]<br>
166 -&gt; socket:[212847]<br>
167 -&gt; socket:[202259]<br>
169 -&gt; pipe:[152692]<br>
170 -&gt; socket:[202261]<br>
171 -&gt; socket:[202269]<br>
173 -&gt; socket:[202267]<br>
174 -&gt; socket:[152811]<br>
175 -&gt; socket:[202268]<br>
177 -&gt; socket:[202271]</p>
<p>ss -x -p | grep 2058<br>
u_str ESTAB 0      0                                                          * 196254                                                * 196255                   users:((“firefox.real”,pid=2058,fd=113))<br>
u_str ESTAB 0      0                                                          * 196280                                                * 196281                   users:((“firefox.real”,pid=2058,fd=124))<br>
u_str ESTAB 0      0                                                          * 196056                                                * 196057                   users:((“firefox.real”,pid=2058,fd=83))<br>
u_str ESTAB 0      0                                                          * 196278                                                * 196279                   users:((“firefox.real”,pid=2058,fd=120))<br>
u_str ESTAB 0      0                                                          * 197191                                                * 197192                   users:((“firefox.real”,pid=2058,fd=140))<br>
u_str ESTAB 0      0                                                          * 196292                                                * 196293                   users:((“firefox.real”,pid=2058,fd=136))<br>
u_seq ESTAB 0      0                                                          * 151017                                                * 0                        users:((“firefox.real”,pid=2058,fd=141))<br>
u_str ESTAB 0      0                                                          * 197193                                                * 197194                   users:((“firefox.real”,pid=2058,fd=144))<br>
u_seq ESTAB 0      0                                                          * 152581                                                * 0                        users:((“firefox.real”,pid=2058,fd=154))<br>
u_seq ESTAB 0      0                                                          * 196289                                                * 196288                   users:((“file:// Content”,pid=2252,fd=24),(“firefox.real”,pid=2058,fd=132))<br>
u_seq ESTAB 0      0                                                          * 22650                                                 * 22651                    users:((“Web Content”,pid=3079,fd=5),(“Web Content”,pid=2302,fd=5),(“WebExtensions”,pid=2277,fd=5),(“file:// Content”,pid=2252,fd=5),(“Web Content”,pid=2220,fd=5),(“firefox.real”,pid=2058,fd=70))<br>
u_str ESTAB 0      0                                                          * 194424                                                * 194425                   users:((“firefox.real”,pid=2058,fd=6))<br>
u_str ESTAB 0      0                                                          * 196656                                                * 196657                   users:((“firefox.real”,pid=2058,fd=108))<br>
u_str ESTAB 0      0                                                          * 22240                                                 * 22239                    users:((“firefox.real”,pid=2058,fd=69))<br>
u_str ESTAB 0      0                                                          * 196282                                                * 196283                   users:((“firefox.real”,pid=2058,fd=126))<br>
u_seq ESTAB 0      0                                                          * 196288                                                * 196289                   users:((“firefox.real”,pid=2058,fd=131))<br>
u_str ESTAB 0      0                                                          * 196652                                                * 196653                   users:((“firefox.real”,pid=2058,fd=96))<br>
u_str ESTAB 0      0                                                          * 196295                                                * 196294                   users:((“firefox.real”,pid=2058,fd=102))<br>
u_str ESTAB 0      0                                                          * 25379                                                 * 25380                    users:((“firefox.real”,pid=2058,fd=93))<br>
u_str ESTAB 0      0                                                          * 194446                                                * 194447                   users:((“firefox.real”,pid=2058,fd=146))<br>
u_str ESTAB 0      0                                                          * 196654                                                * 196655                   users:((“firefox.real”,pid=2058,fd=101))<br>
u_str ESTAB 0      0                                                          * 196578                                                * 196579                   users:((“firefox.real”,pid=2058,fd=134))<br>
u_seq ESTAB 0      0                                                          * 22795                                                 * 0                        users:((“firefox.real”,pid=2058,fd=100))<br>
u_str ESTAB 0      0                                                          * 22275                                                 * 0                        users:((“firefox.real”,pid=2058,fd=67))<br>
u_str ESTAB 0      0                                                          * 201175                                                * 201176                   users:((“firefox.real”,pid=2058,fd=159))<br>
u_str ESTAB 0      0                                                          * 196290                                                * 196291                   users:((“firefox.real”,pid=2058,fd=128))<br>
u_str ESTAB 0      0                                                          * 21867                                                 * 22643                    users:((“firefox.real”,pid=2058,fd=58))<br>
u_str ESTAB 0      0                                                          * 196663                                                * 196664                   users:((“firefox.real”,pid=2058,fd=110))<br>
u_seq ESTAB 0      0                                                          * 197202                                                * 197201                   users:((“Web Content”,pid=2302,fd=22),(“firefox.real”,pid=2058,fd=152))<br>
u_str ESTAB 0      0                                                          * 21827                                                 * 21828                    users:((“firefox.real”,pid=2058,fd=30))<br>
u_str ESTAB 0      0                                                          * 197195                                                * 197196                   users:((“firefox.real”,pid=2058,fd=147))<br>
u_str ESTAB 0      0                                                          * 196668                                                * 196667                   users:((“firefox.real”,pid=2058,fd=99))<br>
u_str ESTAB 0      0                                                          * 202288                                                * 202287                   users:((“firefox.real”,pid=2058,fd=157))<br>
u_seq ESTAB 0      0                                                          * 197201                                                * 197202                   users:((“firefox.real”,pid=2058,fd=151))<br>
u_str ESTAB 0      0                                                          * 202271                                                * 202272                   users:((“firefox.real”,pid=2058,fd=177))<br>
u_seq ESTAB 0      0                                                          * 152811                                                * 0                        users:((“firefox.real”,pid=2058,fd=174))<br>
u_seq ESTAB 0      0                                                          * 196662                                                * 196661                   users:((“Web Content”,pid=2220,fd=26),(“firefox.real”,pid=2058,fd=94))<br>
u_seq ESTAB 0      0                                                          * 23714                                                 * 0                        users:((“firefox.real”,pid=2058,fd=127))<br>
u_str ESTAB 0      0                                                          * 233752                                                * 233753                   users:((“firefox.real”,pid=2058,fd=160))<br>
u_seq ESTAB 0      0                                                          * 196661                                                * 196662                   users:((“firefox.real”,pid=2058,fd=88))<br>
u_str ESTAB 0      0                                                          * 197203                                                * 197204                   users:((“firefox.real”,pid=2058,fd=149))<br>
u_str ESTAB 0      0                                                          * 196665                                                * 196666                   users:((“firefox.real”,pid=2058,fd=111))<br>
u_str ESTAB 0      0                                                          * 197205                                                * 197206                   users:((“firefox.real”,pid=2058,fd=156))<br>
u_str ESTAB 0      0                                                          * 197217                                                * 197216                   users:((“firefox.real”,pid=2058,fd=125))<br>
u_str ESTAB 0      0                                                          * 202257                                                * 202258                   users:((“firefox.real”,pid=2058,fd=165))<br>
u_str ESTAB 0      0                                                          * 22654                                                 * 22655                    users:((“firefox.real”,pid=2058,fd=74))<br>
u_str ESTAB 0      0                                                          * 22749                                                 * 22750                    users:((“firefox.real”,pid=2058,fd=82))<br>
u_seq ESTAB 0      0                                                          * 202267                                                * 202268                   users:((“firefox.real”,pid=2058,fd=173))<br>
u_str ESTAB 0      0                                                          * 22739                                                 * 22740                    users:((“firefox.real”,pid=2058,fd=79))<br>
u_str ESTAB 0      0                                                          * 22737                                                 * 22738                    users:((“firefox.real”,pid=2058,fd=77))<br>
u_seq ESTAB 0      0                                                          * 202268                                                * 202267                   users:((“Web Content”,pid=3079,fd=22),(“firefox.real”,pid=2058,fd=175))<br>
u_seq ESTAB 0      0                                                          * 22747                                                 * 22748                    users:((“firefox.real”,pid=2058,fd=84))<br>
u_str ESTAB 0      0                                                          * 22741                                                 * 22742                    users:((“firefox.real”,pid=2058,fd=81))<br>
u_seq ESTAB 0      0                                                          * 22748                                                 * 22747                    users:((“WebExtensions”,pid=2277,fd=22),(“firefox.real”,pid=2058,fd=85))<br>
u_str ESTAB 0      0                                                          * 22751                                                 * 22752                    users:((“firefox.real”,pid=2058,fd=87))<br>
u_str ESTAB 0      0                                                          * 202259                                                * 202260                   users:((“firefox.real”,pid=2058,fd=167))<br>
u_str ESTAB 0      0                                                          * 202261                                                * 202262                   users:((“firefox.real”,pid=2058,fd=170))<br>
u_str ESTAB 0      0                                                          * 202269                                                * 202270                   users:((“firefox.real”,pid=2058,fd=171))<br>
u_seq ESTAB 0      0                                                          * 22651                                                 * 22650                    users:((“firefox.real”,pid=2058,fd=71))<br>
u_str ESTAB 0      0                                                          * 22530                                                 * 22531                    users:((“firefox.real”,pid=2058,fd=4))</p>
<p>This is in the main process (firefox.real). Child processes (Web Extensions, Web Content, file:// Content, etc) continue to have normal CPU usage from what I can tell.</p>
<p>It appears to be clock-related, but sdwdate shows the VM is synced and nothing abnormal that I can see. Whonixcheck doesn’t show any warnings or errors.</p>
<p>I was wondering if anyone else has had this problem, or if there are any simple ways to debug this further? Any ideas are appreciated.</p>
<p>Edit: I forgot to mention, firefox’s internal task manager (about:performance) doesn’t show any high-impact processes, either.</p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/2</link>
        <pubDate>Sun, 26 Jul 2020 17:18:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-2</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
      <item>
        <title>bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I suspect it is this:</p>
<ul>
<li>Tor Browser is running on one machine and talking to Tor on another machine.</li>
<li>When time is changed using <code>date</code> on another machine, Tor Browser starts to use 100% CPU.</li>
</ul>
<p>Still not “really” a Whonix issue. Also not “really” an sdwdate issue. It still needs to be reproduced without mentioning Whonix / sdwdate as a general bug and then reported against Tor Project trac component Tor Browser.</p>
<p>Help welcome.</p>
<p>Originally reported here with lots of discussion:<br>
<a href="https://github.com/QubesOS/qubes-issues/issues/4969">https://github.com/QubesOS/qubes-issues/issues/4969</a></p>
          <p><a href="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541/1</link>
        <pubDate>Sat, 16 May 2020 13:26:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9541-1</guid>
        <source url="http://forums.whonix.org/t/bug-restart-of-sdwdate-in-whonix-gateway-causes-100-cpu-use-of-tor-browser-in-whonix-workstation/9541.rss">bug: restart of sdwdate in Whonix-Gateway causes 100% CPU use of Tor Browser in Whonix-Workstation</source>
      </item>
  </channel>
</rss>
