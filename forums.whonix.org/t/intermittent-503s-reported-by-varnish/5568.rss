<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Intermittent 503s reported by Varnish</title>
    <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568</link>
    <description>[quote=&quot;torjunkie, post:810, topic:3477, full:true&quot;]
&gt; Error 503 Backend fetch failed
&gt; 
&gt; Backend fetch failed
&gt; Guru Meditation:
&gt; 
&gt; XID: 838205457
&gt; 
&gt; Varnish cache server
&gt; Impressum Datenschutz Haftungsausschluss

Immediately when trying to open &quot;Release Notes&quot; wiki page on v3 onion.

I&#39;ve had another instantenous result like this is similar circumstances.

So, this is a new oddity that was not present over last 2+ years. 

Again, immediate refresh of the page resolves correctly.
[/quote]


Working on a theory that it&#39;s keepalive related and maybe some sort of &#39;new&#39; thing since our OS version upgrade. Looking at experimenting with keepalive settings between nginx, varnish and apache soon, or possibly removing varnish altogether and using nginx cache instead. Thanks</description>
    <language>en</language>
    <lastBuildDate>Tue, 21 Aug 2018 10:10:37 +0000</lastBuildDate>
    <category>Website</category>
    <atom:link href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[torjunkie]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="8" data-topic="5568">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/mig5/40/1647_1.png" class="avatar"> mig5:</div>
<blockquote>
<p>Also frequently coinciding with the 502s is a high rate of ‘crawling’ of the wiki via the v2 onion address by some unknown perpetrator.</p>
</blockquote>
</aside>
<p>Gee… I wonder who that could be…<img src="//forums.whonix.org/images/emoji/twitter/smirk.png?v=6" title=":smirk:" class="emoji" alt=":smirk:"></p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/9</link>
        <pubDate>Tue, 21 Aug 2018 10:10:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-9</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[mig5]]></dc:creator>
        <description><![CDATA[
            <p>Yeah, the latest 502s coincide with the hardware CPU lockups, which for some reason seem to happen at roughly the same time (3PM-ish GMT+2), perhaps some indication of a heavy task, but I can’t find it.</p>
<p>Also frequently coinciding with the 502s is a high rate of ‘crawling’ of the wiki via the v2 onion address by some unknown perpetrator. Half-inclined to disable the v2 onion <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"> they hit a lot of the Mediawiki ‘Special’ pages which might create big queries (revision logs etc). My work at optimising Mediawiki with memcache hasn’t been quite enough, and out of ideas.</p>
<p>We’ll see how we go with a new server…</p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/8</link>
        <pubDate>Sun, 19 Aug 2018 22:47:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-8</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Same reason most likely.</p>
<aside class="quote quote-modified" data-post="2" data-topic="5693">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/mig5/40/1647_1.png" class="avatar">
    <a href="https://forums.whonix.org/t/onion-v3-for-whonix-website-repo-down/5693/2?u=patrick">onion v3 for whonix website + repo DOWN</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/website"><span class="badge-category-bg" style="background-color: #0E76BD;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Issues and improvements with the Whonix website. (website devs) (user documentation devs)">Website</span></a>
  </div>
  <blockquote>
    The onions are working fine (I’m writing on it) 
The server is experiencing periodic hardware issues (which are known about with the provider, they are working on a solution). 
The hardware issue causes CPU lockups which causes Tor, and other things, to go out of whack a bit. 
An existing Tor v3 onion bug (not our bug, but a bug in Tor, expected to be fixed in stable in December) then results in the .onion failing to re-publish its descriptor to the HSDir for a while, but this issue clears itsel…
  </blockquote>
</aside>

<p>Need to wait for the new server.</p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/7</link>
        <pubDate>Sun, 19 Aug 2018 13:20:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-7</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[torjunkie]]></dc:creator>
        <description><![CDATA[
            <p>Varnish stuff has disappeared. So that’s good news.</p>
<p>Now the bad news. It has been replaced by 502 bad gateway (nginx) errors instead here and there.</p>
<p>Immediate refresh loads successfully. Its real whack-a-mole with servers I gather. <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>I once had 2-3 of these errors in a row recently. But seems less common than the Varnish issue. Will report if it keeps popping up.</p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/6</link>
        <pubDate>Sun, 19 Aug 2018 03:40:08 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-6</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[mig5]]></dc:creator>
        <description><![CDATA[
            <p>We’ve made some adjustments that will technically remove all ‘Guru meditation’ errors, but may still cause some form of timeout when we get a big rush of traffic particularly to the wiki. However, we’re hoping the performance adjustments prevent those stampedes either way.</p>
<p>One other issue causing 503s was discovered to be intermittent hardware issues which are also being addressed, but obviously can’t be fixed with software optimisations. So, fighting a multi-headed snake right now <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Closely monitoring since today’s changes.</p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/5</link>
        <pubDate>Mon, 13 Aug 2018 06:15:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-5</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[mig5]]></dc:creator>
        <description><![CDATA[
            <p>Nope, it was not opcache, though it was an important thing to fix anyway.</p>
<p>Just saw it happen again, This time counted the max Apache processes was exactly 150 - which is the limit of MaxRequestWorkers. I normally expect to see this limit mentioned in the log which is why I didn’t think it was this issue, but given the ‘coincidence’, think it’s maybe that. Have adjusted that value up. Will see how it goes…</p>
<p>pretty sure it’s Phabricator (as usual) causing some sort of huge spike in traffic - whenever it occurs, there’s a huge spate of 503s that are on the Phabricator .onion and are all or mostly on /diffusion URLs e.g  <a href="http://phabricator.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/diffusion/WHONIX/history/pidgin/whonix_shared/usr/lib/timesync/30_run-sdwdate;12.0.0.0.7-developers-only">http://phabricator.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/diffusion/WHONIX/history/pidgin/whonix_shared/usr/lib/timesync/30_run-sdwdate;12.0.0.0.7-developers-only</a></p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/4</link>
        <pubDate>Mon, 30 Jul 2018 05:11:25 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-4</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[mig5]]></dc:creator>
        <description><![CDATA[
            <p>It wasn’t KeepAlive, but I am pretty sure it was related to PHP opcache (which indeed was a ‘new’ thing as of a few weeks ago as part of a big upgrade).</p>
<p>Since I adjusted an opcache setting about 6 or 7 hours ago, there’ve been no more random 503s. Hopefully I’ve caught it…</p>
<p>Please let me know in this thread if you encounter the instant 503 ‘guru meditation’ Varnish error again.</p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/3</link>
        <pubDate>Mon, 30 Jul 2018 03:59:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-3</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[mig5]]></dc:creator>
        <description><![CDATA[
            <p>Splitting into a new thread.</p>
<p>I’ve disabled KeepAlive in Apache, working on a hunch. May or may not impact performance though.</p>
<p>Will monitor if there’s any further 503s and if so, I need to catch one ‘in the act’ with varnishlog to see the actual error reported.</p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/2</link>
        <pubDate>Sun, 29 Jul 2018 04:18:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-2</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
      <item>
        <title>Intermittent 503s reported by Varnish</title>
        <dc:creator><![CDATA[mig5]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-post="810" data-topic="3477" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/t/f9ae1b/40.png" class="avatar"> torjunkie:</div>
<blockquote>
<blockquote>
<p>Error 503 Backend fetch failed</p>
<p>Backend fetch failed<br>
Guru Meditation:</p>
<p>XID: 838205457</p>
<p>Varnish cache server<br>
Impressum Datenschutz Haftungsausschluss</p>
</blockquote>
<p>Immediately when trying to open “Release Notes” wiki page on v3 onion.</p>
<p>I’ve had another instantenous result like this is similar circumstances.</p>
<p>So, this is a new oddity that was not present over last 2+ years.</p>
<p>Again, immediate refresh of the page resolves correctly.</p>
</blockquote>
</aside>
<p>Working on a theory that it’s keepalive related and maybe some sort of ‘new’ thing since our OS version upgrade. Looking at experimenting with keepalive settings between nginx, varnish and apache soon, or possibly removing varnish altogether and using nginx cache instead. Thanks</p>
          <p><a href="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568/1</link>
        <pubDate>Sun, 29 Jul 2018 03:57:15 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5568-1</guid>
        <source url="http://forums.whonix.org/t/intermittent-503s-reported-by-varnish/5568.rss">Intermittent 503s reported by Varnish</source>
      </item>
  </channel>
</rss>
