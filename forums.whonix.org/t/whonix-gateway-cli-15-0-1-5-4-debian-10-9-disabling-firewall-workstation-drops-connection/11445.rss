<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Whonix Gateway CLI-15.0.1.5.4 + Debian 10.9 - Disabling Firewall, workstation drops connection</title>
    <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445</link>
    <description>Greetings,
I&#39;m performing some tests by using Whonix Gateway CLI + Debian 10.9 as workstation and some aspects of the whonix firewall in this OS custom scenario.

I guess the configuration, enable and disable of Whonix Firewall is directly related to the iptables rules.
When the Whonix Firewall is enabled (assuming no changes by the user) the iptables rules are the following:
![image|653x500](upload://5MBHojKsPcHfP2aE4T3HRx5oKXX.png) 
![image|690x301](upload://5OR5p8spKNsbX5tUY7TnjTMp4Po.png) 

In this situation, both of the machines work well and they connect also to the Internet.
During my tests, I noted that, if I disable the Whonix Firewall on the Gateway, as described here https://www.whonix.org/wiki/Dev/Firewall_Unload, and executing `./firewall-unload` script, the iptables rules will correctly be:
![image|422x143](upload://gbuS9pWMN3Ppp42kAEzPYxvgWew.png) 
and if I perform a `curl ifconfig.me` in the Whonix Gateway, it connects correctly, but on Debian, if I try to execute `sudo apt-get update` or `curl ifconfig.me`, I receive connection errors, the workstation is not connected to the network anymore. Why disabling the Whonix Firewall isolates the Debian workstation? Is there another component involved in this scenario that blocks the connections when the Whonix Firewall is disabled?

PS: executing `sudo service whonix-firewall status`:
![image|690x150](upload://5kZrwX69cslaHskdHZmBErShQrk.png) 

Regards</description>
    <language>en</language>
    <lastBuildDate>Thu, 15 Apr 2021 18:40:28 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 + Debian 10.9 - Disabling Firewall, workstation drops connection</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>When you run for example <code>curl</code>, <code>apt</code>, <code>apt-get</code> and other <code>uwt</code> wrapped applications by default, what happens under the hood, is actually running <code>torsocks curl</code>. Short introduction:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Stream_Isolation/Easy" target="_blank" rel="noopener" title="10:01AM - 26 December 2020">Whonix – 26 Dec 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/143;"><img src="https://www.whonix.org/w/images/e/eb/Streamisolationme.jpg" class="thumbnail" width="110" height="143"></div>

<h3><a href="https://www.whonix.org/wiki/Stream_Isolation/Easy" target="_blank" rel="noopener">Stream Isolation/Easy</a></h3>

<p>Whonix ™ Tor Stream Isolation Short Introduction</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>This can be disabled:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Stream_Isolation/Disable_Easy" target="_blank" rel="noopener" title="10:01AM - 26 December 2020">Whonix – 26 Dec 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/83;"><img src="https://www.whonix.org/w/images/d/d9/Streamisolation213123.png" class="thumbnail" width="110" height="83"></div>

<h3><a href="https://www.whonix.org/wiki/Stream_Isolation/Disable_Easy" target="_blank" rel="noopener">Stream Isolation/Disable Easy</a></h3>

<p>How to disable stream isolation. Easiest and most common methods only.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Longer explanation:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Stream_Isolation" target="_blank" rel="noopener" title="11:49AM - 02 March 2021">Whonix – 2 Mar 21</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/143;"><img src="https://www.whonix.org/w/images/e/eb/Streamisolationme.jpg" class="thumbnail" width="110" height="143"></div>

<h3><a href="https://www.whonix.org/wiki/Stream_Isolation" target="_blank" rel="noopener">Stream Isolation</a></h3>

<p>Prevent Identity Correlation through Circuit Sharing by using Tor Stream Isolation</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<hr>
<p>For Whonix-Workstation to be able to use system default DNS (non-uwt wrappeed applications and/or uwt disabled) (meaning not using a proxifier / socksifier), it requires Whonix-Gateway providing a Tor <code>DnsPort</code>. (See Tor manual for <code>DnsPort</code>.) Furthermore Tor requires traffic to be redirected to Tor’s <code>DnsPort</code> using iptables (or similar). Once Whonix-Gateway firewall is down, this iptables redirection will be non-existing.</p>
<p>The same, simplified, in more generic terms (unspecific to Whonix):<br>
For machine to be able to use system default DNS, it requires a Tor <code>DnsPort</code>. (See Tor manual for <code>DnsPort</code>.) Furthermore Tor requires traffic to be redirected to Tor’s <code>DnsPort</code> using iptables (or similar).</p>
<p>The same is true for system default TCP traffic. (See Tor manual for <code>TransPort</code>.)</p>
<hr>
<p>This might help too:</p>
<ul>
<li><a href="https://www.whonix.org/wiki/Dev/Technical_Introduction#multiple_security_layers">https://www.whonix.org/wiki/Dev/Technical_Introduction#multiple_security_layers</a></li>
<li>Whonix (by that time still called TorBOX) was originally based on this:
<ul>
<li><a href="https://gitlab.torproject.org/legacy/trac/-/wikis/doc/TransparentProxy#local-redirection-and-anonymizing-middlebox">https://gitlab.torproject.org/legacy/trac/-/wikis/doc/TransparentProxy#local-redirection-and-anonymizing-middlebox</a></li>
</ul>
</li>
</ul>
<p>Related:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Dev/Whonix_Networking" target="_blank" rel="noopener" title="10:01AM - 26 December 2020">Whonix – 26 Dec 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/73;"><img src="https://www.whonix.org/w/images/7/72/Network23423.jpg" class="thumbnail" width="110" height="73"></div>

<h3><a href="https://www.whonix.org/wiki/Dev/Whonix_Networking" target="_blank" rel="noopener">Dev/Whonix Networking</a></h3>

<p>This page documents the differences between Debian and Whonix ™ related to networking.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="quote quote-modified" data-post="1" data-topic="8274">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="https://forums.whonix.org/t/whonix-networking-implementation-developer-documentation-feedback-wanted/8274">Whonix Networking Implementation - Developer Documentation - Feedback Wanted!</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/news/21"><span class="badge-category-bg" style="background-color: #AB9364;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="News posted by Whonix staff. The Whonix Blog. Stay Tuned. (rss)">News</span></a>
  </div>
  <blockquote>
    The diff between Debian buster and Whonix related to changes to network configuration. 
Whonix Networking Implementation - Developer Documentation was just now updated. 


On above page you can find all changes that Whonix applies related to networking: 

Location of the files on the disk in installed Whonix.
The location of the file in Whonix source code on the disk.
A link to the web version of the file on github.
A comment if

not installed by default
gateway or workstation only
Non-Qubes-Who…
  </blockquote>
</aside>

<hr>
<p>You’re underway of a great journey of understanding Whonix networking. If you understand most of that, you’ll be in a much better position to judge the (un)likeliness of leaks when using Whonix-Workstation.</p>
<p>And also if you have ideas on how to document this and perhaps even could contribute the required wiki enhancements, that would be great.</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445/2</link>
        <pubDate>Thu, 15 Apr 2021 18:40:28 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11445-2</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445.rss">Whonix Gateway CLI-15.0.1.5.4 + Debian 10.9 - Disabling Firewall, workstation drops connection</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 + Debian 10.9 - Disabling Firewall, workstation drops connection</title>
        <dc:creator><![CDATA[Bl4ckJ4ck]]></dc:creator>
        <description><![CDATA[
            <p>Greetings,<br>
I’m performing some tests by using Whonix Gateway CLI + Debian 10.9 as workstation and some aspects of the whonix firewall in this OS custom scenario.</p>
<p>I guess the configuration, enable and disable of Whonix Firewall is directly related to the iptables rules.<br>
When the Whonix Firewall is enabled (assuming no changes by the user) the iptables rules are the following:<br>
</p><div class="lightbox-wrapper"><a class="lightbox" href="//forums.whonix.org/uploads/default/original/2X/2/28898109107c3cfb0c0aad737ef434c2159c8d6d.png" data-download-href="//forums.whonix.org/uploads/default/28898109107c3cfb0c0aad737ef434c2159c8d6d" title="image"><img src="//forums.whonix.org/uploads/default/original/2X/2/28898109107c3cfb0c0aad737ef434c2159c8d6d.png" alt="image" data-base62-sha1="5MBHojKsPcHfP2aE4T3HRx5oKXX" width="653" height="500" data-small-upload="//forums.whonix.org/uploads/default/optimized/2X/2/28898109107c3cfb0c0aad737ef434c2159c8d6d_2_10x10.png"></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="//forums.whonix.org/uploads/default/original/2X/2/28ca900679151156851f274bba3af8cac5d4fd1a.png" data-download-href="//forums.whonix.org/uploads/default/28ca900679151156851f274bba3af8cac5d4fd1a" title="image"><img src="//forums.whonix.org/uploads/default/original/2X/2/28ca900679151156851f274bba3af8cac5d4fd1a.png" alt="image" data-base62-sha1="5OR5p8spKNsbX5tUY7TnjTMp4Po" width="690" height="301" data-small-upload="//forums.whonix.org/uploads/default/optimized/2X/2/28ca900679151156851f274bba3af8cac5d4fd1a_2_10x10.png"></a></div><p></p>
<p>In this situation, both of the machines work well and they connect also to the Internet.<br>
During my tests, I noted that, if I disable the Whonix Firewall on the Gateway, as described here <a href="https://www.whonix.org/wiki/Dev/Firewall_Unload" rel="noopener nofollow ugc">https://www.whonix.org/wiki/Dev/Firewall_Unload</a>, and executing <code>./firewall-unload</code> script, the iptables rules will correctly be:<br>
<img src="//forums.whonix.org/uploads/default/original/2X/7/716f83c6e046ab3423d4b079780a5c7cef72dc3c.png" alt="image" data-base62-sha1="gbuS9pWMN3Ppp42kAEzPYxvgWew" width="422" height="143"><br>
and if I perform a <code>curl ifconfig.me</code> in the Whonix Gateway, it connects correctly, but on Debian, if I try to execute <code>sudo apt-get update</code> or <code>curl ifconfig.me</code>, I receive connection errors, the workstation is not connected to the network anymore. Why disabling the Whonix Firewall isolates the Debian workstation? Is there another component involved in this scenario that blocks the connections when the Whonix Firewall is disabled?</p>
<p>PS: executing <code>sudo service whonix-firewall status</code>:<br>
</p><div class="lightbox-wrapper"><a class="lightbox" href="//forums.whonix.org/uploads/default/original/2X/2/256a507f872de8081aa23c25a3fb7ecb249d9966.png" data-download-href="//forums.whonix.org/uploads/default/256a507f872de8081aa23c25a3fb7ecb249d9966" title="image"><img src="//forums.whonix.org/uploads/default/original/2X/2/256a507f872de8081aa23c25a3fb7ecb249d9966.png" alt="image" data-base62-sha1="5kZrwX69cslaHskdHZmBErShQrk" width="690" height="150" data-small-upload="//forums.whonix.org/uploads/default/optimized/2X/2/256a507f872de8081aa23c25a3fb7ecb249d9966_2_10x10.png"></a></div><p></p>
<p>Regards</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445/1</link>
        <pubDate>Thu, 15 Apr 2021 18:10:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11445-1</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-debian-10-9-disabling-firewall-workstation-drops-connection/11445.rss">Whonix Gateway CLI-15.0.1.5.4 + Debian 10.9 - Disabling Firewall, workstation drops connection</source>
      </item>
  </channel>
</rss>
