<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Suggestion: update-torbrowser shouldn&#39;t downgrade by default</title>
    <link>http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279</link>
    <description>For a long time, I&#39;ve only ever used `update-torbrowser --onion --noask` to update Tor Browser in my `whonix-ws` template. As discussed in the [https://forums.whonix.org/t/download-torbrowser-via-onion/10178/10?u=adw] thread, I recently noticed that the onion address was unreachable, so my Tor Browser wasn&#39;t being updated. So, I dropped the `--onion` option and ran `update-torbrowser --noask`. The result was that Tor Borwser was downgraded from 9.5.4 to 9.5.3. In other words, 9.5.4 was already installed, and `update-torbrowser` uninstalled it in order to install 9.5.3.

I&#39;m a bit confused about why this happened. Since I always run the same command (except for `--onion`), then shouldn&#39;t it always do the same thing? For example, if the default is to grab the lowest stable version, then since I never override the default, shouldn&#39;t it always grab the lowest stable version? Maybe it actually is doing this, and The Tor Project bumped the lowest version up to 9.5.4, then bumped it back down to 9.5.3 for some reason? Or maybe the onion server (from when I was using `--onion`) had 9.5.4 as the lowest, while the clearnet server, for some reason, had 9.5.3 as the lowest?

In any case, my suggestion is that perhaps `update-torbrowser` should never downgrade Tor Browser versions by default. In other words, if the lowest stable version available from the server is lower than what we already have, do nothing.</description>
    <language>en</language>
    <lastBuildDate>Thu, 17 Sep 2020 01:58:22 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Suggestion: update-torbrowser shouldn&#39;t downgrade by default</title>
        <dc:creator><![CDATA[adw]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="4" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Check:</p>
<pre><code class="lang-auto">cat /usr/share/tb-updater/tbb_hardcoded_version
</code></pre>
</blockquote>
</aside>
<pre><code class="lang-auto">tbb_hardcoded_version="9.5.4"
</code></pre>
<aside class="quote no-group" data-username="Patrick" data-post="4" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would have failed if <code>tb_onion=true</code> was set in config folder.</p>
</blockquote>
</aside>
<p>I can check this too, but I’m not sure where to look. I don’t recall modifying it myself.</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="4" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Perhaps would be best to abolish <code>--noask</code>. […]</p>
</blockquote>
</aside>
<p>I can understand that. My personal use case is simply that upgrading TB can take a long time, and I usually don’t remember to do it until I need it, at which point it’s too late. So, it’s much easier if I can just script the update to happen unattended, then I can check the logs afterward (which is how I noticed the downgrade).</p>
          <p><a href="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/5</link>
        <pubDate>Thu, 17 Sep 2020 01:58:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-10279-5</guid>
        <source url="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279.rss">Suggestion: update-torbrowser shouldn&#39;t downgrade by default</source>
      </item>
      <item>
        <title>Suggestion: update-torbrowser shouldn&#39;t downgrade by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="adw" data-post="3" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/adw/40/686_2.png" class="avatar"> adw:</div>
<blockquote>
<p>I had considered that, but I figured we would want to verify the signatures on the actual bundles themselves</p>
</blockquote>
</aside>
<p>Bundle signatures are always verified. That authenticates the bundle but version number can’t be authenticated that way. Hence:</p>
<ul>
<li><a href="https://www.whonix.org/wiki/Tor_Browser#Download_Confirmation_Notification"> Download Confirmation Notification</a></li>
<li><a href="https://www.whonix.org/wiki/Tor_Browser#Installation_Confirmation_Notification"> Installation Confirmation Notification</a></li>
</ul>
<aside class="quote no-group" data-username="adw" data-post="3" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/adw/40/686_2.png" class="avatar"> adw:</div>
<blockquote>
<p>But I suppose downloading and verifying all of the bundles might be considered unfeasible.</p>
</blockquote>
</aside>
<p>Indeed. And even when downloading all bundles, there would still be no way to verify it’s version number. gpg signs files. Not file names. The get a trusted version number we’d have to extract the bundle and then look at some file mentioning the version number inside the extracted archive. Possible in theory but a lot code. At some point the workarounds at downstream (Whonix) are no longer reasonable due to upstream issues (no singed version numbers provided by Tor Project).</p>
<aside class="quote no-group" data-username="adw" data-post="3" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/adw/40/686_2.png" class="avatar"> adw:</div>
<blockquote>
<p>Now I am confused why that didn’t prevent <code>update-torbrowser</code> from downgrading from 9.5.4 to 9.5.3. Maybe I hadn’t yet gotten the update in which the hardcoded version got bumped up to 9.5.4?</p>
</blockquote>
</aside>
<p>Hardcoded version numbers are only used when update-torbrowser script is run from postinst script, i.e. during tb-updater package upgrade.</p>
<aside class="quote no-group" data-username="adw" data-post="3" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/adw/40/686_2.png" class="avatar"> adw:</div>
<blockquote>
<p>Reading that, it sounds like updating my <code>whonix-ws-15</code> template should be automatically updating Tor Browser such that fresh DisposableVMs based on <code>whonix-ws-15</code> already have updated Tor Browsers.</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group" data-username="adw" data-post="3" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/adw/40/686_2.png" class="avatar"> adw:</div>
<blockquote>
<p>But this does not happen</p>
</blockquote>
</aside>
<p>Check:</p>
<pre><code>cat /usr/share/tb-updater/tbb_hardcoded_version
</code></pre>
<p>It can fail due to network issues but you’d see this during upgrading. Would have failed if <code>tb_onion=true</code> was set in config folder.</p>
<p>Perhaps would be best to abolish <code>--noask</code>. <code>--noask</code> is not something I have in mind and it’s vulnerable to downgrade attacks. And <code>--noask</code>, automated download, without user oversight, without hardcoded version numbers can’t be made secure with reasonable effort since upstream doesn’t offer authenticated/expiring version metadata. Upstream ticket was created by me years ago.</p>
<p><a href="https://trac.torproject.org/projects/tor/ticket/13065">counter downgrade / stale mirror attacks on RecommendedTBBVersions - sign / verify tbb versions file </a></p>
<p>There is <code>GETINFO consensus/packages</code> but it’s empty, not populated with actual information yet.</p>
<p>Another option could be making <code>--noask</code> use hardcoded version number. That would be safe. But there is little point since after tb-updater package upgrade it should have cached that version in /var/cache/tb-binary folder already anyhow.</p>
          <p><a href="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/4</link>
        <pubDate>Wed, 16 Sep 2020 07:45:03 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-10279-4</guid>
        <source url="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279.rss">Suggestion: update-torbrowser shouldn&#39;t downgrade by default</source>
      </item>
      <item>
        <title>Suggestion: update-torbrowser shouldn&#39;t downgrade by default</title>
        <dc:creator><![CDATA[adw]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It’s hard to know which is the right version.</p>
<ul>
<li>Version numbers are taken from this URL: <a href="https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions/" rel="nofollow noopener">https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions/</a>
<ul>
<li>And there is no strong authentication. TLS only. No onion version. No gpg signed version.</li>
</ul>
</li>
</ul>
</blockquote>
</aside>
<p>I had considered that, but I figured we would want to verify the signatures on the actual bundles themselves in order to determine trusted version numbers anyway, because if we trust the version numbers without authentication, it opens us up to various other attacks, as well. But I suppose downloading and verifying all of the bundles might be considered unfeasible.</p>
<aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>And then there is also the <a href="https://gitlab.com/whonix/tb-updater/-/tree/master/usr/share/tb-updater" rel="nofollow noopener">hardcoded version number(s)</a></p>
</blockquote>
</aside>
<p>Now I am confused why that didn’t prevent <code>update-torbrowser</code> from downgrading from 9.5.4 to 9.5.3. Maybe I hadn’t yet gotten the update in which the hardcoded version got bumped up to 9.5.4?</p>
<aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="10279">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>for the <a href="https://www.whonix.org/wiki/Tor_Browser/Advanced_Users#tb-updater_in_Qubes_TemplateVM" rel="nofollow noopener">tb-updater in Qubes TemplateVM</a> mechanism.</p>
</blockquote>
</aside>
<p>Now I am even more confused. Reading that, it sounds like updating my <code>whonix-ws-15</code> template should be automatically updating Tor Browser such that fresh DisposableVMs based on <code>whonix-ws-15</code> already have updated Tor Browsers. But this does not happen, hence why I had to add <code>update-torbrowser --noask</code> in my own custom update script.</p>
          <p><a href="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/3</link>
        <pubDate>Wed, 16 Sep 2020 04:08:39 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-10279-3</guid>
        <source url="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279.rss">Suggestion: update-torbrowser shouldn&#39;t downgrade by default</source>
      </item>
      <item>
        <title>Suggestion: update-torbrowser shouldn&#39;t downgrade by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>It’s hard to know which is the right version.</p>
<ul>
<li>Version numbers are taken from this URL: <a href="https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions/">https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions/</a>
<ul>
<li>And there is no strong authentication. TLS only. No onion version. No gpg signed version.</li>
</ul>
</li>
<li><a href="https://trac.torproject.org/projects/tor/ticket/14383">RecommendedTBBVersions format is not finalized.</a></li>
</ul>
<p>It uses the lowest version number pointed out in <code>RecommendedTBBVersions</code> because other versions could be alpha or beta versions.</p>
<p>A messy situation worked around with this:</p>
<ul>
<li><a href="https://www.whonix.org/wiki/Tor_Browser#Download_Confirmation_Notification"> Download Confirmation Notification</a></li>
<li><a href="https://www.whonix.org/wiki/Tor_Browser#Installation_Confirmation_Notification"> Installation Confirmation Notification</a></li>
</ul>
<p>…which are both manual interactive methods, not <code>--noask</code>.</p>
<p>And then there is also the <a href="https://gitlab.com/whonix/tb-updater/-/tree/master/usr/share/tb-updater">hardcoded version number(s)</a> for the <a href="https://www.whonix.org/wiki/Tor_Browser/Advanced_Users#tb-updater_in_Qubes_TemplateVM">tb-updater in Qubes TemplateVM</a> mechanism.</p>
<p>Thanks for your suggestion. Implementing downgrade protection when using <code>--noask</code> would be rather difficult.</p>
<p>I’ll change the man page from</p>
<blockquote>
<ul>
<li>
<p>–noask</p>
<p>Installs whatever <a href="https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions">https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions</a><br>
claims to be the latest version without user interaction.</p>
</li>
</ul>
</blockquote>
<p>to</p>
<blockquote>
<ul>
<li>
<p>–noask</p>
<p>Installs whatever <a href="https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions">https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions</a><br>
claims to be the lowest version without user interaction.</p>
</li>
</ul>
</blockquote>
<p>Long term my plan is rather to deprecate tb-updater since it has been causing significant development, support, maintenance effort and to rather use a solution similar to the one for electrum appimage by using package <code>binaries-freedom</code>.</p>
<aside class="quote" data-post="1" data-topic="6635">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar">
    <a href="https://forums.whonix.org/t/policy-for-inclusion-of-compiled-software/6635">Policy for Inclusion of Compiled Software</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development/8"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    What is the policy for including non-packaged programs by default, that are distributed as Appimages or Jar files? Can you please document your policy on this on the wiki? Is Tor Browser the only exception? 
Interesting software we might want to consider in this form is: 

Freenet
Cryptocat

Edit by Patrick: 

<a href="https://phabricator.whonix.org/T215" rel="nofollow noopener">electrum</a>
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/2</link>
        <pubDate>Tue, 15 Sep 2020 09:51:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-10279-2</guid>
        <source url="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279.rss">Suggestion: update-torbrowser shouldn&#39;t downgrade by default</source>
      </item>
      <item>
        <title>Suggestion: update-torbrowser shouldn&#39;t downgrade by default</title>
        <dc:creator><![CDATA[adw]]></dc:creator>
        <description><![CDATA[
            <p>For a long time, I’ve only ever used <code>update-torbrowser --onion --noask</code> to update Tor Browser in my <code>whonix-ws</code> template. As discussed in the [<a href="https://forums.whonix.org/t/download-torbrowser-via-onion/10178/10" class="inline-onebox">download torbrowser via onion</a>] thread, I recently noticed that the onion address was unreachable, so my Tor Browser wasn’t being updated. So, I dropped the <code>--onion</code> option and ran <code>update-torbrowser --noask</code>. The result was that Tor Borwser was downgraded from 9.5.4 to 9.5.3. In other words, 9.5.4 was already installed, and <code>update-torbrowser</code> uninstalled it in order to install 9.5.3.</p>
<p>I’m a bit confused about why this happened. Since I always run the same command (except for <code>--onion</code>), then shouldn’t it always do the same thing? For example, if the default is to grab the lowest stable version, then since I never override the default, shouldn’t it always grab the lowest stable version? Maybe it actually is doing this, and The Tor Project bumped the lowest version up to 9.5.4, then bumped it back down to 9.5.3 for some reason? Or maybe the onion server (from when I was using <code>--onion</code>) had 9.5.4 as the lowest, while the clearnet server, for some reason, had 9.5.3 as the lowest?</p>
<p>In any case, my suggestion is that perhaps <code>update-torbrowser</code> should never downgrade Tor Browser versions by default. In other words, if the lowest stable version available from the server is lower than what we already have, do nothing.</p>
          <p><a href="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279/1</link>
        <pubDate>Tue, 15 Sep 2020 05:45:52 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-10279-1</guid>
        <source url="http://forums.whonix.org/t/suggestion-update-torbrowser-shouldnt-downgrade-by-default/10279.rss">Suggestion: update-torbrowser shouldn&#39;t downgrade by default</source>
      </item>
  </channel>
</rss>
