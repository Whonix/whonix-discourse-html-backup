<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Consider adding Retry Loop into build script</title>
    <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500</link>
    <description>Preface:

I&#39;ve done probably a couple dozen --install-to-root builds over the past few weeks.

Some were in Qubes and some were in VirtualBox.

Some were version 8.2, some 8.6.6.0, some 8.6.6.7.

All were through a Tor internet connection.

I seem to be getting inconsistent build errors at various times, even with the same build configuration.

For example, one time a package dependency is not met and throws an error, and the next time it doesn&#39;t, etc.

It seems like a number of these build errors may often be due to temporary conditions, such as tor/internet interruptions or system resource consumption issues.

Where, by simply waiting a little bit, refreshing Tor circuit, etc, a simple retry of an erred build step might actually succeed instead of fail.


Suggestion:

Much of the infrastructure to catch build errors, and pause the script, seems to be in place already. For example, I often press &quot;c + enter&quot; to ignore and continue in my test builds.

I think a &quot;RETRY&quot; option should be added that loops back through and tries the error build step yet again.

For example, along with the other options: &quot;Press r and enter to retry this step.&quot;

Instead of having to either ignore the step after a single attempt or quit the build script entirely, then have to start all over from the beginning.

it seems like a Retry Loop could help correcting and succeeding with some build error conditions on the fly, instead of having to start from the top and hope for the best again.

This retry capability could also help one further sort out real persistent build errors that the project should know about from temporary conditional ones that are individual and fleeting.



Also, it seems that when the build script is using apt-get to download multiple packages, and sometimes fails on one, it doesn&#39;t have error catching infrastructure to handle that.

For example, I recently got:

&lt;blockquote&gt;Err http://security.debian.org/ wheezy/updates/main python-magic i386 5.11-2+deb7u5 [39.1 kB]
Connection failed.&lt;/blockquote&gt;

The script did not seem to pause for this failed download, where, depending upon the package, something like this maybe could harm the final build and/or spawn additional errors further in the build script which could not be fixed without going back and getting the downloaded package.

So, at some point, maybe adding an error catching and Retry Loop capability to other parts, like these package downloads could be very helpful to ensuring stable and successful builds.


Thanks!</description>
    <language>en</language>
    <lastBuildDate>Fri, 19 Sep 2014 10:12:38 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Consider adding Retry Loop into build script</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:6, topic:500”][quote author=WhonixQubes link=topic=525.msg4046#msg4046 date=1410973841]<br>
This could probably be useful in certain circumstances. I could see doing such a newnym/wait procedure.<br>
[/quote]<br>
Implemented --dispatch-before-retry and --dispatch-after-retry in <a href="https://github.com/Whonix/Whonix/tree/c4c11ee2e8219980293788c1a29bbab6e60989c0" rel="nofollow noopener">https://github.com/Whonix/Whonix/tree/c4c11ee2e8219980293788c1a29bbab6e60989c0</a>, git commit <a href="https://github.com/Whonix/Whonix/commit/c4c11ee2e8219980293788c1a29bbab6e60989c0" rel="nofollow noopener">https://github.com/Whonix/Whonix/commit/c4c11ee2e8219980293788c1a29bbab6e60989c0</a>.</p>
<p>You could use something like:</p>
<pre><code class="lang-auto"></code></pre>
<p>Nice! Thanks Patrick. <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          <p><a href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/7</link>
        <pubDate>Fri, 19 Sep 2014 10:12:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-500-7</guid>
        <source url="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss">Consider adding Retry Loop into build script</source>
      </item>
      <item>
        <title>Consider adding Retry Loop into build script</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="5" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/w/c5a1d2/40.png" class="avatar"> WhonixQubes:</div>
<blockquote>
<p>This could probably be useful in certain circumstances. I could see doing such a newnym/wait procedure.</p>
</blockquote>
</aside>
<p>Implemented --dispatch-before-retry and --dispatch-after-retry in <a href="https://github.com/Whonix/Whonix/tree/c4c11ee2e8219980293788c1a29bbab6e60989c0">https://github.com/Whonix/Whonix/tree/c4c11ee2e8219980293788c1a29bbab6e60989c0</a>, git commit <a href="https://github.com/Whonix/Whonix/commit/c4c11ee2e8219980293788c1a29bbab6e60989c0">https://github.com/Whonix/Whonix/commit/c4c11ee2e8219980293788c1a29bbab6e60989c0</a>.</p>
<p>You could use something like:</p>
<pre><code class="lang-auto"></code></pre>
          <p><a href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/6</link>
        <pubDate>Wed, 17 Sep 2014 19:28:52 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-500-6</guid>
        <source url="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss">Consider adding Retry Loop into build script</source>
      </item>
      <item>
        <title>Consider adding Retry Loop into build script</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="4" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Added --auto-retry (default: 1) and --wait-auto-retry (default: 5) (wait before auto retry in seconds) to error handler.</p>
</blockquote>
</aside>
<p>Nice.</p>
<aside class="quote" data-post="4" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I guess  --auto-retry default 1 is good, because some errors such as missing command line option aren’t useful to be retried more times. It would unnecessarily flood stdout. However, maybe you have another idea here.</p>
</blockquote>
</aside>
<p>Sounds good.</p>
<aside class="quote" data-post="4" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Anything else missing here to ease development?</p>
</blockquote>
</aside>
<p>Nothing notable that I can think of at the moment. Will keep my mind open.</p>
<aside class="quote" data-post="4" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I could also easily add an option for an hook to dispatch (<code>eval</code>uate) a custom command before auto retry. One could automatically run a custom newnym/wait script then or something like that.</p>
</blockquote>
</aside>
<p>This could probably be useful in certain circumstances. I could see doing such a newnym/wait procedure.</p>
<p>Thanks again!</p>
          <p><a href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/5</link>
        <pubDate>Wed, 17 Sep 2014 17:10:41 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-500-5</guid>
        <source url="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss">Consider adding Retry Loop into build script</source>
      </item>
      <item>
        <title>Consider adding Retry Loop into build script</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="3" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/w/c5a1d2/40.png" class="avatar"> WhonixQubes:</div>
<blockquote>
<p>So I’m guessing these inconsistent package dependency errors could simply be due to failed downloads over Tor.</p>
</blockquote>
</aside>
<p>Quite likely.</p>
<blockquote>Would want to make sure if a step continues to fail, one can retry an indefinite number of times in a row.</blockquote>
This is tested, was possible with last commit already.
<blockquote>Yes. Unless there are certain steps where this clearly doesn't make sense for some reason, then I generally think retrying steps is a straight-forward choice to make and could be auto-retried maybe even a few times by default before prompting the user to intervene. Or maybe even some conditional logic to set the number of retries in a command line option flag, like (--auto-retry=20), with a default number of retries of maybe 0, 1, or a few, if this option flag is not set.</blockquote>
<p>Added --auto-retry (default: 1) and --wait-auto-retry (default: 5) (wait before auto retry in seconds) to error handler.</p>
<p>Implemented in <a href="https://github.com/Whonix/Whonix/tree/8d6edb1e77e1d9f60578d013d0d046b88ace0164">https://github.com/Whonix/Whonix/tree/8d6edb1e77e1d9f60578d013d0d046b88ace0164</a>, commit <a href="https://github.com/Whonix/Whonix/commit/8d6edb1e77e1d9f60578d013d0d046b88ace0164">https://github.com/Whonix/Whonix/commit/8d6edb1e77e1d9f60578d013d0d046b88ace0164</a>.</p>
<p>I guess  --auto-retry default 1 is good, because some errors such as missing command line option aren’t useful to be retried more times. It would unnecessarily flood stdout. However, maybe you have another idea here.</p>
<p>Anything else missing here to ease development? I could also easily add an option for an hook to dispatch (<code>eval</code>uate) a custom command before auto retry. One could automatically run a custom newnym/wait script then or something like that.</p>
<blockquote>If after going through all of the apt-get downloads, and it reports a non-zero exit code, then I'm guessing the bash command retry feature would handle this, retry the apt-get downloads, recognize not needing the ones it already has, and attempt the ones that failed before?</blockquote>
Yes.
          <p><a href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/4</link>
        <pubDate>Wed, 17 Sep 2014 16:55:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-500-4</guid>
        <source url="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss">Consider adding Retry Loop into build script</source>
      </item>
      <item>
        <title>Consider adding Retry Loop into build script</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Great. Thanks Patrick!</p>
<p>[quote=“Patrick, post:2, topic:500”][quote author=WhonixQubes link=topic=525.msg4040#msg4040 date=1410959036]<br>
For example, one time a package dependency is not met and throws an error, and the next time it doesn’t, etc.<br>
[/quote]<br>
I don’t see how this is possible. Please post two logs to compare so this can be fixed.[/quote]</p>
<p>I don’t have two comparative logs handy, but I would imagine this could come from a failed package download over Tor.</p>
<p>Back in my 8.2 builds, I mentioned that new error with the “liblwres80” package, but before mentioning that, my 8.2 builds had completed without throwing an error for that package.</p>
<p>I do often see Debian package downloads failing over certain tor circuits and succeeding after refreshing the Tor circuits.</p>
<p>So I’m guessing these inconsistent package dependency errors could simply be due to failed downloads over Tor.</p>
<aside class="quote" data-post="2" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I am always eager to improve the build environment to make development more comfortable.</p>
</blockquote>
</aside>
<p>Awesome to hear that</p>
<aside class="quote" data-post="2" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Let’s start simple with a retry feature for failed bash commands in the error handler?</p>
</blockquote>
</aside>
<p>Sounds good.</p>
<p>[quote=“Patrick, post:2, topic:500”]I just did some changes to implement that:</p>
<p>What do you think?[/quote]</p>
<p>With a brief review and without being very acclimated to Whonix code yet, it looks good.</p>
<p>I’ll have to do a development build at some point and look at it more closely.</p>
<p>Would want to make sure if a step continues to fail, one can retry an indefinite number of times in a row.</p>
<aside class="quote" data-post="2" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would you like to have an auto retry feature?</p>
</blockquote>
</aside>
<p>Yes. Unless there are certain steps where this clearly doesn’t make sense for some reason, then I generally think retrying steps is a straight-forward choice to make and could be auto-retried maybe even a few times by default before prompting the user to intervene. Or maybe even some conditional logic to set the number of retries in a command line option flag, like (–auto-retry=20), with a default number of retries of maybe 0, 1, or a few, if this option flag is not set.</p>
<aside class="quote" data-post="2" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Let’s see if bash command retry feature suffices or if a build step retry feature will be required.</p>
</blockquote>
</aside>
<p>Yup. That might do.</p>
<aside class="quote" data-post="2" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Since it’s a more complex change that needs more testing, that feature will be added to Whonix 10 and above.</p>
</blockquote>
</aside>
<p>Sounds good.</p>
<aside class="quote" data-post="2" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Interestingly you could use this change also in Whonix 9 without git commits.</p>
</blockquote>
</aside>
<p>Good to know.</p>
<aside class="quote" data-post="2" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It is not possible to break that early. At least not without a giant hack (parsing stdout) or patching apt-get. The build script waits until apt-get exits. It’s up to apt-get when it exits. As far I know there is no exit-as-soon-as-first-download-failed feature. However, when apt-get finished it should reliably exit with a non-zero exit code, which the build script will reliably notice and report.</p>
</blockquote>
</aside>
<p>Yeah, that’s likely what happened in that case.</p>
<p>If after going through all of the apt-get downloads, and it reports a non-zero exit code, then I’m guessing the bash command retry feature would handle this, retry the apt-get downloads, recognize not needing the ones it already has, and attempt the ones that failed before?</p>
<p>This would be good if so.</p>
          <p><a href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/3</link>
        <pubDate>Wed, 17 Sep 2014 15:53:29 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-500-3</guid>
        <source url="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss">Consider adding Retry Loop into build script</source>
      </item>
      <item>
        <title>Consider adding Retry Loop into build script</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="WhonixQubes" data-post="1" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/w/c5a1d2/40.png" class="avatar"> WhonixQubes:</div>
<blockquote>
<p>For example, one time a package dependency is not met and throws an error, and the next time it doesn’t, etc.</p>
</blockquote>
</aside>
<p>I don’t see how this is possible. Please post two logs to compare so this can be fixed.</p>
<aside class="quote no-group" data-username="WhonixQubes" data-post="1" data-topic="500">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/w/c5a1d2/40.png" class="avatar"> WhonixQubes:</div>
<blockquote>
<p>I think a “RETRY” option should be added that loops back through and tries the error build step yet again.</p>
</blockquote>
</aside>
<p>I am always eager to improve the build environment to make development more comfortable.</p>
<p>Let’s start simple with a retry feature for failed bash commands in the error handler?</p>
<p>I just did some changes to implement that:<br>
</p><aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/commit/4ff311cd80d0b44199c0bc7b140a953e62c54908" target="_blank">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/Whonix/commit/4ff311cd80d0b44199c0bc7b140a953e62c54908" target="_blank">refactoring</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2014-09-17" data-time="13:42:24" data-timezone="UTC">01:42PM - 17 Sep 14 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 2 additions and 2 deletions">
        <a href="https://github.com/Whonix/Whonix/commit/4ff311cd80d0b44199c0bc7b140a953e62c54908" target="_blank">
          <span class="added">+2</span>
          <span class="removed">-2</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/commit/721e470db0a37c57fede0fa49beefae4eca7ee44" target="_blank">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/Whonix/commit/721e470db0a37c57fede0fa49beefae4eca7ee44" target="_blank">output</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2014-09-17" data-time="13:43:10" data-timezone="UTC">01:43PM - 17 Sep 14 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 1 additions and 1 deletions">
        <a href="https://github.com/Whonix/Whonix/commit/721e470db0a37c57fede0fa49beefae4eca7ee44" target="_blank">
          <span class="added">+1</span>
          <span class="removed">-1</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/commit/deac7955d36115ea9324f0b5d68f24a087f18138" target="_blank">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/Whonix/commit/deac7955d36115ea9324f0b5d68f24a087f18138" target="_blank">refactoring; output</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2014-09-17" data-time="13:44:15" data-timezone="UTC">01:44PM - 17 Sep 14 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 4 additions and 4 deletions">
        <a href="https://github.com/Whonix/Whonix/commit/deac7955d36115ea9324f0b5d68f24a087f18138" target="_blank">
          <span class="added">+4</span>
          <span class="removed">-4</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/commit/389d58aae4b88da3905b501830363a8759c23271" target="_blank">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/Whonix/commit/389d58aae4b88da3905b501830363a8759c23271" target="_blank">help-steps/pre: error handler, code simplification at cost of duplicate "read -p" messages</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2014-09-17" data-time="13:50:00" data-timezone="UTC">01:50PM - 17 Sep 14 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 14 additions and 48 deletions">
        <a href="https://github.com/Whonix/Whonix/commit/389d58aae4b88da3905b501830363a8759c23271" target="_blank">
          <span class="added">+14</span>
          <span class="removed">-48</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/commit/91a427f336b5ba9ae417788272572d34be7fbd04" target="_blank">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/Whonix/commit/91a427f336b5ba9ae417788272572d34be7fbd04" target="_blank">build script: added retry feature to error handler; refactoring; output</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2014-09-17" data-time="14:32:29" data-timezone="UTC">02:32PM - 17 Sep 14 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 44 additions and 20 deletions">
        <a href="https://github.com/Whonix/Whonix/commit/91a427f336b5ba9ae417788272572d34be7fbd04" target="_blank">
          <span class="added">+44</span>
          <span class="removed">-20</span>
        </a>
      </div>
    </div>

  </div>
</div>




  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>Example log:</p>
<pre><code class="lang-auto">sudo ./build-steps.d/1100_prepare-build-machine 
+ true 'INFO: Currently running script: ./build-steps.d/1100_prepare-build-machine'
+++ dirname ./build-steps.d/1100_prepare-build-machine
++ cd ./build-steps.d
++ pwd
+ MYDIR=/home/user/whonix_dot/Whonix/build-steps.d
+ cd /home/user/whonix_dot/Whonix/build-steps.d
+ cd ..
+ cd help-steps
+ WHONIX_BUILD_INTERNALRUN=1
+ whonix_build_on_operating_system_detect_skip=1
+ source pre
++ set +x
+ source variables
++ set +x
INFO: Setting... export UWT_DEV_PASSTHROUGH="1"
++ bash -n /home/user/whonix_dot/Whonix/help-steps/parse-cmd
++ source /home/user/whonix_dot/Whonix/help-steps/parse-cmd
++ whonix_build_cmdoptions
++ trap error_handler_general ERR INT TERM
++ '[' '!' 1 = 1 ']'
++ build_machines=0
++ :
++ case $1 in
++ break
++ '[' '' = '' ']'
++ echo 'INFO: No build target (such as --486-linux, --32bit-linux, --64bit-linux, --64bit-kfreebsd [untested] or--32bit-kfreebsd [untested] has been chosen.
Defaulting to BUILD_TARGET_ARCH i386 and setting BUILD_KERNEL_PKGS to:
   linux-image-486
   linux-headers-486
   linux-image-686-pae
   linux-headers-686-pae'
INFO: No build target (such as --486-linux, --32bit-linux, --64bit-linux, --64bit-kfreebsd [untested] or--32bit-kfreebsd [untested] has been chosen.
Defaulting to BUILD_TARGET_ARCH i386 and setting BUILD_KERNEL_PKGS to:
   linux-image-486
   linux-headers-486
   linux-image-686-pae
   linux-headers-686-pae
++ export BUILD_TARGET_ARCH=i386
++ BUILD_TARGET_ARCH=i386
++ export 'BUILD_KERNEL_PKGS=linux-image-486 linux-headers-486 linux-image-686-pae linux-headers-686-pae'
++ BUILD_KERNEL_PKGS='linux-image-486 linux-headers-486 linux-image-686-pae linux-headers-686-pae'
++ '[' i386 = '' ']'
++ '[' '' = 1 ']'
++ '[' '!' 1 = 1 ']'
++ '[' '' = 1 ']'
++ '[' '' = 1 ']'
++ '[' '' = 1 ']'
++ '[' 0 -gt 1 ']'
++ '[' 0 -le 0 ']'
++ '[' '' = 1 ']'
++ '[' 1 = 1 ']'
++ true
++ '[' '' = 1 ']'
++ '[' '' = true ']'
++ '[' '' = true ']'
++ error 'You must choose --install-to-root, --virtualbox or --qcow2.'
/home/user/whonix_dot/Whonix/help-steps/parse-cmd: line 370: error: command not found
+++ error_handler_general
+++ error_handler_shared
+++ last_failed_exit_code=127
+++ last_failed_bash_command='error "${red}${bold}You must choose --install-to-root, --virtualbox or --qcow2.${reset}"'
+++ error_handler_shared_process
++++ caller
+++ last_caller='46 pre'
+++ last_script=pre
+++ benchmark_time_end
++++ date +%s
+++ benchmark_time_end=1410964589
+++ benchmark_took_seconds=0
++++ convertsecs 0
++++ (( h=0/3600 ))
++++ (( m=(0%3600)/60 ))
++++ (( s=0%60 ))
++++ printf '%02d:%02d:%02d\n' 0 0 0
++++ true
+++ benchmark_took_time=00:00:00
+++ true
+++ true '
############################################################
ERROR in pre detected!
(benchmark: 00:00:00)
last_failed_bash_command: error "${red}${bold}You must choose --install-to-root, --virtualbox or --qcow2.${reset}"
last_failed_exit_code: 127
caller: 46 pre
ERROR in pre!
############################################################
'
+++ '[' '!' '' = 1 ']'
+++ read -p 'ERROR in pre detected!
Please have a look above "error_handler_general", note the command that failed, its output and last_failed_exit_code.
- Please enter c and press enter to ignore the error and continue building. (Recommended against!)
- Please press r and enter to retry.
- Please press s and enter to open an chroot interactive shell.
- Please press enter to cleanup and exit. ' answer
ERROR in pre detected!
Please have a look above "error_handler_general", note the command that failed, its output and last_failed_exit_code.
- Please enter c and press enter to ignore the error and continue building. (Recommended against!)
- Please press r and enter to retry.
- Please press s and enter to open an chroot interactive shell.
- Please press enter to cleanup and exit. r
+++ ignore_error=
+++ error_handler_do_retry=
+++ '[' r = continue ']'
+++ '[' r = c ']'
+++ '[' r = s ']'
+++ '[' r = shell ']'
+++ '[' r = r ']'
+++ ignore_error=true
+++ error_handler_do_retry=true
+++ error_handler_retry
+++ true 'INFO: Retrying last_failed_bash_command...: error "${red}${bold}You must choose --install-to-root, --virtualbox or --qcow2.${reset}" '
+++ eval error '"${red}${bold}You' must choose --install-to-root, --virtualbox or '--qcow2.${reset}"'
++++ error 'You must choose --install-to-root, --virtualbox or --qcow2.'
pre: line 31: error: command not found
+++ retry_last_failed_bash_command_exit_code=127
+++ '[' 127 = 0 ']'
+++ true 'INFO: Retry failed. exit code of last_failed_bash_command: 127 '
+++ last_failed_exit_code=127
+++ last_failed_bash_command='error "${red}${bold}You must choose --install-to-root, --virtualbox or --qcow2.${reset}"'
+++ error_handler_shared_process
++++ caller
+++ last_caller='39 pre'
+++ last_script=pre
+++ benchmark_time_end
++++ date +%s
+++ benchmark_time_end=1410964598
+++ benchmark_took_seconds=9
++++ convertsecs 9
++++ (( h=9/3600 ))
++++ (( m=(9%3600)/60 ))
++++ (( s=9%60 ))
++++ printf '%02d:%02d:%02d\n' 0 0 9
++++ true
+++ benchmark_took_time=00:00:09
+++ true
+++ true '
############################################################
ERROR in pre detected!
(benchmark: 00:00:09)
last_failed_bash_command: error "${red}${bold}You must choose --install-to-root, --virtualbox or --qcow2.${reset}"
last_failed_exit_code: 127
caller: 39 pre
ERROR in pre!
############################################################
'
+++ '[' '!' '' = 1 ']'
+++ read -p 'ERROR in pre detected!
Please have a look above "error_handler_general", note the command that failed, its output and last_failed_exit_code.
- Please enter c and press enter to ignore the error and continue building. (Recommended against!)
- Please press r and enter to retry.
- Please press s and enter to open an chroot interactive shell.
- Please press enter to cleanup and exit. ' answer
ERROR in pre detected!
Please have a look above "error_handler_general", note the command that failed, its output and last_failed_exit_code.
- Please enter c and press enter to ignore the error and continue building. (Recommended against!)
- Please press r and enter to retry.
- Please press s and enter to open an chroot interactive shell.
- Please press enter to cleanup and exit. </code></pre>
<p>What do you think?</p>
<p>Would you like to have an auto retry feature?</p>
<p>Let’s see if bash command retry feature suffices or if a build step retry feature will be required.</p>
<p>Since it’s a more complex change that needs more testing, that feature will be added to Whonix 10 and above.</p>
<p>[<br>
Interestingly you could use this change also in Whonix 9 without git commits.</p>
<p>You could copy the edited/new functions<br>
error_handler_shell<br>
error_handler_retry<br>
error_handler_shared<br>
error_handler_shared_process<br>
error_handler_exit<br>
from <a href="https://github.com/Whonix/Whonix/blob/91a427f336b5ba9ae417788272572d34be7fbd04/help-steps/pre">https://github.com/Whonix/Whonix/blob/91a427f336b5ba9ae417788272572d34be7fbd04/help-steps/pre</a> and paste them into a build configuration file. This is untested, but by doing that, you could re-implement those functions.<br>
]</p>
<blockquote>Also, it seems that when the build script is using apt-get to download multiple packages, and sometimes fails on one, it doesn't have error catching infrastructure to handle that.</blockquote>
<blockquote>Err http://security.debian.org/ wheezy/updates/main python-magic i386 5.11-2+deb7u5 [39.1 kB]
Connection failed.</blockquote>
<blockquote>The script did not seem to pause for this failed download, where, depending upon the package, something like this maybe could harm the final build and/or spawn additional errors further in the build script which could not be fixed without going back and getting the downloaded package.</blockquote>
It is not possible to break that early. At least not without a giant hack (parsing stdout) or patching apt-get. The build script waits until apt-get exits. It's up to apt-get when it exits. As far I know there is no exit-as-soon-as-first-download-failed feature. However, when apt-get finished it should reliably exit with a non-zero exit code, which the build script will reliably notice and report.
          <p><a href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/2</link>
        <pubDate>Wed, 17 Sep 2014 14:52:26 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-500-2</guid>
        <source url="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss">Consider adding Retry Loop into build script</source>
      </item>
      <item>
        <title>Consider adding Retry Loop into build script</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Preface:</p>
<p>I’ve done probably a couple dozen --install-to-root builds over the past few weeks.</p>
<p>Some were in Qubes and some were in VirtualBox.</p>
<p>Some were version 8.2, some 8.6.6.0, some 8.6.6.7.</p>
<p>All were through a Tor internet connection.</p>
<p>I seem to be getting inconsistent build errors at various times, even with the same build configuration.</p>
<p>For example, one time a package dependency is not met and throws an error, and the next time it doesn’t, etc.</p>
<p>It seems like a number of these build errors may often be due to temporary conditions, such as tor/internet interruptions or system resource consumption issues.</p>
<p>Where, by simply waiting a little bit, refreshing Tor circuit, etc, a simple retry of an erred build step might actually succeed instead of fail.</p>
<p>Suggestion:</p>
<p>Much of the infrastructure to catch build errors, and pause the script, seems to be in place already. For example, I often press “c + enter” to ignore and continue in my test builds.</p>
<p>I think a “RETRY” option should be added that loops back through and tries the error build step yet again.</p>
<p>For example, along with the other options: “Press r and enter to retry this step.”</p>
<p>Instead of having to either ignore the step after a single attempt or quit the build script entirely, then have to start all over from the beginning.</p>
<p>it seems like a Retry Loop could help correcting and succeeding with some build error conditions on the fly, instead of having to start from the top and hope for the best again.</p>
<p>This retry capability could also help one further sort out real persistent build errors that the project should know about from temporary conditional ones that are individual and fleeting.</p>
<p>Also, it seems that when the build script is using apt-get to download multiple packages, and sometimes fails on one, it doesn’t have error catching infrastructure to handle that.</p>
<p>For example, I recently got:</p>
<blockquote>Err http://security.debian.org/ wheezy/updates/main python-magic i386 5.11-2+deb7u5 [39.1 kB]
Connection failed.</blockquote>
<p>The script did not seem to pause for this failed download, where, depending upon the package, something like this maybe could harm the final build and/or spawn additional errors further in the build script which could not be fixed without going back and getting the downloaded package.</p>
<p>So, at some point, maybe adding an error catching and Retry Loop capability to other parts, like these package downloads could be very helpful to ensuring stable and successful builds.</p>
<p>Thanks!</p>
          <p><a href="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500/1</link>
        <pubDate>Wed, 17 Sep 2014 13:03:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-500-1</guid>
        <source url="http://forums.whonix.org/t/consider-adding-retry-loop-into-build-script/500.rss">Consider adding Retry Loop into build script</source>
      </item>
  </channel>
</rss>
