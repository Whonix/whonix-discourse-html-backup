<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Namecoin Integration in Whonix -- Technical Discussion</title>
    <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499</link>
    <description>This thread is for technical discussion of how Namecoin might be integrated into Whonix.  Conceptual / high level discussion (e.g. &quot;Should Namecoin integration happen in Whonix?&quot;) should go in [Namecoin Integration in Whonix](http://forums.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/t/namecoin-integration-in-whonix/11498) instead (see that thread for background info).  (I&#39;m splitting the discussion into 2 threads at Patrick&#39;s request.)</description>
    <language>en</language>
    <lastBuildDate>Tue, 01 Feb 2022 09:57:35 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>So, it looks like we can make this work with some very trivial onion-grater patches:</p>
</blockquote>
</aside>
<p>If easy for you, then that sounds great!</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>If <code>restrict-stream-events</code> is true, make onion-grater filter <code>ATTACHSTREAM</code>, <code>REDIRECTSTREAM</code>, and <code>CLOSESTREAM</code> if the stream ID supplied by the client isn’t already in <code>self.client_streams</code>. That prevents one Workstation from messing with another Workstation’s streams.</p>
</blockquote>
</aside>
<p>Awesome! That is more than I would have dreamed possible.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>I am inclined not to worry about the DoS vector of attaching streams whose status is not <code>CONTROLLER_WAIT</code>, because if StemNS is malicious/compromised, it can already do a pretty effective DoS of local streams by simply not attaching them at all; therefore I don’t think the extra complexity from mitigating this is worth it.</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>(We could also match against the SOCKS5 username of the <code>StreamEvent</code> in the same way as Patch 2, which would prevent websites from fingerprinting whether Namecoin is enabled; I think this is desirable but it’s not a hard requirement.)</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>I do see one issue: the onion-grater docs indicate that <code>restrict-stream-events</code> only works for “local clients”. Does that imply that it’s only a thing for Tails and does not work on Whonix?</p>
</blockquote>
</aside>
<p>Dunno. Never had a use case for it.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>Patrick, do you happen to know what the rationale of that restriction is?</p>
</blockquote>
</aside>
<p>No.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>Thoughts on this approach?</p>
</blockquote>
</aside>
<p>Generally good. If you could get that submitted, merged in Tails, that would be awesome!</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/15</link>
        <pubDate>Tue, 01 Feb 2022 09:57:35 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-15</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="JeremyRand" data-post="13" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>I do see one issue: the onion-grater docs indicate that <code>restrict-stream-events</code> only works for “local clients”. Does that imply that it’s only a thing for Tails and does not work on Whonix? I looked at the code and I don’t understand why it shouldn’t work for Whonix clients if that explicit check is removed. Patrick, do you happen to know what the rationale of that restriction is?</p>
</blockquote>
</aside>
<p>This looks maybe relevant?  <a href="https://gitlab.tails.boum.org/tails/tails/-/issues/18417" class="inline-onebox" rel="noopener nofollow ugc">restrict-stream-events is not enforced for Tor Browser anymore (#18417) · Issues · tails / tails · GitLab</a></p>
<p>EDIT: Found the answer (I think), it’s in this thread: <a href="https://gitlab.tails.boum.org/tails/tails/-/issues/18123#note_167228" class="inline-onebox" rel="noopener nofollow ugc">onion-grater race condition: move OnionShare to its netns (#18123) · Issues · tails / tails · GitLab</a> .  So it sounds like Tails intends to support remote clients (via IP matching) but they don’t yet.</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/14</link>
        <pubDate>Tue, 01 Feb 2022 08:52:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-14</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <blockquote>
<p>If request has <code>MATCH_TARGET</code>, send a <code>GETINFO</code> request to Tor with <code>stream-status</code> key. It will then check the list of results:</p>
</blockquote>
<p>Unfortunately, <code>GETINFO</code>'s <code>stream-status</code> key doesn’t return the full set of fields that a <code>STREAM</code> event does.  In particular, the <code>SOURCE_ADDR</code> isn’t included.  So that’s not going to work.  This seems like a Tor daemon bug, but since our last patch was rejected due to the feature freeze pending Arti, this bug is not likely to get fixed even if we send in a patch.</p>
<p>However, I just realized there is a simpler way.</p>
<p>onion-grater already maintains a list of stream ID’s for each client (grep for <code>self.client_streams</code>).  So, it looks like we can make this work with some very trivial onion-grater patches:</p>
<ol>
<li>If <code>restrict-stream-events</code> is true, make onion-grater filter <code>ATTACHSTREAM</code>, <code>REDIRECTSTREAM</code>, and <code>CLOSESTREAM</code> if the stream ID supplied by the client isn’t already in <code>self.client_streams</code>.  That prevents one Workstation from messing with another Workstation’s streams.</li>
<li>The <code>target</code> <em>is</em> included in <code>GETINFO</code>'s response, so we could in principle get that data with yanmaani’s approach, but we don’t need to introduce that complexity.  Currently, <code>self.client_streams</code> is a <code>set</code> of stream ID’s, but we could easily change it to a <code>dict</code> whose keys are stream ID’s, and whose values are <code>StreamEvent</code>s.  We could then add an onion-grater config option that specifies a RegEx pattern (or even a list of simple string suffixes), which is matched against the <code>target</code> of the <code>StreamEvent</code> for the stream ID supplied by the client for <code>REDIRECTSTREAM</code>.</li>
<li>I am inclined not to worry about the DoS vector of attaching streams whose status is not <code>CONTROLLER_WAIT</code>, because if StemNS is malicious/compromised, it can already do a pretty effective DoS of local streams by simply not attaching them at all; therefore I don’t think the extra complexity from mitigating this is worth it.</li>
</ol>
<p>(We could also match against the SOCKS5 username of the <code>StreamEvent</code> in the same way as Patch 2, which would prevent websites from fingerprinting whether Namecoin is enabled; I think this is desirable but it’s not a hard requirement.)</p>
<p>Patch 1 seems irrelevant to Namecoin in Tails since there won’t be multiple Namecoin instances using a single Tails Tor daemon, but it’s presumably still important if Tails ever wanted to use onion-grater with some other application that used those commands, so I can’t see any reason why Tails would be hostile to such a patch.</p>
<p>Patch 2 would be directly relevant to Namecoin in Tails too, so getting it merged to Tails seems a very sane approach.</p>
<p>I do see one issue: the onion-grater docs indicate that <code>restrict-stream-events</code> only works for “local clients”.  Does that imply that it’s only a thing for Tails and does not work on Whonix?  I looked at the code and I don’t understand why it shouldn’t work for Whonix clients if that explicit check is removed.  Patrick, do you happen to know what the rationale of that restriction is?</p>
<p>Thoughts on this approach?</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/13</link>
        <pubDate>Mon, 31 Jan 2022 22:52:03 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-13</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This generally (this whole forum thread) seems really complex to me. Maybe I am getting old.</p>
<p>As mentioned earlier, my hope was to keep the complexity away from onion-grater and the gateway.</p>
<p>Would it be possible to implement this using an onion-grater profile? If so, that would be great. That would keep most complexity away from me.</p>
<p>onion-grater was developed by Tails, not Whonix. I wouldn’t want to carry any patches directly to onion-grater (outside onion-grater profiles) in Whonix. That’s because I expect such a a patch would seems pretty difficult to review for me as well as keeping backporting future updates to onion-grater by Tails, potential future merge conflicts.</p>
<p>If onion-grater modifications are required, may I hope that these would be useful in Tails too? In that case, may I request that onion-grater is patched in Tails first? Then Whonix would shortly later run the same version.</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/12</link>
        <pubDate>Mon, 31 Jan 2022 22:09:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-12</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[yanmaani]]></dc:creator>
        <description><![CDATA[
            <p>Alas, the Tor team don’t want to merge our patches to <code>REDIRECTSTREAM</code>, because of the feature freeze.</p>
<p>But I don’t see why we need to patch Tor. Can’t we just have onion-grater do something like this:</p>
<ul>
<li>If request isn’t <code>REDIRECTSTREAM</code>, forward</li>
<li>If request has no <code>MATCH_TARGET</code>, forward</li>
<li>If request has <code>MATCH_TARGET</code>, send a <code>GETINFO</code> request to Tor with <code>stream-status</code> key. It will then check the list of results:</li>
<li>If the Stream ID is not in there, reject the request</li>
<li>If the Stream ID is in there, check that <code>target</code> matches. If so, forward</li>
</ul>
<p>Likewise for similar calls, like <code>ATTACHSTREAM</code>, <code>DETACHSTREAM</code>, etc, and for other options (<code>MATCH_SOURCEPORT</code> etc).</p>
<p>The advantage of this is that it doesn’t have any state; just a callback/synchronous blocking. It is a bit hacky though, but not terrible.</p>
<p>Thoughts?</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/11</link>
        <pubDate>Mon, 31 Jan 2022 19:47:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-11</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <p>Unfortunately no substantive news I can share; we are still waiting for this to reach the front of the Tor Browser Team’s priority queue.  The Tor Network Team informed us a few days ago that the C Tor daemon is nearing a formal feature freeze, and as a result they don’t want to merge our control port patches; they are asking that we wait for Arti instead.  We are evaluating what to do next to push things forward.</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/10</link>
        <pubDate>Sun, 23 Jan 2022 13:04:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-10</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Any news on Tor Browser Namecoin integration?</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/9</link>
        <pubDate>Fri, 21 Jan 2022 16:40:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-9</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="7" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>That sounds good!</p>
<p>Keeping as much away of the gateway + onion-grater modifications sounds good.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="6" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>Tor could add some optional arguments to <code>REDIRECTSTREAM</code> and <code>ATTACHSTREAM</code> that contain the extra status variables, which cause the command to be a NOP if the stream’s status doesn’t match the args; onion-grater could then apply standard regex whitelisting to those args.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="JeremyRand" data-post="6" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>(3) might be the simplest, but would require Tor to merge a patch. Tor has merged control protocol patches related to Namecoin use cases before, so it’s not out of the question that Tor could merge such a patch.</p>
</blockquote>
</aside>
<p>From Whonix (and perhaps Tails) perspective this might be ideal since then complexity is abstracted in Tor, not Whonix.</p>
</blockquote>
</aside>
<p>I’ve <a href="https://gitlab.torproject.org/tpo/core/tor/-/issues/40376" rel="noopener nofollow ugc">filed a Tor issue</a> about adding this feature to the Tor control protocol.  Nick has replied and appears open to it.  So, looks like that is the most suitable path forward.  I will work on implementing that patch; not sure how long it’ll take me.  (I don’t enjoy writing C, so it may not happen super quickly.)</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="7" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<aside class="quote no-group" data-username="JeremyRand" data-post="6" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>Pondering this more… the primary risk of proxy leaks is from Electrum-NMC, since it’s the only component that intentionally opens external network connections. (StemNS only connects to the Tor control port, and ncprop279 only connects to the Electrum-NMC RPC port. StemNS communicates with ncprop279 via stdin/stdout.) However, Electrum-NMC doesn’t need to be in the same VM as StemNS+ncprop279.</p>
</blockquote>
</aside>
<p>I hope this would be considered during packaging.</p>
</blockquote>
</aside>
<p>ncprop279 is the component that would need a config option set to use Electrum-NMC in another VM, and ncprop279 already supports that config option (and supports <code>conf.d</code>), so I think this should be pretty easy.</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/8</link>
        <pubDate>Sat, 08 May 2021 11:29:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-8</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>That sounds good!</p>
<p>Keeping as much away of the gateway + onion-grater modifications sounds good.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="6" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>Tor could add some optional arguments to <code>REDIRECTSTREAM</code> and <code>ATTACHSTREAM</code> that contain the extra status variables, which cause the command to be a NOP if the stream’s status doesn’t match the args; onion-grater could then apply standard regex whitelisting to those args.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="JeremyRand" data-post="6" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>(3) might be the simplest, but would require Tor to merge a patch. Tor has merged control protocol patches related to Namecoin use cases before, so it’s not out of the question that Tor could merge such a patch.</p>
</blockquote>
</aside>
<p>From Whonix (and perhaps Tails) perspective this might be ideal since then complexity is abstracted in Tor, not Whonix.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="6" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>Pondering this more… the primary risk of proxy leaks is from Electrum-NMC, since it’s the only component that intentionally opens external network connections. (StemNS only connects to the Tor control port, and ncprop279 only connects to the Electrum-NMC RPC port. StemNS communicates with ncprop279 via stdin/stdout.) However, Electrum-NMC doesn’t need to be in the same VM as StemNS+ncprop279.</p>
</blockquote>
</aside>
<p>I hope this would be considered during packaging.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="6" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>Wouldn’t this only work for applications that use the system DNS resolver? I.e. any application that uses a SOCKS port won’t have Namecoin resolution. That would be rather unfortunate.</p>
</blockquote>
</aside>
<p>Indeed.</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/7</link>
        <pubDate>Tue, 27 Apr 2021 15:28:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-7</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="5" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Namecoin on gateway -&gt; leak risk. (But not higher than running in Tails.)</p>
</blockquote>
</aside>
<p>Pondering this more… the primary risk of proxy leaks is from Electrum-NMC, since it’s the only component that intentionally opens external network connections.  (StemNS only connects to the Tor control port, and ncprop279 only connects to the Electrum-NMC RPC port.  StemNS communicates with ncprop279 via stdin/stdout.)  However, Electrum-NMC doesn’t need to be in the same VM as StemNS+ncprop279.</p>
<p>So, an approach we could take here is that StemNS and ncprop279 run on the Gateway, and Electrum-NMC runs on the Workstation.  StemNS will detect which IP the <code>STREAM</code> event came from (i.e. the IP of the Workstation), and can instruct ncprop279 to connect to Electrum-NMC on that IP.  This would require me to make some minor patches to StemNS (and maybe ncprop279), but that’s not a problem for me.</p>
<aside class="quote no-group" data-username="Patrick" data-post="5" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Namecoin using <code>ControlPort</code> in workstation -&gt; difficult <code>ControlPort</code> filtering.</p>
</blockquote>
</aside>
<p>Hmm, this point may benefit from some more pondering too.  As far as I can tell, the main threats we need to prevent are:</p>
<ol>
<li>Calling <code>REDIRECTSTREAM</code> on a stream where the <code>Target</code> doesn’t have a <code>.bit</code> suffix.  (Prevents a Namecoin vulnerability from affecting non-Namecoin domains.)</li>
<li>Calling <code>REDIRECTSTREAM</code> from one Workstation on a stream where the <code>SOURCE_ADDR</code> is a different Workstation.  (Prevents a vulnerability in one Workstation from hijacking Namecoin lookups in other Workstations.  Also avoids situations where two StemNS instances try to resolve the same stream.)</li>
<li>Calling <code>ATTACHSTREAM</code> with a nonzero <code>CircuitID</code> or with a non-null <code>HopNum</code>.  (Prevents a vulnerability in Namecoin from messing with how circuits are assigned to streams.)</li>
<li>Calling <code>ATTACHSTREAM</code> on a stream with a <code>StreamStatus</code> not equal to <code>CONTROLLER_WAIT</code>.  (Prevents a vulnerability in Namecoin from DoSing local applications by causing their streams to disconnect.)</li>
</ol>
<p>(3) can be easily prevented by standard onion-grater regex.  The others are all dependent on knowing the stream status, which we could handle in 3 ways:</p>
<ol>
<li>onion-grater could cache all <code>STREAM</code> events, and check their status as part of the filtering of <code>REDIRECTSTREAM</code> and <code>ATTACHSTREAM</code>.  Perhaps by applying a regex whitelist to the <code>STREAM</code> event when choosing whether to filter <code>REDIRECTSTREAM</code> and <code>ATTACHSTREAM</code>.</li>
<li>onion-grater could send <code>GETINFO</code> to Tor when it sees <code>REDIRECTSTREAM</code> and <code>ATTACHSTREAM</code>, in order to fetch the current stream status, and use the result to determine whether to filter the command.  Again, possibly by applying a regex whitelist to the <code>GETINFO</code> result.</li>
<li>Tor could add some optional arguments to <code>REDIRECTSTREAM</code> and <code>ATTACHSTREAM</code> that contain the extra status variables, which cause the command to be a NOP if the stream’s status doesn’t match the args; onion-grater could then apply standard regex whitelisting to those args.</li>
</ol>
<p>(1) seems unpleasant since it makes onion-grater keep track of state.  (2) seems relatively straightforward, but does slightly increase the complexity of onion-grater.  (3) might be the simplest, but would require Tor to merge a patch.  Tor has merged control protocol patches related to Namecoin use cases before, so it’s not out of the question that Tor could merge such a patch.</p>
<aside class="quote no-group" data-username="Patrick" data-post="5" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Why not hook into system the DNS resolver too?</p>
</blockquote>
</aside>
<p>Wouldn’t this only work for applications that use the system DNS resolver?  I.e. any application that uses a SOCKS port won’t have Namecoin resolution.  That would be rather unfortunate.</p>
<aside class="quote no-group" data-username="Patrick" data-post="5" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Disadvantage: not stream isolated. Well, but system default DNS isn’t either.</p>
</blockquote>
</aside>
<p>My take is that losing stream isolation is a pretty bad privacy hit; I’d be a lot happier about the approaches described above.  Running StemNS and ncprop279 in the Gateway while running Electrum-NMC in the workstation seems to me to be the most straightforward approach, though if for some reason you strongly prefer another approach (e.g. one of the control port filtering methods I described), I’m not ruling that out.</p>
<aside class="quote no-group" data-username="Patrick" data-post="5" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If Tor Browser ships its own namecoin, I guess there is no way around the control port filtering anyhow without having limited functionality inside a Tor Browser that runs inside Whonix-Workstation?</p>
</blockquote>
</aside>
<p>In Tor Browser Nightly, the Namecoin support can be toggled with an environment variable.  I suspect that disabling Tor Browser’s Namecoin support in the Workstation via environment variable, while enabling Namecoin on the Gateway’s Tor instance, will mostly work fine; Namecoin resolution should work approximately the same way.  There may be a few rare edge cases that would need to be handled, but I expect they would be manageable (especially because the code  in the Tor Browser integration that might produce such edge cases hasn’t been written yet, and when I write that code, I should be able to do it in a way that will minimize the impact on Whonix).</p>
<p>(Skipped replying to a few paragraphs that I suspect are less applicable given my reply; let me know if you still want me to reply to those.)</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/6</link>
        <pubDate>Mon, 26 Apr 2021 11:20:35 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-6</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>We don’t have a great rough implementation idea yet.</p>
<ul>
<li>Dedicated VM -&gt; overkill.</li>
<li>Namecoin on gateway -&gt; leak risk. (But not higher than running in Tails.)</li>
<li>Namecoin using <code>ControlPort</code> in workstation -&gt; difficult <code>ControlPort</code> filtering.</li>
</ul>
<aside class="quote no-group" data-username="JeremyRand" data-post="4" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>For Whonix (and other Tor use cases), messing with <code>resolv.conf</code> is not needed; resolve operations are hooked via the Tor control port, not the system DNS resolver.</p>
</blockquote>
</aside>
<p>Why not hook into system the DNS resolver too?</p>
<ul>
<li>No dedicated namecoin VM required.</li>
<li>No <code>ControlPort</code> filtering required.</li>
<li>No leak risks.</li>
</ul>
<p>Disadvantage: not stream isolated. Well, but system default DNS isn’t either.</p>
<p>(And before someone quotes me on that and asks (much) later what that is about, see <a href="https://www.whonix.org/wiki/Stream_Isolation">https://www.whonix.org/wiki/Stream_Isolation</a>)</p>
<p>Using that method, even the generic namecoin Debian package would work out of the box inside Whonix.</p>
<p>(With a small limitation I am happy to work on. Whonix might need to change to resolvconf of unbound (?) to support /etc/resolv.conf configuration drop-ins.</p>
<aside class="quote no-group" data-username="JeremyRand" data-post="4" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/j/f475e1/40.png" class="avatar"> JeremyRand:</div>
<blockquote>
<p>For non-Tor usage (e.g. Kicksecure or standard Debian), the typical setup would not involve ncdns modifying <code>resolv.conf</code>; rather, <code>resolv.conf</code> would be modified by a recursive resolver package (e.g. Unbound), and ncdns would place a file in <code>unbound.conf.d</code>. AFAIK this works fine right now; <code>unbound.conf.d</code> globbing is supported by Unbound, and the ncdns docs instruct to do it that way. (Presumably as we get ncdns packaged in Debian, the package will do that automatically.)</p>
</blockquote>
</aside>
<p>Why unbound? I haven’t looked into it. Is that a strong dependency? Or would resolvconf work too in principle? I imagine with resolvconf there could be two snippets.</p>
<p>Non-Tor use case:</p>
<ul>
<li>
<ol>
<li>namecoin (virtual) IP drop-in</li>
</ol>
</li>
<li>
<ol start="2">
<li>real DNS drop-in</li>
</ol>
</li>
</ul>
<p>Whonix use case:</p>
<ul>
<li>
<ol>
<li>namecoin (virtual) IP</li>
</ol>
</li>
<li>
<ol start="2">
<li>Whonix-Gateway IP</li>
</ol>
</li>
</ul>
<p>Once the first (1) resolver (namecoin) noticed “not a <code>.bit</code> domain” it says “no” and the next entry (2) takes over.</p>
<hr>
<p>Above might work well for system DNS with namecoin support inside Whonix?</p>
<p>But if Tor Browser enables namecoin by default inside Whonix that could be an issue? Because Tor Browser expects to talk to talk to a Tor that understands namecoin and stream isolation? If Tor Browser ships its own namecoin, I guess there is no way around the control port filtering anyhow without having limited functionality inside a Tor Browser that runs inside Whonix-Workstation?</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/5</link>
        <pubDate>Mon, 26 Apr 2021 10:02:18 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-5</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <p>Lots of good questions here.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>This is mostly about resolving <code>.bit</code> inside Whonix? Or and/or namecoin wallet?</p>
</blockquote>
</aside>
<p>Resolving <code>.bit</code> inside Whonix is most interesting to me, and is the intended purpose of this thread.  I would not be opposed to having a Namecoin wallet in Whonix, but it’s not why I started the thread.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>To resolve <code>.bit</code> is installation of namecoin<strong>d</strong> required?</p>
</blockquote>
</aside>
<p>Namecoin Core (the daemon version of which is called namecoind) is one option, but not the only option; Electrum-NMC is an option as well.  The Tor Browser developers prefer Electrum-NMC due to its lower bandwidth requirements (as per your next question).</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would namecoin<strong>d</strong> (or anything) need to download a ~ 300 GB blockchain?</p>
</blockquote>
</aside>
<p>If Namecoin Core is used, it would need to download the Namecoin blockchain, which is ~4.6 GiB.  Much smaller than the Bitcoin blockchain, but still significant.  Electrum-NMC only downloads recent block headers (specifically, headers that are after the checkpoint).  A chunk of 2016 headers typically uses ~3.5 MB of download bandwidth (we think this can be optimized down to ~1.4 MB if needed).  We typically include a checkpoint when tagging a release that is circa 2 chunks behind the release date.  So that’s about 7 MB of download bandwidth on the first run.  A new chunk of ~3.5 MB accumulates approximately every 2 weeks, which users will need to download in order to stay synced.  So, the bandwidth usage of Electrum-NMC is pretty low.  My guess is that Whonix would prefer Electrum-NMC over Namecoin Core for this reason (but this is up to you).</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What are the disk space requirements?</p>
</blockquote>
</aside>
<p>Namecoin Core supports pruning.  Most of the storage used by Namecoin Core when pruning is enabled is in the UTXO database (i.e. the <code>chainstate</code> folder).  That folder on my Namecoin Core node is currently 806.1 MiB.</p>
<p>The Electrum-NMC data folder in my regularly-used Tor Browser Nightly instance is 41.5 MiB (most of which is the blockchain headers file).  However, I noticed that if I compress that folder via Dolphin’s default tar.gz settings, it compresses quite well down to 3.0 MiB, which suggests that the 41.5 MiB figure could maybe be significantly reduced if you consider it too high.</p>
<p>(Again, up to you whether you prefer Namecoin Core or Electrum-NMC, only one of them is required.)</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Or can <code>ncdns</code> be used standalone?</p>
</blockquote>
</aside>
<p>ncdns is buildable as either an executable or a library.  The executable is intended for integrating <code>.bit</code> into a standard DNS recursive resolver like Unbound.  In Whonix’s case, that doesn’t make much sense, since DNS resolution in Whonix is usually done by Tor.  ncdns as a library is used by ncprop279, which is a <a href="http://jqs44zhtxl2uo6gk.onion/torspec.git/tree/proposals/279-naming-layer-api.txt" rel="noopener nofollow ugc">Prop279</a> plugin that (when combined with StemNS, which interfaces with the Tor control port) allows <code>.bit</code> resolution with Tor.  I suspect that ncprop279 will make more sense for Whonix than ncdns as an executable.  Either way, they need a Namecoin client (either Namecoin Core or Electrum-NMC) to be present.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>A separate VM for namecoin only seems overkill indeed at this point.</p>
</blockquote>
</aside>
<p>I concur.  Maybe reasonable to support as an optional configuration for users with unusually strong security requirements, in the distant future, but probably not a default recommended configuration, and probably not the first step.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Realistic to get namecoin integrated into Tor instead the browser (Tor Browser)?</p>
<p>How to start simpler…? Using namecoin on Debian? The web search results for that aren’t great.</p>
<p>I am asking because perhaps namecoin integration would be easier if done on Whonix-Gateway.</p>
</blockquote>
</aside>
<p>There’s almost no code in the Tor Browser Nightly integration that depends on Firefox.  Pretty much everything is interfacing with Tor rather than Firefox.  It happened to end up in the Tor Browser packaging (as opposed to the Tor daemon packaging) for UX and practical reasons, but those reasons don’t matter for Whonix.</p>
<p>It should be possible to do this entirely on the Gateway, but I would be concerned about the risk of proxy leaks from Electrum-NMC.  I did some brief testing of Electrum-NMC for proxy leaks and did not find any (and I assume there’s been significant testing of upstream Electrum for proxy leaks since it’s used in Tails and Whonix), but if there were such a proxy leak, having Electrum-NMC running on the Gateway would be a deanonymization hazard, since the network traffic it issues reveals which names are being looked up.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would also be interesting to see how Tails integration would go. (Tails used to have monkeysphere and i2p integration. Wondering if that indicates openness for namecoin integration.)</p>
</blockquote>
</aside>
<p>Interesting, I wasn’t aware that Tails used to support Monkeysphere and I2P.  I intend to reach out to the Tails devs as well about this; I decided to reach out to Whonix first since Whonix is my daily driver and I’ve submitted patches to you before, whereas my familiarity with the Tails ecosystem is pretty minimal.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Ideally this could be implemented as an add-on package. That would be cleaner. This is even unspecific to Whonix. Also for users of Debian it would be much better if they could “sudo apt install namecoin”.</p>
</blockquote>
</aside>
<p>Parts of this could definitely be done as a generic Debian package (and I would definitely be in favor of that), but the parts that integrate with the Tor control port may need special consideration with respect to Whonix given the unique security-by-isolation requirements of Whonix.</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Using <code>ncdns</code> requires modification of system DNS configuration file <code>/etc/resolv.conf</code> as far as I understand. For sake of being an add-on package, for better usability, could you please support something like <code>/etc/resolv.conf.d</code>? I think that requires package <code>resolvconf</code>. Long ago since I looked into that. Avoided for lower complexity. Maybe now would be a time to reconsider that.</p>
<p>By supporting dropping a snippet into <code>/etc/resolv.conf.d</code> things would look much better. In my very strong opinion, Debian (and similar for other Linux distribution) installation experience needs to boil down to a “sudo apt install namecoin” level of simplicity. An "oh but you need to edit <code>/etc/resolv.conf</code>" would be a major usability issue.</p>
<p>Needing to edit a configuration file such as <code>/etc/resolv.conf</code> is bad. Not exactly but <a href="https://www.whonix.org/wiki/Dev/About_Debian_Packaging#Modifying_Default_Configuration_of_Third_Party_Packages" rel="noopener nofollow ugc">Modifying Default Configuration of Third Party Packages</a> is realted. I can make a stronger case for that if needed.</p>
</blockquote>
</aside>
<p>This is definitely relevant to non-Tor usage, e.g. Kicksecure.  For Whonix (and other Tor use cases), messing with <code>resolv.conf</code> is not needed; resolve operations are hooked via the Tor control port, not the system DNS resolver.</p>
<p>For non-Tor usage (e.g. Kicksecure or standard Debian), the typical setup would not involve ncdns modifying <code>resolv.conf</code>; rather, <code>resolv.conf</code> would be modified by a recursive resolver package (e.g. Unbound), and ncdns would place a file in <code>unbound.conf.d</code>.  AFAIK this works fine right now; <code>unbound.conf.d</code> globbing is supported by Unbound, and the ncdns docs instruct to do it that way.  (Presumably as we get ncdns packaged in Debian, the package will do that automatically.)</p>
<aside class="quote no-group" data-username="Patrick" data-post="3" data-topic="11499">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><code>ncdns</code> supports using Tor’s <code>SocksPort</code>? (If <code>ncdns</code> isn’t needed / supposed for this use case then might question might not make sense / not be important.)</p>
</blockquote>
</aside>
<p>ncprop279 (as well as ncdns) doesn’t generate external network traffic; it only passes requests to Electrum-NMC (or Namecoin Core).  Electrum-NMC produces external network traffic per lookup (and when downloading block headers), and supports Tor’s SOCKS port (with stream isolation via SOCKS username/password).  Namecoin Core (if you decided to use it instead of Electrum-NMC) produces external network traffic when downloading the blockchain (and also supports Tor’s SOCKS port, with stream isolation via SOCKS username/password), but does not produce any network traffic on lookup operations (since Namecoin Core is able to cache the name database locally because it has the full blockchain available).</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/4</link>
        <pubDate>Mon, 26 Apr 2021 07:45:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-4</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This is mostly about resolving <code>.bit</code> inside Whonix? Or and/or namecoin wallet?</p>
<p>To resolve <code>.bit</code> is installation of namecoin<strong>d</strong> required? Would namecoin<strong>d</strong> (or anything) need to download a ~ 300 GB blockchain? What are the disk space requirements? Or can <code>ncdns</code> be used standalone?</p>
<p>A separate VM for namecoin only seems overkill indeed at this point.</p>
<p>Realistic to get namecoin integrated into Tor instead the browser (Tor Browser)?</p>
<p>How to start simpler…? Using namecoin on Debian? The web search results for that aren’t great.</p>
<p>I am asking because perhaps namecoin integration would be easier if done on Whonix-Gateway.</p>
<p>Would also be interesting to see how Tails integration would go. (Tails used to have monkeysphere and i2p integration. Wondering if that indicates openness for namecoin integration.)</p>
<p>Ideally this could be implemented as an add-on package. That would be cleaner. This is even unspecific to Whonix. Also for users of Debian it would be much better if they could “sudo apt install namecoin”.</p>
<p>(The request for being an add-on package is unrelated to <a href="//forums.whonix.org/t/namecoin-integration-in-whonix/11498" class="inline-onebox">Namecoin Integration in Whonix</a>, opt-in vs default installation.)</p>
<p>Using <code>ncdns</code> requires modification of system DNS configuration file <code>/etc/resolv.conf</code> as far as I understand. For sake of being an add-on package, for better usability, could you please support something like <code>/etc/resolv.conf.d</code>? I think that requires package <code>resolvconf</code>. Long ago since I looked into that. Avoided for lower complexity. Maybe now would be a time to reconsider that.</p>
<p>By supporting dropping a snippet into <code>/etc/resolv.conf.d</code> things would look much better. In my very strong opinion, Debian (and similar for other Linux distribution) installation experience needs to boil down to a “sudo apt install namecoin” level of simplicity. An "oh but you need to edit <code>/etc/resolv.conf</code>" would be a major usability issue.</p>
<p>Needing to edit a configuration file such as <code>/etc/resolv.conf</code> is bad. Not exactly but <a href="https://www.whonix.org/wiki/Dev/About_Debian_Packaging#Modifying_Default_Configuration_of_Third_Party_Packages">Modifying Default Configuration of Third Party Packages</a> is realted. I can make a stronger case for that if needed.</p>
<p><code>ncdns</code> supports using Tor’s <code>SocksPort</code>? (If <code>ncdns</code> isn’t needed / supposed for this use case then might question might not make sense / not be important.)</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/3</link>
        <pubDate>Mon, 26 Apr 2021 06:34:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-3</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <p>A couple of starting points for discussion:</p>
<p>We’re working on getting the Tor-relevant Namecoin components packaged in Debian, but since Bullseye has (AFAIK) already reached its freeze date, I don’t think it’s possible for us to get Namecoin into Bullseye.  Getting into Bullseye-Backports may be feasible though, depending on how the Debian folks feel about it (I’m not certain what their policies are on getting into Backports).  However, it should be noted that most of the Tor-relevant Namecoin components are available as either an AppImage (e.g. Electrum-NMC) or a statically linked Go binary (e.g. ncprop279).  (I <em>think</em> both the AppImage and the Go binaries build reproducibly, though the build reproducibility is not routinely audited yet [1].)  I’m curious whether it would be feasible to get those components into <code>binaries-freedom</code>, or if it would be strongly preferred to get packaged in Debian itself (which might incur some delay).</p>
<p>Namecoin uses StemNS (our fork of meejah’s TorNS, which adds some security features like stream isolation support) to intercept <code>STREAM</code> events from the Tor control port, and perform resolution on them via the <code>REDIRECTSTREAM</code> command.  This raises some questions about what the best approach is to running this under Whonix.  The <code>REDIRECTSTREAM</code> command is somewhat dangerous if not contained.  I’m not sure of the best way to contain it with onion-grater… perhaps there’s a way for onion-grater to block StemNS from redirecting any streams that don’t initially have a <code>.bit</code> (Namecoin) domain as their destination.  Care would also need to be taken to make sure that multiple Whonix-Workstation VM’s don’t interfere with each other.  StemNS should, I think, be safe to run in its own Workstation VM, and handle all the Namecoin resolution for all other Workstation VM’s that are hooked up to that Gateway, but this may be unreasonable from a resource usage perspective (a lot of users may not want to run an extra Workstation VM just to use Namecoin).  The core security considerations here are (1) we don’t want multiple StemNS instances to try to handle the same <code>STREAM</code> event, and (2) if a StemNS instance is in a compromised Workstation VM, then that could compromise whatever streams in other Workstation VM’s are resolved by that compromised StemNS.</p>
<p>Probably plenty of other technical discussion points to be had, but I’ll start with those.  Thoughts?</p>
<p>[1] I gave a presentation at a recent Tor Demo Day on using Cirrus CI as a reproducible build co-signer for Tor Browser’s RBM build system; this work should result in an improvement with respect to regular auditing of build reproducibility of anything that uses RBM, which includes Namecoin’s Go binaries.</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/2</link>
        <pubDate>Mon, 26 Apr 2021 05:49:43 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-2</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
      <item>
        <title>Namecoin Integration in Whonix -- Technical Discussion</title>
        <dc:creator><![CDATA[JeremyRand]]></dc:creator>
        <description><![CDATA[
            <p>This thread is for technical discussion of how Namecoin might be integrated into Whonix.  Conceptual / high level discussion (e.g. “Should Namecoin integration happen in Whonix?”) should go in <a href="http://forums.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/t/namecoin-integration-in-whonix/11498" rel="noopener nofollow ugc">Namecoin Integration in Whonix</a> instead (see that thread for background info).  (I’m splitting the discussion into 2 threads at Patrick’s request.)</p>
          <p><a href="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499/1</link>
        <pubDate>Sun, 25 Apr 2021 02:42:35 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11499-1</guid>
        <source url="http://forums.whonix.org/t/namecoin-integration-in-whonix-technical-discussion/11499.rss">Namecoin Integration in Whonix -- Technical Discussion</source>
      </item>
  </channel>
</rss>
