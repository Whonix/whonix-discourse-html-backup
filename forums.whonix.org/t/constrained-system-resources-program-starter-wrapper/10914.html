<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>constrained system resources program starter wrapper - Development - Whonix Forum</title>
    <meta name="description" content="systemd provides a powerful tool, systemd-run which can constrain how many system resources an application started by it can use. It can limit (non-exhaustive list) use of CPU, memory and disk. However, this powerful too&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="10914.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;constrained system resources program starter wrapper&#39;" href="10914.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/constrained-system-resources-program-starter-wrapper/10914" />
<meta name="twitter:url" content="https://forums.whonix.org/t/constrained-system-resources-program-starter-wrapper/10914" />
<meta property="og:title" content="constrained system resources program starter wrapper" />
<meta name="twitter:title" content="constrained system resources program starter wrapper" />
<meta property="og:description" content="systemd provides a powerful tool, systemd-run which can constrain how many system resources an application started by it can use. It can limit (non-exhaustive list) use of CPU, memory and disk. However, this powerful too is too complicated to use on the command line. A wrapper is required to make it easily accessible. Use case: running resource intensive tasks (such as backups, compression) without making the system (almost) unusable by the load generated by that task.  limit-low design goals:   ..." />
<meta name="twitter:description" content="systemd provides a powerful tool, systemd-run which can constrain how many system resources an application started by it can use. It can limit (non-exhaustive list) use of CPU, memory and disk. However, this powerful too is too complicated to use on the command line. A wrapper is required to make it easily accessible. Use case: running resource intensive tasks (such as backups, compression) without making the system (almost) unusable by the load generated by that task.  limit-low design goals:   ..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 ‚ù§" />
<meta property="article:published_time" content="2020-12-28T09:32:23+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="10914.html">constrained system resources program starter wrapper</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-28T09:32:23Z' class='post-time'>
                December 28, 2020,  9:32am
              </time>
              <meta itemprop='dateModified' content='2020-12-28T10:49:32Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>systemd provides a powerful tool, <code>systemd-run</code> which can constrain how many system resources an application started by it can use. It can limit (non-exhaustive list) use of CPU, memory and disk. However, this powerful too is too complicated to use on the command line. A wrapper is required to make it easily accessible. Use case: running resource intensive tasks (such as backups, compression) without making the system (almost) unusable by the load generated by that task.</p>
<p><code>limit-low</code> design goals:</p>
<blockquote>
<ul>
<li>Do one thing and do it well.</li>
<li>The one thing is to be a wrapper that limits system resources for wrapped<br>
applications.</li>
<li>Support being run as:
<ul>
<li>user</li>
<li>root</li>
<li>in shell or script in pipes</li>
<li>stdout, stderr, stdin interactive shell input/output</li>
<li>graphical (GUI) applications</li>
</ul>
</li>
<li>Being as non-intrusive as possible. For example, not adding extraneous<br>
output to stdout such as<br>
‚ÄúRunning scope as unit: run-r0d607a8f35dc4dea909b830f9d922b99.scope‚Äù.</li>
</ul>
</blockquote>
<p><code>limit-low</code> is a around <code>systemd-run</code> setting <code>systemd-run</code> parameters to run an<br>
application with limited system resources. <code>systemd-run</code> itself is using Linux <code>cgroups</code>.</p>
<p>systemd upstream feature request:</p>
<aside class="onebox githubissue">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/systemd/systemd/issues/16180" target="_blank" rel="noopener">github.com/systemd/systemd</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/systemd/systemd/issues/16180" target="_blank" rel="noopener">constrained system resources program starter wrapper</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-06-14" data-time="17:50:44" data-timezone="UTC">05:50PM - 14 Jun 20 UTC</span>
      </div>


      <div class="user">
        <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Is your feature request related to a problem? Please describe.
When running non-time critical things such as server backups, compression, log analysis...</p>
</div>

<div class="labels">
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">RFE üéÅ</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">documentation</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">run</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>To start graphical (GUI) applications such as Tor Browser it requires installation of package <code>dbus-user-session</code>. The (non-)security impact of this is being discussed here: <a href="../dbus-user-vs-system-session/10913.html" class="inline-onebox">dbus - user vs system session</a>.</p>
<pre><code>sudo apt update
sudo apt install dbus-user-session
</code></pre>
<p>Depending on the outcome of that discussion, <code>dbus-user-session</code> will be installed by default in Kicksecure and Whonix or perhaps <code>systemd-run</code> can be run with different parameters such as <code>--scope</code> not requiring <code>dbus-user-session</code>. <code>--scope</code> as alternative works but systemd tells:</p>
<blockquote>
<p><code>--pty/--pipe</code> is not compatible in timer or <code>--scope</code> mode</p>
</blockquote>
<p>Which would break <code>limit-low</code> design goals.</p>
<ul>
<li><a href="../../../external.html?link=https://gitlab.com/Whonix/helper-scripts/blob/master/usr/bin/limit-low">https://gitlab.com/Whonix/helper-scripts/blob/master/usr/bin/limit-low</a></li>
<li><a href="../../../external.html?link=https://gitlab.com/Whonix/helper-scripts/blob/master/usr/bin/limit-medium">https://gitlab.com/Whonix/helper-scripts/blob/master/usr/bin/limit-medium</a></li>
</ul>
        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../system-wide-sandboxing-framework-sandbox-app-launcher/9008/305.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../system-wide-sandboxing-framework-sandbox-app-launcher/9008/305.html'>
                      <span itemprop='name'>System-wide sandboxing framework - sandbox-app-launcher</span>
                    </a>
                    <meta itemprop='position' content='5'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../system-wide-sandboxing-framework-sandbox-app-launcher/9008/304.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../system-wide-sandboxing-framework-sandbox-app-launcher/9008/304.html'>
                      <span itemprop='name'>System-wide sandboxing framework - sandbox-app-launcher</span>
                    </a>
                    <meta itemprop='position' content='6'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../why-has-whonix-become-unusable/10907/3.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../why-has-whonix-become-unusable/10907/3.html'>
                      <span itemprop='name'>Why has Whonix become unusable.</span>
                    </a>
                    <meta itemprop='position' content='7'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../whonix-for-virtualbox-15-0-1-7-2-point-release/11349.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../whonix-for-virtualbox-15-0-1-7-2-point-release/11349.html'>
                      <span itemprop='name'>Whonix for VirtualBox - 15.0.1.7.2 - Point Release!</span>
                    </a>
                    <meta itemprop='position' content='8'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../dbus-user-vs-system-session/10913.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../dbus-user-vs-system-session/10913.html'>
                      <span itemprop='name'>dbus - user vs system session</span>
                    </a>
                    <meta itemprop='position' content='9'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../system-wide-sandboxing-framework-sandbox-app-launcher/9008/307.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../system-wide-sandboxing-framework-sandbox-app-launcher/9008/307.html'>
                      <span itemprop='name'>System-wide sandboxing framework - sandbox-app-launcher</span>
                    </a>
                    <meta itemprop='position' content='10'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../vm-fingerprinting-linking-two-or-more-locally-compromised-vms-to-the-same-pseudonym/9310/6.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../vm-fingerprinting-linking-two-or-more-locally-compromised-vms-to-the-same-pseudonym/9310/6.html'>
                      <span itemprop='name'>VM Fingerprinting - linking two or more locally compromised VMs to the same pseudonym</span>
                    </a>
                    <meta itemprop='position' content='11'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-28T12:45:57Z' class='post-time'>
                December 28, 2020, 12:45pm
              </time>
              <meta itemprop='dateModified' content='2020-12-28T12:45:57Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>To test:</p>
<pre><code>sudo apt update
sudo apt install stress
</code></pre>
<p>Does not work as user yet.</p>
<pre><code>limit-low stress --cpu 8 --io 4 --vm 2 --vm-bytes 128M --timeout 10s
</code></pre>
<p>Only works as root.</p>
<pre><code>sudo limit-low stress --cpu 8 --io 4 --vm 2 --vm-bytes 128M --timeout 10s
</code></pre>
<p>Difference can be easily seen for example in <code>ksysguard</code>.</p>
        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-28T14:18:59Z' class='post-time'>
                December 28, 2020,  2:18pm
              </time>
              <meta itemprop='dateModified' content='2020-12-28T14:18:59Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Perhaps it would be better to implement this with plain cgroups, i.e. <code>cgexec</code>? Avoiding <code>systemd-run</code>. Could avoid a lot issues such as dbus, environment variables, and whatnot.</p>
        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-31T14:10:48Z' class='post-time'>
                December 31, 2020,  2:10pm
              </time>
              <meta itemprop='dateModified' content='2020-12-31T14:10:48Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>cgroups are not easy to use for this purpose either. Here is what I got.</p>
<pre><code>set -x
set -e

## TODO
#sudo apt install cgroup-tools

testcommand="stress --cpu 8 --io 4 --vm 2 --vm-bytes 128M --timeout 10s"
#testcommand=hello
testcommand="dd if=/dev/zero of=/tmp/xxx bs=10M count=1"

sudo cgdelete cpu,memory,blkio:limit-low &amp;&gt;/dev/null || true

## TODO: user:user
sudo cgcreate -t user:user -a user:user -g cpu,memory,blkio:limit-low

## cpu.max default is 100000
#sudo cgset -r cpu.max=1 limit-low
#sudo cgset -r cpu.shares=1 limit-low

## https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt
## 20%
sudo cgset -r cpu.cfs_quota_us=10000 limit-low
sudo cgset -r cpu.cfs_period_us=50000 limit-low

sudo cgset -r memory.limit_in_bytes=100m limit-low

## https://andrestc.com/post/cgroups-io/
## To limit I/O to 1MB/s, as done previously, we write into the io.max file:
## $ echo "8:0 wbps=1048576" &gt; io.max
#sudo cgset -r io.max="8:0 wbps=1048576" limit-low

## https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v1/blkio-controller.html
## Specify a bandwidth rate on particular device for root group. The format for policy is ‚Äú&lt;major&gt;:&lt;minor&gt; &lt;bytes_per_second&gt;‚Äù:
## echo "8:16  1048576" &gt; /sys/fs/cgroup/blkio/blkio.throttle.read_bps_device
## Above will put a limit of 1MB/second on reads happening for root group on device having major/minor number 8:16.
##
## https://lqhl.me/blog/2015/09/09/network-disk-bandwidth-limiting-on-linux/
## &lt;major&gt;:&lt;minor&gt;  &lt;bytes_per_second&gt;
## How to find out &lt;major&gt;:&lt;minor&gt;?
## TODO: Qubes ls -la /dev/xvda
# sudo cgset -r blkio.throttle.read_bps_device="202:0  1048576" limit-low
# sudo cgset -r blkio.throttle.write_bps_device="202:0  1048576" limit-low

cgexec -g cpu,memory,blkio:limit-low \
$testcommand

#ionice --class 3 \
#nice -n 19 \

sudo cgdelete cpu,memory,blkio:limit-low</code></pre>
        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-31T15:00:16Z' class='post-time'>
                December 31, 2020,  3:00pm
              </time>
              <meta itemprop='dateModified' content='2020-12-31T15:00:16Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Neither with cgroups one can easily say ‚Äúuse maximum hard limit of xx % of available system resources (CPU, RAM, IO) for this application‚Äù.</p>
<p>Maxmium RAM can be a hard limit such as xxxx MB.</p>
<p>Throttling a device IO (virtual) (harddrive) syntax is <code>&lt;major&gt;:&lt;minor&gt;  &lt;bytes_per_second&gt;</code>. See <a href="../../../external.html?link=https://lqhl.me/blog/2015/09/09/network-disk-bandwidth-limiting-on-linux/">https://lqhl.me/blog/2015/09/09/network-disk-bandwidth-limiting-on-linux/</a>. Also a hardcoded value. Which value to choose? One would have to benchmark the disk first before deciding on a reasonable value. Also finding out <code>&lt;major&gt;:&lt;minor&gt;</code> is non-trivial from a script.</p>
<p>It seems cgroups resource moderation is more useful to say ‚Äúwithin this cgroup this application can use xx % of CPU‚Äù.  This might be useful when implementing this for the whole system.</p>
<p>Maybe just combining <code>ionice</code> with <code>nice</code> would be a good enough hack. I.e.</p>
<pre><code>ionice --class 3 nice -n 19 application-name
</code></pre>
<p>But that wouldn‚Äôt limit maximum RAM the application can use. And once RAM is exhausted, system will probably freeze or get so slow that one would loose patience and reboot.</p>
<p>Would be best if Debian had this implemented for the whole system. For example guaranteeing that X always has sufficient system resources and cannot be starved by a broken application.</p>
        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-31T15:04:06Z' class='post-time'>
                December 31, 2020,  3:04pm
              </time>
              <meta itemprop='dateModified' content='2020-12-31T15:04:06Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox stackexchange">
  <header class="source">
      <a href="../../../external.html?link=https://unix.stackexchange.com/questions/32368/how-to-limit-application-memory-usage" target="_blank" rel="noopener">unix.stackexchange.com</a>
  </header>
  <article class="onebox-body">
      <a href="../../../external.html?link=https://unix.stackexchange.com/users/15807/dragomir-ivanov" target="_blank" rel="noopener">
    <img alt="Dragomir Ivanov" src="../../../external.html?link=https://i.stack.imgur.com/bZ5Ac.jpg?s=128&amp;g=1" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="../../../external.html?link=https://unix.stackexchange.com/questions/32368/how-to-limit-application-memory-usage" target="_blank" rel="noopener">How to limit application memory usage?</a>
</h4>

<div class="tags">
  <strong>linux, memory</strong>
</div>

<div class="date">
  asked by
  
  <a href="../../../external.html?link=https://unix.stackexchange.com/users/15807/dragomir-ivanov" target="_blank" rel="noopener">
    Dragomir Ivanov
  </a>
  on <a href="../../../external.html?link=https://unix.stackexchange.com/questions/32368/how-to-limit-application-memory-usage" target="_blank" rel="noopener">08:40AM - 22 Feb 12 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-01-04T09:49:24Z' class='post-time'>
                January 4, 2021,  9:49am
              </time>
              <meta itemprop='dateModified' content='2021-01-04T09:49:24Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox stackexchange">
  <header class="source">
      <a href="../../../external.html?link=https://unix.stackexchange.com/questions/134414/how-to-limit-the-total-resources-memory-of-a-process-and-its-children/174894#174894" target="_blank" rel="noopener">unix.stackexchange.com</a>
  </header>
  <article class="onebox-body">
      <a href="../../../external.html?link=https://unix.stackexchange.com/users/50793/jankanis" target="_blank" rel="noopener">
    <img alt="JanKanis" src="../../../external.html?link=https://www.gravatar.com/avatar/4bec61fe6165806be5ec752ba87245dd?s=128&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="../../../external.html?link=https://unix.stackexchange.com/questions/134414/how-to-limit-the-total-resources-memory-of-a-process-and-its-children/174894#174894" target="_blank" rel="noopener">How to limit the total resources (memory) of a process and its children</a>
</h4>

<div class="tags">
  <strong>linux, memory, limit, resources</strong>
</div>

<div class="date">
  
  answered by
  <a href="../../../external.html?link=https://unix.stackexchange.com/users/50793/jankanis" target="_blank" rel="noopener">
    JanKanis
  </a>
  on <a href="../../../external.html?link=https://unix.stackexchange.com/questions/134414/how-to-limit-the-total-resources-memory-of-a-process-and-its-children/174894#174894" target="_blank" rel="noopener">04:35PM - 18 Dec 14 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox stackexchange">
  <header class="source">
      <a href="../../../external.html?link=https://unix.stackexchange.com/questions/44985/limit-memory-usage-for-a-single-linux-process/536046#536046" target="_blank" rel="noopener">unix.stackexchange.com</a>
  </header>
  <article class="onebox-body">
      <a href="../../../external.html?link=https://unix.stackexchange.com/users/59928/hi-angel" target="_blank" rel="noopener">
    <img alt="Hi-Angel" src="../../../external.html?link=https://i.stack.imgur.com/4QzSp.jpg?s=128&amp;g=1" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="../../../external.html?link=https://unix.stackexchange.com/questions/44985/limit-memory-usage-for-a-single-linux-process/536046#536046" target="_blank" rel="noopener">Limit memory usage for a single Linux process</a>
</h4>

<div class="tags">
  <strong>linux, memory, ulimit</strong>
</div>

<div class="date">
  
  answered by
  <a href="../../../external.html?link=https://unix.stackexchange.com/users/59928/hi-angel" target="_blank" rel="noopener">
    Hi-Angel
  </a>
  on <a href="../../../external.html?link=https://unix.stackexchange.com/questions/44985/limit-memory-usage-for-a-single-linux-process/536046#536046" target="_blank" rel="noopener">06:02PM - 17 Aug 19 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=http://coldattic.info/favicon-32x32.png" class="site-icon" width="16" height="16">
      <a href="../../../external.html?link=http://coldattic.info/post/40/" target="_blank" rel="noopener" title="09:34PM - 23 August 2010">coldattic.info ‚Äì 23 Aug 10</a>
  </header>
  <article class="onebox-body">
    <img src="#" class="thumbnail" width="60" height="60">

<h3><a href="../../../external.html?link=http://coldattic.info/post/40/" target="_blank" rel="noopener">Limiting time and memory consumption of a program in Linux</a></h3>

<p>For those impatient developers, here's the link to the script that limits time and memory. It's implemented in Perl, weights 14 kilobytes, and has several additional features, such as hangup detection or collecting resource usage statistics. You may...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="10914.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-01-04T09:56:32Z' class='post-time'>
                January 4, 2021,  9:56am
              </time>
              <meta itemprop='dateModified' content='2021-01-04T09:56:32Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubissue">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/pshved/timeout/issues/21" target="_blank" rel="noopener">github.com/pshved/timeout</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/pshved/timeout/issues/21" target="_blank" rel="noopener">port to CGroups</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2021-01-04" data-time="09:56:25" data-timezone="UTC">09:56AM - 04 Jan 21 UTC</span>
      </div>


      <div class="user">
        <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Since you mentioned in readme...
Note: CGroups
Linux now supports the CGroups feature, which is a much better method to track
memory and time...</p>
</div>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='constrained system resources program starter wrapper'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
