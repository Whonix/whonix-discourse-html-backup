<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Proposal: Add tcptimestamp disabling script for running on host</title>
    <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447</link>
    <description>[b]Situation:[/b]
- On a GNU/Linux system running trusted Free Software, no information is leaked without the users consent. There are two caveats which are a result of misguided standards specs and design decisions.

- The 2 known ways a host&#39;s clock was/is leaked to the clearnet are through TLS handshakes made by software running on the host and and TCP connection made by default.

- Recent work was made in this area due to more vigilance by privacy software engineers in the TorProject. At the moment work has been done by TPO member Nick to eliminate ssl timestamp leaks both in upstream crypto libraries OpenSSL and NSS (used in Firefox) and in the IETF standard itself that encouraged this harmful practice. 
If unsure about the availability of this patch in one&#39;s OS, as a workaround its best to simply not to connect to the clearnet from there. There are many compelling reasons not to do so out of a vm as discussed in my blog post.
However there are reasons where its still necessary to do so such as updating the system. This leaves one more leak open.

- This leaves the TCP timestamp which is enabled in the Linux kernel by default for some esoteric performance reasons. TCP timestamps serve to reveal how many unique devices are running behind a router, the uptime of the system and the host&#39;s time down to the millisecond. Downright dangerous and unnecessary information.



The clock skew attack for deanonymization becomes a problem only if the adversary has the host&#39;s clock time to compare to the one in the vm. If we deprive them from the former, that renders this attack useless.

At this point whether NTP is enabled or not on the host is irrelevant as a skew should not be readable. Whether a secure distributed torclock ever becomes a reality is far fetched and not needed if the underlying system is configured safely.


[b]Recommendation:[/b]
Distribute a simple script  that disables TCP timestamps for Linux host&#39;s with the qcow2 images under a : &quot;anonymity enhancements&quot; directory.


[b]References:[/b]

ietf.org/mail-archive/web/tls/current/msg09861.html
&lt;blockquote&gt;PROPOSAL 1:

Declare that implementations MAY replace gmt_unix_time either with
four more random bytes, or four bytes of zeroes.

Rationale:
   * Some implementations (like TorBrowser) are already doing this
     in practice.

   * It&#39;s sensible and simple.  Implementors are quite unlikely to
     mess it up.&lt;/blockquote&gt;
MAY in this context means not mandated as per the IETF draft and providing a zeroed out timestamp instead.

https://www.ietf.org/mail-archive/web/tls/current/msg10857.html
&lt;blockquote&gt;Sorry about my late reply. I am a programmer working on the NSS crypto
libraries. While reviewing recent changes to NSS, I noticed that
Nick&#39;s proposal 1 has been implemented in the OpenSSL and NSS source
code repositories, which led me to this old email thread.&lt;/blockquote&gt;

https://mailman.boum.org/pipermail/tails-dev/2013-December/004522.html
&lt;blockquote&gt;Yes. And due to a Tor issue (TLS itself), the absolute clock on the
system is also leaked in the handshake. Nick has been working on fixing
this - both in the IETF working group on TLS, in patches for OpenSSL and
in other places, I think. When Nick finishes killing the gmt time leak
in TLS, we&#39;ll still have one left in Tails: the TCP timestamp itself... :(&lt;/blockquote&gt;</description>
    <language>en</language>
    <lastBuildDate>Mon, 19 Oct 2015 16:26:29 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“HulaHoop, post:8, topic:447”]<code>
iptables -A INPUT -p icmp --icmp-type timestamp-request -j DROP
iptables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP
</code>[/quote]</p>
<p>That works.</p>
<p>[quote=“HulaHoop, post:8, topic:447”]<code>
ip6tables -A INPUT -p icmp --icmp-type timestamp-request -j DROP
ip6tables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP
</code>[/quote]</p>
<p>That does not work. It requires…</p>
<pre><code class="lang-auto"></code></pre>
<p>And…</p>
<pre><code class="lang-auto"></code></pre>
<p>However, the following still does not work.</p>
<pre><code class="lang-auto">ip6tables -A INPUT -p ipv6-icmp --icmpv6-type timestamp-request -j DROP
ip6tables -A OUTPUT -p ipv6-icmp --icmpv6-type timestamp-reply -j DROP</code></pre>
<p>There are no icmpv6-type timestamp-request / timestamp-reply.<br>
Looks like IPv6 does not support ICMP timestamps.<br>
(<a href="http://networkengineering.stackexchange.com/questions/5253/ipv6-replacement-for-icmp-timestamp">http://networkengineering.stackexchange.com/questions/5253/ipv6-replacement-for-icmp-timestamp</a>)</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/14</link>
        <pubDate>Mon, 19 Oct 2015 16:26:29 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-14</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>We’ll be disabling leaking TCP timestamps by default on Qubes:<br>
</p><aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/QubesOS/qubes-issues/issues/1344" target="_blank">github.com/QubesOS/qubes-issues</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/QubesOS/qubes-issues/issues/1344" target="_blank">disable leaking TCP timestamps by default</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2015-10-17" data-time="19:28:29" data-timezone="UTC">07:28PM - 17 Oct 15 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2015-10-30" data-time="14:18:04" data-timezone="UTC">02:18PM - 30 Oct 15 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Use cases:
Security general: you want to hide the exact state of your local clock from outside observers for cryptographic purposes.
Anonymity. Avoiding...</p>
</div>

<div class="labels">
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">C: core</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">P: minor</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">T: enhancement</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/13</link>
        <pubDate>Mon, 19 Oct 2015 14:08:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-13</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I don’t know if it’s useful to invest time into this. I can’t teach how to code, because explaining all the issues requires equally or more time than doing it myself but I don’t even believe this is a clean, right way to solve it.</p>
<p>As proper implementation for ‘best simplicity’* I am planing to provide an apt repository that users can add and then apt-get install these changes. (* still not that user friendly since it still requires using the command line because linux distros don’t really have a user friendly graphical way to add third party repositories and more.)</p>
<ul>
<li>SUDO=’’" - what?</li>
<li>$SUDO a_command - what?</li>
<li>shellcheck is your friend</li>
<li>quote your variables</li>
<li>use sysctl.d to make uninstallation easier</li>
<li>handle failures (any command, especially apt-get would fail silently resulting in a half installed state)</li>
<li>begs the question on how to uninstall it</li>
</ul>
<p>I guess this will cause more confusion and support requests than doing it right. There is lots of stuff that could be done on the host but I don’t think it’s a good idea to invest a lot into a hacky solution. What I would like better in meanwhile would be adding it here: <a href="https://www.whonix.org/wiki/Pre_Install_Advice#Host_Security">https://www.whonix.org/wiki/Pre_Install_Advice#Host_Security</a></p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/12</link>
        <pubDate>Thu, 28 Aug 2014 18:40:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-12</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>RHEL/CentOS Hosts</p>
<p>[code]#!/bin/bash</p>
<h2>This file is part of Whonix.</h2>
<h2>Copyright © 2012 - 2014 Patrick Schleizer <a href="mailto:adrelanos@riseup.net">adrelanos@riseup.net</a>
</h2>
<h2>See the file COPYING for copying conditions.</h2>
<h2>TCP/ICMP Timestamp disabling script for RHEL/CentOS GNU/Linux Hosts.</h2>
<h2>This script should be run as root.</h2>
<p>set -x</p>
<p>SUDO=’'<br>
if (( $EUID != 0 )); then<br>
SUDO='sudo’<br>
fi<br>
$SUDO a_command</p>
<p>echo “This script will now disable TCP/ICMP Timestamping to prevent clock leaks on RHEL/CentOS Hosts.”</p>
<p>echo 0 &gt; /proc/sys/net/ipv4/tcp_timestamps</p>
<p>echo  net.ipv4.tcp_timestamps = 0 &gt; /etc/sysctl.conf</p>
<p>iptables -A INPUT -p icmp --icmp-type timestamp-request -j DROP<br>
iptables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP</p>
<p>ip6tables -A INPUT -p icmp --icmp-type timestamp-request -j DROP<br>
ip6tables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP</p>
<p>iptables-save &gt; /etc/sysconfig/iptables<br>
ip6tables-save &gt; /etc/sysconfig/ip6tables</p>
<p>service iptables start<br>
chkconfig iptables on<br>
service iptables save</p>
<p>[/code]</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/11</link>
        <pubDate>Thu, 28 Aug 2014 17:50:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-11</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>I added the root check code, please see if it makes sense. making iptables rules permanent differs between distro families. I will dedicate a separate script to support the two main ones in the Linux community.</p>
<p>References:<br>
<a href="http://www.thomas-krenn.com/en/wiki/Saving_Iptables_Firewall_Rules_Permanently" class="onebox" target="_blank">http://www.thomas-krenn.com/en/wiki/Saving_Iptables_Firewall_Rules_Permanently</a></p>
<p>[code]#!/bin/bash</p>
<h2>This file is part of Whonix.</h2>
<h2>Copyright © 2012 - 2014 Patrick Schleizer <a href="mailto:adrelanos@riseup.net">adrelanos@riseup.net</a>
</h2>
<h2>See the file COPYING for copying conditions.</h2>
<h2>TCP/ICMP Timestamp disabling script for Debian/Ubuntu GNU/Linux Hosts.</h2>
<h2>This script should be run as root.</h2>
<p>set -x</p>
<p>SUDO=’'<br>
if (( $EUID != 0 )); then<br>
SUDO='sudo’<br>
fi<br>
$SUDO a_command</p>
<p>echo “This script will now disable TCP/ICMP Timestamping to prevent clock leaks on Debian/Ubuntu Hosts.”</p>
<p>echo 0 &gt; /proc/sys/net/ipv4/tcp_timestamps</p>
<p>echo  net.ipv4.tcp_timestamps = 0 &gt; /etc/sysctl.conf</p>
<p>iptables -A INPUT -p icmp --icmp-type timestamp-request -j DROP<br>
iptables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP</p>
<p>ip6tables -A INPUT -p icmp --icmp-type timestamp-request -j DROP<br>
ip6tables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP</p>
<p>apt-get update<br>
apt-get install iptables-persistent</p>
<p>iptables-save &gt; /etc/iptables/rules.v4<br>
ip6tables-save &gt; /etc/iptables/rules.v6</p>
<p>[/code]</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/10</link>
        <pubDate>Thu, 28 Aug 2014 17:38:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-10</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>It needs a root check and iptables rules need to be made permanent (after reboot) and be set before networking is getting up.</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/9</link>
        <pubDate>Thu, 28 Aug 2014 16:16:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-9</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>Here is what  have in mind. It’s very primitive so please and help me with this as I would like to commit it for distribution with libvirt files. I don’t want to use variables or anything fancy:</p>
<pre><code class="lang-auto">#!/bin/bash

## This file is part of Whonix.
## Copyright (C) 2012 - 2014 Patrick Schleizer &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

## TCP/ICMP Timestamp disabling script for GNU/Linux Hosts.

## This script should be run as root.

set -x

echo "This script will now disable TCP/ICMP Timestamping preventing host clock leaks"

echo 0 &gt; /proc/sys/net/ipv4/tcp_timestamps

echo  net.ipv4.tcp_timestamps = 0 &gt; /etc/sysctl.conf

iptables -A INPUT -p icmp --icmp-type timestamp-request -j DROP
iptables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP

ip6tables -A INPUT -p icmp --icmp-type timestamp-request -j DROP
ip6tables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP

</code></pre>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/8</link>
        <pubDate>Thu, 28 Aug 2014 15:00:12 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-8</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Everything is important. As said in another place there is stuff that may have disastrous effects that is not being worked on either, for example <a href="https://github.com/Whonix/Whonix/issues/125">https://github.com/Whonix/Whonix/issues/125</a>.</p>
<p>I’ll implement it when I get to work on the Whonix Host Additions ticket. I don’t know if I ever will be able to support software I maintain on Debian + derivatives + other distributions at the same time. Not there yet. I think best I can do is create a fine implementation for Debian and then hope/rely on maintainers of other distributions to port the software to their distributions.</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/7</link>
        <pubDate>Thu, 28 Aug 2014 13:33:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-7</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>That’s excellent. Can you please consider releasing this specific nd very important fix, also as a standalone bash script so those of us who don’t use Debian as a host can benefit too?</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/6</link>
        <pubDate>Thu, 28 Aug 2014 13:11:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-6</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>There are two things here. TCP timestamps and ICMP timestamps.</p>
<p>This will be done when Whonix Host Additions will be implemented:<br>
</p><aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/issues/39" target="_blank">github.com/Whonix/Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/Whonix/issues/39" target="_blank">Whonix Host Additions</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2013-07-15" data-time="23:46:15" data-timezone="UTC">11:46PM - 15 Jul 13 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2014-11-24" data-time="00:50:36" data-timezone="UTC">12:50AM - 24 Nov 14 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Important:
Host firewall (progress: in source code, folder whonix_host), see also https://www.whonix.org/forum/index.php/topic,416
tcp timestamps: install tcp-timestamps-disable
icmp timestamps
sdwdate / timesync

Bonus:
AppArmor for VBox / KVM
ksm
https://github.com/dnaeon/ksm-init.d-debian
https://www.whonix.org/wiki/Dev/KVM#Kernel_Samepage_Merging_.28KSM.29
Not...</p>
</div>

<div class="labels">
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">enhancement</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">security</span>
    <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">usability</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>(It will initially probably be a meta package called whonix-host, that can be installed on Debian [perhaps on derivatives as well], that will depend on the tcp-timestamps-disable package, that will come with a firewall (perhaps using parts of corridor to allow only Tor traffic) and block ICMP timestamps. [And maybe that whonix-host package will later turn into a Whonix host operating system.])</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/5</link>
        <pubDate>Thu, 28 Aug 2014 12:41:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-5</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <blockquote>Could be maybe added here:
https://github.com/Whonix/tcp-timestamps-disable/blob/master/etc/sysctl.d/tcp_timestamps.conf
<p>There is no such “file” /proc/sys/net/ipv6/tcp_timestamps and apparently there is a setting net.ipv4.tcp_timestamps=0 but no setting net.ipv6.tcp_timestamps=0. (Also see: <a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</a>)</p>
</blockquote>
<p>Seems that ipv4 tcp settings apply to ipv6 as well:</p>
<blockquote>/proc/sys/net/ipv6/* Variables:
<p>IPv6 has no global variables such as tcp_<em>.  tcp_</em> settings under ipv4/ also<br>
apply to IPv6 [XXX?].</p>
</blockquote>
<blockquote>We don't allow IPv6 traffic using firewall/iptables at the moment anyway and creating a fully featured IPv6 firewall looks like a huge task I am not even thinking about at this stage.</blockquote>
<p>You are right, for Whonix it wouldn’t  make sense for this to be supported yet however Both the incoming and outgoing are relevant for a script that sets the host’s firewall settings to safe values as per my first post’s suggestion.</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/4</link>
        <pubDate>Thu, 28 Aug 2014 03:42:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-4</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <blockquote>Whonix does the very first step and so does TAILS. question is wouldn't it be beneficial to also add the iptables rules too?</blockquote>
Incoming: Better covering that in Whonix 9 (no big issue in Whonix 8 either):
https://github.com/Whonix/whonix-gw-firewall/blob/master/usr/bin/whonix_firewall#L251
<p>Outgoing: I don’t know why it would be useful to block outgoing tcp timestamp requests since only Tor is allowed to connect to outside targets.</p>
<p>See also:<br>
<a href="https://www.mail-archive.com/tails-dev@boum.org/msg06492.html" class="onebox" target="_blank">https://www.mail-archive.com/tails-dev@boum.org/msg06492.html</a></p>
<blockquote>What about ipv6 equivalent rules for future proofing this setup?</blockquote>
We don't allow IPv6 traffic using firewall/iptables at the moment anyway and creating a fully featured IPv6 firewall looks like a huge task I am not even thinking about at this stage.
<blockquote>Its accomplished by using ip6tables and additionally  enforcing [b]echo 0 &gt; /proc/sys/net/ipv6/tcp_timestamps[/b]</blockquote>
Could be maybe added here:
https://github.com/Whonix/tcp-timestamps-disable/blob/master/etc/sysctl.d/tcp_timestamps.conf
<p>There is no such “file” /proc/sys/net/ipv6/tcp_timestamps and apparently there is a setting net.ipv4.tcp_timestamps=0 but no setting net.ipv6.tcp_timestamps=0. (Also see: <a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</a>)</p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/3</link>
        <pubDate>Thu, 28 Aug 2014 03:15:41 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-3</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p><span class="bbcode-b">Discussion:</span></p>
<p>As per <a href="http://www.tmltechnologies.com/html-2012/index.php/linux-rescue-kits/82-secret/91-disable-tcp-timestamps-on-linux">http://www.tmltechnologies.com/html-2012/index.php/linux-rescue-kits/82-secret/91-disable-tcp-timestamps-on-linux</a> its done like so:</p>
<blockquote>Disable TCP timestamps on Linux
<p>It is possible to estimate the current uptime of a Linux machine remotely. It’s preferable to disable TCP timestamps on your systems. The less information attackers can get, the better of you are.<br>
Sysctl</p>
<p>Todynamically disable TCPtime stamping,run the following command:</p>
<p>root@thunderchicken:~# echo 0 &gt; /proc/sys/net/ipv4/tcp_timestamps</p>
<p>To make that change permenant though, you need to add the following line to /etc/sysctl.conf:</p>
<p>net.ipv4.tcp_timestamps = 0</p>
<p>IPTables</p>
<p>To be on the safe side, add the following 2 lines to your firewall script:</p>
<p>iptables -A INPUT -p icmp --icmp-type timestamp-request -j DROP<br>
iptables -A OUTPUT -p icmp --icmp-type timestamp-reply -j DROP</p>
</blockquote>
<p>Whonix does the very first step and so does TAILS. question is wouldn’t it be beneficial to also add the iptables rules too?</p>
<p>What about ipv6 equivalent rules for future proofing this setup?</p>
<p>Its accomplished by using ip6tables and additionally  enforcing <span class="bbcode-b">echo 0 &gt; /proc/sys/net/ipv6/tcp_timestamps</span></p>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/2</link>
        <pubDate>Thu, 28 Aug 2014 02:46:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-2</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
      <item>
        <title>Proposal: Add tcptimestamp disabling script for running on host</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p><span class="bbcode-b">Situation:</span></p>
<ul>
<li>
<p>On a GNU/Linux system running trusted Free Software, no information is leaked without the users consent. There are two caveats which are a result of misguided standards specs and design decisions.</p>
</li>
<li>
<p>The 2 known ways a host’s clock was/is leaked to the clearnet are through TLS handshakes made by software running on the host and and TCP connection made by default.</p>
</li>
<li>
<p>Recent work was made in this area due to more vigilance by privacy software engineers in the TorProject. At the moment work has been done by TPO member Nick to eliminate ssl timestamp leaks both in upstream crypto libraries OpenSSL and NSS (used in Firefox) and in the IETF standard itself that encouraged this harmful practice.<br>
If unsure about the availability of this patch in one’s OS, as a workaround its best to simply not to connect to the clearnet from there. There are many compelling reasons not to do so out of a vm as discussed in my blog post.<br>
However there are reasons where its still necessary to do so such as updating the system. This leaves one more leak open.</p>
</li>
<li>
<p>This leaves the TCP timestamp which is enabled in the Linux kernel by default for some esoteric performance reasons. TCP timestamps serve to reveal how many unique devices are running behind a router, the uptime of the system and the host’s time down to the millisecond. Downright dangerous and unnecessary information.</p>
</li>
</ul>
<p>The clock skew attack for deanonymization becomes a problem only if the adversary has the host’s clock time to compare to the one in the vm. If we deprive them from the former, that renders this attack useless.</p>
<p>At this point whether NTP is enabled or not on the host is irrelevant as a skew should not be readable. Whether a secure distributed torclock ever becomes a reality is far fetched and not needed if the underlying system is configured safely.</p>
<p><span class="bbcode-b">Recommendation:</span><br>
Distribute a simple script  that disables TCP timestamps for Linux host’s with the qcow2 images under a : “anonymity enhancements” directory.</p>
<p><span class="bbcode-b">References:</span></p>
<p><a href="http://ietf.org/mail-archive/web/tls/current/msg09861.html" class="onebox" target="_blank">ietf.org/mail-archive/web/tls/current/msg09861.html</a></p>
<blockquote>PROPOSAL 1:
<p>Declare that implementations MAY replace gmt_unix_time either with<br>
four more random bytes, or four bytes of zeroes.</p>
<p>Rationale:</p>
<ul>
<li>
<p>Some implementations (like TorBrowser) are already doing this<br>
in practice.</p>
</li>
<li>
<p>It’s sensible and simple.  Implementors are quite unlikely to<br>
mess it up.</p>
</li>
</ul>
</blockquote><br>
MAY in this context means not mandated as per the IETF draft and providing a zeroed out timestamp instead.


<p><a href="https://www.ietf.org/mail-archive/web/tls/current/msg10857.html" class="onebox" target="_blank">https://www.ietf.org/mail-archive/web/tls/current/msg10857.html</a></p>
<blockquote>Sorry about my late reply. I am a programmer working on the NSS crypto
libraries. While reviewing recent changes to NSS, I noticed that
Nick's proposal 1 has been implemented in the OpenSSL and NSS source
code repositories, which led me to this old email thread.</blockquote>
<p><a href="https://mailman.boum.org/pipermail/tails-dev/2013-December/004522.html" class="onebox" target="_blank">https://mailman.boum.org/pipermail/tails-dev/2013-December/004522.html</a></p>
<blockquote>Yes. And due to a Tor issue (TLS itself), the absolute clock on the
system is also leaked in the handshake. Nick has been working on fixing
this - both in the IETF working group on TLS, in patches for OpenSSL and
in other places, I think. When Nick finishes killing the gmt time leak
in TLS, we'll still have one left in Tails: the TCP timestamp itself... :(</blockquote>
          <p><a href="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447/1</link>
        <pubDate>Thu, 28 Aug 2014 02:39:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-447-1</guid>
        <source url="http://forums.whonix.org/t/proposal-add-tcptimestamp-disabling-script-for-running-on-host/447.rss">Proposal: Add tcptimestamp disabling script for running on host</source>
      </item>
  </channel>
</rss>
