<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Are 2 templates necessary?</title>
    <link>http://forums.whonix.org/t/are-2-templates-necessary/731</link>
    <description>Hi! Thanks for the work you&#39;re doing toward a good Tor solution on Qubes. I am using Whonix Qubes now and it seems to be working very well for such an early release.

It did occur to me that maybe two whole OS templates for Qubes might not be necessary in the long run. Without having delved into the details of Whonix yet, it seems like you could eventually make one template serve both gateway and app roles based on a simple condition; A hostname with a suffix of &quot;-gw&quot; could trigger a startup script that is geared to running the gateway. Otherwise, the VM would act like an app system.

I realized this when I saw some of the behavior in the two templates is already the same (the sanity check program appears in both VM types, and even tells me I should upgrade Tor browser in the gw ;D ).

Thanks again...</description>
    <language>en</language>
    <lastBuildDate>Mon, 08 Dec 2014 13:15:17 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/are-2-templates-necessary/731.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Are 2 templates necessary?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Common, shared code is great. Trying to use it everywhere possible.</p>
<p>However, Whonix wasn’t implemented with the good idea of “a single switch can change the behavior from workstation to gateway and vice versa” in mind. When Whonix development started, no one had Qubes’s architecture in mind. I see for Qubes it would be useful. For other platforms such as VirtualBox, having for example XChat installed in the gateway and Tor in the workstation wouldn’t be useful. Whonix was developed in mind to cleanly package a fine, shared configuration for a workstation or gateway machine. Some (configuration) packages are gateway specific (<a href="https://github.com/Whonix?query=-gw-">https://github.com/Whonix?query=-gw-</a>), others are workstation specific (<a href="https://github.com/Whonix?query=-ws-">https://github.com/Whonix?query=-ws-</a>). Dynamically choosing the gw or ws specific /etc/network/interfaces might be possible somehow. Maybe using custom scripts (preserving user modifications) (fragile) or (auto chosen) boot options that mount different /etc or something like that.</p>
<p>At the moment there are two packages which install a so called marker file, that allows other packages such as whonixcheck detect whether they are running in a workstation or gateway:</p>
<ul>
<li><a href="https://github.com/Whonix/anon-gw-base-files">https://github.com/Whonix/anon-gw-base-files</a></li>
<li><a href="https://github.com/Whonix/anon-ws-base-files">https://github.com/Whonix/anon-ws-base-files</a></li>
</ul>
<p>But that could also be implemented as VirtualBox setextradata setting (which can be used to create some unique hardware string somewhere, that can be used to distinguish if running in gateway or workstation mode). Similar mechanisms might exist for KVM and Qubes.</p>
<p>Yes, it might be possible. But I think it would be a lot work to implement such a Whonix-Morphstation.</p>
          <p><a href="http://forums.whonix.org/t/are-2-templates-necessary/731/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/are-2-templates-necessary/731/4</link>
        <pubDate>Mon, 08 Dec 2014 13:15:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-731-4</guid>
        <source url="http://forums.whonix.org/t/are-2-templates-necessary/731.rss">Are 2 templates necessary?</source>
      </item>
      <item>
        <title>Are 2 templates necessary?</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="2" data-topic="731">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/w/c5a1d2/40.png" class="avatar"> WhonixQubes:</div>
<blockquote>
<p>And Whonix would have to have some hook for knowing if was being used as a ProxyVM (Whonix-Gateway) or as an AppVM (Whonix-Workstation), and dynamically change its functionality like the Qubes Fedora template does.</p>
</blockquote>
</aside>
<p>In Qubes, I can already distinguish if VM is running as a template, gateway (ProxyVM) or workstation (AppVM).  I already use common init scripts between all states which complete certain tasks based on what type of VM it is.</p>
<blockquote>I'm not sure about the "hostname" variable switch for Gateway vs. Workstation. Probably unnecessary and hostname is already anonymized to generic value of "host" for fingerprinting. Ideally the VM would auto detect the correct VM type, like in Qubes, and auto configure itself.</blockquote>
<p>I handle this on init as well since Qubes by default sets the hostname.</p>
<p>Guess Patrick just needs to decide of its a good idea or not.</p>
          <p><a href="http://forums.whonix.org/t/are-2-templates-necessary/731/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/are-2-templates-necessary/731/3</link>
        <pubDate>Mon, 08 Dec 2014 07:59:28 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-731-3</guid>
        <source url="http://forums.whonix.org/t/are-2-templates-necessary/731.rss">Are 2 templates necessary?</source>
      </item>
      <item>
        <title>Are 2 templates necessary?</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Hi cprise! Nice to see you! <img src="//forums.whonix.org/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>From a Qubes perspective, you might be right about this.</p>
<p>Sidebar: Let me make a distinction about your point for others here… You’re not talking about doing away with the TwoVM operational configuration of having a Whonix-Gateway and Whonix-Workstation running together, for the purpose of isolating the Tor proxy from the user space. Rather, you are talking about sliming down the distribution of template files to one single VM template that can be used to create both the Whonix-Gateway and Whonix-Workstation VMs. Like how the single Fedora template in Qubes can generate both ProxyVMs and AppVMs from the same single template.</p>
<p>First, due to the TwoVM Tor isolation concept, I don’t know if there would be any fatal security flaws to including all of the same Gateway &amp; Workstation packages into each template, where malware could reconfigure the VM with all of those packages? There is already Tor-over-Tor protection in the Workstation provided by a Whonix package. And malware could install whatever packages it wants. So maybe both VMs could sanely include all the same packages due to fundamental VM isolation and forced ProxyVM routing.</p>
<p>The use of Whonix in Qubes in still only a few months old, since my original port. And Whonix is still primarily developed with VirtualBox as the primary virtualization platform in mind. Maybe this will change in the future, especially as the Qubes R3 Odyssey framework becomes public and stable, so that Qubes can be run on top of other existing platforms, like Windows, KVM, etc.</p>
<p>Right now, the 2 Whonix templates (Gateway &amp; Workstation) are both <em>built</em> from one single code repository. And the --tor-gateway and --tor-workstation parameters are used to differentiate the type of template that gets built.</p>
<p>The Whonix code would likely have to be refactored to merge the two templates into one.</p>
<p>And Whonix would have to have some hook for knowing if was being used as a ProxyVM (Whonix-Gateway) or as an AppVM (Whonix-Workstation), and dynamically change its functionality like the Qubes Fedora template does.</p>
<p>To me, this makes sense overall. But, making it a reality might depend upon how Whonix’s relationship with Qubes grows in comparison with its other virtualization platforms, and the priority/effort involved to refactor for this single template optimization.</p>
<p>I’m not sure about the “hostname” variable switch for Gateway vs. Workstation. Probably unnecessary and hostname is already anonymized to generic value of “host” for fingerprinting. Ideally the VM would auto detect the correct VM type, like in Qubes, and auto configure itself.</p>
<p>If needing to manually set a variable in Whonix when using other virtualization platforms, like VirtualBox, then messing with the “hostname” variable shouldn’t be necessary. Rather, in something like the existing “whonixsetup” script or “first run initialization” script, the user could be forced to choose Whonix-Gateway or Whonix-Workstaiton and the system could store that variable anywhere convenient in the filesystem. That could be the manual way for platforms where it couldn’t be auto detected like is possible in Qubes.</p>
<p>So like this…</p>
<p>One Whonix Template:</p>
<ul>
<li>
<p>In Qubes: Auto-Configure based on ProxyVM or AppVM setting.</p>
</li>
<li>
<p>In VirtualBox: Manually configure upon first setup, choose Gateway or Workstation.</p>
</li>
</ul>
<p>Or, here is an alternative idea, if that would be asking too much for VirtualBox users…</p>
<p>Build and offer 1 Whonix template file for Qubes users.</p>
<p>Build and offer 2 Whonix template files for VirtualBox users.</p>
<p>But they can come from the same integrated build script that has the ability to build a merged or separated VM template type.</p>
<p>Just using simple examples here to demonstrate principle as I know there are additional platforms.</p>
<p>Overall, I like the idea of having, at least the option of, one integrated Whonix template (assuming there are not fatal insecure design issues).</p>
<p>The refactoring work, other feature priorities, and platform market conditions for Whonix, might be limiting factors for seeing this happen though. Not sure. That would be more in Patrick’s domain right now.</p>
<p>But, in the “long run”, as you mention, the concept of optimizing to having the option of using one integrated Whonix template makes sense to me, especially in Qubes.</p>
<p>And Qubes R3 Odyssey framework expands the Qubes system’s reach out to working within other platforms, like Windows, KVM, etc, where an OS reinstall or multi-booting is no longer necessary to use Qubes + Whonix.</p>
          <p><a href="http://forums.whonix.org/t/are-2-templates-necessary/731/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/are-2-templates-necessary/731/2</link>
        <pubDate>Sat, 06 Dec 2014 09:24:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-731-2</guid>
        <source url="http://forums.whonix.org/t/are-2-templates-necessary/731.rss">Are 2 templates necessary?</source>
      </item>
      <item>
        <title>Are 2 templates necessary?</title>
        <dc:creator><![CDATA[cprise]]></dc:creator>
        <description><![CDATA[
            <p>Hi! Thanks for the work you’re doing toward a good Tor solution on Qubes. I am using Whonix Qubes now and it seems to be working very well for such an early release.</p>
<p>It did occur to me that maybe two whole OS templates for Qubes might not be necessary in the long run. Without having delved into the details of Whonix yet, it seems like you could eventually make one template serve both gateway and app roles based on a simple condition; A hostname with a suffix of “-gw” could trigger a startup script that is geared to running the gateway. Otherwise, the VM would act like an app system.</p>
<p>I realized this when I saw some of the behavior in the two templates is already the same (the sanity check program appears in both VM types, and even tells me I should upgrade Tor browser in the gw ;D ).</p>
<p>Thanks again…</p>
          <p><a href="http://forums.whonix.org/t/are-2-templates-necessary/731/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/are-2-templates-necessary/731/1</link>
        <pubDate>Fri, 05 Dec 2014 22:07:36 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-731-1</guid>
        <source url="http://forums.whonix.org/t/are-2-templates-necessary/731.rss">Are 2 templates necessary?</source>
      </item>
  </channel>
</rss>
