<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>VMs do no start until the CPU configuration is set to “Copy host CPU configuration” - #5 by Patrick - KVM - Whonix Forum</title>
    <meta name="description" content="@onion_knight in https://forums.whonix.org/t/whonix-desktop-installer-with-calamares-field-report/7350/109">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../7917.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;VMs do no start until the CPU configuration is set to “Copy host CPU configuration”&#39;" href="../7917.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/vms-do-no-start-until-the-cpu-configuration-is-set-to-copy-host-cpu-configuration/7917/5" />
<meta name="twitter:url" content="https://forums.whonix.org/t/vms-do-no-start-until-the-cpu-configuration-is-set-to-copy-host-cpu-configuration/7917/5" />
<meta property="og:title" content="VMs do no start until the CPU configuration is set to “Copy host CPU configuration”" />
<meta name="twitter:title" content="VMs do no start until the CPU configuration is set to “Copy host CPU configuration”" />
<meta property="og:description" content="When Whonix Host starts in a VM… To make developer builds more easy…  I could write a systemd unit file that does “something” only when detecting virtualization. Even only if some forms of virtualization are detected. Perhaps (not) do something when detected running inside VirtualBox / Xen (Qubes) but (not) do something when running inside KVM.  “something” could be such as switching from KVM to QEMU.  At that stage the VMs are already imported so probably another command is needed to change fro..." />
<meta name="twitter:description" content="When Whonix Host starts in a VM… To make developer builds more easy…  I could write a systemd unit file that does “something” only when detecting virtualization. Even only if some forms of virtualization are detected. Perhaps (not) do something when detected running inside VirtualBox / Xen (Qubes) but (not) do something when running inside KVM.  “something” could be such as switching from KVM to QEMU.  At that stage the VMs are already imported so probably another command is needed to change fro..." />
<meta property="article:published_time" content="2019-08-20T07:47:57+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7917.html">VMs do no start until the CPU configuration is set to “Copy host CPU configuration”</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/kvm/11.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #9EB83B'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>KVM</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-19T13:50:17Z' class='post-time'>
                August 19, 2019,  1:50pm
              </time>
              <meta itemprop='dateModified' content='2019-08-19T13:50:17Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/onion_knight">@onion_knight</a> in <a href="../../whonix-desktop-installer-with-calamares-field-report/7350/109.html" class="inline-onebox">Whonix Desktop Installer with Calamares - field report</a></p>
<aside class="quote no-group" data-post="109" data-topic="7350">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"><a href="../../whonix-desktop-installer-with-calamares-field-report/7350/109.html">Whonix Desktop Installer with Calamares - field report</a>
</div>
<blockquote>
<ul>
<li>By default, the VMs do no start until the CPU configuration is set to “Copy host CPU configuration”, which is expected in KVM, but also happened when testing on real hardware (both using the ISO and the installed version). Might be related to my specific hardware though.</li>
</ul>
</blockquote>
</aside>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../whonix-desktop-installer-with-calamares-field-report/7350/111.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../whonix-desktop-installer-with-calamares-field-report/7350/111.html'>
                      <span itemprop='name'>Whonix Desktop Installer with Calamares - field report</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-19T13:50:55Z' class='post-time'>
                August 19, 2019,  1:50pm
              </time>
              <meta itemprop='dateModified' content='2019-08-19T13:50:55Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Did this also happen for you if you used KVM “normally” “as a normal user” as per the usual instructions on <a href="../../../../external.html?link=https://www.whonix.org/wiki/KVM" rel="nofollow noopener">https://www.whonix.org/wiki/KVM</a> on Debian buster hosts?</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-19T18:35:26Z' class='post-time'>
                August 19, 2019,  6:35pm
              </time>
              <meta itemprop='dateModified' content='2019-08-19T18:35:26Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>No, this only happens using the Whonix-Host system.</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-19T22:58:51Z' class='post-time'>
                August 19, 2019, 10:58pm
              </time>
              <meta itemprop='dateModified' content='2019-08-20T11:45:18Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>OK, I think I found what is the problem <img src="../../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>First, at least one of the kernel hardening boot parameters somehow messes  with the CPU detection on the host (in my case, a quadcore showing only two physical cores, the virtual cores being ignored), which heavily decreases performances. I need to further investigate this issue to find out which specific boot parameter(s) causes that.</p>
<p>But the main problem is that currently the VMs domain types in the host are set as qemu and not kvm. Indeed, this is done on purpose during building as a workaround to configure the VMs:</p>
<pre><code>## workaround to replace the 'kvm' domain type with 'qemu' otherwise libvirtd service will fail to start in chroot
sed -i "1 s/^.*$/&lt;domain type='qemu'&gt;/" "$temp_dir/xml/Whonix-Gateway.xml"
sed -i "1 s/^.*$/&lt;domain type='qemu'&gt;/" "$temp_dir/xml/Whonix-Workstation.xml"
</code></pre>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/blob/2d6ed37237af6ae3553eeee307872d0c24615b9f/usr/lib/whonix-libvirt/install" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/blob/2d6ed37237af6ae3553eeee307872d0c24615b9f/usr/lib/whonix-libvirt/install" target="_blank" rel="nofollow noopener">Whonix/whonix-libvirt/blob/2d6ed37237af6ae3553eeee307872d0c24615b9f/usr/lib/whonix-libvirt/install</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2019 - 2019 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

set -x
set -e

## {{ Taken from qemu-system-common.postinst.
# Add the kvm group unless it's already there
if ! getent group kvm &gt;/dev/null; then
   addgroup --quiet --system kvm || true
fi
## }} Taken from qemu-system-common.postinst.

## {{ Taken from libvirt-bin.postinst.
if ! getent group libvirt &gt;/dev/null; then
   addgroup --system libvirt
fi
## }} Taken from libvirt-bin.postinst.
</code></pre>

  This file has been truncated. <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/blob/2d6ed37237af6ae3553eeee307872d0c24615b9f/usr/lib/whonix-libvirt/install" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>The problem is that this temporary change must be reverted back once the VMs have been configured, which was initially taken care of, but these lines were (probably mistakenly) removed from the same file:</p>
<pre><code>## now we can replace back 'qemu' with 'kvm' domain type
sed -i "8 s/^.*$/&lt;domain type='kvm'&gt;/" $CHROOT_DIRECTORY/etc/libvirt/qemu/Whonix-Gateway.xml
sed -i "8 s/^.*$/&lt;domain type='kvm'&gt;/" $CHROOT_DIRECTORY/etc/libvirt/qemu/Whonix-Workstation.xml
</code></pre>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/commit/3c15dda26942f72c4173706fe019064fff729147#diff-743295d57fb671f4ac59a2e65834769a" target="_blank" rel="nofollow noopener">github.com/Whonix/whonix-libvirt</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/commit/3c15dda26942f72c4173706fe019064fff729147" target="_blank" rel="nofollow noopener">undo no longer required since done in temp dir</a>
</h4>


<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/commit/3c15dda26942f72c4173706fe019064fff729147" target="_blank" rel="nofollow noopener">08:52AM - 12 May 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>1 files</strong>
  with <strong>0 additions</strong>
  and <strong>4 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>See my <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/pull/92" rel="nofollow noopener">pull request</a> <img src="../../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> (I hope I changed the right file! but you get the idea…)</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../error-starting-domain-unsupported-configuration-host-doesnt-support-paravirtual-spinlocks/7916/4.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../error-starting-domain-unsupported-configuration-host-doesnt-support-paravirtual-spinlocks/7916/4.html'>
                      <span itemprop='name'>Error starting domain: unsupported configuration: host doesn&#39;t support paravirtual spinlocks</span>
                    </a>
                    <meta itemprop='position' content='6'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../kernel-hardening/7296/153.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../kernel-hardening/7296/153.html'>
                      <span itemprop='name'>Kernel Hardening</span>
                    </a>
                    <meta itemprop='position' content='7'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-20T07:47:57Z' class='post-time'>
                August 20, 2019,  7:47am
              </time>
              <meta itemprop='dateModified' content='2019-08-20T07:47:57Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>When Whonix Host starts in a VM… To make developer builds more easy…<br>
I could write a systemd unit file that does “something” only when detecting virtualization. Even only if some forms of virtualization are detected. Perhaps (not) do something when detected running inside VirtualBox / Xen (Qubes) but (not) do something when running inside KVM.<br>
“something” could be such as switching from KVM to QEMU.<br>
At that stage the VMs are already imported so probably another command is needed to change from KVM to QEMU?<br>
I just need to know the conditions (which virtualization or any virtualization) and which command to run.</p>
<p>Or better… Does <code>Nested KVM Virtualization</code> work for you? I see it documented here:<br>
<a href="../../../../external.html?link=https://www.whonix.org/wiki/KVM#Nested_KVM_Virtualization" rel="nofollow noopener">https://www.whonix.org/wiki/KVM#Nested_KVM_Virtualization</a></p>
<p>Can you enable <code>Nested KVM Virtualization</code> on the physical host as well as inside Whonix Host (running in VM)?</p>
<p>It it sane to enable <code>Nested KVM Virtualization</code> on Whonix Host by default?</p>
<p>Otherwise we get minimal QEMU support for developer testing purposes? <a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../../external.html?link=https://www.whonix.org/wiki/QEMU" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:111/35;"><img src="../../../../external.html?link=https://www.whonix.org/w/images/e/ee/Qemulogo.svg.png" class="thumbnail"></div>

<h3><a href="../../../../external.html?link=https://www.whonix.org/wiki/QEMU" target="_blank" rel="nofollow noopener">QEMU</a></h3>

<p>Using Whonix ™ with QEMU instead of VirtualBox</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>That is only if we cannot get <code>Nested KVM Virtualization</code> functional?</p>
<aside class="quote no-group" data-post="4" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>First, at least one of the kernel hardening boot parameters somehow messes with the CPU detection on the host (in my case, a quadcore showing only two physical cores, the virtual cores being ignored), which heavily decreases performances. I need to further investigate this issue to find out which specific boot parameter(s) causes that.</p>
</blockquote>
</aside>
<p>Copied here: <a href="../../kernel-hardening/7296/15.html" class="inline-onebox">Kernel Hardening</a></p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-20T08:03:12Z' class='post-time'>
                August 20, 2019,  8:03am
              </time>
              <meta itemprop='dateModified' content='2019-08-20T08:18:58Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>EDIT: forget what I just wrote and erased, I missed the part where you said you were talking about “When Whonix Host starts in a VM”.<br>
Will try nested KVM virtualization and report back.</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-20T09:44:45Z' class='post-time'>
                August 20, 2019,  9:44am
              </time>
              <meta itemprop='dateModified' content='2019-08-20T09:44:45Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <ol>
<li>I confirm that running (manually in my case)</li>
</ol>
<pre><code class="lang-auto">sed -i "8 s/^.*$/&lt;domain type='kvm'&gt;/" $CHROOT_DIRECTORY/etc/libvirt/qemu/Whonix-Gateway.xml
sed -i "8 s/^.*$/&lt;domain type='kvm'&gt;/" $CHROOT_DIRECTORY/etc/libvirt/qemu/Whonix-Workstation.xml
</code></pre>
<p><strong>solves the initial problem, as expected.</strong></p>
<ol start="2">
<li>I confirm that once enabled on host, <strong>nested KVM virtualization works, both with ISO and on install target!</strong>
</li>
</ol>
<p>Actually, I am currently writing this post from a Whonix-Host install running in KVM in live-mode, with both Whonix-VM in live-mode too! Isn’t that amazing? <img src="../../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> It’s not even that slow! Perfectly fine for testing!</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">

            <link itemprop="image" href="../../../uploads/default/original/2X/4/474cb6602431bdce233388b7a9781a7ca22d46a9.png">

          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-20T09:47:42Z' class='post-time'>
                August 20, 2019,  9:47am
              </time>
              <meta itemprop='dateModified' content='2019-08-20T09:47:42Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>See screenshot below:</p>
<p>Host running Whonix-Host install (booted in live mode) on KVM with virt-manager -&gt; Whonix-Host running Whonix-Gateway and Whonix-Workstation VMs in live-mode (nested KVM virtualization)</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../uploads/default/original/2X/4/474cb6602431bdce233388b7a9781a7ca22d46a9.png" data-download-href="//forums.whonix.org/uploads/default/474cb6602431bdce233388b7a9781a7ca22d46a9" title="Screenshot_2019-08-20_11-44-41.png"><img src="../../../uploads/default/optimized/2X/4/474cb6602431bdce233388b7a9781a7ca22d46a9_2_690x379.png" alt="Screenshot_2019-08-20_11-44-41" data-base62-sha1="aaKfRWWvrWfuQGLXieN0PCLXH7P" width="690" height="379" srcset="//forums.whonix.org/uploads/default/optimized/2X/4/474cb6602431bdce233388b7a9781a7ca22d46a9_2_690x379.png, //forums.whonix.org/uploads/default/optimized/2X/4/474cb6602431bdce233388b7a9781a7ca22d46a9_2_1035x568.png 1.5x, //forums.whonix.org/uploads/default/optimized/2X/4/474cb6602431bdce233388b7a9781a7ca22d46a9_2_1380x758.png 2x" data-small-upload="../../../uploads/default/optimized/2X/4/474cb6602431bdce233388b7a9781a7ca22d46a9_2_10x10.png"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">Screenshot_2019-08-20_11-44-41.png</span><span class="informations">1923×1058 177 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-20T14:26:57Z' class='post-time'>
                August 20, 2019,  2:26pm
              </time>
              <meta itemprop='dateModified' content='2019-08-20T14:26:57Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="5" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It it sane to enable <code>Nested KVM Virtualization</code> on Whonix Host by default?</p>
<p>Otherwise we get minimal QEMU support for developer testing purposes? <a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
</blockquote>
</aside>
<p>Emulation should always be a last resort because performance.</p>
<p><a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/onion_knight">@onion_knight</a> Are there changes I need to do to the libvirt files to make things easier?</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-20T14:29:55Z' class='post-time'>
                August 20, 2019,  2:29pm
              </time>
              <meta itemprop='dateModified' content='2019-08-20T14:29:55Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a> not that I know of.</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-21T06:13:53Z' class='post-time'>
                August 21, 2019,  6:13am
              </time>
              <meta itemprop='dateModified' content='2019-08-21T06:13:53Z'>
          <span itemprop='position'>#11</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>What (simply) <code>virsh define</code></p>
<pre><code>virsh -c qemu:///system define /usr/share/whonix-libvirt/xml/Whonix-Gateway.xml
</code></pre>
<p>is does is simply copy <code>/usr/share/whonix-libvirt/xml/Whonix-Gateway.xml</code> to <code>/etc/libvirt/qemu/Whonix-Gateway.xml</code>?</p>
<p>(The file name in name <code>Whonix-Gateway.xml</code> folder <code>/etc/libvirt/qemu/</code> is not extracted from the path <code>/usr/share/whonix-libvirt/xml/Whonix-Gateway.xml</code> but from <code>&lt;name&gt;Whonix-Gateway&lt;/name&gt;</code>.</p>
<p>I.e. if you replace <code>&lt;name&gt;Whonix-Gateway&lt;/name&gt;</code> with <code>&lt;name&gt;Whonix-Gateway&lt;/name&gt;</code> then <code>/etc/libvirt/qemu/Whonix-Gateway-test.xml</code> is created.</p>
<p>Does (simply) <code>virsh define</code> do something else too on top of that?</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-21T06:15:16Z' class='post-time'>
                August 21, 2019,  6:15am
              </time>
              <meta itemprop='dateModified' content='2019-08-21T06:15:16Z'>
          <span itemprop='position'>#12</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I am asking because rather than (simply) <code>virsh define</code> we could avoid using (simply) <code>virsh define</code> and copy over the file manually instead. That would spare us all the creation of a temporary file and all the sed calls.</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-21T06:18:52Z' class='post-time'>
                August 21, 2019,  6:18am
              </time>
              <meta itemprop='dateModified' content='2019-08-21T06:18:52Z'>
          <span itemprop='position'>#13</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Are both QEMU and KVM xml files inside the same folder <code>/etc/libvirt/qemu</code>?</p>
<p>Do you have folder <code>/etc/libvirt/kvm</code> anywhere on any “<a href="../../../../external.html?link=https://www.whonix.org/wiki/KVM" rel="nofollow noopener">usual</a>” (KVM VM version as of now) on any of your hosts?</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-21T06:35:13Z' class='post-time'>
                August 21, 2019,  6:35am
              </time>
              <meta itemprop='dateModified' content='2019-08-21T06:35:13Z'>
          <span itemprop='position'>#14</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/commit/62a212bbfd52d0f5f82a55aa57d886ebfc76b166" target="_blank" rel="nofollow noopener">github.com/Whonix/whonix-libvirt</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/commit/62a212bbfd52d0f5f82a55aa57d886ebfc76b166" target="_blank" rel="nofollow noopener">fix string replacement</a>
</h4>


<div class="date">
  by <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/commit/62a212bbfd52d0f5f82a55aa57d886ebfc76b166" target="_blank" rel="nofollow noopener">06:30AM - 21 Aug 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>2 files</strong>
  with <strong>9 additions</strong>
  and <strong>5 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-21T06:39:30Z' class='post-time'>
                August 21, 2019,  6:39am
              </time>
              <meta itemprop='dateModified' content='2019-08-21T06:39:30Z'>
          <span itemprop='position'>#15</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="11" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does (simply) <code>virsh define</code> do something else too on top of that?</p>
</blockquote>
</aside>
<p>It does or maybe “it might”. Unrelated command (<a href="../../../../external.html?link=https://phabricator.whonix.org/T914" rel="nofollow noopener">https://phabricator.whonix.org/T914</a>)</p>
<p><code>sudo virt-xml Whonix-Workstation --edit --disk readonly=on</code></p>
<p>changes on top of what is expected additionally domain type from <code>kvm</code> to <code>qubes</code> on my Qubes test machine.</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-21T07:19:04Z' class='post-time'>
                August 21, 2019,  7:19am
              </time>
              <meta itemprop='dateModified' content='2019-08-21T07:19:04Z'>
          <span itemprop='position'>#16</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Did you need to enable <code>Nested KVM Virtualization</code> inside the Whonix-Host build which was running inside a VM?</p>
<aside class="quote no-group" data-post="4" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>See my <a href="../../../../external.html?link=https://github.com/Whonix/whonix-libvirt/pull/92" rel="nofollow noopener">pull request</a> <img src="../../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> (I hope I changed the right file! but you get the idea…)</p>
</blockquote>
</aside>
<p>Merged. And modified/fixed.</p>
<aside class="quote no-group" data-post="4" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>The problem is that this temporary change must be reverted back once the VMs have been configured, which was initially taken care of, but these lines were (probably mistakenly) removed from the same file:</p>
</blockquote>
</aside>
<p>In conclusion, this should be fixed in <code>whonix-libvirt</code> git master.</p>
<aside class="quote no-group" data-post="7" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>Actually, I am currently writing this post from a Whonix-Host install running in KVM in live-mode, with both Whonix-VM in live-mode too! Isn’t that amazing? <img src="../../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> It’s not even that slow! Perfectly fine for testing!</p>
</blockquote>
</aside>
<p>Yay!</p>
<aside class="quote no-group" data-post="8" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>Host running Whonix-Host install (booted in live mode) on KVM with virt-manager -&gt; Whonix-Host running Whonix-Gateway and Whonix-Workstation VMs in live-mode (nested KVM virtualization)</p>
</blockquote>
</aside>
<p>Terrific! <img src="../../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> <img src="../../../images/emoji/twitter/partying_facec164.png?v=9" title=":partying_face:" class="emoji" alt=":partying_face:"></p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7917.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-08-21T12:02:21Z' class='post-time'>
                August 21, 2019, 12:02pm
              </time>
              <meta itemprop='dateModified' content='2019-08-21T12:02:21Z'>
          <span itemprop='position'>#17</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="11" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What (simply) <code>virsh define</code></p>
<pre><code class="lang-auto">virsh -c qemu:///system define /usr/share/whonix-libvirt/xml/Whonix-Gateway.xml
</code></pre>
<p>is does is simply copy <code>/usr/share/whonix-libvirt/xml/Whonix-Gateway.xml</code> to <code>/etc/libvirt/qemu/Whonix-Gateway.xml</code> ?</p>
</blockquote>
</aside>
<p>As far as I remember (but would need testing anew to confirm), <code>virsh define</code> command was necessary as “simply copying” the file would not would not persist after reboot or something like that… Or maybe the following <code>virsh</code> commands would not work otherwise…</p>
<aside class="quote no-group" data-post="13" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Are both QEMU and KVM xml files inside the same folder <code>/etc/libvirt/qemu</code> ?</p>
<p>Do you have folder <code>/etc/libvirt/kvm</code> anywhere on any “<a href="../../../../external.html?link=https://www.whonix.org/wiki/KVM" rel="nofollow noopener">usual</a>” (KVM VM version as of now) on any of your hosts?</p>
</blockquote>
</aside>
<p>On my debian buster host: yes, everything is inside this directory, and I have no <code>/etc/libvirt/kvm</code> directory.</p>
<aside class="quote no-group" data-post="16" data-topic="7917">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Did you need to enable <code>Nested KVM Virtualization</code> inside the Whonix-Host build which was running inside a VM?</p>
</blockquote>
</aside>
<p>No, only on the physical host (as the virtualized host probably “doesn’t know” it is virtualized?).</p>
        </div>

        <meta itemprop='headline' content='VMs do no start until the CPU configuration is set to “Copy host CPU configuration”'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
