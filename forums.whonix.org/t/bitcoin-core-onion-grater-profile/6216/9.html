<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Bitcoin Core onion-grater profile - #9 by nyxnor - Development - Whonix Forum</title>
    <meta name="description" content="I started to learn onion-grater for the first time and I managed to make a profile for Bitcoin Core (tested on v0.17). It allows creating mainnet or testnet hidden service and discards private key to keep services epheme&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../6216.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Bitcoin Core onion-grater profile&#39;" href="../6216.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/bitcoin-core-onion-grater-profile/6216/9" />
<meta name="twitter:url" content="https://forums.whonix.org/t/bitcoin-core-onion-grater-profile/6216/9" />
<meta property="og:title" content="Bitcoin Core onion-grater profile" />
<meta name="twitter:title" content="Bitcoin Core onion-grater profile" />
<meta property="og:description" content="I don’t see why this pattern is beneficial?  It is allowing services to be created to any port to be used instead of only 8333.  Ok, so the person wants to create a restest and testnet service, they would need to edit the config, or the config should use all the default ports, eg. 18333 for testnet.  But the default ports can be hardcoded, if a person uses a non default port, then they are already configuring the service diffferently.  My proposal is to implement all default ports patterns so th..." />
<meta name="twitter:description" content="I don’t see why this pattern is beneficial?  It is allowing services to be created to any port to be used instead of only 8333.  Ok, so the person wants to create a restest and testnet service, they would need to edit the config, or the config should use all the default ports, eg. 18333 for testnet.  But the default ports can be hardcoded, if a person uses a non default port, then they are already configuring the service diffferently.  My proposal is to implement all default ports patterns so th..." />
<meta property="article:published_time" content="2022-09-08T15:26:55+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="next" href="../62164658.html?page=2">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../6216.html">Bitcoin Core onion-grater profile</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-11-30T11:45:18Z' class='post-time'>
                November 30, 2018, 11:45am
              </time>
              <meta itemprop='dateModified' content='2018-11-30T11:45:18Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2" target="_blank">github.com/Whonix/onion-grater</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://github.com/qubenix" target="_blank">
    <img alt="qubenix" src="../../../../external.html?link=https://avatars0.githubusercontent.com/u/15707061?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2" target="_blank">remove unnecessary lines from bitcoind profile</a>
</h4>

<div class="date">
  by <a href="../../../../external.html?link=https://github.com/qubenix" target="_blank">qubenix</a>
  on <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2" target="_blank">11:29PM - 29 Nov 18 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>1 commits</strong>
  changed <strong>1 files</strong>
  with <strong>0 additions</strong>
  and <strong>3 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-20T06:27:06Z' class='post-time'>
                December 20, 2020,  6:27am
              </time>
              <meta itemprop='dateModified' content='2020-12-20T06:27:06Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/7" target="_blank" rel="noopener">github.com/Whonix/onion-grater</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/7" target="_blank" rel="noopener">update 40_bitcoind.yml to work with bitcoind v0.21</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>qubenix:update-bitcoind</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-12-19" data-time="16:37:56" data-timezone="UTC">04:37PM - 19 Dec 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../../external.html?link=https://github.com/qubenix" target="_blank" rel="noopener">
          <img alt="qubenix" src="../../../../external.html?link=https://avatars0.githubusercontent.com/u/15707061?v=4" class="onebox-avatar-inline" width="20" height="20">
          qubenix
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 4 additions and 0 deletions">
        <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/7/files" target="_blank" rel="noopener">
          <span class="added">+4</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/qubenix'><span itemprop='name'>qubenix</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-01-01T13:56:10Z' class='post-time'>
                January 1, 2021,  1:56pm
              </time>
              <meta itemprop='dateModified' content='2021-01-01T13:56:10Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I realized that this profile can be simplified, but I’m wondering what you think about it <a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a>.</p>
<p>This is how I’ve been running. Is it too permissive like this?</p>
<pre><code class="lang-auto">---
- exe-paths:
    - '*'
  users:
    - '*'
  hosts:
    - '*'
  commands:
    ADD_ONION:
      ## {{{ bitcoind onion service
      - pattern:     'NEW:(\S+) Port=(\S+),127.0.0.1:(\S+)'
        replacement: 'NEW:{} Port={},{client-address}:{} Flags=DiscardPK'
      ## }}}
</code></pre>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-01-01T14:37:40Z' class='post-time'>
                January 1, 2021,  2:37pm
              </time>
              <meta itemprop='dateModified' content='2021-01-01T14:37:40Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>No opinion yet. Since you maintain this, please do as you think this can be best maintained.</p>
<hr>
<p><a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/blob/master/usr/share/doc/onion-grater-merger/examples/40_bitcoind.yml">https://github.com/Whonix/onion-grater/blob/master/usr/share/doc/onion-grater-merger/examples/40_bitcoind.yml</a></p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-01-02T07:20:11Z' class='post-time'>
                January 2, 2021,  7:20am
              </time>
              <meta itemprop='dateModified' content='2021-01-02T07:20:11Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/8" target="_blank" rel="noopener">github.com/Whonix/onion-grater</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/8" target="_blank" rel="noopener">Simplify 40_bitcoind.yml</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>qubenix:simplify-bitcoind</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2021-01-01" data-time="15:38:28" data-timezone="UTC">03:38PM - 01 Jan 21 UTC</span>
      </div>

      <div class="user">
        <a href="../../../../external.html?link=https://github.com/qubenix" target="_blank" rel="noopener">
          <img alt="qubenix" src="../../../../external.html?link=https://avatars0.githubusercontent.com/u/15707061?v=4" class="onebox-avatar-inline" width="20" height="20">
          qubenix
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 3 additions and 10 deletions">
        <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/8/files" target="_blank" rel="noopener">
          <span class="added">+3</span>
          <span class="removed">-10</span>
        </a>
      </div>
    </div>

  </div>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-08T15:26:55Z' class='post-time'>
                September 8, 2022,  3:26pm
              </time>
              <meta itemprop='dateModified' content='2022-09-08T15:26:55Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I don’t see why this pattern is beneficial?</p>
<p>It is allowing services to be created to any port to be used instead of only 8333.</p>
<p>Ok, so the person wants to create a restest and testnet service, they would need to edit the config, or the config should use all the default ports, eg. 18333 for testnet.</p>
<p>But the default ports can be hardcoded, if a person uses a non default port, then they are already configuring the service diffferently.</p>
<p>My proposal is to implement all default ports patterns so the above can be avoided.</p>
<p>Of course the service is only reachable after port is opened on the firewall. But I think the control port should not allow all ports, only the whitelisted ports.</p>
<p>Seeing the examples<br>
<a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/tree/master/usr/share/doc/onion-grater-merger/examples" class="inline-onebox" rel="noopener nofollow ugc">onion-grater/usr/share/doc/onion-grater-merger/examples at master · Whonix/onion-grater · GitHub</a></p>
<p>None is allowing all ports, only onionshare that has a huge range, but that is onionshare default to have that range and search for open ports.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../whonix-16-0-8-2-for-virtualbox-point-release/15836.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../whonix-16-0-8-2-for-virtualbox-point-release/15836.html'>
                      <span itemprop='name'>Whonix 16.0.8.2 - for VirtualBox - Point Release!</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-08T15:35:52Z' class='post-time'>
                September 8, 2022,  3:35pm
              </time>
              <meta itemprop='dateModified' content='2022-09-08T15:35:52Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <pre><code class="lang-auto">bitcoind -help

  -port=&lt;port&gt;
       Listen for connections on &lt;port&gt;. Nodes not using the default ports
       (default: 8333, testnet: 18333, signet: 38333, regtest: 18444)
       are unlikely to get incoming connections. Not relevant for I2P
       (see doc/i2p.md).
</code></pre>
<p>So the ports are: <code>8333, 18333, 38333, 18444</code></p>
<p>Any counter arguments to this?</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T10:53:39Z' class='post-time'>
                September 9, 2022, 10:53am
              </time>
              <meta itemprop='dateModified' content='2022-09-09T10:53:39Z'>
          <span itemprop='position'>#11</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Not from me.</p>
<p><code>## Maintained by: https://forums.whonix.org/u/qubenix &lt;qubenix@riseup.net&gt;</code></p>
<p><a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/qubenix">@qubenix</a>?</p>
<p><a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/blob/master/usr/share/doc/onion-grater-merger/examples/40_bitcoind.yml">https://github.com/Whonix/onion-grater/blob/master/usr/share/doc/onion-grater-merger/examples/40_bitcoind.yml</a></p>
<p>Revert <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/commit/9539d88c7e0b8336b74586d8c93821cad946fc90" class="inline-onebox">simplify 40_bitcoind.yml · Whonix/onion-grater@9539d88 · GitHub</a>?</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-29T22:04:41Z' class='post-time'>
                September 29, 2022, 10:04pm
              </time>
              <meta itemprop='dateModified' content='2022-09-29T22:04:41Z'>
          <span itemprop='position'>#12</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Removed the maintained by <code>qubenix</code>, he has not been active since january and did not reply on time.</p>
<p>Did not put my name because I am using default configuration, there is no need to be dependent on me.</p>
<p>“Complicated” the ports to only use defaults instead of allowing any port to be used.</p>
<aside class="onebox githubpullrequest" data-onebox-src="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/1">
  <header class="source">

      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/1" target="_blank" rel="noopener">github.com/Whonix/onion-grater</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/1" target="_blank" rel="noopener">correct bitcond pattern for all default ports of the chains</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>nyxnor:master</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-09-29" data-time="22:03:48" data-timezone="UTC">10:03PM - 29 Sep 22 UTC</span>
      </div>

      <div class="user">
        <a href="../../../../external.html?link=https://github.com/nyxnor" target="_blank" rel="noopener">
          <img alt="nyxnor" src="../../../../external.html?link=https://avatars.githubusercontent.com/u/69700936?v=4" class="onebox-avatar-inline" width="20" height="20">
          nyxnor
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 12 additions and 4 deletions">
        <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/1/files" target="_blank" rel="noopener">
          <span class="added">+12</span>
          <span class="removed">-4</span>
        </a>
      </div>
    </div>
  </div>
</div>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-30T08:26:43Z' class='post-time'>
                September 30, 2022,  8:26am
              </time>
              <meta itemprop='dateModified' content='2022-09-30T08:26:43Z'>
          <span itemprop='position'>#13</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>wait a little bit before merging, I’m correcting something</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-30T10:13:12Z' class='post-time'>
                September 30, 2022, 10:13am
              </time>
              <meta itemprop='dateModified' content='2022-09-30T10:13:12Z'>
          <span itemprop='position'>#14</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Good to go now.</p>
<p>Corrected the binding ports.</p>
<p>Bitcoind binds onions to:  P2P_port + 1.</p>
<p>This is the request:</p>
<pre><code class="lang-auto">ADD_ONION NEW:ED25519-V3 Port=8333,127.0.0.1:8334
</code></pre>
<p><code>sudo netstat -tulnp | grep bitcoin</code></p>
<pre><code class="lang-auto">tcp        0      0 0.0.0.0:8333            0.0.0.0:*               LISTEN      1564026/bitcoind    
tcp        0      0 127.0.0.1:8334          0.0.0.0:*               LISTEN      1564026/bitcoind    
tcp        0      0 127.0.0.1:8332          0.0.0.0:*               LISTEN      1564026/bitcoind    
tcp6       0      0 :::8333                 :::*                    LISTEN      1564026/bitcoind    
tcp6       0      0 ::1:8332                :::*                    LISTEN      1564026/bitcoind
</code></pre>
<p>Mainnet;</p>
<ul>
<li>RPC: 8332</li>
<li>P2P: 8333</li>
<li>bind onion p2p port: 8334</li>
</ul>
<p>The virtual port is still 8333, but they use a different binding port for onion.</p>
<p>Just saying this so it is easier to debug next time.</p>
<p>I did not choose/configure these ports, this are the default ports.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-01T14:05:26Z' class='post-time'>
                October 1, 2022,  2:05pm
              </time>
              <meta itemprop='dateModified' content='2022-10-01T14:05:26Z'>
          <span itemprop='position'>#15</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks! Merged.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-02T19:22:17Z' class='post-time'>
                October 2, 2022,  7:22pm
              </time>
              <meta itemprop='dateModified' content='2022-10-02T20:00:58Z'>
          <span itemprop='position'>#16</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Ok, there is a problem with the current pattern.</p>
<p>Bitcoin onion-grater profile is only necessary if you want to <code>listen=1</code> for incoming connections, this means relaying blocks on the p2p network.</p>
<p>Bitcoind does indeed start the onion binding port on <code>127.0.0.1:8334</code>. This means that it isn’t reachable on <code>$(qubesdb-read /qubes-ip):8334</code>.</p>
<p>It would be reachable on that interface if the onion binding port was <code>0.0.0.0:8334</code> or the <code>$(qubesdb-read /qubes-ip):8334</code>, but the first option <code>0.0.0.0:8334</code> is better because it does not depend on knowing the qubes ip and updating it.</p>
<p>So if you want to listen for incoming connections, you need to set on the bitcoin.conf:</p>
<pre><code class="lang-auto">listen=1
## although this is the default binding address:port,
## it is necessary to set it for it to listen on multiple addresses
## if not set, only 0.0.0.0:8334 would be binded and the default
## bind address and port would not be used
bind=0.0.0.0:8333
bind=0.0.0.0:8334=onion
</code></pre>
<p>and opening external port 8334 on the workstation.</p>
<p>This also means that I need to update the onion-grater profile to overwrite the client add onion address with regex to match every address (0.0.0.0 and 127.0.0.01 should be modified to {client-address}). Something like <code>(\S+)</code>, will test later.</p>
<p>You can test this is the case for example with nginx by listening on <code>127.0.0.1:82</code>, only that address will be reachable and not the qubes ip and same port.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-02T20:13:33Z' class='post-time'>
                October 2, 2022,  8:13pm
              </time>
              <meta itemprop='dateModified' content='2022-10-02T20:13:33Z'>
          <span itemprop='position'>#17</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><code>https://www.whonix.org/wiki/Onion_Services#cite_note-11</code></p>
<p>(I don’t really understand how to print the link and not the title of the page with discourse…)</p>
<p>Just like apache only listening on 127.0.0.1, its traffic needs to be redirected to the Workstation listening interface. The thing is that by default nginx starts with 0.0.0.0 (all interfaces).</p>
<p>And using <code>sudo ncat -l 0.0.0.0 8334 -c 'ncat 127.0.0.1 8334'</code> but that is just dumb and prone to mistakes of forgetting about it, better to set in the bitcoin.conf.</p>
<p>So yeah, changing the bitcoin.conf to <code>bind=0.0.0.0:8334=onion</code> is necessary.</p>
<p>And I believe it is reasonable for bitcoind default to 127.0.0.1 for onion connections and not 0.0.0.0, because it could leak server info, but not for Whonix, as it is isolated network with the Gateway.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-02T20:54:31Z' class='post-time'>
                October 2, 2022,  8:54pm
              </time>
              <meta itemprop='dateModified' content='2022-10-02T20:54:31Z'>
          <span itemprop='position'>#18</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubpullrequest" data-onebox-src="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2">
  <header class="source">

      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2" target="_blank" rel="noopener">github.com/Whonix/onion-grater</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2" target="_blank" rel="noopener">make bitcoind accept 127.0.0.1 and 0.0.0.0</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>nyxnor:master</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-10-02" data-time="20:53:43" data-timezone="UTC">08:53PM - 02 Oct 22 UTC</span>
      </div>

      <div class="user">
        <a href="../../../../external.html?link=https://github.com/nyxnor" target="_blank" rel="noopener">
          <img alt="nyxnor" src="../../../../external.html?link=https://avatars.githubusercontent.com/u/69700936?v=4" class="onebox-avatar-inline" width="20" height="20">
          nyxnor
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 8 additions and 5 deletions">
        <a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2/files" target="_blank" rel="noopener">
          <span class="added">+8</span>
          <span class="removed">-5</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">bitcoind binding to onion defaults to 127.0.0.1, that doesn't work for Whonix, i<span class="show-more-container"><a href="../../../../external.html?link=https://github.com/Whonix/onion-grater/pull/2" target="_blank" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">t needs to be 0.0.0.0. So make onion-grater accept both, although 127.0.0.1 will never work.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Used the same pattern as 40_wayhay.yml</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-02T21:35:51Z' class='post-time'>
                October 2, 2022,  9:35pm
              </time>
              <meta itemprop='dateModified' content='2022-10-02T21:35:51Z'>
          <span itemprop='position'>#19</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="nyxnor" data-post="16" data-topic="6216">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/forums.whonix.org/nyxnor/40/2874_2.jpg" class="avatar"> nyxnor:</div>
<blockquote>
<pre><code class="lang-auto">bind=0.0.0.0:8333
bind=0.0.0.0:8334=onion
</code></pre>
</blockquote>
</aside>
<p>Note the first listening address <code>8333</code> is only necessary if you want applications to use that address. This is useful for qubes if you want to bind 8333 to another qube and have a pruned node on one qube and a full on another, without the need to set rpc for the other node, thus minimizing risks when possible.</p>
<p>So in the end, it is good to have <code>8333</code> always set because that is default bitcoind behavior that most applications will be expecting.</p>
<p>And the reason to set a different port for onion <code>8334</code> is:</p>
<ul>
<li>default bitcoind configuration (except the address 127.0.0.1 which needs to be changed to 0.0.0.0)</li>
<li>correctly tagging incoming connections to that separate port as onion, thus making it very clear it is not coming from localhost. Useful for debugging, logs, verification etc.</li>
</ul>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-03T08:24:41Z' class='post-time'>
                October 3, 2022,  8:24am
              </time>
              <meta itemprop='dateModified' content='2022-10-03T08:24:41Z'>
          <span itemprop='position'>#20</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Makes sense.</p>
<aside class="quote no-group" data-username="nyxnor" data-post="17" data-topic="6216">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/forums.whonix.org/nyxnor/40/2874_2.jpg" class="avatar"> nyxnor:</div>
<blockquote>
<p><code>https://www.whonix.org/wiki/Onion_Services#cite_note-11</code></p>
<p>(I don’t really understand how to print the link and not the title of the page with discourse…)</p>
</blockquote>
</aside>
<p>(<a href="../../../../external.html?link=https://www.kicksecure.com/wiki/Forum_Best_Practices#Avoid_Oneboxing_for_Anchored_Links">Avoid Oneboxing for Anchored Links</a> + Created <a href="../../../../external.html?link=https://meta.discourse.org/t/improve-oneboxing-for-anchored-links/240699" class="inline-onebox">Improve oneboxing for anchored links - feature - Discourse Meta</a> just now. To discuss this further, would be best to post there or create a new forum thread here.)</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-03T11:55:07Z' class='post-time'>
                October 3, 2022, 11:55am
              </time>
              <meta itemprop='dateModified' content='2022-10-03T11:55:07Z'>
          <span itemprop='position'>#21</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Ok. So I don’t believe there is a problem with my onion-grater profile, but something strange happens.</p>
<aside class="onebox githubissue" data-onebox-src="../../../../external.html?link=https://github.com/bitcoin/bitcoin/issues/26228">
  <header class="source">

      <a href="../../../../external.html?link=https://github.com/bitcoin/bitcoin/issues/26228" target="_blank" rel="noopener">github.com/bitcoin/bitcoin</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewbox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../../external.html?link=https://github.com/bitcoin/bitcoin/issues/26228" target="_blank" rel="noopener">retry add onion after tor's controller closed connection</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-10-02" data-time="22:35:21" data-timezone="UTC">10:35PM - 02 Oct 22 UTC</span>
      </div>


      <div class="user">
        <a href="../../../../external.html?link=https://github.com/nyxnor" target="_blank" rel="noopener">
          <img alt="nyxnor" src="../../../../external.html?link=https://avatars.githubusercontent.com/u/69700936?v=4" class="onebox-avatar-inline" width="20" height="20">
          nyxnor
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          Bug
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">&lt;!-- This issue tracker is only for technical issues related to Bitcoin Core.

<span class="show-more-container"><a href="#" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">
General bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.

For reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.

If the node is "stuck" during sync or giving "block checksum mismatch" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! --&gt;


I am running Bitcoind on Qubes-Whonix.
Whonix-Gateway is where tor resides, and every tor controller's command made by Whonix-Workstation to Whonix-Gateway is filtered by a proxy called onion-grater (upstream development is made by Tails OS)

From this point on I will be referring to tor's controller simply by "control" or "controller".

If the control connection is closed by restarting onion-grater to apply new rules (even not regarding the bitcoind.yml) file, bitcoind will remove the current onion and won't be able to set it as address again.
```
RemoveLocal(myonion.onion:8333)
tor: No supported authentication method
```
and `bitcoin-cli -netinfo`
```
Local addresses: n/a
```
and of course none of my nodes listening to this address will continue working.

ADD_ONION command works the first time but not the second.
The problem occurs because bitcoind does not give time for the controller to restart the second time, so the authentication is not "available yet".

In fact, tor is not being reloaded or restarted, only the proxy, which is what bitcoind sees as the controller.

This happens because I am using bitcoind tor controller feature to send ADD_ONION.
If I set the onion service manually on the gateway, I wouldn't have this problem, but then the problem would be:
- it wouldn't be pragmatically deleted, although I am rewriting it with `Flag=DiscardPK` anyway
- it would stay as a file on the Gateway and the onion address would need to be manually inserted into the bitcoin.conf

**Expected behavior**


I expect that after bitcoind can't authenticate to the controller, it tries again after some time.
This way, I can restart my controller without needing to restart bitcoind for it to get a onion listening address again.

**Actual behavior**


Bitcoind removes current listening onion hostname and not retry to authenticate to the controller.

**To reproduce**


This is difficult to reproduce on normal systems.
First, Qubes may not interfere, so you could try to reproduce on Whonix KVM or Virtualbox or Tails OS (probably).

If you can't test on that setup, I would try to simple close the controller connection on a normal system and then see what bitcoind does to the listening onion address.

Also you need to add the bitcoind onion-grater profile, I don't know if Tails has, but for Whonix, I am using https://github.com/Whonix/onion-grater/blob/9addd1d6dd9671b18e5415a196b92d7f6ee5846c/usr/share/doc/onion-grater-merger/examples/40_bitcoind.yml

It is not the current Whonix onion-grater profile but it is the correct one and will be merged upstream soon.

If that is the case, add that profile to `/usr/local/etc/onion-grater-merger.d/40_bitcoind.yml`

Also set in the `bitcoin.conf` the onion binding to `bind=0.0.0.0:8334=onion` and not `127.0.0.1`. This makes the service listen on the Whonix internal interface and does not affect security. Restart bitcoind to apply changes.

You will also have to open the port on the Whonix-Workstation firewall.
```
$ sudo mkdir -p /usr/local/etc/whonix_firewall.d
$ echo "EXTERNAL_OPEN_PORTS+=" 8334 " | tee -a /usr/local/etc/whonix_firewall.d/50_user.conf`
$ sudo whonix_firewall
```

To view onion-grater logs, you need to enable debug mode on the Whonix-Gateway:
```
$ echo "[Service]
## Clear onion-grater default file '/lib/systemd/system/onion-grater.service'.
ExecStart=
## Enable debug mode.
ExecStart=/usr/lib/onion-grater --listen-interface eth1 --debug
" | tee /usr/lib/systemd/system/onion-grater.service.d/50_user.conf
$ sudo systemctl daemon-reload
$ sudo systemctl restart onion-grater
```


Then after adding the profile, enabling onion-grater debug mode, restarting onion-grater and bitcoind, test if the address is reachable externally. Use the bitcoid option `connect=address.onion`, so you are sure it is connecting.

If it is, restart onion-grater.
```
$ sudo systemctl restart onion-grater
```

On the bitcoin debug.logs, you should see the same error I saw above about removing onion address and not able to authenticate to the controller.

But that is not entirely correct, because I can issue an ADD_ONION manually and it will accept, but bitcoind does not try to issue ADD_ONION a second time.


```
host onion-grater[149562]: 10.137.0.31:54044 (filter: 30_autogenerated): -&gt; PROTOCOLINFO 1
host onion-grater[149562]: 10.137.0.31:54044 (filter: 30_autogenerated): &lt;- 250-PROTOCOLINFO 1
host onion-grater[149562]: 10.137.0.31:54044 (filter: 30_autogenerated): &lt;- 250-AUTH METHODS=NULL
host onion-grater[149562]: 10.137.0.31:54044 (filter: 30_autogenerated): &lt;- 250-VERSION Tor="0.4.7.10"
host onion-grater[149562]: 10.137.0.31:54044 (filter: 30_autogenerated): &lt;- 250 OK
host onion-grater[149562]: 10.137.0.31:54044 (filter: 30_autogenerated): -&gt; AUTHENTICATE
host onion-grater[149562]: 10.137.0.31:54044 (filter: 30_autogenerated): &lt;- 250 OK
```
The controller actually lets bitcoind authenticate, as seen from the onion-grater logs above. But I don't understand why bitcoind says it can't authenticate.
The ip doesn't matter, it is internal ip.

What you should expect from onion-grater logs is the following:
```
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated): -&gt; AUTHENTICATE
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated): &lt;- 250 OK
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated): -&gt; ADD_ONION NEW:ED25519-V3 Port=8333,0.0.0.0:8334
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated): rewrote command:
host onion-grater[149562]:     ADD_ONION NEW:ED25519-V3 Port=8333,0.0.0.0:8334
host onion-grater[149562]: to:
host onion-grater[149562]:     ADD_ONION NEW:ED25519-V3 Port=8333,10.137.0.31:8334 Flags=DiscardPK
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated): &lt;- (multi-line)
host onion-grater[149562]:     250-ServiceID=myonionhostnamewithoutonion
host onion-grater[149562]:     250 OK
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated): -&gt; QUIT
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated): &lt;- 250 closing connection
host onion-grater[149562]: 10.137.0.31:43566 (filter: 30_autogenerated) disconnected: client quit
```

You could try on Whonix with `tor-ctrl` to authenticate after restarting onion-grater and it will work:
```
$ tor-ctrl ADD_ONION NEW:ED25519-V3 Port=8333,0.0.0.0:8334
```
and it will authenticate.

But for some unknown reason bitcoind does not reauthenticate to the controller.

I understand that once the contoller connection closes, the commands send to the controller are not valid anymore. But bitcoind should be able to reauthenticate once it loses connection.

**System information**










System information was already described above.
I understand this may be difficult debug because it requires a system with onion-grater.
But it does not rely on Whonix or Tails or onion-grater package to fix this, as they are only restarting to read the new configuration, but bitcoind understand that as a connection that must be closed forever.

If you read all this and is open to make bitcoind retry to authenticate cleanly, I am open to help debug and instruct how to reproduce.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Sometimes when restarting onion-grater, bitcoind gets a ServiceID, sometimes it can’t authenticate although onion-grater replied correctly that it could authenticate.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-03T12:15:14Z' class='post-time'>
                October 3, 2022, 12:15pm
              </time>
              <meta itemprop='dateModified' content='2022-10-03T12:15:14Z'>
          <span itemprop='position'>#22</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I am not sure upstream will accept the bug report because of the mention of onion-grater. Their position could be “that needs to be fixed in onion-grater than”. If the issue could be re-produced without onion-grater and only with Tor, then the argument be much stronger. Could this be reproduced by simply reloading or restarting Tor?<br>
From my experience, bug reports generally, with such complexity have very low chance of being acted on by upstream.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/nyxnor'><span itemprop='name'>nyxnor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../6216.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-10-03T12:22:29Z' class='post-time'>
                October 3, 2022, 12:22pm
              </time>
              <meta itemprop='dateModified' content='2022-10-03T13:20:17Z'>
          <span itemprop='position'>#23</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="22" data-topic="6216">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could this be reproduced by simply reloading or restarting Tor?</p>
</blockquote>
</aside>
<p>Unfortunately no. I tested on a debian qube running bitcoind with local tor, this does not occurr.</p>
<p>I tried to make the bug “simpler” but it does not happen without onion-grater. This does not mean its onion-grater fault, because it replies correctly. But maybe bitcoind doesn’t wait for it to reply? Not sure.</p>
<p>Tested on debian by restarting tor, as that is the way to close the control connection as there is no proxy. Bitcoind can always add onion. But on Whonix with onion-grater, it does not always works, don’t know why.</p>
        </div>

        <meta itemprop='headline' content='Bitcoin Core onion-grater profile'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><b><a rel="next" itemprop="url" href="../62164658.html?page=2">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
