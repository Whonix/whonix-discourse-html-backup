<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
    <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383</link>
    <description>Hello,
I&#39;m testing the bridge configuration starting from a fresh Whonix Gateway CLI and by using `startx` for executing `anon-connection-wizard`.

The &quot;obfs4&quot; transport type works correctly. The &quot;meek-azure&quot; transport type does not.
Step by step is shown this small test:

The machine is connected to TOR:
![Tor_Status_CLI|516x322](upload://uG4H8ylVxBVnUii7BD497bliEJD.png) 

The `50_user.conf` file is empty
![50_user-conf_file_fresh|279x84](upload://znMGEgXkaaYp5OHLvSBPUdtEb8f.png)

I didn&#39;t touch the `40_tor_control_panel.conf`.

Then I start the bridge configuration:
![Bridge_conf_meek-azure|690x497](upload://grBWf94WYGOULmjqXt8xBDq60P3.png) 

![noproxy|690x497](upload://wotirARFxUtjECsbo50kbNQkcZZ.png) 

![summary_bridge|690x495](upload://fxr4fLiKADTYvta3PaES0anIu64.png) 

When I click on &quot;Next&quot;, the bootstrapping will freeze at 10%
![error_bridge3|591x459](upload://qfVc0WNoPDGr8UlyD2JrvT3t6Kk.png) 

and the messages produced by this process are:
![error_bridge1|500x321](upload://yd7ghDdvxx2JaOtZhZhJnflXqgt.png) 
![error_bridge2|494x323](upload://76JAIBARDF8RScaB5R5bGUBmaL7.png) 

So the errors that are triggered continuosly while the progress bar stucks at 10% are these `&quot;TLS_ERROR&quot;` where about each second the `COUNT` variable increase by 1.

When I stop the bootstrapping, the content of the `40_tor_control_panel.conf` file is:
![error_bridge4|502x178](upload://zv0bRj3ulOGMdjyzGavyMij0n8u.png) 

Is it a known issue? Could be due to a TLS certificate error?

PS: sorry if I do not copy and paste directly the text but the copy and paste from the VM does not work, even though I installed the vbox addition guests by &quot;upgrade-nonroot&quot; command.</description>
    <language>en</language>
    <lastBuildDate>Wed, 07 Apr 2021 22:45:46 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This is now in Whonix developers repository.</p>
<p>See also:<br>
<a href="https://www.whonix.org/wiki/Reporting_Bugs#Package_Upgrade_Policy">https://www.whonix.org/wiki/Reporting_Bugs#Package_Upgrade_Policy</a></p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/9</link>
        <pubDate>Wed, 07 Apr 2021 22:45:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-9</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/anon-connection-wizard/blob/master/usr/lib/python3/dist-packages/anon_connection_wizard/edit_etc_resolv_conf.py" target="_blank" rel="noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/anon-connection-wizard/blob/master/usr/lib/python3/dist-packages/anon_connection_wizard/edit_etc_resolv_conf.py" target="_blank" rel="noopener">Whonix/anon-connection-wizard/blob/master/usr/lib/python3/dist-packages/anon_connection_wizard/edit_etc_resolv_conf.py</a></h4>
<pre><code class="lang-py">#!/usr/bin/python3 -u

## Copyright (C) 2021 - 2021 ENCRYPTED SUPPORT LP &lt;adrelanos@whonix.org&gt;
## See the file COPYING for copying conditions.

import os, sys
from subprocess import check_output, STDOUT, call, Popen, PIPE

if os.path.exists('/usr/share/anon-gw-base-files/gateway'):
    whonix=True
else:
    whonix=False

def edit_etc_resolv_conf_add():
   if not whonix:
      ## Not implemented for non-Whonix.
      return

   try:
      command = ['/usr/lib/anon-gw-anonymizer-config/edit-etc-resolv-conf']
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/anon-connection-wizard/blob/master/usr/lib/python3/dist-packages/anon_connection_wizard/edit_etc_resolv_conf.py" target="_blank" rel="noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/anon-connection-wizard/commit/2b33df7e051a2d7426b6312ecc9a128f7e7ffa95" target="_blank" rel="noopener">github.com/Whonix/anon-connection-wizard</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/anon-connection-wizard/commit/2b33df7e051a2d7426b6312ecc9a128f7e7ffa95" target="_blank" rel="noopener">part of fixing meek lite in Whonix</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2021-04-07" data-time="20:48:05" data-timezone="UTC">08:48PM - 07 Apr 21 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 31 additions and 0 deletions">
        <a href="https://github.com/Whonix/anon-connection-wizard/commit/2b33df7e051a2d7426b6312ecc9a128f7e7ffa95" target="_blank" rel="noopener">
          <span class="added">+31</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">add /usr/lib/anon-gw-anonymizer-config/edit-etc-resolv-conf
https://forums.whonix.org/t/censorship-circumvention-tor-pluggable-transports/2601/9
https://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383
Thanks to @Bl3ckJ4ck for the bug report!</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/anon-connection-wizard/commit/3d1d5ad3f5ec5a9da997c248cdc78ad0c8669533" target="_blank" rel="noopener">github.com/Whonix/anon-connection-wizard</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/anon-connection-wizard/commit/3d1d5ad3f5ec5a9da997c248cdc78ad0c8669533" target="_blank" rel="noopener">part of fixing meek lite in Whonix</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2021-04-07" data-time="21:28:20" data-timezone="UTC">09:28PM - 07 Apr 21 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 3 files with 28 additions and 2 deletions">
        <a href="https://github.com/Whonix/anon-connection-wizard/commit/3d1d5ad3f5ec5a9da997c248cdc78ad0c8669533" target="_blank" rel="noopener">
          <span class="added">+28</span>
          <span class="removed">-2</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">https://forums.whonix.org/t/censorship-circumvention-tor-pluggable-transports/2601/9
https://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383
Thanks to @Bl3ckJ4ck for the bug report!</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/8</link>
        <pubDate>Wed, 07 Apr 2021 22:43:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-8</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>No ETA.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/lib/anon-gw-anonymizer-config/edit-etc-resolv-conf" target="_blank" rel="noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/lib/anon-gw-anonymizer-config/edit-etc-resolv-conf" target="_blank" rel="noopener">Whonix/anon-gw-anonymizer-config/blob/master/usr/lib/anon-gw-anonymizer-config/edit-etc-resolv-conf</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2021 - 2021 ENCRYPTED SUPPORT LP &lt;adrelanos@whonix.org&gt;
## See the file COPYING for copying conditions.

#### meta start
#### project Whonix
#### category tor
#### gateway_only yes
#### description
## TODO
#### meta end

set -x
set -e

start_marker="## START-autogenerated-by-edit-etc-torrc-conf-START"
end_marker="## END-autogenerated-by-edit-etc-torrc-conf-END"

remove_autogenerated() {
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/lib/anon-gw-anonymizer-config/edit-etc-resolv-conf" target="_blank" rel="noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/7</link>
        <pubDate>Wed, 07 Apr 2021 20:46:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-7</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Bl4ckJ4ck]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a> when the updated ACW will be released and in which feed I can get this update?</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/6</link>
        <pubDate>Wed, 07 Apr 2021 18:38:06 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-6</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Bl4ckJ4ck]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a><br>
Excellent. I confirm it works too. And your post answers also to my question: <a href="https://forums.whonix.org/t/whonix-force-traffic-to-clearnet-with-no-tor/11388" class="inline-onebox">Whonix - Force traffic to clearnet with no Tor</a></p>
<p>Thank you.</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/5</link>
        <pubDate>Wed, 07 Apr 2021 17:58:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-5</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Issue found. Whonix-Gateway System DNS over Clearnet is required for meek lite. These instructions will make it work:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Whonix-Gateway_System_DNS" target="_blank" rel="noopener" title="02:06PM - 07 April 2021">Whonix – 7 Apr 21</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/170;"><img src="https://www.whonix.org/w/images/e/ee/Robot-162087640.png" class="thumbnail" width="110" height="170"></div>

<h3><a href="https://www.whonix.org/wiki/Whonix-Gateway_System_DNS" target="_blank" rel="noopener">Whonix-Gateway System DNS - Whonix</a></h3>

<p>Information about Whonix-Gateway ™ System DNS, /etc/resolv.conf and nslookup. Getting System DNS working on Whonix-Gateway ™</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Reference:</p>
<aside class="quote quote-modified" data-post="9" data-topic="2601">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="https://forums.whonix.org/t/censorship-circumvention-tor-pluggable-transports/2601/9">censorship circumvention / Tor pluggable transports</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development/8"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    iry: 


Tested on Whonix13 with obfs4proxy updated to 0.0.7 and Whonix14, 
both successfully connected to the Tor network. My configuration: 
in /etc/hosts added: 
meek_lite specific 93.184.221.200 <a href="http://ajax.aspnetcdn.com">ajax.aspnetcdn.com</a>

52.222.172.206 <a href="http://a0.awsstatic.com">a0.awsstatic.com</a> ## End of meek_lite specific 
in /etc/tor/torrc added: 
DisableNetwork 0 UseBridges 1 ClientTransportPlugin meek_lite exec 
/usr/bin/obfs4proxy Bridge meek_lite 0.0.2.0:2 
B9E7141C594AF25699E0079C1F0146F409495296 
url=https://d2cly7j4zqgua7.cloudfron…
  </blockquote>
</aside>

<p>Solution: add this feature to ACW. I’ll look into that now.</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/4</link>
        <pubDate>Wed, 07 Apr 2021 17:37:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-4</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Bl4ckJ4ck]]></dc:creator>
        <description><![CDATA[
            <p>Ok <a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a><br>
In the following reply, for tracing reason, I report my test on Debian 10.9 (buster). I used the <code>debian-10.9.0-amd64-netinst</code> image.</p>
<p>I installed obfs4proxy and tor by following the links on the 4) and 5) points. Then I added to <code>/etc/tor/torrc</code> file the following:</p>
<pre><code>UseBridges 1
ClientTransportPlugin meek_lite exec /usr/bin/obfs4proxy
bridge meek_lite 0.0.2.0:3 97700DFE9F483596DDA6264C4D7DF7641E1E39CE url=https://meek.azureedge.net/ front=ajax.aspnetcdn.com
</code></pre>
<p>as reported above. So:<br>
</p><div class="lightbox-wrapper"><a class="lightbox" href="//forums.whonix.org/uploads/default/original/2X/5/58c52a31a24e39ad30b45f19181186907f1a0b81.png" data-download-href="//forums.whonix.org/uploads/default/58c52a31a24e39ad30b45f19181186907f1a0b81" title="1"><img src="//forums.whonix.org/uploads/default/optimized/2X/5/58c52a31a24e39ad30b45f19181186907f1a0b81_2_690x116.png" alt="1" data-base62-sha1="cFirlvcDFfzI5wwFLf5zFJUeWml" width="690" height="116" srcset="//forums.whonix.org/uploads/default/optimized/2X/5/58c52a31a24e39ad30b45f19181186907f1a0b81_2_690x116.png, //forums.whonix.org/uploads/default/optimized/2X/5/58c52a31a24e39ad30b45f19181186907f1a0b81_2_1035x174.png 1.5x, //forums.whonix.org/uploads/default/optimized/2X/5/58c52a31a24e39ad30b45f19181186907f1a0b81_2_1380x232.png 2x" data-small-upload="//forums.whonix.org/uploads/default/optimized/2X/5/58c52a31a24e39ad30b45f19181186907f1a0b81_2_10x10.png"></a></div><p></p>
<p>To test this configuration, I run:<br>
<code>sudo service tor restart</code><br>
and I don’t get error.</p>
<p>In particular, if I move to the log file by using <code>sudo journalctl -u tor@default</code> I get:</p>
<pre><code>Apr 06 07:43:16 debian Tor[523]: Interrupt: exiting cleanly.
Apr 06 07:43:16 debian systemd[1]: Stopping Anonymizing overlay network for TCP...
Apr 06 07:43:16 debian systemd[1]: tor@default.service: Succeeded.
Apr 06 07:43:16 debian systemd[1]: Stopped Anonymizing overlay network for TCP.
Apr 06 07:43:16 debian systemd[1]: Starting Anonymizing overlay network for TCP...
Apr 06 07:43:16 debian tor[2127]: Apr 06 07:43:16.775 [notice] Tor 0.3.5.14 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 07:43:16 debian tor[2127]: Apr 06 07:43:16.776 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 07:43:16 debian tor[2127]: Apr 06 07:43:16.776 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 07:43:16 debian tor[2127]: Apr 06 07:43:16.776 [notice] Read configuration file "/etc/tor/torrc".
Apr 06 07:43:16 debian tor[2127]: Configuration was valid
Apr 06 07:43:16 debian tor[2128]: Apr 06 07:43:16.925 [notice] Tor 0.3.5.14 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 07:43:16 debian tor[2128]: Apr 06 07:43:16.926 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 07:43:16 debian tor[2128]: Apr 06 07:43:16.926 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 07:43:16 debian tor[2128]: Apr 06 07:43:16.926 [notice] Read configuration file "/etc/tor/torrc".
Apr 06 07:43:16 debian tor[2128]: Apr 06 07:43:16.930 [notice] Opening Socks listener on 127.0.0.1:9050
Apr 06 07:43:16 debian tor[2128]: Apr 06 07:43:16.930 [notice] Opened Socks listener on 127.0.0.1:9050
Apr 06 07:43:16 debian Tor[2128]: We compiled with OpenSSL 1010104f: OpenSSL 1.1.1d  10 Sep 2019 and we are running with OpenSSL 1010104f: 1.1.1d. These two versions should be binary compatible.
Apr 06 07:43:16 debian Tor[2128]: Tor 0.3.5.14 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 07:43:16 debian Tor[2128]: Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 07:43:16 debian Tor[2128]: Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 07:43:16 debian Tor[2128]: Read configuration file "/etc/tor/torrc".
Apr 06 07:43:16 debian Tor[2128]: Opening Socks listener on 127.0.0.1:9050
Apr 06 07:43:16 debian Tor[2128]: Opened Socks listener on 127.0.0.1:9050
Apr 06 07:43:16 debian Tor[2128]: Parsing GEOIP IPv4 file /usr/share/tor/geoip.
Apr 06 07:43:17 debian Tor[2128]: Parsing GEOIP IPv6 file /usr/share/tor/geoip6.
Apr 06 07:43:17 debian Tor[2128]: Bootstrapped 0%: Starting
Apr 06 07:43:17 debian Tor[2128]: Starting with guard context "bridges"
Apr 06 07:43:17 debian Tor[2128]: new bridge descriptor 'cymrubridge02' (cached): $97700DFE9F483596DDA6264C4D7DF7641E1E39CE~cymrubridge02 at 0.0.2.0
Apr 06 07:43:17 debian Tor[2128]: Delaying directory fetches: Pluggable transport proxies still configuring
Apr 06 07:43:17 debian Tor[2128]: Signaled readiness to systemd
Apr 06 07:43:17 debian systemd[1]: Started Anonymizing overlay network for TCP.
Apr 06 07:43:18 debian Tor[2128]: Opening Socks listener on /run/tor/socks
Apr 06 07:43:18 debian Tor[2128]: Opened Socks listener on /run/tor/socks
Apr 06 07:43:18 debian Tor[2128]: Opening Control listener on /run/tor/control
Apr 06 07:43:18 debian Tor[2128]: Opened Control listener on /run/tor/control
Apr 06 07:43:18 debian Tor[2128]: Bootstrapped 5%: Connecting to directory server
Apr 06 07:43:18 debian Tor[2128]: Bootstrapped 10%: Finishing handshake with directory server
Apr 06 07:43:18 debian Tor[2128]: Bootstrapped 80%: Connecting to the Tor network
Apr 06 07:43:27 debian Tor[2128]: Bootstrapped 90%: Establishing a Tor circuit
Apr 06 07:43:33 debian Tor[2128]: Bootstrapped 100%: Done
</code></pre>
<p>It means that the configuration above works correctly.</p>
<p>I also did a “fault” test to be sure that the system referred correctly to the information inside the torrc file, indeed I chose to change certificate value substituting the final E with F:</p>
<pre><code>UseBridges 1
ClientTransportPlugin meek_lite exec /usr/bin/obfs4proxy
bridge meek_lite 0.0.2.0:3 97700DFE9F483596DDA6264C4D7DF7641E1E39CF url=https://meek.azureedge.net/ front=ajax.aspnetcdn.com
</code></pre>
<p>Then, restarting tor by <code>sudo service tor restart</code>, if again I move to the log file by using <code>sudo journalctl -u tor@default</code> I get a stuck on the bootstrap:</p>
<pre><code>Apr 06 07:50:38 debian Tor[2128]: Interrupt: exiting cleanly.
Apr 06 07:50:38 debian systemd[1]: Stopping Anonymizing overlay network for TCP...
Apr 06 07:50:38 debian systemd[1]: tor@default.service: Succeeded.
Apr 06 07:50:38 debian systemd[1]: Stopped Anonymizing overlay network for TCP.
Apr 06 07:50:38 debian systemd[1]: Starting Anonymizing overlay network for TCP...
Apr 06 07:50:38 debian tor[2162]: Apr 06 07:50:38.119 [notice] Tor 0.3.5.14 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 07:50:38 debian tor[2162]: Apr 06 07:50:38.124 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 07:50:38 debian tor[2162]: Apr 06 07:50:38.124 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 07:50:38 debian tor[2162]: Apr 06 07:50:38.124 [notice] Read configuration file "/etc/tor/torrc".
Apr 06 07:50:38 debian tor[2162]: Configuration was valid
Apr 06 07:50:38 debian tor[2164]: Apr 06 07:50:38.273 [notice] Tor 0.3.5.14 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 07:50:38 debian tor[2164]: Apr 06 07:50:38.273 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 07:50:38 debian tor[2164]: Apr 06 07:50:38.273 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 07:50:38 debian tor[2164]: Apr 06 07:50:38.273 [notice] Read configuration file "/etc/tor/torrc".
Apr 06 07:50:38 debian tor[2164]: Apr 06 07:50:38.278 [notice] Opening Socks listener on 127.0.0.1:9050
Apr 06 07:50:38 debian tor[2164]: Apr 06 07:50:38.278 [notice] Opened Socks listener on 127.0.0.1:9050
Apr 06 07:50:38 debian Tor[2164]: We compiled with OpenSSL 1010104f: OpenSSL 1.1.1d  10 Sep 2019 and we are running with OpenSSL 1010104f: 1.1.1d. These two versions should be binary compatible.
Apr 06 07:50:38 debian Tor[2164]: Tor 0.3.5.14 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 07:50:38 debian Tor[2164]: Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 07:50:38 debian Tor[2164]: Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 07:50:38 debian Tor[2164]: Read configuration file "/etc/tor/torrc".
Apr 06 07:50:38 debian Tor[2164]: Opening Socks listener on 127.0.0.1:9050
Apr 06 07:50:38 debian Tor[2164]: Opened Socks listener on 127.0.0.1:9050
Apr 06 07:50:38 debian Tor[2164]: Parsing GEOIP IPv4 file /usr/share/tor/geoip.
Apr 06 07:50:38 debian Tor[2164]: Parsing GEOIP IPv6 file /usr/share/tor/geoip6.
Apr 06 07:50:38 debian Tor[2164]: Bootstrapped 0%: Starting
Apr 06 07:50:39 debian Tor[2164]: Starting with guard context "bridges"
Apr 06 07:50:39 debian Tor[2164]: Delaying directory fetches: No running bridges
Apr 06 07:50:39 debian Tor[2164]: Signaled readiness to systemd
Apr 06 07:50:39 debian systemd[1]: Started Anonymizing overlay network for TCP.
Apr 06 07:50:39 debian Tor[2164]: Opening Socks listener on /run/tor/socks
Apr 06 07:50:39 debian Tor[2164]: Opened Socks listener on /run/tor/socks
Apr 06 07:50:39 debian Tor[2164]: Opening Control listener on /run/tor/control
Apr 06 07:50:39 debian Tor[2164]: Opened Control listener on /run/tor/control
Apr 06 07:50:40 debian Tor[2164]: Bootstrapped 5%: Connecting to directory server
Apr 06 07:50:40 debian Tor[2164]: Bootstrapped 10%: Finishing handshake with directory server
Apr 06 07:50:48 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:50:48 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 1; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:50:53 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:50:53 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 2; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:50:53 debian Tor[2164]: 1 connections have failed:
Apr 06 07:50:53 debian Tor[2164]:  1 connections died in state handshaking (Tor, v3 handshake) with SSL state SSL negotiation finished successfully in OPEN
Apr 06 07:51:02 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:51:02 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 3; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:51:02 debian Tor[2164]: 2 connections have failed:
Apr 06 07:51:02 debian Tor[2164]:  2 connections died in state handshaking (Tor, v3 handshake) with SSL state SSL negotiation finished successfully in OPEN
Apr 06 07:51:13 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:51:13 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 4; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:51:13 debian Tor[2164]: 3 connections have failed:
Apr 06 07:51:13 debian Tor[2164]:  3 connections died in state handshaking (Tor, v3 handshake) with SSL state SSL negotiation finished successfully in OPEN
Apr 06 07:51:23 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:51:23 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 5; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:51:23 debian Tor[2164]: 4 connections have failed:
Apr 06 07:51:23 debian Tor[2164]:  4 connections died in state handshaking (Tor, v3 handshake) with SSL state SSL negotiation finished successfully in OPEN
Apr 06 07:51:47 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:51:47 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 6; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:51:47 debian Tor[2164]: 5 connections have failed:
Apr 06 07:51:47 debian Tor[2164]:  5 connections died in state handshaking (Tor, v3 handshake) with SSL state SSL negotiation finished successfully in OPEN
Apr 06 07:52:33 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:52:33 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 7; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:52:33 debian Tor[2164]: 6 connections have failed:
Apr 06 07:52:33 debian Tor[2164]:  6 connections died in state handshaking (Tor, v3 handshake) with SSL state SSL negotiation finished successfully in OPEN
Apr 06 07:53:08 debian Tor[2164]: Tried connecting to router at 0.0.2.0:3, but RSA + ed25519 identity keys were not as expected: wanted 97700DFE9F483596DDA6264C4D7DF7641E1E39CF + no ed25519 key but got 97700DFE9F483596DDA6264C4D7DF7641E1E39CE + /LIpGKq6STgqkVJaKWDj92BCzGWbwqe3lBU+8hsQKP8.
Apr 06 07:53:08 debian Tor[2164]: Problem bootstrapping. Stuck at 10%: Finishing handshake with directory server. (Unexpected identity in router certificate; IDENTITY; count 8; recommendation warn; host 97700DFE9F483596DDA6264C4D7DF7641E1E39CF at 0.0.2.0:3)
Apr 06 07:53:08 debian Tor[2164]: 7 connections have failed:
Apr 06 07:53:08 debian Tor[2164]:  7 connections died in state handshaking (Tor, v3 handshake) with SSL state SSL negotiation finished successfully in OPEN
</code></pre>
<p>Overall, this test shows that the configuration used in Whonix inside the <code>40_tor_control_panel.conf</code> file for meek-azure is correct.</p>
<p>Maybe the cause we get that problem could It could mean that some process blocks the contact of Whonix to azure service.</p>
<p>Afterwards, I also did the same test with the same version of tor in both of OS (0.4.5.7) with the same versions of libraries (<code>Tor 0.4.5.7 running on Linux with Libevent 2.1.12-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, Libzstd 1.4.8 and Glibc 2.31 as libc.</code>) but I get the same issue on Whonix while on Debian works.</p>
<p>The difference between Debian and Whonix when Tor is connecting is that Debian reads only configuration files: <code>/usr/share/tor/tor-service-defaults-torrc</code> and <code>/etc/tor/torrc</code>. While Whonix reads (<code>sudo journalctl -u tor@default</code>):</p>
<pre><code>Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Read configuration file "/etc/tor/torrc".
Including configuration file "/etc/torrc.d//60_network.conf".
Including configuration file "/etc/torrc.d//65_gateway.conf".
Including configuration file "/etc/torrc.d//65_leak_tests.conf".
Including configuration file "/etc/torrc.d//70_workstation.conf".
Including configuration file "/usr/share/tor/tor-service-defaults-torrc.anondist".
Including configuration file "/etc/torrc.d//95_whonix.conf".
Including configuration file "/usr/local/etc/torrc.d//40_tor_control_panel.conf".
Including configuration file "/usr/local/etc/torrc.d//50_user.conf".
</code></pre>
<p>The difference among the configuration files used on two OS:<br>
<code>/usr/share/tor/tor-service-defaults-torrc</code> --&gt; equal content on Whonix and Debian;<br>
<code>/etc/tor/torrc</code> --&gt; in Whonix the file refers to the /etc/torrc.d/ directory, in Debian we have the content that in Whonix is inside the <code>40_tor_control_panel.conf</code> file;<br>
The rest of the files is only in Whonix of course.<br>
So, maybe the issue could be in one of these files that can generate some conflict? I don’t know.</p>
<p>PS: in the anon_connection_wizard.py file, at 1590 row, is there a “<code>except selftem.connection.IncorrectCookieSize</code>:” Maybe the correct form is not selftem but should be stem, right?<br>
For the next Tor updates (as the 0.4.5.7) maybe you could get an error like “RuntimeError: dictionary keys changed during iteration”. If it happens, just edit the “<code>/usr/lib/python3/dist-packages/stem/control.py</code>” file by changing the 2273 row to “<code>for key in list(reply):</code>” (so, adding <code>list()</code>) Source: <a href="https://stackoverflow.com/questions/11941817/how-to-avoid-runtimeerror-dictionary-changed-size-during-iteration-error" rel="noopener nofollow ugc">https://stackoverflow.com/questions/11941817/how-to-avoid-runtimeerror-dictionary-changed-size-during-iteration-error</a></p>
<p>A warn that I get in Whonix inside the tor logs when I connect to Tor network by anon-connection-wizard is:<br>
<code>Option 'DisableNetwork' used more than once; all but the last value will be ignored.</code><br>
It does not generate issues (I think) but it could be a best practice to understand where is used two times: I’m seeing is used one time in <code>40_tor_control_panel.conf</code> and on <code>60_network.conf</code>. Since the warn message says that the “last value will be ignored” it means that the value in <code>40_tor_control_panel.conf</code> will be always ignored so DisableNetwork is always set to 1?.</p>
<p>UPDATE: The problem is not related to the files shown above (60_x, 65_x and so on). I’m looking for obfs4proxy. I edited the content of configuration file as:</p>
<pre><code>UseBridges 1
ClientTransportPlugin meek_lite exec /usr/bin/obfs4proxy --enableLogging --logLevel DEBUG
bridge meek_lite 0.0.2.0:3 97700DFE9F483596DDA6264C4D7DF7641E1E39CE url=https://meek.azureedge.net/ front=ajax.aspnetcdn.com
</code></pre>
<p>adding logging on obfs4proxy. The result of logs (/var/lib/tor/pt_state/obfs4proxy.log) shows the following:</p>
<pre><code>2021/04/06 12:24:46 [NOTICE]: obfs4proxy-0.0.7 - launched
2021/04/06 12:24:46 [INFO]: obfs4proxy - initializing client transport listeners
2021/04/06 12:24:46 [INFO]: meek_lite - registered listener: 127.0.0.1:40147
2021/04/06 12:24:46 [INFO]: obfs4proxy - accepting connections
2021/04/06 12:24:47 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:24:48 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:24:49 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:24:51 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:24:52 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:24:54 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:24:57 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:24:59 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
2021/04/06 12:25:02 [WARN]: meek_lite([scrubbed]:3) - closed connection: readfrom: io: read/write on closed pipe
</code></pre>
<p>The [WARN] logs are created when on the other side the anon-connection-wizard stucks at the 10% during the bootstrapping.</p>
<p>So, from this [WARN] it means that it is trying to do a read/write operations on a closed pipe… Maybe the requests are sent after a specific timeout after that the pipe will be closed… so I think this timeout should be increased.</p>
<p>I also checked the pipe connections by using <code>sudo lsof | grep obfs4</code> on both machines and the only difference I get is that on Debian I have:</p>
<pre><code>obfs4prox 15352 15353 obfs4prox debian-tor  cwd       DIR                8,1     4096          2 /
obfs4prox 15352 15353 obfs4prox debian-tor  rtd       DIR                8,1     4096          2 /
obfs4prox 15352 15353 obfs4prox debian-tor  txt       REG                8,1  5437776     291005 /usr/bin/obfs4proxy
obfs4prox 15352 15353 obfs4prox debian-tor  mem       REG                8,1  1839792     296277 /usr/lib/x86_64-linux-gnu/libc-2.31.so
obfs4prox 15352 15353 obfs4prox debian-tor  mem       REG                8,1   149520     296288 /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
obfs4prox 15352 15353 obfs4prox debian-tor  mem       REG                8,1   177928     267663 /usr/lib/x86_64-linux-gnu/ld-2.31.so
obfs4prox 15352 15353 obfs4prox debian-tor    0r     FIFO               0,12      0t0     238331 pipe
obfs4prox 15352 15353 obfs4prox debian-tor    1w     FIFO               0,12      0t0     238332 pipe
obfs4prox 15352 15353 obfs4prox debian-tor    2w     FIFO               0,12      0t0     238333 pipe
obfs4prox 15352 15353 obfs4prox debian-tor    3w      REG                8,1      279    1314830 /var/lib/tor/pt_state/obfs4proxy.log
obfs4prox 15352 15353 obfs4prox debian-tor    4u  a_inode               0,13        0       8261 [eventpoll]
obfs4prox 15352 15353 obfs4prox debian-tor    5u     IPv4             237064      0t0        TCP localhost:41397 (LISTEN)
obfs4prox 15352 15353 obfs4prox debian-tor    6u     IPv4             237067      0t0        TCP localhost:41397-&gt;localhost:44970 (ESTABLISHED)
obfs4prox 15352 15353 obfs4prox debian-tor    7u     IPv4             234969      0t0        TCP debian:41908-&gt;152.199.19.160:https (ESTABLISHED)
</code></pre>
<p>and on Whonix I have:</p>
<pre><code>obfs4prox 6427 6428 obfs4prox debian-tor  cwd       DIR                8,1     4096          2 /
obfs4prox 6427 6428 obfs4prox debian-tor  rtd       DIR                8,1     4096          2 /
obfs4prox 6427 6428 obfs4prox debian-tor  txt       REG                8,1  5516056     133634 /usr/bin/obfs4proxy
obfs4prox 6427 6428 obfs4prox debian-tor  mem       REG                8,1  1839792     532341 /lib/x86_64-linux-gnu/libc-2.31.so
obfs4prox 6427 6428 obfs4prox debian-tor  mem       REG                8,1   149520     532352 /lib/x86_64-linux-gnu/libpthread-2.31.so
obfs4prox 6427 6428 obfs4prox debian-tor  mem       REG                8,1   177928     524957 /lib/x86_64-linux-gnu/ld-2.31.so
obfs4prox 6427 6428 obfs4prox debian-tor    0r     FIFO               0,12      0t0      80980 pipe
obfs4prox 6427 6428 obfs4prox debian-tor    1w     FIFO               0,12      0t0      80981 pipe
obfs4prox 6427 6428 obfs4prox debian-tor    2w     FIFO               0,12      0t0      80982 pipe
obfs4prox 6427 6428 obfs4prox debian-tor    3w      REG                8,1     5086    5506010 /var/lib/tor/pt_state/obfs4proxy.log
obfs4prox 6427 6428 obfs4prox debian-tor    4u  a_inode               0,13        0       8261 [eventpoll]
obfs4prox 6427 6428 obfs4prox debian-tor    5r     FIFO               0,12      0t0      79794 pipe
obfs4prox 6427 6428 obfs4prox debian-tor    6w     FIFO               0,12      0t0      79794 pipe
obfs4prox 6427 6428 obfs4prox debian-tor    7u     IPv4              79795      0t0        TCP localhost:41231 (LISTEN)
</code></pre>
<p>So the main difference is that on Debian I have at the end of each cycle:</p>
<pre><code>obfs4prox 15352 15353 obfs4prox debian-tor    5u     IPv4             237064      0t0        TCP localhost:41397 (LISTEN)
obfs4prox 15352 15353 obfs4prox debian-tor    6u     IPv4             237067      0t0        TCP localhost:41397-&gt;localhost:44970 (ESTABLISHED)
obfs4prox 15352 15353 obfs4prox debian-tor    7u     IPv4             234969      0t0        TCP debian:41908-&gt;152.199.19.160:https (ESTABLISHED)
</code></pre>
<p>while on Whonix I have only:</p>
<pre><code>obfs4prox 6427 6428 obfs4prox debian-tor    7u     IPv4              79795      0t0        TCP localhost:41231 (LISTEN)
</code></pre>
<p>without establishing a connection to another socket.</p>
<p>Indeed, giving <code>ss</code> command on Debian I have:</p>
<pre><code>tcp                  ESTAB                 0                     0                                                          127.0.0.1:44970                                        127.0.0.1:41397                 
tcp                  ESTAB                 0                     0                                                          127.0.0.1:41397                                        127.0.0.1:44970                 
tcp                  ESTAB                 0                     0                                                          10.0.2.15:45918                                   152.199.19.160:https 
</code></pre>
<p>Instead on Whonix I don’t have an output containing this similar information.</p>
<p>2nd UPDATE: I performed a test also on Kicksecure-XFCE-15.0.1.5.4 by inserting the rows related to meek-azure in <code>/etc/tor/torrc</code> and it works correctly as shown in the following logs:</p>
<pre><code>Apr 06 19:45:42 localhost.localdomain systemd[1]: Stopping Anonymizing overlay network for TCP...
Apr 06 19:45:42 localhost.localdomain Tor[493]: Interrupt: exiting cleanly.
Apr 06 19:45:42 localhost.localdomain systemd[1]: tor@default.service: Succeeded.
Apr 06 19:45:42 localhost.localdomain systemd[1]: Stopped Anonymizing overlay network for TCP.
Apr 06 19:45:42 localhost.localdomain systemd[1]: Starting Anonymizing overlay network for TCP...
Apr 06 19:45:42 localhost.localdomain tor[2717]: Apr 06 19:45:42.513 [notice] Tor 0.4.4.6 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 19:45:42 localhost.localdomain tor[2717]: Apr 06 19:45:42.513 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 19:45:42 localhost.localdomain tor[2717]: Apr 06 19:45:42.513 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 19:45:42 localhost.localdomain tor[2717]: Apr 06 19:45:42.513 [notice] Read configuration file "/etc/tor/torrc".
Apr 06 19:45:42 localhost.localdomain tor[2717]: Configuration was valid
Apr 06 19:45:42 localhost.localdomain tor[2718]: Apr 06 19:45:42.679 [notice] Tor 0.4.4.6 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 19:45:42 localhost.localdomain tor[2718]: Apr 06 19:45:42.679 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 19:45:42 localhost.localdomain tor[2718]: Apr 06 19:45:42.679 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 19:45:42 localhost.localdomain tor[2718]: Apr 06 19:45:42.679 [notice] Read configuration file "/etc/tor/torrc".
Apr 06 19:45:42 localhost.localdomain tor[2718]: Apr 06 19:45:42.682 [notice] Opening Socks listener on 127.0.0.1:9050
Apr 06 19:45:42 localhost.localdomain tor[2718]: Apr 06 19:45:42.682 [notice] Opened Socks listener on 127.0.0.1:9050
Apr 06 19:45:42 localhost.localdomain Tor[2718]: Tor 0.4.4.6 running on Linux with Libevent 2.1.8-stable, OpenSSL 1.1.1d, Zlib 1.2.11, Liblzma 5.2.4, and Libzstd 1.3.8.
Apr 06 19:45:42 localhost.localdomain Tor[2718]: Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Apr 06 19:45:42 localhost.localdomain Tor[2718]: Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Apr 06 19:45:42 localhost.localdomain Tor[2718]: Read configuration file "/etc/tor/torrc".
Apr 06 19:45:42 localhost.localdomain Tor[2718]: Opening Socks listener on 127.0.0.1:9050
Apr 06 19:45:42 localhost.localdomain Tor[2718]: Opened Socks listener on 127.0.0.1:9050
Apr 06 19:45:42 localhost.localdomain Tor[2718]: Bootstrapped 0% (starting): Starting
Apr 06 19:45:43 localhost.localdomain Tor[2718]: Starting with guard context "bridges"
Apr 06 19:45:43 localhost.localdomain Tor[2718]: Delaying directory fetches: No running bridges
Apr 06 19:45:43 localhost.localdomain Tor[2718]: Signaled readiness to systemd
Apr 06 19:45:43 localhost.localdomain systemd[1]: Started Anonymizing overlay network for TCP.
Apr 06 19:45:44 localhost.localdomain Tor[2718]: Opening Socks listener on /run/tor/socks
Apr 06 19:45:44 localhost.localdomain Tor[2718]: Opened Socks listener on /run/tor/socks
Apr 06 19:45:44 localhost.localdomain Tor[2718]: Opening Control listener on /run/tor/control
Apr 06 19:45:44 localhost.localdomain Tor[2718]: Opened Control listener on /run/tor/control
Apr 06 19:45:44 localhost.localdomain Tor[2718]: Bootstrapped 1% (conn_pt): Connecting to pluggable transport
Apr 06 19:45:44 localhost.localdomain Tor[2718]: Bootstrapped 2% (conn_done_pt): Connected to pluggable transport
Apr 06 19:45:44 localhost.localdomain Tor[2718]: Bootstrapped 10% (conn_done): Connected to a relay
Apr 06 19:45:48 localhost.localdomain Tor[2718]: Bootstrapped 14% (handshake): Handshaking with a relay
Apr 06 19:45:51 localhost.localdomain Tor[2718]: Bootstrapped 15% (handshake_done): Handshake with a relay done
Apr 06 19:45:51 localhost.localdomain Tor[2718]: Bootstrapped 20% (onehop_create): Establishing an encrypted directory connection
Apr 06 19:45:54 localhost.localdomain Tor[2718]: Bootstrapped 25% (requesting_status): Asking for networkstatus consensus
Apr 06 19:45:57 localhost.localdomain Tor[2718]: new bridge descriptor 'cymrubridge02' (fresh): $97700DFE9F483596DDA6264C4D7DF7641E1E39CE~cymrubridge02 at 0.0.2.0
Apr 06 19:45:57 localhost.localdomain Tor[2718]: Bootstrapped 75% (enough_dirinfo): Loaded enough directory info to build circuits
Apr 06 19:45:58 localhost.localdomain Tor[2718]: Bootstrapped 76% (ap_conn_pt): Connecting to pluggable transport to build circuits
Apr 06 19:45:58 localhost.localdomain Tor[2718]: Bootstrapped 77% (ap_conn_done_pt): Connected to pluggable transport to build circuits
Apr 06 19:45:58 localhost.localdomain Tor[2718]: Bootstrapped 85% (ap_conn_done): Connected to a relay to build circuits
Apr 06 19:46:02 localhost.localdomain Tor[2718]: Bootstrapped 89% (ap_handshake): Finishing handshake with a relay to build circuits
Apr 06 19:46:03 localhost.localdomain Tor[2718]: Bootstrapped 90% (ap_handshake_done): Handshake finished with a relay to build circuits
Apr 06 19:46:03 localhost.localdomain Tor[2718]: Bootstrapped 95% (circuit_create): Establishing a Tor circuit
Apr 06 19:46:15 localhost.localdomain Tor[2718]: Bootstrapped 100% (done): Done
</code></pre>
<p>Summarizing, meek-azure works correctly on Debian 10.9 and Kicksecure-XFCE-15.0.1.5.4, but not on Whonix Gateway (CLI and XFCE).</p>
<p>So the issue could be caused by a Whonix component. I tried also to access the whonix_firewall script (<code>/usr/bin/whonix_firewall</code>), commenting all the functions inside main(), renaming also its configuration files in the <code>/etc/whonix_firewall.d/</code> directory as .OLD. I also used <code>sudo service whonix-firewall stop</code> and <code>sudo service whonix-firewall-restart stop</code> commands but I get always the same error reported ath the beginning.</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/3</link>
        <pubDate>Tue, 06 Apr 2021 08:00:11 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-3</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Bl4ckJ4ck" data-post="1" data-topic="11383">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/bl4ckj4ck/40/2702_2.png" class="avatar"> Bl4ckJ4ck:</div>
<blockquote>
<p>Is it a known issue?</p>
</blockquote>
</aside>
<p>Previously, no.</p>
<p>Now confirmed.</p>
<p>Please help fixing this.</p>
<ol>
<li>“forget” about ACW</li>
<li>“forget” about Whonix</li>
<li>reproduce on Debian</li>
<li>use <a href="https://packages.debian.org/buster/obfs4proxy">https://packages.debian.org/buster/obfs4proxy</a>
</li>
<li>use <a href="https://packages.debian.org/buster/tor">https://packages.debian.org/buster/tor</a> or newer <code>tor</code> package from <a href="https://www.torproject.org/docs/debian">https://www.torproject.org/docs/debian</a>
</li>
<li>as per <a href="https://www.whonix.org/wiki/Free_Support_Principle">https://www.whonix.org/wiki/Free_Support_Principle</a>
</li>
<li>add to <code>/etc/tor/torrc</code>
</li>
</ol>
<pre><code class="lang-auto">UseBridges 1
ClientTransportPlugin meek_lite exec /usr/bin/obfs4proxy
bridge meek_lite 0.0.2.0:3 97700DFE9F483596DDA6264C4D7DF7641E1E39CE url=https://meek.azureedge.net/ front=ajax.aspnetcdn.com
</code></pre>
<p>Then figure out if you can fix the config somehow. If not, report bugs to Debian and/or Tor Project. Don’t mention Whonix. Keep Whonix out from reproduction. Otherwise upstream might say “Whonix issue, not our issue”.</p>
<p>More background:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Network_Obstacle" target="_blank" rel="noopener" title="10:06AM - 03 April 2021">Whonix – 3 Apr 21</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/55;"><img src="https://www.whonix.org/w/images/7/73/Networkobstacle123123455.png" class="thumbnail" width="110" height="55"></div>

<h3><a href="https://www.whonix.org/wiki/Network_Obstacle" target="_blank" rel="noopener">Network Obstacle</a></h3>

<p>Organizational background on Network Obstacles.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>If you figure out what to change, how to make it work in Debian, then very most likely I’ll be able to apply the same with ACW / Whonix.</p>
<aside class="quote no-group" data-username="Bl4ckJ4ck" data-post="1" data-topic="11383">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/bl4ckj4ck/40/2702_2.png" class="avatar"> Bl4ckJ4ck:</div>
<blockquote>
<p>sorry if I do not copy and paste directly the text</p>
</blockquote>
</aside>
<p>No problem.</p>
<aside class="quote no-group" data-username="Bl4ckJ4ck" data-post="1" data-topic="11383">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/bl4ckj4ck/40/2702_2.png" class="avatar"> Bl4ckJ4ck:</div>
<blockquote>
<p>copy and paste from the VM does not work, even though I installed the vbox addition guests</p>
</blockquote>
</aside>
<p>Expected. VirtualBox does not have that feature as far as I know. Works only when a desktop environment is running.</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/2</link>
        <pubDate>Mon, 05 Apr 2021 15:54:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-2</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
      <item>
        <title>Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</title>
        <dc:creator><![CDATA[Bl4ckJ4ck]]></dc:creator>
        <description><![CDATA[
            <p>Hello,<br>
I’m testing the bridge configuration starting from a fresh Whonix Gateway CLI and by using <code>startx</code> for executing <code>anon-connection-wizard</code>.</p>
<p>The “obfs4” transport type works correctly. The “meek-azure” transport type does not.<br>
Step by step is shown this small test:</p>
<p>The machine is connected to TOR:<br>
<img src="//forums.whonix.org/uploads/default/original/2X/d/d702d1a860d592adddbddf3ce633f288fada5c4d.png" alt="Tor_Status_CLI" data-base62-sha1="uG4H8ylVxBVnUii7BD497bliEJD" width="516" height="322"></p>
<p>The <code>50_user.conf</code> file is empty<br>
<img src="//forums.whonix.org/uploads/default/original/2X/f/f7fc64fd20fd01df5b20d31d4eead47c7f20eb9b.png" alt="50_user-conf_file_fresh" data-base62-sha1="znMGEgXkaaYp5OHLvSBPUdtEb8f" width="279" height="84"></p>
<p>I didn’t touch the <code>40_tor_control_panel.conf</code>.</p>
<p>Then I start the bridge configuration:<br>
</p><div class="lightbox-wrapper"><a class="lightbox" href="//forums.whonix.org/uploads/default/original/2X/7/7341d34f0c8b028455fd13f54aa972188f50e9ad.png" data-download-href="//forums.whonix.org/uploads/default/7341d34f0c8b028455fd13f54aa972188f50e9ad" title="Bridge_conf_meek-azure"><img src="//forums.whonix.org/uploads/default/original/2X/7/7341d34f0c8b028455fd13f54aa972188f50e9ad.png" alt="Bridge_conf_meek-azure" data-base62-sha1="grBWf94WYGOULmjqXt8xBDq60P3" width="690" height="497" data-small-upload="//forums.whonix.org/uploads/default/optimized/2X/7/7341d34f0c8b028455fd13f54aa972188f50e9ad_2_10x10.png"></a></div><p></p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="//forums.whonix.org/uploads/default/original/2X/e/e309c2ae1f86520d0d1261e0da2a8eaa2ad31673.png" data-download-href="//forums.whonix.org/uploads/default/e309c2ae1f86520d0d1261e0da2a8eaa2ad31673" title="noproxy"><img src="//forums.whonix.org/uploads/default/original/2X/e/e309c2ae1f86520d0d1261e0da2a8eaa2ad31673.png" alt="noproxy" data-base62-sha1="wotirARFxUtjECsbo50kbNQkcZZ" width="690" height="497" data-small-upload="//forums.whonix.org/uploads/default/optimized/2X/e/e309c2ae1f86520d0d1261e0da2a8eaa2ad31673_2_10x10.png"></a></div><p></p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="//forums.whonix.org/uploads/default/original/2X/6/6ce835107732f9aabdf8cee457265da8bc22e3c0.png" data-download-href="//forums.whonix.org/uploads/default/6ce835107732f9aabdf8cee457265da8bc22e3c0" title="summary_bridge"><img src="//forums.whonix.org/uploads/default/original/2X/6/6ce835107732f9aabdf8cee457265da8bc22e3c0.png" alt="summary_bridge" data-base62-sha1="fxr4fLiKADTYvta3PaES0anIu64" width="690" height="495" data-small-upload="//forums.whonix.org/uploads/default/optimized/2X/6/6ce835107732f9aabdf8cee457265da8bc22e3c0_2_10x10.png"></a></div><p></p>
<p>When I click on “Next”, the bootstrapping will freeze at 10%<br>
<img src="//forums.whonix.org/uploads/default/original/2X/b/b8054ae47240f48ea14060b12aa596693b9187f8.png" alt="error_bridge3" data-base62-sha1="qfVc0WNoPDGr8UlyD2JrvT3t6Kk" width="591" height="459"></p>
<p>and the messages produced by this process are:<br>
<img src="//forums.whonix.org/uploads/default/original/2X/e/efc580a5a905bd0762ad968e5610763a39172f3d.png" alt="error_bridge1" data-base62-sha1="yd7ghDdvxx2JaOtZhZhJnflXqgt" width="500" height="321"><br>
<img src="//forums.whonix.org/uploads/default/original/2X/3/31d220a70c08be891c8cf68e8b0db404b7f33231.png" alt="error_bridge2" data-base62-sha1="76JAIBARDF8RScaB5R5bGUBmaL7" width="494" height="323"></p>
<p>So the errors that are triggered continuosly while the progress bar stucks at 10% are these <code>"TLS_ERROR"</code> where about each second the <code>COUNT</code> variable increase by 1.</p>
<p>When I stop the bootstrapping, the content of the <code>40_tor_control_panel.conf</code> file is:<br>
<img src="//forums.whonix.org/uploads/default/original/2X/f/f8cd43e2b4e860c2e1fd7213d983d55aa5fda05a.png" alt="error_bridge4" data-base62-sha1="zv0bRj3ulOGMdjyzGavyMij0n8u" width="502" height="178"></p>
<p>Is it a known issue? Could be due to a TLS certificate error?</p>
<p>PS: sorry if I do not copy and paste directly the text but the copy and paste from the VM does not work, even though I installed the vbox addition guests by “upgrade-nonroot” command.</p>
          <p><a href="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383/1</link>
        <pubDate>Mon, 05 Apr 2021 02:13:41 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-11383-1</guid>
        <source url="http://forums.whonix.org/t/whonix-gateway-cli-15-0-1-5-4-meek-azure-bridge-tls-error/11383.rss">Whonix Gateway CLI-15.0.1.5.4 - meek-azure bridge &quot;TLS_ERROR&quot;</source>
      </item>
  </channel>
</rss>
