<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>authenticated onion service not working using old or new methods</title>
    <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110</link>
    <description>I found this thread that seemed to be a similar issue: http://forums.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/t/issues-with-onion-service-authentication/12205

It seems that entering the private keys via the browser in Whonix does not work? I would be happy to get the authorization working either way.

I recently upgraded to Qubes 4.1, after doing so the whonix gateway I was using for authenticated access would no longer boot. So I decided to start from scratch. After failing with the manual set up, I found out the setup now has automated scripts described here: http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup

The scripts are:

for the client: anon-server-to-client-install
for the host: anon-auth-autogen

However, using the scripts also failed to work for me. Instead of getting the pop up box asking for a private key it just gives me &quot;Unable to Connect&quot;.

In my old manual setup I had to edit /usr/local/etc/torrc.d50_user.conf to add:

     ClientAuthDir /var/lib/tor/authdir

The current docs make reference to this file:

&gt; After editing `/usr/local/etc/torrc.d/50_user.conf`, Tor must be reloaded for changes to take effect.
&gt; 
&gt; **Note:** If Tor does not connect after completing all these steps, then a user mistake is the most likely explanation. Recheck `/usr/local/etc/torrc.d/50_user.conf` and repeat the steps outlined in the sections above. If Tor then connects successfully, all the necessary changes have been made.

But there is nothing in the instructions about editing that file. So I tried adding the ClientAuthDir above. Then the browser gives me a different message &quot;The Connection Was Rest&quot; (instead of &quot;Unable to Connect&quot;). 

It seems the docs for the client set up is incorrect. And I&#39;m unable to get an authenticated connection via Tor Browser.</description>
    <language>en</language>
    <lastBuildDate>Mon, 31 Jan 2022 16:01:25 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>There are two options to setup Onion Service Client Authentication. Chose either option <strong>A)</strong> or <strong>B)</strong>.</p>
<ul>
<li>
<strong>A)</strong> <a href="https://www.whonix.org/wiki/Tor_Browser#Onion_Client_Authorization">Tor Browser Onion Client Authorization</a>, or</li>
<li>
<strong>B)</strong> <a href="https://www.whonix.org/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup">Onion Service Client Authentication setup on Whonix-Gateway ™</a>.</li>
</ul>
          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/8</link>
        <pubDate>Mon, 31 Jan 2022 16:01:25 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-8</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="mimp" data-post="6" data-topic="13110">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/47e85d/40.png" class="avatar"> mimp:</div>
<blockquote>
<p>The one thought I had was that I was not waiting long enough for changes to take place before testing?</p>
</blockquote>
</aside>
<p>Possibly. → <a href="https://www.whonix.org/wiki/Onion_Services#Onion_Services_Reliability_Issues">Onion Services Reliability Issues</a></p>
          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/7</link>
        <pubDate>Mon, 31 Jan 2022 15:56:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-7</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[mimp]]></dc:creator>
        <description><![CDATA[
            <p>Good to know. May try that some time.</p>
<p>I just got my authentication working again. What worked was restoring the gateway for the server from a backup. Creating a new gateway for the client by cloning sys-whonix-16. Copying authentication file from old client gateway to this new client gateway. Reloading tor on the gateway.</p>
<p>I never got it to work using the automated scripts.</p>
<p>I spent many hours just getting the above to work, with inconsistent results. The one thought I had was that I was not waiting long enough for changes to take place before testing? As a result I was not able to find any problems with the automated scripts or why they were not working for me. At this point I need to just keep the working setup I have. And if no one else has had problems with the scripts it may have just been user error in how I was testing.</p>
          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/6</link>
        <pubDate>Sun, 02 Jan 2022 15:53:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-6</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="60" data-topic="975">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar">
    <a href="https://forums.whonix.org/t/onion-services-authentication/975/60">Onion Services Authentication</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development/8"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of components looking for maintainer)">Development</span></a>
  </div>
  <blockquote>
    Tor Browser Onion Client Authorization in Whonix works for me. Just now documented: 
<a href="https://www.whonix.org/wiki/Tor_Browser#Onion_Client_Authorization">Onion Client Authorization</a>
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/5</link>
        <pubDate>Sun, 02 Jan 2022 11:52:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-5</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="mimp" data-post="3" data-topic="13110">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/47e85d/40.png" class="avatar"> mimp:</div>
<blockquote>
<p>Should the reference to 50_user.conf be removed from here then:<br>
<a href="http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup">http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup</a></p>
<p>Since that is no longer used here?</p>
</blockquote>
</aside>
<p>Yes. Done.</p>
          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/4</link>
        <pubDate>Fri, 31 Dec 2021 12:19:08 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-4</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[mimp]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="13110">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Getting authenticated Tor onion services to work outside of Whonix first might be helpful. (<a href="https://www.whonix.org/wiki/Reporting_Bugs#Generic_Bug_Reproduction" rel="noopener nofollow ugc">Generic Bug Reproduction</a>) That might give insights on what’s wrong with the automation scripts, if anything.</p>
</blockquote>
</aside>
<p>I do have it working. In fact, I restored my backup of old whonix gateway I was using to connect in Qubes 4.0.4 and I have it working again in Qubes Whonix (Qubes 4.1). [after testing stuff below this is no longer true <img src="//forums.whonix.org/images/emoji/twitter/frowning.png?v=9" title=":frowning:" class="emoji" alt=":frowning:">  But was using it successfully for a day or so. ]</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="2" data-topic="13110">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<aside class="quote no-group" data-username="mimp" data-post="1" data-topic="13110">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/47e85d/40.png" class="avatar"> mimp:</div>
<blockquote>
<p>It seems that entering the private keys via the browser in Whonix does not work?</p>
</blockquote>
</aside>
<p>That never worked.</p>
</blockquote>
</aside>
<p>OK, good to know, I’ve never used it either, but seemed potentially easier.</p>
<p>Should the reference to 50_user.conf be removed from here then:<br>
<a href="http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup" class="onebox" target="_blank" rel="noopener nofollow ugc">http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup</a></p>
<p>Since that is no longer used here?</p>
<hr>
<p>Here’s my attempts to test the automated scripts again, but in the end I just broke everything somehow.</p>
<p>on new gateway <em>anon-server-to-client-install</em> ended with “Success”.  When I use this as my gateway I still get the pop up in my browser asking for an authentication key.</p>
<p>So I compared my old working gateway to the new one.</p>
<p>old gw has /usr/local/etc/torrc.d/50_user.conf<br>
new gw has /usr/local/etc/torrc.d/43_clientonionauthdir.conf</p>
<p>both set the ClientOnionAuthDir</p>
<p>As you pointed out, new gw also has this in /etc/torrc.d/65_gateway.conf</p>
<p>All that seems equivalent.</p>
<p>Then I confirmed the *.auth_private files on each qube. The difference was that the old one had “.onion” at the end of the onion address. The new autogenerated key file did not have that.</p>
<p>I tried adding “.onion” to the file on the new gw to match the old one. Then I restarted tor on the new gw. But nothing changed, I still get the prompt for an authentication key in Tor Browser. I can’t figure out what the difference is that could be causing this.</p>
<p>However, then I restarted tor on the gateway to the server where the new public key was added. This led the authenticated connection to give an “Unable to Connect” response in Tor browser. Whereas another connection from an unauthenticated machine will bring up the popup asking for the authentication key.</p>
<p>I tried restoring gateways from backups again and am still getting “Unable to Connect” (when I was able to connect before starting this post). Unauthenticated connections will reach the site and prompt for authentication key still. Either way I cannot access the site anymore and am confused why my old working gateway stopped working when I did not alter it.</p>
          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/3</link>
        <pubDate>Thu, 30 Dec 2021 20:29:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-3</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Getting authenticated Tor onion services to work outside of Whonix first might be helpful. (<a href="https://www.whonix.org/wiki/Reporting_Bugs#Generic_Bug_Reproduction">Generic Bug Reproduction</a>) That might give insights on what’s wrong with the automation scripts, if anything.</p>
<aside class="quote no-group" data-username="mimp" data-post="1" data-topic="13110">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/47e85d/40.png" class="avatar"> mimp:</div>
<blockquote>
<p>It seems that entering the private keys via the browser in Whonix does not work?</p>
</blockquote>
</aside>
<p>That never worked.</p>
<aside class="quote no-group" data-username="mimp" data-post="1" data-topic="13110">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/47e85d/40.png" class="avatar"> mimp:</div>
<blockquote>
<p>In my old manual setup I had to edit /usr/local/etc/torrc.d50_user.conf to add:</p>
<pre><code class="lang-auto"> ClientAuthDir /var/lib/tor/authdir
</code></pre>
</blockquote>
</aside>
<p>It’s already here:</p>
<aside class="onebox githubblob">
  <header class="source">

      <a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/torrc.d/65_gateway.conf#L32-L39" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/torrc.d/65_gateway.conf#L32-L39" target="_blank" rel="noopener">Whonix/anon-gw-anonymizer-config/blob/master/etc/torrc.d/65_gateway.conf#L32-L39</a></h4>



  <pre class="onebox">    <code class="lang-conf">
      <ol class="start lines" start="32" style="counter-reset: li-counter 31 ;">
          <li>###################################</li>
          <li># Authenticated Onion v3 Services #</li>
          <li>###################################</li>
          <li>
          </li>
<li>## anon-gw-anonymizer-config.service /</li>
          <li>## /usr/libexec/anon-gw-anonymizer-config/make-sure-torrc-exist</li>
          <li>## creates folder /var/lib/tor/authdir</li>
          <li>ClientOnionAuthDir /var/lib/tor/authdir</li>
      </ol>
    </code>
  </pre>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>This might help:<br>
<a href="https://www.whonix.org/w/index.php?title=Tor&amp;stable=0#Troubleshooting">Troubleshooting</a></p>
          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/2</link>
        <pubDate>Wed, 29 Dec 2021 10:13:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-2</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
      <item>
        <title>authenticated onion service not working using old or new methods</title>
        <dc:creator><![CDATA[mimp]]></dc:creator>
        <description><![CDATA[
            <p>I found this thread that seemed to be a similar issue: <a href="http://forums.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/t/issues-with-onion-service-authentication/12205" rel="noopener nofollow ugc">http://forums.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/t/issues-with-onion-service-authentication/12205</a></p>
<p>It seems that entering the private keys via the browser in Whonix does not work? I would be happy to get the authorization working either way.</p>
<p>I recently upgraded to Qubes 4.1, after doing so the whonix gateway I was using for authenticated access would no longer boot. So I decided to start from scratch. After failing with the manual set up, I found out the setup now has automated scripts described here: <a href="http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup" rel="noopener nofollow ugc">http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Onion_Services#Onion_Service_Authentication_Client_Setup</a></p>
<p>The scripts are:</p>
<p>for the client: anon-server-to-client-install<br>
for the host: anon-auth-autogen</p>
<p>However, using the scripts also failed to work for me. Instead of getting the pop up box asking for a private key it just gives me “Unable to Connect”.</p>
<p>In my old manual setup I had to edit /usr/local/etc/torrc.d50_user.conf to add:</p>
<pre><code> ClientAuthDir /var/lib/tor/authdir
</code></pre>
<p>The current docs make reference to this file:</p>
<blockquote>
<p>After editing <code>/usr/local/etc/torrc.d/50_user.conf</code>, Tor must be reloaded for changes to take effect.</p>
<p><strong>Note:</strong> If Tor does not connect after completing all these steps, then a user mistake is the most likely explanation. Recheck <code>/usr/local/etc/torrc.d/50_user.conf</code> and repeat the steps outlined in the sections above. If Tor then connects successfully, all the necessary changes have been made.</p>
</blockquote>
<p>But there is nothing in the instructions about editing that file. So I tried adding the ClientAuthDir above. Then the browser gives me a different message “The Connection Was Rest” (instead of “Unable to Connect”).</p>
<p>It seems the docs for the client set up is incorrect. And I’m unable to get an authenticated connection via Tor Browser.</p>
          <p><a href="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110/1</link>
        <pubDate>Tue, 28 Dec 2021 21:19:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13110-1</guid>
        <source url="http://forums.whonix.org/t/authenticated-onion-service-not-working-using-old-or-new-methods/13110.rss">authenticated onion service not working using old or new methods</source>
      </item>
  </channel>
</rss>
