<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Permission Denied with Flatpak (/sys/block)</title>
    <link>http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781</link>
    <description>```
user@host:~$ flatpak run org.mozilla.firefox
bwrap: Can&#39;t find source path /sys/block: Permission denied
user@host:~$
```

Note: All these hardened features are enabled in my VM:

https://www.kicksecure.com/wiki/Test#New_Security_Features_Looking_for_Testers</description>
    <language>en</language>
    <lastBuildDate>Tue, 11 Oct 2022 23:27:59 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Permission Denied with Flatpak (/sys/block)</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>related feature:<br>
<a href="https://www.kicksecure.com/wiki/Security-misc#Reduce_Kernel_Information_Leaks">https://www.kicksecure.com/wiki/Security-misc#Reduce_Kernel_Information_Leaks</a></p>
<hr>
<p>flatpak requires <code>/sys/block</code> it. See this highlighted line:</p>
<aside class="onebox githubblob" data-onebox-src="https://github.com/flatpak/flatpak/blob/main/common/flatpak-run.c#L3529">
  <header class="source">

      <a href="https://github.com/flatpak/flatpak/blob/main/common/flatpak-run.c#L3529" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/flatpak/flatpak/blob/main/common/flatpak-run.c#L3529" target="_blank" rel="noopener">flatpak/flatpak/blob/main/common/flatpak-run.c#L3529</a></h4>



    <pre class="onebox">      <code class="lang-c">
        <ol class="start lines" start="3519" style="counter-reset: li-counter 3518 ;">
            <li>if (!(flags &amp; FLATPAK_RUN_FLAG_PARENT_SHARE_PIDS))</li>
            <li>  flatpak_bwrap_add_arg (bwrap, "--unshare-pid");</li>
            <li>
            </li>
<li>flatpak_bwrap_add_args (bwrap,</li>
            <li>                        "--dir", "/tmp",</li>
            <li>                        "--dir", "/var/tmp",</li>
            <li>                        "--dir", "/run/host",</li>
            <li>                        "--perms", "0700", "--dir", run_dir,</li>
            <li>                        "--setenv", "XDG_RUNTIME_DIR", run_dir,</li>
            <li>                        "--symlink", "../run", "/var/run",</li>
            <li class="selected">                        "--ro-bind", "/sys/block", "/sys/block",</li>
            <li>                        "--ro-bind", "/sys/bus", "/sys/bus",</li>
            <li>                        "--ro-bind", "/sys/class", "/sys/class",</li>
            <li>                        "--ro-bind", "/sys/dev", "/sys/dev",</li>
            <li>                        "--ro-bind", "/sys/devices", "/sys/devices",</li>
            <li>                        "--ro-bind-try", "/proc/self/ns/user", "/run/.userns",</li>
            <li>                        /* glib uses this like /etc/timezone */</li>
            <li>                        "--symlink", "/etc/timezone", "/var/db/zoneinfo",</li>
            <li>                        NULL);</li>
            <li>
            </li>
<li>if (flags &amp; FLATPAK_RUN_FLAG_DIE_WITH_PARENT)</li>
        </ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>reported upstream:</p>
<aside class="onebox githubissue" data-onebox-src="https://github.com/flatpak/flatpak/issues/5138">
  <header class="source">

      <a href="https://github.com/flatpak/flatpak/issues/5138" target="_blank" rel="noopener">github.com/flatpak/flatpak</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/flatpak/flatpak/issues/5138" target="_blank" rel="noopener">flatpak shouldn't permit unconditional access to `/sys/block` with bwrap for better security</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-10-11" data-time="23:21:37" data-timezone="UTC">11:21PM - 11 Oct 22 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          bug
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">### Checklist

- [X] I agree to follow the [Code of Conduct](https://github.com/<span class="show-more-container"><a href="http://forums.whonix.org" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">flatpak/flatpak/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.
- [X] I have searched the [issue tracker](https://www.github.com/flatpak/flatpak/issues) for a bug that matches the one I want to file, without success.
- [X] If this is an issue with a particular app, I have tried filing it in the appropriate issue tracker for the app (e.g. under https://github.com/flathub/) and determined that it is an issue with Flatpak itself.
- [X] This issue is not a report of a security vulnerability (see [here](https://github.com/flatpak/flatpak/blob/main/SECURITY.md) if you need to report a security issue).

### Flatpak version

1.10.7

### What Linux distribution are you using?

Debian

### Linux distribution version

bullseye

### What architecture are you using?

x86_64

### How to reproduce

1. flatpak while access to `/sys/block` is restricted to root ([`/lib/systemd/system/hide-hardware-info.service`](https://github.com/Kicksecure/security-misc/blob/master/lib/systemd/system/hide-hardware-info.service))
2. run flatpak

### Expected Behavior

flatpak shouldn't unconditionally need access to `/sys/block` because that's dangerous for security.

### Actual Behavior

flatpak hardcoded, requires access to `/sys/block`.

    flatpak run org.mozilla.firefox                                                               

&gt; bwrap: Can't find source path /sys/block: Permission denied

### Additional Information

flatpak in https://github.com/flatpak/flatpak/blob/main/common/flatpak-run.c#L3529 uses:

&gt;                          "--ro-bind", "/sys/block", "/sys/block",

What's the purpose of this?

It's the block devices.

    ls /sys/block

&gt; xvda  xvdb  xvdc  xvdd

I don't see why flatpak needs access to these?</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<hr>
<p>workaround:<br>
<a href="https://www.kicksecure.com/wiki/Security-misc#Whitelisting_Applications">https://www.kicksecure.com/wiki/Security-misc#Whitelisting_Applications</a></p>
          <p><a href="http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781/2</link>
        <pubDate>Tue, 11 Oct 2022 23:27:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15781-2</guid>
        <source url="http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781.rss">Permission Denied with Flatpak (/sys/block)</source>
      </item>
      <item>
        <title>Permission Denied with Flatpak (/sys/block)</title>
        <dc:creator><![CDATA[TNT_BOM_BOM]]></dc:creator>
        <description><![CDATA[
            <pre><code class="lang-auto">user@host:~$ flatpak run org.mozilla.firefox
bwrap: Can't find source path /sys/block: Permission denied
user@host:~$
</code></pre>
<p>Note: All these hardened features are enabled in my VM:</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.kicksecure.com/wiki/Test#New_Security_Features_Looking_for_Testers">
  <header class="source">
      <img src="https://www.kicksecure.com/w/images/4/45/Kicksecure-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="https://www.kicksecure.com/wiki/Test#New_Security_Features_Looking_for_Testers" target="_blank" rel="noopener nofollow ugc" title="07:41PM - 13 August 2022">Kicksecure – 13 Aug 22</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:437/500;"><img src="https://www.kicksecure.com/w/images/c/ca/Wanted12312412.jpg?version=704cca23975f777025ba4c01fbabc001" class="thumbnail" width="437" height="500"></div>

<h3><a href="https://www.kicksecure.com/wiki/Test#New_Security_Features_Looking_for_Testers" target="_blank" rel="noopener nofollow ugc">Testers Wanted!</a></h3>

  <p>New Security Features Looking for Testers</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781/1</link>
        <pubDate>Sun, 09 Oct 2022 14:06:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15781-1</guid>
        <source url="http://forums.whonix.org/t/permission-denied-with-flatpak-sys-block/15781.rss">Permission Denied with Flatpak (/sys/block)</source>
      </item>
  </channel>
</rss>
