<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>apt-get DNS Bypasses apt.conf Proxy Settings - Development - Whonix Forum</title>
    <meta name="description" content="[moved post to correct sequence]">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="5256.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;apt-get DNS Bypasses apt.conf Proxy Settings&#39;" href="5256.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/apt-get-dns-bypasses-apt-conf-proxy-settings/5256" />
<meta name="twitter:url" content="https://forums.whonix.org/t/apt-get-dns-bypasses-apt-conf-proxy-settings/5256" />
<meta property="og:title" content="apt-get DNS Bypasses apt.conf Proxy Settings" />
<meta name="twitter:title" content="apt-get DNS Bypasses apt.conf Proxy Settings" />
<meta property="og:description" content="[moved post to correct sequence]" />
<meta name="twitter:description" content="[moved post to correct sequence]" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="6 ❤" />
<meta property="article:published_time" content="2018-05-22T17:59:46+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="5256.html">apt-get DNS Bypasses apt.conf Proxy Settings</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-22T17:59:46Z' class='post-time'>
                May 22, 2018,  5:59pm
              </time>
              <meta itemprop='dateModified' content='2018-05-22T19:05:55Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>[moved post to correct sequence]</p>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-19T03:52:33Z' class='post-time'>
                May 19, 2018,  3:52am
              </time>
              <meta itemprop='dateModified' content='2018-05-19T04:21:48Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Finally getting back to testing here. I plan on reading through the <a href="../qubes-whonix-14-0-0-6-9-templatevms-for-r3-2-and-r4-testers-wanted/4988.html">Qubes-Whonix testing thread</a> tomorrow, so my comment may have been addressed already.</p>
<ol>
<li>Downloaded and cloned lastest whonix-gw-14 template manually on Qubes 3.2.</li>
<li>Attached template to existing sys-whonix-13 proxyVM.</li>
<li>Ran apt-get update.</li>
</ol>
<ul>
<li>Initial traffic is DROPPED by sys-whonix-13. LOG reveals destination IP: sys-whonix-13 &amp; port: 53</li>
<li>Eventually times out. apt-get then sends traffic to tinyproxy on 10.*.255.254:8082 and completes successfully</li>
</ul>
<p>Not sure why apt-get is requesting a standard DNS lookup when apt.conf.d/01qubes-proxy is configured to use tinyproxy.</p>
<p>(same is true for apt, per OP, as well as apt-get)</p>
<p>Forgot to mention: Port 53 dropped because Workstation Transparent DNS disabled on my Gateway. Do you have that set also <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/kuruu">@kuruu</a>?</p>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-19T07:15:00Z' class='post-time'>
                May 19, 2018,  7:15am
              </time>
              <meta itemprop='dateModified' content='2018-05-19T07:15:00Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Btw mixing 13 and 14 will be unsupported.</p>
<p>entr0py:&gt; Finally getting back to testing here. I plan on reading<br>
through the <a href="../qubes-whonix-14-0-0-6-9-templatevms-for-r3-2-and-r4-testers-wanted/4988.html">Qubes-Whonix testing<br>
thread</a><br>
tomorrow, so my comment may have been addressed already.&gt;</p>
<blockquote>
<ol>
<li>Downloaded and cloned lastest whonix-gw-14 template manually on Qubes 3.2.</li>
<li>Attached template to existing sys-whonix-13 proxyVM.</li>
<li>Ran apt-get update.</li>
</ol>
<ul>
<li>Initial traffic is DROPPED by sys-whonix-13. LOG reveals destination IP: sys-whonix-13 &amp; port: 53</li>
<li>Eventually times out. apt-get then sends traffic to tinyproxy on 10.*.255.254:8082 and completes successfully</li>
</ul>
<p>Not sure why apt-get is requesting a standard DNS lookup when apt.conf.d/01qubes-proxy is configured to use tinyproxy.</p>
</blockquote>
<p>Do you have the dom0 settings?</p>
<ul>
<li><a href="../../../external.html?link=https://www.whonix.org/wiki/Dev/Qubes#Qubes_R4">https://www.whonix.org/wiki/Dev/Qubes#Qubes_R4</a></li>
<li><a href="../../../external.html?link=https://www.whonix.org/wiki/Dev/Qubes#anon-vm_tag">https://www.whonix.org/wiki/Dev/Qubes#anon-vm_tag</a></li>
</ul>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-20T19:43:26Z' class='post-time'>
                May 20, 2018,  7:43pm
              </time>
              <meta itemprop='dateModified' content='2018-05-21T18:29:43Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="7" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Do you have the dom0 settings?</p>
</blockquote>
</aside>
<p>I suspect this is not a Qubes or Whonix issue. It appears to be an apt-get DNS leak (by design?).</p>
<p>apt-get performs DNS lookup [using system resolver] for every repository entry (including http, onion, and even numeric IPs) [regardless of whether or not a proxy is configured for that particular host].</p>
<p>This may be expected behavior because Acquire::http::Proxy can be configured per host. Also, http may be proxied while other apt-transports are not. In these cases, it would be desirable to have local DNS resolution. It seems the only way to block DNS requests for our use case would be to establish complex rules.</p>
<p>This was not an issue in the past because uwt tunneled all apt-get traffic over SocksPort. Even now, users with Transparent DNS enabled will not notice - but seems rather sloppy behavior for core Whonix components to be polluting Transparent Ports.</p>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-21T01:30:01Z' class='post-time'>
                May 21, 2018,  1:30am
              </time>
              <meta itemprop='dateModified' content='2018-05-21T01:30:01Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><code>tinyproxy</code> recently (Feb 2018) added SOCKS support (<a href="../../../external.html?link=https://github.com/tinyproxy/tinyproxy/pull/64">https://github.com/tinyproxy/tinyproxy/pull/64</a>). Wonder if it’s possible to keep apt-get’s old uwt wrapper and just direct it to qubes-update-proxy?</p>
<p>(github question: how can I tell which version of tinyproxy contains that merge? it went into master but I don’t see any associated label, tag, release.) edit: nvm, there hasn’t been a release since Jan 2016.</p>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-21T17:11:00Z' class='post-time'>
                May 21, 2018,  5:11pm
              </time>
              <meta itemprop='dateModified' content='2018-05-21T17:11:00Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I am failing to understand this still but this may be important.</p>
<p>entr0py:</p>
<blockquote>
<aside class="quote" data-post="7" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Do you have the dom0 settings?</p>
</blockquote>
</aside>
<p>I suspect this is not a Qubes or Whonix issue. It appears to be an apt-get DNS leak (by design?).</p>
<p>apt-get performs DNS lookup for every repository entry (including http, onion, and even numeric IPs).</p>
</blockquote>
<p>Of course apt-get performs DNS lookup. apt-get knows nothing about Tor,<br>
Whonix, etc. We just need to make sure the DNS lookup is done by<br>
Whonix-Gateway through Tor. apt-get does DNS lookup like any application.</p>
<blockquote>
<p>This may be expected behavior because Acquire::http::Proxy can be configured per host. Also, http may be proxied while other apt-transports are not. In these cases, it would be desirable to have local DNS resolution.</p>
</blockquote>
<blockquote>
<p>It seems the only way to block DNS requests for our use case would be to establish complex rules.</p>
</blockquote>
<p>There is no DNS connectivity in Qubes-Whonix templates by default. So<br>
all DNS requests are filtered anyhow. More so in Qubes R4 since<br>
Qubes-Whonix TemplateVM’s NetVM is set to <code>none</code>.</p>
<p>Do you mean there is a non-Whonix / non-Qubes specific apt-get bug that<br>
it ignores proxy settings and makes system default DNS (“clearnet”)<br>
requests?</p>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-21T18:48:51Z' class='post-time'>
                May 21, 2018,  6:48pm
              </time>
              <meta itemprop='dateModified' content='2018-05-21T18:48:51Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="11" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I am failing to understand this still but this may be important.</p>
</blockquote>
</aside>
<p>rewrite:</p>
<aside class="quote" data-post="9" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>apt-get performs DNS lookup [using system resolver] for every repository entry (including http, onion, and even numeric IPs) [regardless of whether or not a proxy is configured for that particular host using apt.conf].</p>
</blockquote>
</aside>
<aside class="quote" data-post="11" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Do you mean there is a non-Whonix / non-Qubes specific apt-get bug that it ignores proxy settings and makes system default DNS (“clearnet”) requests?</p>
</blockquote>
</aside>
<p>This. apt-get leaks and whonix cleans up the mess as expected. Still trying to decide whether it’s a bug or expected behavior in apt-get. We would prefer this logic:</p>
<ol>
<li>check if proxy is configured for host</li>
<li>use proxy to resolve dns</li>
</ol>
<p>apt-get:</p>
<ol>
<li>resolve dns first</li>
<li>check if proxy is configured</li>
</ol>
<p>apt-get’s implementation may be correct since dns resolution may be required to check blocked hosts, configured proxies, etc.</p>
<aside class="quote" data-post="11" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>There is no DNS connectivity in Qubes-Whonix templates by default.</p>
</blockquote>
</aside>
<p>So that solves the issue for templates. Running apt-get in appVMs will leak DNS queries through WORKSTATION_TRANSPARENT_DNS. Not ideal but not a big issue.</p>
<p>Reinforces what we’ve known all along: Never trust application proxy settings! I’ve been testing vscode with stream isolation using its command line proxy settings. Has behaved well for a long time. Fetches extensions through the proxy but then, when extension needs downloads - it ignores proxy settings. Every program should use uwt.</p>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-22T02:11:00Z' class='post-time'>
                May 22, 2018,  2:11am
              </time>
              <meta itemprop='dateModified' content='2018-05-22T02:11:00Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>entr0py:</p>
<blockquote>
<aside class="quote" data-post="11" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I am failing to understand this still but this may be important.</p>
</blockquote>
</aside>
<p>rewrite:</p>
<aside class="quote" data-post="9" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>apt-get performs DNS lookup [using system resolver] for every repository entry (including http, onion, and even numeric IPs) [regardless of whether or not a proxy is configured for that particular host using apt.conf].</p>
</blockquote>
</aside>
</blockquote>
<p>I see.</p>
<blockquote>
<aside class="quote" data-post="11" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Do you mean there is a non-Whonix / non-Qubes specific apt-get bug that it ignores proxy settings and makes system default DNS (“clearnet”) requests?</p>
</blockquote>
</aside>
<p>This. apt-get leaks and whonix cleans up the mess as expected.</p>
</blockquote>
<p>Phew. At least no Whonix leak bug found.</p>
<blockquote>
<p>Still trying to decide whether it’s a bug or expected behavior in apt-get. We would prefer this logic:</p>
<ol>
<li>check if proxy is configured for host</li>
<li>use proxy to resolve dns</li>
</ol>
<p>apt-get:</p>
<ol>
<li>resolve dns first</li>
<li>check if proxy is configured</li>
</ol>
</blockquote>
<p>Very much agreed!</p>
<blockquote>
<p>apt-get’s implementation may be correct since dns resolution may be required to check blocked hosts, configured proxies, etc.</p>
</blockquote>
<p>I guess that would be a big surprise, violating principle of least<br>
surprise. Should at very least be clearly documented. I guess if so,<br>
would be considered an apt-get bug.</p>
<blockquote>
<aside class="quote" data-post="11" data-topic="5236">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>There is no DNS connectivity in Qubes-Whonix templates by default.</p>
</blockquote>
</aside>
<p>So that solves the issue for templates. Running apt-get in appVMs will leak DNS queries through WORKSTATION_TRANSPARENT_DNS.</p>
</blockquote>
<p>Shouldn’t. [*] Does it?</p>
<ul>
<li>
<p>In Whonix TemplateBasedVMs, uwt is being used.</p>
</li>
<li>
<p>Only Whonix TemplateVMs use proxy settings (so Qubes UpdatesProxy<br>
mechanism gets used), but also in Whonix TemplateVMs NetVM is set to<br>
<code>none</code> by default.</p>
</li>
</ul>
<blockquote>
<p>Not ideal but not a big issue.</p>
</blockquote>
<p>If so: Really wouldn’t be ideal.</p>
<blockquote>
<p>Reinforces what we’ve known all along: Never trust application proxy settings!</p>
</blockquote>
<p>Agreed.</p>
<blockquote>
<p>I’ve been testing vscode with stream isolation using its command line proxy settings.</p>
</blockquote>
<p>Nice!</p>
<blockquote>
<p>Every program should use uwt.</p>
</blockquote>
<p>[*] Since uwt is based on torsocks, it’s not bulletproof either. Not<br>
even close.</p>
<aside class="quote" data-post="1" data-topic="4840">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar">
    <a href="../managing-programs-without-tor-dns-support-orjail/4840/13.html">Managing programs without Tor DNS Support</a> <a class="badge-wrapper  bullet" href="../../c/development/8.html"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    Summary way forward: 
As uwt/torsocks replacement… 
Run application either 
a) under its own linux user name (problematic linux access rights) OR 
b) under its own linux network namespace (strongly preferred) 
then redirect to pre-configured Tor TransPorts or DnsPorts. 
(Similar to how we currently pre-configure multiple Tor SocksPorts currently.)
  </blockquote>
</aside>

        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="5256.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-05-22T19:02:23Z' class='post-time'>
                May 22, 2018,  7:02pm
              </time>
              <meta itemprop='dateModified' content='2018-05-22T19:02:23Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> I will follow up with debian/apt (re: bug vs expected). There is nothing to do for Whonix / Qubes. (Haven’t tested yet, but if TemplateBasedVMs are using uwt, I don’t anticipate any issues - haven’t had any to date in W13).</p>
<p>Actually… this is a non-issue for Qubes 4 but it still affects Qubes 3.2 &amp; non-Qubes-Whonix(?). (Only <em>noticeable</em> for users with WORKSTATION_TRANSPARENT_DNS=0.)</p>
<p>Will update after hearing from upstream.</p>
        </div>

        <meta itemprop='headline' content='apt-get DNS Bypasses apt.conf Proxy Settings'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
