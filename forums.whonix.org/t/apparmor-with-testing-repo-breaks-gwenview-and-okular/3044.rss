<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
    <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044</link>
    <description>I&#39;m using AppArmor with the Testing Repo as per the Whonix wiki.

https://www.whonix.org/wiki/AppArmor#Installation

Gwenview and Okular can be opened no problem, but AppArmor blocks the programs from opening images. I&#39;ve tested it a bit and I have found that the only way to view images with these programs is to transfer the image to the desktop. If the image file is on the desktop, it can be opened. However, if the images are in a directory on the desktop, they cannot be opened. 

How to reproduce:

Install KVM Whonix with Testing Repo and AppArmor as described in the wiki. Download any image with Tor Browser to Tor Browser&#39;s downloads directory. Try to open the image with Okular or Gwenview. It fails with an AppArmor notification appearing. Now try transferring the image to the desktop and opening it. It works. Now create a directory on the desktop and transfer the image to that. Try opening it. It fails.

I imagine that this is a bug, right? 

I&#39;ve personally just disabled the AppArmor profiles for Gwenview and Okular, since I have no idea how to edit profiles.</description>
    <language>en</language>
    <lastBuildDate>Thu, 13 Oct 2016 16:01:00 +0000</lastBuildDate>
    <category>AppArmor</category>
    <atom:link href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="10" data-topic="3044">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>Yes. [I keep data on non-networked VMs but that’s probably not how a new user would start out.]</p>
</blockquote>
</aside>
<p>That is much better indeed.</p>
<aside class="quote" data-post="10" data-topic="3044">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/e/8dc957/40.png" class="avatar"> entr0py:</div>
<blockquote>
<p>Ok, so… what should we use to view our interesting documents? <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
</blockquote>
</aside>
<p>Let’s say it’s for example simple text files (lower attack surface) (probably no attack surface when self-written), then you just open them with your favorite text editor. Better to have them in a folder where higher attack surface applications such as an image viewer (gwenview) or a pdf reader (okular) have read access.</p>
<hr>
<p>Could you please git pull request / wiki edit your suggestions?</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/11</link>
        <pubDate>Thu, 13 Oct 2016 16:01:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-11</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[entr0py]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="9" data-topic="3044">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Wondering if we should refactor this so they are on par with respect to<br>
which folders they can read… I.e. allow the same folders.</p>
</blockquote>
</aside>
<p>Makes sense. All of the pre-installed network-enabled document viewers should have same access:<br>
tor-browser (already has user-download)<br>
gwenview<br>
okular<br>
vlc (to be completed)</p>
<aside class="quote" data-post="9" data-topic="3044">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Try to imagine what a compromised okular / gwenview could do. If it can<br>
read all of the home folder, it can leak all home folder contents to the<br>
internet. Not great.</p>
</blockquote>
</aside>
<p>Yes. [I keep data on non-networked VMs but that’s probably not how a new user would start out.]</p>
<aside class="quote" data-post="9" data-topic="3044">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>So if we go through the usability hassle of using<br>
apparmor, I think it is better to restrict it to a few folders probably<br>
not holding long term interesting documents.</p>
</blockquote>
</aside>
<p>Ok, so… what should we use to view our interesting documents? <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Would need documentation explaining that documents need to be copied to the Downloads or Desktop directory for viewing/editing. And that important documents should not be stored in those directories.</p>
<aside class="quote" data-post="9" data-topic="3044">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I am not sure about read / write. Anything useful okular / gwenview<br>
could write? I sometimes use gwenview to rotate images, I guess that<br>
gets stored inside the image.</p>
</blockquote>
</aside>
<p>tags, orientation, crop/resize, plus whatever plugins do… Write is probably needed.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/10</link>
        <pubDate>Thu, 13 Oct 2016 03:43:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-10</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Wondering if we should refactor this so they are on par with respect to<br>
which folders they can read… I.e. allow the same folders.</p>
<p>Try to imagine what a compromised okular / gwenview could do. If it can<br>
read all of the home folder, it can leak all home folder contents to the<br>
internet. Not great. So if we go through the usability hassle of using<br>
apparmor, I think it is better to restrict it to a few folders probably<br>
not holding long term interesting documents.</p>
<p>What about both using abstractions/user-download?</p>
<p>I am not sure about read / write. Anything useful okular / gwenview<br>
could write? I sometimes use gwenview to rotate images, I guess that<br>
gets stored inside the image.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/9</link>
        <pubDate>Wed, 12 Oct 2016 23:59:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-9</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[entr0py]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="7" data-topic="3044" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>gwenview whitelists other folders than okular btw.</p>
</blockquote>
</aside>
<p>Ah, right. Looks like okular uses abstractions/user-download which seems unneccessarily strict from a usability point-of-view.</p>
<p><span class="bbcode-s">My own solution was this:</span></p>
<pre><code>  ## Read-access to any non-dot file in /home/user/
  ## not contained in a /home/user/dot directory or private-files-strict

  #include &lt;abstractions/private-files-strict&gt;
  @{HOME}/ r,
  @{HOME}/[a-z,A-Z,0-9]* r,
  @{HOME}/[a-z,A-Z,0-9]*/ r,
  @{HOME}/[a-z,A-Z,0-9]*/** r,
</code></pre>
<p><span class="bbcode-s">YMMV: I only use gwenview and okular as viewers, not editors (no write permissions).</span></p>
<p>EDIT: Don’t do this. See below.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/8</link>
        <pubDate>Wed, 12 Oct 2016 23:36:11 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-8</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>gwenview whitelists other folders than okular btw.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/7</link>
        <pubDate>Wed, 12 Oct 2016 20:18:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-7</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[entr0py]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="1" data-topic="3044">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/w/a183cd/40.png" class="avatar"> whtest4321:</div>
<blockquote>
<p>If the image file is on the desktop, it can be opened. However, if the images are in a directory on the desktop, they cannot be opened.</p>
</blockquote>
</aside>
<p>Strange. You should not be able to open images in /home/user/Desktop either. Did you make changes to your profile? Not being able to open images in subdirectories of Desktop is expected.</p>
<p>Here is the relevant section of the gwenview profile (/etc/apparmor.d/usr.bin.gwenview):</p>
<pre><code>  # user files
  @{HOME}/ r,
  @{HOME}/* r,
  @{HOME}/Documents/ r,
  @{HOME}/Documents/** rw,
  @{HOME}/Downloads/ r,
  @{HOME}/Downloads/** rw,
  @{HOME}/Pictures/ r,
  @{HOME}/Pictures/** rw,
</code></pre>
<p>You have 2 choices:</p>
<ol>
<li>
<p>Keep images in Documents, Downloads, Pictures or their subdirectories.</p>
</li>
<li>
<p>Add the following 2 lines to /etc/apparmor.d/usr.bin.gwenview:</p>
<p><code>@{HOME}/Desktop/ r, @{HOME}/Desktop/** rw,</code></p>
</li>
</ol>
<p>Reload profile: <code>sudo apparmor_parser --replace /etc/apparmor.d/usr/bin/gwenview</code></p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/6</link>
        <pubDate>Wed, 12 Oct 2016 18:21:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-6</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This is expected because these applications are restricted to be able to<br>
access only folders they have business in. Not all folders.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/5</link>
        <pubDate>Wed, 12 Oct 2016 13:51:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-5</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>whtest4321:</p>
<blockquote>
<p>I do not have this problem on Qubes Whonix which I also use with Testing Repo.</p>
</blockquote>
<p>Because it does not have apparmor enabled by default.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/4</link>
        <pubDate>Wed, 12 Oct 2016 13:49:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-4</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[whtest4321]]></dc:creator>
        <description><![CDATA[
            <p>Okay, no problem. I thought it would be best to place it in KVM forum because I do not have this problem on Qubes Whonix which I also use with Testing Repo.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/3</link>
        <pubDate>Wed, 12 Oct 2016 13:22:26 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-3</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for testing however I’ll move this to the Apparmor sub-forum where it makes more sense. I understand you are using KVM Whonix however these bugs don’t really have anything to do with the choice of hypervisor.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/2</link>
        <pubDate>Wed, 12 Oct 2016 13:19:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-2</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
      <item>
        <title>AppArmor with Testing Repo breaks Gwenview and Okular</title>
        <dc:creator><![CDATA[whtest4321]]></dc:creator>
        <description><![CDATA[
            <p>I’m using AppArmor with the Testing Repo as per the Whonix wiki.</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/AppArmor#Installation" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:640/480;"><img src="https://www.whonix.org/w/images/f/f1/Coat-of-mail-948960640.jpg" class="thumbnail"></div>

<h3><a href="https://www.whonix.org/wiki/AppArmor#Installation" target="_blank" rel="nofollow noopener">AppArmor</a></h3>

<p>AppArmor profiles (Security Hardening) for Whonix and other Linux distributions.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Gwenview and Okular can be opened no problem, but AppArmor blocks the programs from opening images. I’ve tested it a bit and I have found that the only way to view images with these programs is to transfer the image to the desktop. If the image file is on the desktop, it can be opened. However, if the images are in a directory on the desktop, they cannot be opened.</p>
<p>How to reproduce:</p>
<p>Install KVM Whonix with Testing Repo and AppArmor as described in the wiki. Download any image with Tor Browser to Tor Browser’s downloads directory. Try to open the image with Okular or Gwenview. It fails with an AppArmor notification appearing. Now try transferring the image to the desktop and opening it. It works. Now create a directory on the desktop and transfer the image to that. Try opening it. It fails.</p>
<p>I imagine that this is a bug, right?</p>
<p>I’ve personally just disabled the AppArmor profiles for Gwenview and Okular, since I have no idea how to edit profiles.</p>
          <p><a href="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044/1</link>
        <pubDate>Wed, 12 Oct 2016 13:16:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-3044-1</guid>
        <source url="http://forums.whonix.org/t/apparmor-with-testing-repo-breaks-gwenview-and-okular/3044.rss">AppArmor with Testing Repo breaks Gwenview and Okular</source>
      </item>
  </channel>
</rss>
