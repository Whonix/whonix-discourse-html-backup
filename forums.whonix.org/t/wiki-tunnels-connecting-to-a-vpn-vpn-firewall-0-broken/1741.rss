<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
    <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741</link>
    <description>From [Template:Firewall_Settings](https://www.whonix.org/wiki/Template:Firewall_Settings):
``&gt; sudo nano /etc/whonix_firewall.d/50_user.conf


Content duplicated at both [Connecting_to_a_VPN_before_Tor](https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor) and [Using_Tunnels_with_Whonix](https://www.whonix.org/wiki/Using_Tunnels_with_Whonix):
``&gt; 2. Add the following settings. ...
``&gt; ###########################
``&gt; ## VPN-Firewall Settings ##
``&gt; ###########################

``- de-dup content by making it into a wiki template section as [Template:Firewall_Settings](https://www.whonix.org/wiki/Template:Firewall_Settings) is?


Having made a 50_user.conf file as per wiki / text contents, with the following (active content) changed / lines:
``VPN_FIREWALL=0
``VPN_SERVERS=&quot;198.252.153.26&quot;
``VPN_INTERFACE=tun0
``; LOCAL_NET=&quot;192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24&quot;

... result ... no -gateway network / tor at reboot.

Move file up a level temporarily, reboot, network / tor functional again.

Apparently
``&gt; VPN_FIREWALL=0
isn&#39;t being adhered to, despite wiki article&#39;s comments indicating 0 = disable vpn firewall. i.e. Same default as if not set / file not present.

``- feels like a bug.

Note:
``VPN_SERVERS=&quot;198.252.153.26&quot;
``VPN_INTERFACE=tun0
``- left unchanged from wiki text. Since VPN_FIREWALL=0 set, settings weren&#39;t expected to be adhered to / impact anything.

``; LOCAL_NET=&quot;192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24&quot;
``- is the wiki text with a comment `(;)` character in front.

Could the wiki text be updated to indicate that &#39;;&#39; is/n&#39;t (also?) a valid commenting character?
e.g. `&#39;```## ; may also|not be used as a comment indicator`&#39;`

In any case, perhaps something after the 
``VPN_FIREWALL=0
line above is being processed when it shouldn&#39;t be. Either code is not checking for VPN_FIREWALL=0 at each setting, or lines post VPN_FIREWALL=0 are not being turfed unless/until a VPN_FIREWALL=1 entry is encountered.

How I got here: Having come across the code in reading through the wiki, I popped the file in (&#39;neutered&#39;) in preparation for attempting vpn at some later time. I expected VPN_FIREWALL=0 to render all to defaults per wiki coded comments, as though the file were not present at all.

(Being somewhat familiar with OpenVPN), I do expect VPN_INTERFACE=tun0 will be accurate, so left it alone. The need to change VPN_SERVERS would be intuitively obvious to change when I got to the point of going back in to turn VPN on. I commented out (with &#39;;&#39;) LOCAL_NET ... knowing I would have to figure out entries correct for my particular environment when I got that far. Not being certain that the example line would be 100% accurate then, I just commented the line out.

Summary:
``VPN_FIREWALL=0
``- breaks networking / doesn&#39;t do the expected (at least per wiki comments).

Arguably, someone making such a change and rebooting would be able to correlate cause and effect, reverse, and reboot - however, if one made more than one change before rebooting, they could spend a great deal of time playing hunt the wumpus before cottoning on to the specific cause and effective impact. With the net (and thus ability to peruse the wiki) down at the time. And, if they thought to reboot to effect the change, upon reversal.

Thus, additional suggestion: add to the wiki how to effect/reverse the change without rebooting (in the wiki affected articles).

``- firewall restart of #whonix_firewall (as per [Dev/Build_Documentation/0.3.0]([https://www.whonix.org/wiki/Dev/Build_Documentation/0.3.0) didn&#39;t do it.</description>
    <language>en</language>
    <lastBuildDate>Thu, 10 Dec 2015 14:26:42 +0000</lastBuildDate>
    <category>Website</category>
    <atom:link href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="9" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>iptables -A OUTPUT -d ; -j ACCEPT</p>
</blockquote>
</aside>
<p>That would result in iptables exiting non-zero, which would be caught by Whonix firewall error handler. Firewall would fail.</p>
<hr>
<aside class="quote" data-post="9" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>Still feels like there’s a bug here, though. With VPN_FIREWALL=0, that section of the code doesn’t get executed.</p>
</blockquote>
</aside>
<p>I don’t understand. Please post a github pull request. Just press edit on <a href="https://github.com/Whonix/whonix-gw-firewall/blob/master/usr/bin/whonix_firewall">https://github.com/Whonix/whonix-gw-firewall/blob/master/usr/bin/whonix_firewall</a> and make the modification you suggest. Then I might understand better.</p>
<p>It works as expected. With variable <code>VPN_FIREWALL=0</code> or unset…</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2012 - 2015 Patrick Schleizer &lt;adrelanos@riseup.net&gt;
## Copyright (C) 2014 - 2015 Jason Mehring &lt;nrgaway@gmail.com&gt;
## See the file COPYING for copying conditions.

###########################
## debugging
###########################

#set -x

###########################
## error_handler
###########################

set -o pipefail

error_handler() {
  echo "##################################################"
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>The following is executed. That’s the default. (Because the default is <code>VPN_FIREWALL</code> not being set to <code>1</code>.)</p>
<pre><code>$iptables_cmd -t nat -A OUTPUT -m iprange --dst-range "$NET" -j RETURN
</code></pre>
<p>Works as expected.</p>
<p>(<code>NON_TOR_GATEWAY</code> is only for non-VPN.)</p>
<hr>
<p>Also the following…</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2012 - 2015 Patrick Schleizer &lt;adrelanos@riseup.net&gt;
## Copyright (C) 2014 - 2015 Jason Mehring &lt;nrgaway@gmail.com&gt;
## See the file COPYING for copying conditions.

###########################
## debugging
###########################

#set -x

###########################
## error_handler
###########################

set -o pipefail

error_handler() {
  echo "##################################################"
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Works as expected. The above code runs always, unless <code>VPN_FIREWALL=1</code>.</p>
<p>(<code>NON_TOR_GATEWAY</code> is only for non-VPN.)</p>
<hr>
<p>Also the following…</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall</a></h4>
<pre><code class="lang-">#!/bin/bash

## Copyright (C) 2012 - 2015 Patrick Schleizer &lt;adrelanos@riseup.net&gt;
## Copyright (C) 2014 - 2015 Jason Mehring &lt;nrgaway@gmail.com&gt;
## See the file COPYING for copying conditions.

###########################
## debugging
###########################

#set -x

###########################
## error_handler
###########################

set -o pipefail

error_handler() {
  echo "##################################################"
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/whonix-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Works as expected. That code is only executed if <code>VPN_FIREWALL=1</code>.</p>
<p>(<code>LOCAL_NET</code> is only for VPN.)</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/14</link>
        <pubDate>Thu, 10 Dec 2015 14:26:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-14</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:11, topic:1741”]many bash places, ; is. A quick check in my system shows openvpn, smb.</p>
<p>I don’t get what you mean by “many bash places”. Your local shell does not matter. The language the tool written in matters. openvpn/smb aren’t written in sh or bash.[/quote]</p>
<p>Mmmm … not entirely. Not so much the tool, as the environment.</p>
<p>And in this case, the environment is Linux. Or, ‘configuration files’. The user neither knows nor cares what the tool is written in, whether it is a script or a binary config file user or caller, they’re following instructions to modify a config file.</p>
<p>[And Linux gets enough complaints of don’t make me relearn everything with each new tool.]</p>
<p>So … what seems to have been tending to happen (in Linux) is multiple configuration file consumers gravitating towards a common set of commenting / configuration file usage.</p>
<p>Having worked through things now, as in prior messages - I quite agree, the whonix_firewall environment does not permit the use of ; for comments / you have no choice.</p>
<p>However, for the user, which tool, and it’s environment, doesn’t matter - it’s a configuration file. (And configuration files tend to have certain conventions - although agreed, not as many things as we would like adhere to them. Arguably - too bad anyone ever used ; for commenting in the first place. But we are where we are.)</p>
<p>Thus the request of noting that ; doesn’t work, as noted - as a more polite way of kicking the user in the head than “Don’t Do That - Stupid!” <img src="//forums.whonix.org/images/emoji/twitter/smile.png?v=5" title=":smile:" class="emoji" alt=":smile:"></p>
<p>If I did it, others will, and when whonix_firewall goes bad … it goes very bad.</p>
<p>So, I thank you for agreeing to put a warning in: hopefully it will save someone else the (self-inflicted) internetless head scratching that I went through.</p>
<p>Adding a comment of … “Don’t forget to re-run whonix_firewall, and/or reboot if you change this file.” won’t hurt either. (Since fixing my botched file and reruning whonix_firewall wouldn’t have fixed the damage booting from the damaged file did - only rebooting fixes it.)</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/13</link>
        <pubDate>Thu, 10 Dec 2015 10:57:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-13</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>I think you’re misunderstanding what I meant by that comment.</p>
<p>The wiki page notes that VPN_FIREWALL=0 disables talking through the VPN.<br>
(2 lines above the VPN_FIREWALL=1 line. [Thus, the wiki essentially says/mentions VPN_FIREWALL=0.]</p>
<p>So, one of my comments was, there is a school of thought that defaults (even in documentation), should ‘do no harm’. So it is arguable that the wiki page use VPN_FIREWALL=0, with a note to say “change if you install VPN”. (However, as also commented, the point of the page is enabling VPN, so … agreed, those principles [do no harm / what are we describing] are diametrically opposed.)</p>
<p>I also noted I used VPN_FIREWALL=0 to get the file in place, neutered, as sort of a visual reminder to make appropriate changes when I got that far, but have not yet gotten as far as installing it (VPN).</p>
<p>I’ve lost track of where / why you’re asking “Where exactly does the wiki ever say VPN_FIREWALL=0?” - remind me.</p>
<p>I also noted (at one point) that the presence of VPN_FIREWALL=0 in the file, vs the lack of the file entirely, should effect equivalent behaviour. (* Which it does, in the end.)</p>
<p>``- this comment[1] was made while working through what / how my initially posted file was breaking things (or a bug to be reported). The end of that comment was … ‘;’ broke things in ways unanticipatable, and once replaced with ‘#’ the expected behaviour applies, and thus that comment[1] no longer applied.</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/12</link>
        <pubDate>Thu, 10 Dec 2015 10:41:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-12</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="6" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>many bash places, ; is. A quick check in my system shows openvpn, smb.</p>
</blockquote>
</aside>
<p>I don’t get what you mean by “many bash places”. Your local shell does not matter. The language the tool written in matters. openvpn/smb aren’t written in sh or bash.</p>
<aside class="quote" data-post="6" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>I don’t think suggesting a line of:## Note: ; is not a valid comment starting character in this file.</p>
</blockquote>
</aside>
<p>Can do.</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/11</link>
        <pubDate>Thu, 10 Dec 2015 09:26:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-11</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Where exactly does the wiki ever say <code>VPN_FIREWALL=0</code>?</p>
<p><a href="https://www.whonix.org/w/index.php?search=VPN_FIREWALL&amp;fulltext=Search">https://www.whonix.org/w/index.php?search=VPN_FIREWALL&amp;fulltext=Search</a></p>
<p>It’s always <code>VPN_FIREWALL=1</code>.</p>
<p>What do you think what <code>VPN_FIREWALL=1</code> does?</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/10</link>
        <pubDate>Thu, 10 Dec 2015 09:22:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-10</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="7" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>Will try to do both, and report back. (a) behaviour change with # instead of ; (b) behaviour change with all lines commented out.</p>
</blockquote>
</aside>
<p>Confirmed: Changing ; to # leaves ifconfig / route / ip route the same as if the file were not present.</p>
<p>In:</p>
<blockquote>
<p>; LOCAL_NET=“192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24”</p>
</blockquote>
<p>that is.</p>
<p>Presuming ; is being taken as a bash line separator, this leaves "LOCAL_NET=“192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24” impactful.</p>
<p>Which feels like undesirable behaviour. i.e. The user using the wiki lines, and forgetting to change it for their particular environment, should be left with unchanged behaviour.</p>
<p>Arguable VPN_FIREWALL=0, not VPN_FIREWALL=1, should be in the article, on that basis. Granted, the whole point of the article is to implement VPN. (Guess this is the ‘do not harm by default’ principle. Chicken and egg here, in this case.)</p>
<p>More telling, /usr/bin/whonix_firewall contains:</p>
<blockquote>
<p>[ -n “$LOCAL_NET” ] || LOCAL_NET=“192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24”</p>
</blockquote>
<p>which is the same as the wiki article. So that a behaviour change occurred is … unexpected. (?)</p>
<p>Further, /usr/bin/whonix_firewall contains:</p>
<blockquote>
<p>if [ “$VPN_FIREWALL” = “1” ]; then<br>
for NET in $LOCAL_NET; do<br>
$iptables_cmd -A OUTPUT -d “$NET” -j ACCEPT<br>
done<br>
fi</p>
</blockquote>
<p>So (a), VPN_FIREWALL=0 means this code would not have been executed.</p>
<p>And even if it was, (b) the result would be:</p>
<blockquote>
<h1>iptables -A OUTPUT -d ; -j ACCEPT</h1>
<p>iptables v1.4.21: option “-d” requires an argument<br>
Try `iptables -h’ or ‘iptables --help’ for more information.<br>
-j: command not found</p>
<h1></h1>
</blockquote>
<p>``- of no impact.</p>
<p>That there was an impact is … unhappiness.</p>
<p>Correction: Using ; instead of # results in:</p>
<blockquote>
<p>root@host:/etc/whonix_firewall.d# set -v -x<br>
root@host:/etc/whonix_firewall.d# whonix_firewall<br>
whonix_firewall</p>
<ul>
<li>whonix_firewall<br>
Invalid config file: /etc/whonix_firewall.d/50_user.conf<br>
bash_n_exit_code: 2<br>
bash_n_output:<br>
/etc/whonix_firewall.d/50_user.conf: line 24: syntax error near unexpected token <code>;' /etc/whonix_firewall.d/50_user.conf: line 24:</code>; LOCAL_NET=“192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24”'<br>
root@host:/etc/whonix_firewall.d#</li>
</ul>
</blockquote>
<p>So the impact of the ; is a bail in the script.</p>
<p>Rebooting, leaving the ; in place, duplicates the initial report. A route of</p>
<blockquote>
<p>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>
default         10.152.152.10   0.0.0.0         UG    1024   0        0 eth1</p>
</blockquote>
<p>Granted: buyer beware, user self-inflicted, theirs to deal with.</p>
<p>However, a firewall restart of “# whonix_firewall” with the ; changed back to a # leaves that route in place. Only a reboot fixes things. Unhappiness.</p>
<p>Unsure as to what, if any, coding defences could be put in place here. Even if doing so were reasonable - and I’m not convinced it is. User broke it, up to user to fix it. (Too many ways a script could be user-inflicted broken, and they keep building better idiots such as myself.)</p>
<p>At the least, however, I can so comment in the wiki changes.</p>
<p>Assuming ‘# whonix_firewall’ is the correct incantation, that running it didn’t fix things is obviously unexpected (at least per the documentation / wiki).</p>
<p>Still feels like there’s a bug here, though. With VPN_FIREWALL=0, that section of the code doesn’t get executed. (But if the script bails, it bails, nothing one can do about it but live with the result, find and fix and reboot.)</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/9</link>
        <pubDate>Thu, 10 Dec 2015 06:04:03 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-9</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“rAntOCauDgb, post:7, topic:1741”]Except … so how does one, having changed the file, kick it in the knee to reread it?</p>
<p>service whonix_firewall restart</p>
<p>?[/quote]</p>
<p>Sorry, I now see it’s # whonix_firewall , per Connecting_to_a_VPN_before_Tor#How_to_add_the_VPN_in_Whonix-Gateway</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/8</link>
        <pubDate>Thu, 10 Dec 2015 05:10:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-8</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="5" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p>[quote]… result … no -gateway network / tor at reboot.[/quote]If you mess up firewall config …</p>
</blockquote>
</aside>
<p>I think you are missing the point / bug report I intended:<br>
File says:</p>
<blockquote>
<pre><code>## Make sure Tor always connects through the VPN.
## Enable: 1
## Disable: 0
## DISABELD BY DEFAULT, because it requires a VPN provider.
VPN_FIREWALL=0
</code></pre>
</blockquote>
<p>Which is to say, whether the file is present (with VPN_FIREWALL=0 set), or not present - the same behavior should result. It didn’t. Which, at the least, is unexpected, per the comments in the file.</p>
<p>I don’t disagree that self-inflicted user messing up pf the file - deserves whatever happens.<br>
(e.g. my prefixing a line with ; instead of #.)</p>
<p>My point is the user following the instructions present got unexpected (and unreasonable - broken network, and broken ability to research solution) result.</p>
<p>i.e. As per initial report, something isn’t being ignored as one would expect - I was suggesting that perhaps there is something to look at here. Full stop.</p>
<p>I’m not saying adding a line along the lines of:</p>
<blockquote>
<h2>Unless you have implemented a VPN, leave VPN_FIREWALL entirely commented out, or remove the file.</h2>
<h2>Else … you WILL break your network in the mean time.</h2>
</blockquote>
<p>isn’t a complete and appropriate solution. I wouldn’t know - never mind VPN_FIREWALL=0 being present is working as expected or not.</p>
<aside class="quote">
<blockquote>
<p>That might also explain route.</p>
</blockquote>
</aside>
<p>Will try to do both, and report back. (a) behaviour change with # instead of ; (b) behaviour change with all lines commented out.</p>
<aside class="quote">
<blockquote>
<p>[quote]Thus, additional suggestion: add to the wiki how to effect/reverse the change without rebooting (in the wiki affected articles).[/quote]Can you add this in the following style please?</p>
</blockquote>
</aside>
<p>Yes, I can do that.</p>
<p>I saw examples of expand use, so I should be able to cut and paste.</p>
<p>Except … so how does one, having changed the file, kick it in the knee to reread it?</p>
<p>service whonix_firewall restart</p>
<p>?</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/7</link>
        <pubDate>Thu, 10 Dec 2015 04:55:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-7</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:4, topic:1741”]<br>
; is not a valid configuration file comment. Many others aren’t either. Firewall config is a bash fragment. I don’t think it makes sense to point out all the invalid commenting characters. Aren’t there too many of them?[/quote]</p>
<p>In many bash places, ; is. A quick check in my system shows openvpn, smb. A not uncommon convention is something like # for config elements, ; for site specific elements. I don’t think suggesting a line of:<br>
``## Note: ; is not a valid comment starting character in this file.<br>
is unreasonable. You are, of course, free to reject the suggestion.</p>
<aside class="quote">
<blockquote>
<p>I don’t think it makes sense to point out all the invalid commenting characters. Aren’t there too many of them?</p>
</blockquote>
</aside>
<p>Ridicule?</p>
<aside class="quote">
<blockquote>
<p>[quote]firewall restart of <span class="hashtag">#whonix_firewall</span> (as per Dev/Build_Documentation/0.3.0 didn’t do it.[/quote]Dev/Build_Documentation/0.3.0  is only kept for historical purposes.</p>
</blockquote>
</aside>
<p>Fair enough, but searching brought the article up. I take your point, but how is the new / quick reader to know what to pay attention to and what not.</p>
<p>In the mean time, perhaps a blurb in the wiki so that such searches bring up correct information would be useful.</p>
<p>[quote]whonix-gateway config parsing code is quite simple in Whonix 12: <a href="https://github.com/Whonix/whonix-gw-firewall/blob/c30ad852911856051f43205f822446cc2a032fec/usr/bin/whonix_firewall#L32-L55" rel="nofollow noopener">https://github.com/Whonix/whonix-gw-firewall/blob/c30ad852911856051f43205f822446cc2a032fec/usr/bin/whonix_firewall#L32-L55</a></p>
<p>And even simpler in Whonix 13: <a href="https://github.com/Whonix/whonix-gw-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall#L32-L44%5B/quote%5D" rel="nofollow noopener">https://github.com/Whonix/whonix-gw-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall#L32-L44[/quote]</a></p>
<p>Not sure what you’re point me to at these links. Commenting examples? Or noting the entries the code permits?</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/6</link>
        <pubDate>Thu, 10 Dec 2015 04:31:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-6</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="1" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>… result … no -gateway network / tor at reboot.</p>
</blockquote>
</aside>
<p>If you mess up firewall config, and after boot, then firewall will fail, networking will not come up. if-pre-up.d will fail.<br>
( <a href="https://github.com/Whonix/whonix-gw-firewall/blob/master/etc/network/if-pre-up.d/30_whonix_firewall">https://github.com/Whonix/whonix-gw-firewall/blob/master/etc/network/if-pre-up.d/30_whonix_firewall</a> )<br>
This is a security feature. Don’t mess up firewall config. You should have noticed that error during the step “reload firewall”.</p>
<p>That might also explain <code>route</code>.</p>
<aside class="quote" data-post="1" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<p>Thus, additional suggestion: add to the wiki how to effect/reverse the change without rebooting (in the wiki affected articles).</p>
</blockquote>
</aside>
<p>Can you add this in the following style please?</p>
<blockquote>
<p>If you want to undo these settings, please press expand on the right.</p>
</blockquote>
<p>(Then use wiki markup for expand buttons. You can see an example usage for example here: <a href="https://www.whonix.org/wiki/Bridges#scramblesuit">https://www.whonix.org/wiki/Bridges#scramblesuit</a>)</p>
<p>(just get rid of all config changes - delete the 50_user config files - reload firewall)</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/5</link>
        <pubDate>Wed, 09 Dec 2015 04:19:18 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-5</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><code>;</code> is not a valid configuration file comment. Many others aren’t either. Firewall config is a bash fragment. I don’t think it makes sense to point out all the invalid commenting characters. Aren’t there too many of them?</p>
<p><code>## ;</code> works.</p>
<p>It already says…</p>
<blockquote>
<p>You can skip comments (starting with #)</p>
</blockquote>
<p>whonix-gateway config parsing code is quite simple in Whonix 12: <a href="https://github.com/Whonix/whonix-gw-firewall/blob/c30ad852911856051f43205f822446cc2a032fec/usr/bin/whonix_firewall#L32-L55">https://github.com/Whonix/whonix-gw-firewall/blob/c30ad852911856051f43205f822446cc2a032fec/usr/bin/whonix_firewall#L32-L55</a></p>
<p>And even simpler in Whonix 13: <a href="https://github.com/Whonix/whonix-gw-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall#L32-L44">https://github.com/Whonix/whonix-gw-firewall/blob/5e6e36a23cb8f273d5d7cbfce13fd7061d45377c/usr/bin/whonix_firewall#L32-L44</a></p>
<aside class="quote" data-post="1" data-topic="1741">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/rantocaudgb/40/135_1.png" class="avatar"> rAntOCauDgb:</div>
<blockquote>
<ul>
<li>firewall restart of <span class="hashtag">#whonix_firewall</span> (as per Dev/Build_Documentation/0.3.0 didn’t do it.</li>
</ul>
</blockquote>
</aside>
<p>Dev/Build_Documentation/0.3.0  is only kept for historical purposes.</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/4</link>
        <pubDate>Wed, 09 Dec 2015 04:09:26 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-4</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>Should add: With the (thought to be neutral) file in place, route was</p>
<p>default         10.0.2.15        0.0.0.0         UG    0      0        0 eth1</p>
<p>``- I think. Definitely .15 and eth1. (Rebooting cleared /tmp where I had piped the output, so I’m going from memory.)</p>
<p>In any case, with .15 and eth1, was obviously wonky / never gonna work.<br>
<code></code><br>
Instead of the normal:</p>
<p>default         10.0.2.2        0.0.0.0         UG    0      0        0 eth0</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/3</link>
        <pubDate>Wed, 09 Dec 2015 03:52:54 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-3</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Not duplication. That’s currently being rewritten.</p>
<p><a href="https://phabricator.whonix.org/T125">https://phabricator.whonix.org/T125</a></p>
<p>You won’t find <a href="https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor">https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor</a> in documentation yet.<br>
<a href="https://www.whonix.org/wiki/Using_Tunnels_with_Whonix">https://www.whonix.org/wiki/Using_Tunnels_with_Whonix</a> will be moved to <a href="https://www.whonix.org/wiki/Deprecated/Using_Tunnels_with_Whonix">https://www.whonix.org/wiki/Deprecated/Using_Tunnels_with_Whonix</a>.</p>
<p>(<a class="mention" href="http://forums.whonix.org/u/jasonjayalap">@JasonJAyalaP</a>)</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/2</link>
        <pubDate>Wed, 09 Dec 2015 03:42:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-2</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
      <item>
        <title>wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</title>
        <dc:creator><![CDATA[rAntOCauDgb]]></dc:creator>
        <description><![CDATA[
            <p>From <a href="https://www.whonix.org/wiki/Template:Firewall_Settings" rel="nofollow noopener">Template:Firewall_Settings</a>:<br>
``&gt; sudo nano /etc/whonix_firewall.d/50_user.conf</p>
<p>Content duplicated at both <a href="https://www.whonix.org/wiki/Tunnels/Connecting_to_a_VPN_before_Tor" rel="nofollow noopener">Connecting_to_a_VPN_before_Tor</a> and <a href="https://www.whonix.org/wiki/Using_Tunnels_with_Whonix" rel="nofollow noopener">Using_Tunnels_with_Whonix</a>:<br>
<code>&gt; 2. Add the following settings. ...</code>&gt; ###########################<br>
<code>&gt; ## VPN-Firewall Settings ##</code>&gt; ###########################</p>
<p>``- de-dup content by making it into a wiki template section as <a href="https://www.whonix.org/wiki/Template:Firewall_Settings" rel="nofollow noopener">Template:Firewall_Settings</a> is?</p>
<p>Having made a 50_user.conf file as per wiki / text contents, with the following (active content) changed / lines:<br>
<code>VPN_FIREWALL=0</code>VPN_SERVERS=“198.252.153.26”<br>
<code>VPN_INTERFACE=tun0</code>; LOCAL_NET=“192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24”</p>
<p>… result … no -gateway network / tor at reboot.</p>
<p>Move file up a level temporarily, reboot, network / tor functional again.</p>
<p>Apparently<br>
``&gt; VPN_FIREWALL=0<br>
isn’t being adhered to, despite wiki article’s comments indicating 0 = disable vpn firewall. i.e. Same default as if not set / file not present.</p>
<p>``- feels like a bug.</p>
<p>Note:<br>
<code>VPN_SERVERS="198.252.153.26"</code>VPN_INTERFACE=tun0<br>
``- left unchanged from wiki text. Since VPN_FIREWALL=0 set, settings weren’t expected to be adhered to / impact anything.</p>
<p><code>; LOCAL_NET="192.168.1.0/24 192.168.0.0/24 127.0.0.0/8 10.152.152.0/24 10.0.2.2/24"</code>- is the wiki text with a comment <code>(;)</code> character in front.</p>
<p>Could the wiki text be updated to indicate that ‘;’ is/n’t (also?) a valid commenting character?<br>
e.g. <code>'```## ; may also|not be used as a comment indicator</code>'`</p>
<p>In any case, perhaps something after the<br>
``VPN_FIREWALL=0<br>
line above is being processed when it shouldn’t be. Either code is not checking for VPN_FIREWALL=0 at each setting, or lines post VPN_FIREWALL=0 are not being turfed unless/until a VPN_FIREWALL=1 entry is encountered.</p>
<p>How I got here: Having come across the code in reading through the wiki, I popped the file in (‘neutered’) in preparation for attempting vpn at some later time. I expected VPN_FIREWALL=0 to render all to defaults per wiki coded comments, as though the file were not present at all.</p>
<p>(Being somewhat familiar with OpenVPN), I do expect VPN_INTERFACE=tun0 will be accurate, so left it alone. The need to change VPN_SERVERS would be intuitively obvious to change when I got to the point of going back in to turn VPN on. I commented out (with ‘;’) LOCAL_NET … knowing I would have to figure out entries correct for my particular environment when I got that far. Not being certain that the example line would be 100% accurate then, I just commented the line out.</p>
<p>Summary:<br>
<code>VPN_FIREWALL=0</code>- breaks networking / doesn’t do the expected (at least per wiki comments).</p>
<p>Arguably, someone making such a change and rebooting would be able to correlate cause and effect, reverse, and reboot - however, if one made more than one change before rebooting, they could spend a great deal of time playing hunt the wumpus before cottoning on to the specific cause and effective impact. With the net (and thus ability to peruse the wiki) down at the time. And, if they thought to reboot to effect the change, upon reversal.</p>
<p>Thus, additional suggestion: add to the wiki how to effect/reverse the change without rebooting (in the wiki affected articles).</p>
<p>``- firewall restart of <span class="hashtag">#whonix_firewall</span> (as per <a href="http://forums.whonix.org">Dev/Build_Documentation/0.3.0</a> didn’t do it.</p>
          <p><a href="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741/1</link>
        <pubDate>Wed, 09 Dec 2015 03:34:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-1741-1</guid>
        <source url="http://forums.whonix.org/t/wiki-tunnels-connecting-to-a-vpn-vpn-firewall-0-broken/1741.rss">wiki: Tunnels/Connecting_to_a_VPN ... VPN_FIREWALL=0 - broken.</source>
      </item>
  </channel>
</rss>
