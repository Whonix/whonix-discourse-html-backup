<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>KVM virtual TPM aka the &quot;Universal Smartcard&quot;</title>
    <link>http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244</link>
    <description>KVM has recently added virtualized TPM support. They can be very valuable from a security standpoint  (and more trustworthy than hardware TPMs). A big thing is they can be used like virtual smartcards providing security like Qubes&#39; split-gpg but for more types of software keys like OpenSSH, OpenSSL and more.

To summarize in someone else&#39;s words:

&gt; 
&gt; TPMs are useful as an alternative to key cards: they provide the same security against key theft and the same cryptographic protections.  The main difference is that TPMs are universally present in every laptop, so they provide a simple and ubiquitous solution to key security.  The only real downside is that unlike key cards, TPM protected keys cannot be transferred between laptops, you must instead keep an offline backup copy of the key can then be transferred to the TPM of any new laptop.
&gt; 
&gt; The way TPM protection works is slightly different from key cards.
&gt;  Instead of moving the key inside the card, the TPM converts any given key to a TPM specific representation (meaning it&#39;s encrypted by a special key that only the TPM possesses).  The TPM represenation must be stored offline somewhere and if it is lost, so is the protected key.
&gt;  
&gt; The way I implemented this is to use the TPM to convert the key to
&gt; protected representation and then store it in the shadow_info of a
&gt; shadowed-private-key using a shadow type of tpm2-v1.  The TPM can handle an arbitrary number of keys, but the price is the shadow_info stores the keys and must be preserved.

https://lwn.net/Articles/768419/
https://blog.hansenpartnership.com/using-your-tpm-as-a-secure-key-store/

***

Patches for [GPG support for TPMs](https://lists.gnupg.org/pipermail/gnupg-devel/2018-January/033350.html) has been submitted but I have yet to see what happened. Needs following up for sure so it can make it before the next freeze hopefully. 

To be done: 

* How to secure OpenSSH keys 
* Suggesting Tor supports this for Onion service keys and even session key material if TPM detected.

***

Contents of TPM can be encrypted in the libvirt version in Bullseye.

***
EDIT:

This nifty code supports the major applications on TPM 2

https://github.com/irtimmer/tpm2-pk11

https://wiki.archlinux.org/index.php/TPM2-PK11



    * OpenSSH Client (SSH key in TPM)
    * Firefox (Private key of Client certificate in TPM)
    * GnuPG using gnupg-pkcs11-scd (PGP key in TPM)</description>
    <language>en</language>
    <lastBuildDate>Tue, 21 Sep 2021 22:01:06 +0000</lastBuildDate>
    <category>KVM</category>
    <atom:link href="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>KVM virtual TPM aka the &quot;Universal Smartcard&quot;</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><a href="http://fasttrack.debian.net">fasttrack.debian.net</a> has a limited scope. It’s really awesome, livesaver for Whonix VirtualBox but not a magic bullet by any stretch. Since gnupg doesn’t have any issues requiring it being uploaded to <a href="http://fasttrack.debian.net">fasttrack.debian.net</a> I don’t think it will ever be added to <a href="http://fasttrack.debian.net">fasttrack.debian.net</a>. fasttrack isn’t going to succeed Debian backports in speed. To verify gnupg being unavailable in fasttrack, web search term:</p>
<p>site:fasttrack.debian.net gnupg</p>
<p>At time of writing, gnupg doesn’t seem to be available in Debian backports either.</p>
          <p><a href="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/5</link>
        <pubDate>Tue, 21 Sep 2021 22:01:06 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8244-5</guid>
        <source url="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244.rss">KVM virtual TPM aka the &quot;Universal Smartcard&quot;</source>
      </item>
      <item>
        <title>KVM virtual TPM aka the &quot;Universal Smartcard&quot;</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>gpg 2.3 now supports TPM devices, but unfortunately only 2.2 is in stable. <a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a> is it recommeded to use fasttrack for a newer version of this core program?</p>
<p><a href="https://www.gnupg.org/blog/20210315-using-tpm-with-gnupg-2.3.html" class="onebox" target="_blank" rel="noopener">https://www.gnupg.org/blog/20210315-using-tpm-with-gnupg-2.3.html</a></p>
          <p><a href="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/4</link>
        <pubDate>Tue, 21 Sep 2021 15:23:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8244-4</guid>
        <source url="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244.rss">KVM virtual TPM aka the &quot;Universal Smartcard&quot;</source>
      </item>
      <item>
        <title>KVM virtual TPM aka the &quot;Universal Smartcard&quot;</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="2" data-topic="8244">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/a183cd/40.png" class="avatar"> Algernon:</div>
<blockquote>
<p>How so?</p>
</blockquote>
</aside>
<p>Hardware TPMs come with their own secret keys burned into the chip from the factory. If they collude with states or are infiltrated then these private keys are considered compromised. There is no way I can trust the crypto engine’s RNG on these things as these can be silently compromised and there is no way to find out unlike other security exploits. As QEMU’s hardware is an open implementation it has a chance of being properly vetted and being easily fixed in case of a vuln more than a hardware chip can be. The Infineon TPM <a href="https://www.theregister.co.uk/2017/10/16/roca_crypto_vuln_infineon_chips/" rel="nofollow noopener">debacle</a> makes a case for this.</p>
<p>A software TPM can be easily updated to support more modern encryption algos which is not the case for laptops that have chips with the 1.2 spec where they are limited to SHA1 and can’t be upgraded without changing the hardware.</p>
<p>Note that physical access is out of scope here, but I would never rely on the physical chip to store secrets because they can be <a href="https://www.nzherald.co.nz/technology/news/article.cfm?c_id=5&amp;objectid=10625082&amp;pnum=0" rel="nofollow noopener">cracked</a> by those who get their hands on the machine.</p>
<aside class="quote no-group" data-post="2" data-topic="8244">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/a183cd/40.png" class="avatar"> Algernon:</div>
<blockquote>
<p>Hopefully the average cryptomessenger too?</p>
</blockquote>
</aside>
<p>If they natively support TPMs then yes it can happen. Adam Langley’s asynchronous messenger over Tor “Pond” was designed to make use of TPMs. Without their explicit support, the software package I found can in theory be extended to support other programs though I’m not sure if they must support the PKCS#11 standard or not.</p>
          <p><a href="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/3</link>
        <pubDate>Wed, 02 Oct 2019 14:17:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8244-3</guid>
        <source url="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244.rss">KVM virtual TPM aka the &quot;Universal Smartcard&quot;</source>
      </item>
      <item>
        <title>KVM virtual TPM aka the &quot;Universal Smartcard&quot;</title>
        <dc:creator><![CDATA[Algernon]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="1" data-topic="8244">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>and more trustworthy than hardware TPMs</p>
</blockquote>
</aside>
<p>How so?</p>
<aside class="quote no-group" data-post="1" data-topic="8244">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>To be done:</p>
</blockquote>
</aside>
<p>Hopefully the average cryptomessenger too?</p>
          <p><a href="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/2</link>
        <pubDate>Wed, 02 Oct 2019 09:04:25 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8244-2</guid>
        <source url="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244.rss">KVM virtual TPM aka the &quot;Universal Smartcard&quot;</source>
      </item>
      <item>
        <title>KVM virtual TPM aka the &quot;Universal Smartcard&quot;</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <p>KVM has recently added virtualized TPM support. They can be very valuable from a security standpoint  (and more trustworthy than hardware TPMs). A big thing is they can be used like virtual smartcards providing security like Qubes’ split-gpg but for more types of software keys like OpenSSH, OpenSSL and more.</p>
<p>To summarize in someone else’s words:</p>
<blockquote>
<p>TPMs are useful as an alternative to key cards: they provide the same security against key theft and the same cryptographic protections.  The main difference is that TPMs are universally present in every laptop, so they provide a simple and ubiquitous solution to key security.  The only real downside is that unlike key cards, TPM protected keys cannot be transferred between laptops, you must instead keep an offline backup copy of the key can then be transferred to the TPM of any new laptop.</p>
<p>The way TPM protection works is slightly different from key cards.<br>
Instead of moving the key inside the card, the TPM converts any given key to a TPM specific representation (meaning it’s encrypted by a special key that only the TPM possesses).  The TPM represenation must be stored offline somewhere and if it is lost, so is the protected key.</p>
<p>The way I implemented this is to use the TPM to convert the key to<br>
protected representation and then store it in the shadow_info of a<br>
shadowed-private-key using a shadow type of tpm2-v1.  The TPM can handle an arbitrary number of keys, but the price is the shadow_info stores the keys and must be preserved.</p>
</blockquote>
<p></p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://lwn.net/images/favicon.png" class="site-icon" width="32" height="32">
      <a href="https://lwn.net/Articles/768419/" target="_blank" rel="nofollow noopener">lwn.net</a>
  </header>
  <article class="onebox-body">
    

<h3><a href="https://lwn.net/Articles/768419/" target="_blank" rel="nofollow noopener">Secure key handling using the TPM [LWN.net]</a></h3>

<p>
Trusted Computing has not had the best
reputation over the years — Richard Stallman dubbing it "Treacherous
Computing" probably hasn't helped — though those fears of taking away
users' control of their computers have not proven to be founded, at...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
<a href="https://blog.hansenpartnership.com/using-your-tpm-as-a-secure-key-store/" class="onebox" target="_blank" rel="nofollow noopener">https://blog.hansenpartnership.com/using-your-tpm-as-a-secure-key-store/</a><p></p>
<hr>
<p>Patches for <a href="https://lists.gnupg.org/pipermail/gnupg-devel/2018-January/033350.html" rel="nofollow noopener">GPG support for TPMs</a> has been submitted but I have yet to see what happened. Needs following up for sure so it can make it before the next freeze hopefully.</p>
<p>To be done:</p>
<ul>
<li>How to secure OpenSSH keys</li>
<li>Suggesting Tor supports this for Onion service keys and even session key material if TPM detected.</li>
</ul>
<hr>
<p>Contents of TPM can be encrypted in the libvirt version in Bullseye.</p>
<hr>
<p>EDIT:</p>
<p>This nifty code supports the major applications on TPM 2</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://github.githubassets.com/favicon.ico" class="site-icon" width="32" height="32">
      <a href="https://github.com/irtimmer/tpm2-pk11" target="_blank" rel="nofollow noopener">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="https://avatars2.githubusercontent.com/u/3816189?s=400&amp;amp;v=4" class="thumbnail onebox-avatar" width="420" height="420">

<h3><a href="https://github.com/irtimmer/tpm2-pk11" target="_blank" rel="nofollow noopener">irtimmer/tpm2-pk11</a></h3>

<p>PKCS#11 Module for TPM 2.0. Contribute to irtimmer/tpm2-pk11 development by creating an account on GitHub.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p><a href="https://wiki.archlinux.org/index.php/TPM2-PK11" class="onebox" target="_blank" rel="nofollow noopener">https://wiki.archlinux.org/index.php/TPM2-PK11</a></p>
<pre><code>* OpenSSH Client (SSH key in TPM)
* Firefox (Private key of Client certificate in TPM)
* GnuPG using gnupg-pkcs11-scd (PGP key in TPM)</code></pre>
          <p><a href="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244/1</link>
        <pubDate>Tue, 01 Oct 2019 21:32:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8244-1</guid>
        <source url="http://forums.whonix.org/t/kvm-virtual-tpm-aka-the-universal-smartcard/8244.rss">KVM virtual TPM aka the &quot;Universal Smartcard&quot;</source>
      </item>
  </channel>
</rss>
