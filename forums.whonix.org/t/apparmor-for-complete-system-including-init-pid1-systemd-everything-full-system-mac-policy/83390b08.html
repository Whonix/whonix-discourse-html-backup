<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy - AppArmor - Whonix Forum</title>
    <meta name="description" content="Currently, Whonix only has AppArmor profiles for a few high-risk applications. This isnâ€™t the best. It would be much better to have everything confined by default, including init which would greatly increase security. 
T&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="83390b08.html?page=9" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy&#39;" href="8339.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339?page=9" />
<meta name="twitter:url" content="https://forums.whonix.org/t/apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339?page=9" />
<meta property="og:title" content="AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy" />
<meta name="twitter:title" content="AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy" />
<meta property="og:description" content="The issue was closed and he said:   Iâ€™d recommend just linking those programs against it. I donâ€™t want to add this.   Linking programs against it is something that is done at compile time AFAIK which isnâ€™t a viable solution for most apps so we canâ€™t have both environment scrubbing and hardened_malloc. Unless we add it to /etc/ld.so.preload and use hardened_malloc globally (with exceptions added for broken programs)." />
<meta name="twitter:description" content="The issue was closed and he said:   Iâ€™d recommend just linking those programs against it. I donâ€™t want to add this.   Linking programs against it is something that is done at compile time AFAIK which isnâ€™t a viable solution for most apps so we canâ€™t have both environment scrubbing and hardened_malloc. Unless we add it to /etc/ld.so.preload and use hardened_malloc globally (with exceptions added for broken programs)." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="97 mins ğŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="496 â¤" />
<meta property="article:published_time" content="2019-11-23T23:51:26+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="8339fdfa.html?page=8">
        <link rel="next" href="83391448.html?page=10">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="8339.html">AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/apparmor/14.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #12A89D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>AppArmor</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-23T23:51:26Z' class='post-time'>
                November 23, 2019, 11:51pm
              </time>
              <meta itemprop='dateModified' content='2019-11-23T23:51:26Z'>
          <span itemprop='position'>#163</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>The issue was closed and he said:</p>
<blockquote>
<p>Iâ€™d recommend just linking those programs against it. I donâ€™t want to add this.</p>
</blockquote>
<p>Linking programs against it is something that is done at compile time AFAIK which isnâ€™t a viable solution for most apps so we canâ€™t have both environment scrubbing and hardened_malloc. Unless we add it to /etc/ld.so.preload and use hardened_malloc globally (with exceptions added for broken programs).</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-24T10:51:16Z' class='post-time'>
                November 24, 2019, 10:51am
              </time>
              <meta itemprop='dateModified' content='2019-11-24T10:51:16Z'>
          <span itemprop='position'>#164</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a href="../../../external.html?link=https://gitlab.com/apparmor/apparmor/issues/66#note_249476708">https://gitlab.com/apparmor/apparmor/issues/66#note_249476708</a> getting worse news. (<strong>Bold</strong> added by me.)</p>
<p>John Johansen commented:</p>
<blockquote>
<p>So not that <span class="mention">@setharnold</span> is wrong <strong>current environment scrubbing</strong> is handled by the loader as Seth described, and it <strong>is entirely insufficient</strong>.</p>
<p>However there are indeed plans for apparmor to pick up environment variable scrubbing. It can be done in the kernel, and we actually have a basic prototype for it but it isnâ€™t a prioritized work item and there is still a lot of work to do on before it can land.</p>
</blockquote>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-25T14:12:01Z' class='post-time'>
                November 25, 2019,  2:12pm
              </time>
              <meta itemprop='dateModified' content='2019-11-25T14:12:01Z'>
          <span itemprop='position'>#165</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Could you fix these please?</p>
<blockquote>
<p>user@host:~$ sudo journalctl -b | grep -i denied<br>
Nov 25 14:04:40 host audit[1533]: AVC apparmor=â€œDENIEDâ€ operation=â€œlinkâ€ info=â€œlink not subset of targetâ€ error=-13 profile="/usr/bin/apt-get" name="/usr/lib/security-misc/pam_tally2-info.dpkg-tmp" pid=1533 comm=â€œdpkgâ€ requested_mask=â€œxâ€ denied_mask=â€œxâ€ fsuid=0 ouid=0 target="/usr/lib/security-misc/pam_tally2-info"<br>
Nov 25 14:04:40 host kernel: audit: type=1400 audit(1574690680.014:19): apparmor=â€œDENIEDâ€ operation=â€œlinkâ€ info=â€œlink not subset of targetâ€ error=-13 profile="/usr/bin/apt-get" name="/usr/lib/security-misc/pam_tally2-info.dpkg-tmp" pid=1533 comm=â€œdpkgâ€ requested_mask=â€œxâ€ denied_mask=â€œxâ€ fsuid=0 ouid=0 target="/usr/lib/security-misc/pam_tally2-info"<br>
Nov 25 14:04:44 host audit[1830]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:44 host kernel: audit: type=1400 audit(1574690684.266:20): apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:44 host kernel: audit: type=1400 audit(1574690684.266:21): apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:44 host kernel: audit: type=1400 audit(1574690684.266:22): apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:44 host kernel: audit: type=1400 audit(1574690684.266:23): apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:44 host audit[1830]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:44 host audit[1830]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:44 host audit[1830]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1830 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:04:47 host audit[2295]: AVC apparmor=â€œDENIEDâ€ operation=â€œcapableâ€ profile="/usr/bin/apt-get" pid=2295 comm="(sd-askpwagent)" capability=24  capname=â€œsys_resourceâ€<br>
Nov 25 14:04:47 host kernel: audit: type=1400 audit(1574690687.514:24): apparmor=â€œDENIEDâ€ operation=â€œcapableâ€ profile="/usr/bin/apt-get" pid=2295 comm="(sd-askpwagent)" capability=24  capname=â€œsys_resourceâ€</p>
</blockquote>
<hr>
<blockquote>
<p>user@host:~$ sudo journalctl -b | grep -i denied<br>
Nov 25 14:06:43 host audit[1549]: AVC apparmor=â€œDENIEDâ€ operation=â€œlinkâ€ info=â€œlink not subset of targetâ€ error=-13 profile="/usr/bin/apt-get" name="/usr/lib/security-misc/pam_tally2-info.dpkg-tmp" pid=1549 comm=â€œdpkgâ€ requested_mask=â€œxâ€ denied_mask=â€œxâ€ fsuid=0 ouid=0 target="/usr/lib/security-misc/pam_tally2-info"<br>
Nov 25 14:06:45 host audit[1837]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1837 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:06:45 host audit[1837]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1837 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:06:45 host audit[1837]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1837 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:06:45 host audit[1837]: AVC apparmor=â€œDENIEDâ€ operation=â€œfile_inheritâ€ profile="/usr/lib/security-misc/permission-lockdown" name="/dev/pts/1" pid=1837 comm=â€œpermission-lockâ€ requested_mask=â€œwrâ€ denied_mask=â€œwrâ€ fsuid=0 ouid=0<br>
Nov 25 14:06:48 host audit[2300]: AVC apparmor=â€œDENIEDâ€ operation=â€œcapableâ€ profile="/usr/bin/apt-get" pid=2300 comm="(sd-askpwagent)" capability=24  capname=â€œsys_resourceâ€</p>
</blockquote>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-25T14:44:11Z' class='post-time'>
                November 25, 2019,  2:44pm
              </time>
              <meta itemprop='dateModified' content='2019-11-25T14:44:11Z'>
          <span itemprop='position'>#166</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="149" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>unless debian provides a <code>glibc-hardened-malloc</code> package or similar.</p>
</blockquote>
</aside>
<p>Seems very unlikely.</p>
<ul>
<li><a href="../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=945455">RFP: hardened-malloc â€“ hardened memory allocator</a></li>
<li><a href="../../../external.html?link=https://sourceware.org/bugzilla/show_bug.cgi?id=25223">glibc feature request - consider using Hardened Malloc</a></li>
<li><a href="../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=945457">debian glibc feature request - consider using hardened malloc (hardened memory allocator)</a></li>
<li><a href="../../../external.html?link=https://sourceware.org/ml/libc-alpha/2019-11/msg00810.html">glibc-alpha mailing list - consider using Hardened Malloc</a></li>
<li><a href="../hardened-malloc-hardened-memory-allocator/7474/50.html" class="inline-onebox">Hardened Malloc - Hardened Memory Allocator</a></li>
</ul>
<aside class="quote no-group quote-modified" data-post="149" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Iâ€™m thinking of using apparmorâ€™s environment scrubbing on all binaries although that would break using LD_PRELOAD for hardened_malloc.</p>
<p>Also, using a different environment for apt is not enough. Attackers can still write to <code>/etc/ld.so.preload</code> and other <code>/etc/ld.so.*</code> files so everything preloads their malicious library, including apt even with a new environment.</p>
<p>But, using environment scrubbing and disallowing writing to <code>/etc/ld.so.preload</code> will prevent us from using hardened_malloc at all unless â€¦</p>
</blockquote>
</aside>
<p>Users could boot into admin mode (without apparmor-profile-everything) and configure <code>/etc/ld.so.preload</code>?</p>
<p>We could allow root to run a yet to be invented script which copies a file <code>/etc/ld.so.preload_template</code> to <code>/etc/ld.so.preload</code>.</p>
<p><code>/etc/ld.so.preload_template</code> would have the following contents:</p>
<pre><code>/usr/lib/libhardened_malloc.so/libhardened_malloc.so
</code></pre>
<p>That way while apparmor-profile-everything is enabled, root could enable hardened malloc but not configure an arbitrary (malicious) <code>/etc/ld.so.preload</code>?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-25T16:22:52Z' class='post-time'>
                November 25, 2019,  4:22pm
              </time>
              <meta itemprop='dateModified' content='2019-11-25T16:22:52Z'>
          <span itemprop='position'>#167</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="166" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Users could boot into admin mode (without apparmor-profile-everything) and configure <code>/etc/ld.so.preload</code> ?</p>
</blockquote>
</aside>
<p>Yes, but we should rely on booting without apparmor as little as possible.</p>
<aside class="quote no-group" data-post="166" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>We could allow root to run a yet to be invented script which copies a file <code>/etc/ld.so.preload_template</code> to <code>/etc/ld.so.preload</code> .</p>
<p><code>/etc/ld.so.preload_template</code> would have the following contents:</p>
<pre><code class="lang-auto">/usr/lib/libhardened_malloc.so/libhardened_malloc.so
</code></pre>
<p>That way while apparmor-profile-everything is enabled, root could enable hardened malloc but not configure an arbitrary (malicious) <code>/etc/ld.so.preload</code> ?</p>
</blockquote>
</aside>
<p>That sounds like a good idea.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-26T17:18:44Z' class='post-time'>
                November 26, 2019,  5:18pm
              </time>
              <meta itemprop='dateModified' content='2019-11-26T17:18:44Z'>
          <span itemprop='position'>#168</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="165" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could you fix these please?</p>
</blockquote>
</aside>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/8" target="_blank">github.com/Whonix/apparmor-profile-everything</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/8" target="_blank">Fix apt</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> â† <code>madaidan:apt-fixes</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2019-11-26" data-time="17:18:28" data-timezone="UTC">05:18PM - 26 Nov 19 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 4 additions and 6 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/8/files" target="_blank">
          <span class="added">+4</span>
          <span class="removed">-6</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/security-misc/pull/37" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/security-misc/pull/37" target="_blank">Fix permission-lockdown</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> â† <code>madaidan:apparmor-fixes</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2019-11-26" data-time="17:12:43" data-timezone="UTC">05:12PM - 26 Nov 19 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 1 additions and 0 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/security-misc/pull/37/files" target="_blank">
          <span class="added">+1</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-26T18:02:51Z' class='post-time'>
                November 26, 2019,  6:02pm
              </time>
              <meta itemprop='dateModified' content='2019-11-26T18:02:51Z'>
          <span itemprop='position'>#169</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks, merged. <img src="../../images/emoji/twitter/slight_smilec164.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-06T15:42:09Z' class='post-time'>
                December 6, 2019,  3:42pm
              </time>
              <meta itemprop='dateModified' content='2019-12-06T15:42:09Z'>
          <span itemprop='position'>#170</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>
<p>sudo journalctl -b | grep -i denied<br>
Dec 06 15:35:06 host audit[1538]: AVC apparmor=â€œDENIEDâ€ operation=â€œlinkâ€ info=â€œlink not subset of targetâ€ error=-13 profile="/usr/bin/apt-get" name="/usr/lib/security-misc/pam_tally2-info.dpkg-tmp" pid=1538 comm=â€œdpkgâ€ requested_mask=â€œxâ€ denied_mask=â€œxâ€ fsuid=0 ouid=0 target="/usr/lib/security-misc/pam_tally2-info"<br>
Dec 06 15:35:06 host kernel: audit: type=1400 audit(1575646506.818:19): apparmor=â€œDENIEDâ€ operation=â€œlinkâ€ info=â€œlink not subset of targetâ€ error=-13 profile="/usr/bin/apt-get" name="/usr/lib/security-misc/pam_tally2-info.dpkg-tmp" pid=1538 comm=â€œdpkgâ€ requested_mask=â€œxâ€ denied_mask=â€œxâ€ fsuid=0 ouid=0 target="/usr/lib/security-misc/pam_tally2-info"</p>
</blockquote>
<p>Could you fix this one please?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-06T17:00:33Z' class='post-time'>
                December 6, 2019,  5:00pm
              </time>
              <meta itemprop='dateModified' content='2019-12-06T17:00:33Z'>
          <span itemprop='position'>#171</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Iâ€™m not sure what the issue is. Apt already has access to all of /usr/lib.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/blob/master/etc/apparmor.d/apt-get#L51" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/blob/master/etc/apparmor.d/apt-get#L51" target="_blank">Whonix/apparmor-profile-everything/blob/master/etc/apparmor.d/apt-get#L51</a></h4>
<pre class="onebox"><code class="lang-d/apt-get"><ol class="start lines" start="41" style="counter-reset: li-counter 40 ;">
<li>
</li>
<li>## Programs and libraries.</li>
<li>## TODO: Allow execution of only needed binaries.</li>
<li>/{,usr/,usr/local/}{,s}bin/ r,</li>
<li>/{,usr/,usr/local/}{,s}bin/** rwmix,</li>
<li>owner /{,usr/,usr/local/}{,s}bin/** rwixl,</li>
<li>/opt/ r,</li>
<li>/opt/** rwmix,</li>
<li>owner /opt/** rwixl,</li>
<li>/{,usr/,usr/local/}lib{,32,64}/ r,</li>
<li class="selected">/{,usr/,usr/local/}lib{,32,64}/** rwmixl,</li>
<li>owner /{,usr/,usr/local/}lib{,32,64}/** rwmixlk,</li>
<li>/usr/{,local/}{,share,include}/ r,</li>
<li>/usr/{,local/}{,share,include}/** rwix,</li>
<li>owner /usr/{,local/}{,share,include}/** rwixl,</li>
<li>/usr/{,local/}games/ r,</li>
<li>/usr/{,local/}games/** rw,</li>
<li>owner /usr/{,local/}games/** rwl,</li>
<li>
</li>
<li>## Contains kernel module source files.</li>
<li>## TODO: Make sure this cannot be abused.</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>It just canâ€™t lock (the <code>k</code> permission) files it isnâ€™t an owner of. Maybe try adding the <code>k</code> permission to line 51.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-06T20:03:43Z' class='post-time'>
                December 6, 2019,  8:03pm
              </time>
              <meta itemprop='dateModified' content='2019-12-06T20:03:43Z'>
          <span itemprop='position'>#172</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>We should look into pam_apparmor. From what I can see, it allows us to give specific users their own apparmor profile. So, as soon as the <code>user</code> user logs in, we can make them switch to their own, more restrictive profile.</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://gitlab.com/assets/favicon-7901bd695fb93edb07975966062049829afb56cf11511236e61bcf425070e36e.png" class="site-icon" width="16" height="16">
      <a href="../../../external.html?link=https://gitlab.com/apparmor/apparmor/wikis/Pam_apparmor" target="_blank">GitLab</a>
  </header>
  <article class="onebox-body">
    <img src="../../../external.html?link=https://gitlab.com/uploads/-/system/project/avatar/4484878/apparmor-red-diag_1w2h.png" class="thumbnail onebox-avatar" width="60" height="60">

<h3><a href="../../../external.html?link=https://gitlab.com/apparmor/apparmor/wikis/Pam_apparmor" target="_blank">Pam_apparmor Â· Wiki Â· AppArmor / apparmor</a></h3>

<p>The AppArmor user space development project.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-06T21:08:45Z' class='post-time'>
                December 6, 2019,  9:08pm
              </time>
              <meta itemprop='dateModified' content='2019-12-06T21:08:45Z'>
          <span itemprop='position'>#173</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I could work on pam integration. Package? apparmor-profile-everything?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T07:44:22Z' class='post-time'>
                December 7, 2019,  7:44am
              </time>
              <meta itemprop='dateModified' content='2019-12-07T07:44:22Z'>
          <span itemprop='position'>#174</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="171" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>It just canâ€™t lock (the <code>k</code> permission) files it isnâ€™t an owner of. Maybe try adding the <code>k</code> permission to line 51.</p>
</blockquote>
</aside>
<p>Done in git master. That didnâ€™t fix it. This issue is only happening when upgrading pacakge security-misc. Cannot reproduce with <code>sudo apt install --reinstall security-misc</code>. Only only reproduce through <code>sudo apt dist-upgrade</code> when there is an upgrade for <code>security-misc</code>.</p>
<p>To reproduce could you please download a version of security-misc?<br>
(This is required because apt cannot write to user home.)</p>
<pre><code>cd /tmp
apt dowload security-misc
</code></pre>
<p>Maybe move to home folder.</p>
<p>Then produce a newer version. Or I produce a newer version. Then downgrade / upgrade among them? Not yet tested. Can apt install from file? I usually used dpkg. But perhaps for debugging weâ€™ll just make the APT profile match DPKG?</p>
<p>Are you sure that line</p>
<pre><code>/{,usr/,usr/local/}lib{,32,64}/** rwmixlk,
</code></pre>
<p>matches</p>
<pre><code>/usr/lib/security-misc/pam_tally2-info.dpkg-tmp
</code></pre>
<p>?</p>
<blockquote>
<p>apparmor=â€œDENIEDâ€ operation=â€œlinkâ€ info=â€œlink not subset of targetâ€ error=-13 profile="/usr/bin/apt-get" name="/usr/lib/security-misc/pam_tally2-info.dpkg-tmp" pid=1523 comm=â€œdpkgâ€ requested_mask=â€œxâ€ denied_mask=â€œxâ€ fsuid=0 ouid=0 target="/usr/lib/security-misc/pam_tally2-info"</p>
</blockquote>
<p>Trying to wrap my head around it. I always got confused by AppArmor. Maybe now itâ€™s time to ask.</p>
<blockquote>
<p>profile="/usr/bin/apt-get"</p>
</blockquote>
<p>Alright so it can only be fixed in that profile. Thatâ€™s the profile causting the error.</p>
<blockquote>
<p>operation=â€œlinkâ€</p>
</blockquote>
<p>Why operation link?</p>
<blockquote>
<p>info=â€œlink not subset of targetâ€</p>
</blockquote>
<p>Does looking at the apparmor source around that link help?</p>
<blockquote>
<p>comm=â€œdpkgâ€</p>
</blockquote>
<p>Itâ€™s APT which called DPKG. While itâ€™s the APT profile, itâ€™s DPKG attempting to run this operation. Doesnâ€™t get us any closer.</p>
<blockquote>
<p>denied_mask=â€œxâ€</p>
</blockquote>
<p>Execute? apparmor profile apt-get missing flag <code>x</code> for line <code>/{,usr/,usr/local/}lib{,32,64}/** rwmixlk,</code>? But that line already includes <code>x</code>. Maybe itâ€™s some other line that is triggering this?</p>
<blockquote>
<p>name="/usr/lib/security-misc/pam_tally2-info.dpkg-tmp"</p>
</blockquote>
<blockquote>
<p>target="/usr/lib/security-misc/pam_tally2-info"</p>
</blockquote>
<p>I am confused by name vs target. What means name, what means target?</p>
<hr>
<p>Why is it only happening for <code>/usr/lib/security-misc/pam_tally2-info</code> but not for <code>/usr/lib/security-misc/pam-abort-on-locked-password</code>? Neither file changed on disk. Only other parts of security-misc changed. Yet, only pam_tally2-info is throwing the error. Which indicates that the issue is not in apt-get apparmor profile but elsewhere?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T08:04:42Z' class='post-time'>
                December 7, 2019,  8:04am
              </time>
              <meta itemprop='dateModified' content='2019-12-07T08:04:42Z'>
          <span itemprop='position'>#175</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>To find out whatâ€™s special about <code>pam_tally2-info</code> I grepped whole Whonix source code for <code>pam_tally2-info</code>.</p>
<p>Found this:</p>
<blockquote>
<p>apparmor-profile-anondist/etc/apparmor.d/abstractions/base.anondist:  /usr/lib/security-misc/pam_tally2-info rpx</p>
</blockquote>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-anondist/blob/master/etc/apparmor.d/abstractions/base.anondist#L237" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-anondist/blob/master/etc/apparmor.d/abstractions/base.anondist#L237" target="_blank">Whonix/apparmor-profile-anondist/blob/master/etc/apparmor.d/abstractions/base.anondist#L237</a></h4>
<pre class="onebox"><code class="lang-anondist"><ol class="start lines" start="227" style="counter-reset: li-counter 226 ;">
<li>/etc/machine-id r,</li>
<li>/var/lib/dbus/ r,</li>
<li>/var/lib/dbus/machine-id rwk,</li>
<li>/var/lib/dbus/machine-id.* rwk,</li>
<li>
</li>
<li>## security-misc</li>
<li>## AppArmor feature request:</li>
<li>## allow adding permissions globally using drop-in .d folder</li>
<li>## https://gitlab.com/apparmor/apparmor/issues/50</li>
<li>/usr/lib/security-misc/permission-lockdown rpx,</li>
<li class="selected">/usr/lib/security-misc/pam_tally2-info rpx,</li>
<li>
</li>
<li>## }} Whonix, Kicksecure, uwt, security-misc specific additions end here</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>And <code>/etc/apparmor.d/apt-get</code> uses <code>#include &lt;abstractions/base&gt;</code>. Could that be the cause?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T12:51:47Z' class='post-time'>
                December 7, 2019, 12:51pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T12:51:47Z'>
          <span itemprop='position'>#176</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="173" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Package? apparmor-profile-everything?</p>
</blockquote>
</aside>
<p>Yes. It should be part of apparmor-profile-everything.</p>
<aside class="quote no-group" data-post="174" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Why operation link?</p>
</blockquote>
</aside>
<p>Probably for symlinks.</p>
<aside class="quote no-group" data-post="174" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I am confused by name vs target. What means name, what means target?</p>
</blockquote>
</aside>
<p>Probably means the name of the file youâ€™re symlinking and the target is where you want to symlink it to.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T13:21:58Z' class='post-time'>
                December 7, 2019,  1:21pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T13:21:58Z'>
          <span itemprop='position'>#177</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a href="../../../external.html?link=https://github.com/Whonix/security-misc/blob/master/usr/lib/security-misc/remove-system.map">https://github.com/Whonix/security-misc/blob/master/usr/lib/security-misc/remove-system.map</a> and <a href="../../../external.html?link=https://github.com/Whonix/helper-scripts/blob/master/usr/lib/helper-scripts/first-boot-skel">https://github.com/Whonix/helper-scripts/blob/master/usr/lib/helper-scripts/first-boot-skel</a> need their own apparmor profiles too.</p>
<p>remove-system.map needs access to /boot and first-boot-skel needs access to home directories.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T13:34:28Z' class='post-time'>
                December 7, 2019,  1:34pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T13:34:28Z'>
          <span itemprop='position'>#178</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Instead of creating profiles for every shell script that needs extra permissions, we might be able to create a whonix-shell-script profile and make all our scripts run under that.</p>
<p>It would be far easier to manage.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T14:02:17Z' class='post-time'>
                December 7, 2019,  2:02pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T14:02:17Z'>
          <span itemprop='position'>#179</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="175" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>And <code>/etc/apparmor.d/apt-get</code> uses <code>#include &lt;abstractions/base&gt;</code> . Could that be the cause?</p>
</blockquote>
</aside>
<p>That was the issue.</p>
<p>I fixed that and a few other things <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/9">https://github.com/Whonix/apparmor-profile-everything/pull/9</a></p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T15:24:09Z' class='post-time'>
                December 7, 2019,  3:24pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T15:24:09Z'>
          <span itemprop='position'>#180</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="178" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Instead of creating profiles for every shell script that needs extra permissions, we might be able to create a whonix-shell-script profile and make all our scripts run under that.</p>
</blockquote>
</aside>
<p>I did that. Dunno the best way to make all the scripts run under it so I just created a generic abstraction and a profile with each script that includes the abstraction.</p>
<p>whonix-shell-script profile: <a href="../../../external.html?link=https://paste.debian.net/hidden/f15599a4/">https://paste.debian.net/hidden/f15599a4/</a></p>
<p>whonix-shell-script abstraction: <a href="../../../external.html?link=https://paste.debian.net/hidden/280123b0/">https://paste.debian.net/hidden/280123b0/</a></p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T15:38:27Z' class='post-time'>
                December 7, 2019,  3:38pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T15:38:27Z'>
          <span itemprop='position'>#181</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><code>haveged.service</code>, <code>onion-grater.service</code>, <code>sdwdate.service</code> and <code>kloak.service</code> are all failing when apparmor-profile-everything is being used.</p>
<p>This isnâ€™t an issue with the apparmor profile. Some of those services even have their own profile. This is caused by the systemd sandboxing in those services. If you disable the sandboxing and reboot, they work fine.</p>
<p>The only explanation I can find for this is <a href="../../../external.html?link=https://forums.grsecurity.net/viewtopic.php?t=4326#p15815">https://forums.grsecurity.net/viewtopic.php?t=4326#p15815</a></p>
<blockquote>
<p>It would be because that option causes Tor to be run with a private mount namespace created on demand, so any inode associated with /dev/urandom inside that namespace isnâ€™t knowable from the point where RBAC is loaded. That option shouldnâ€™t be enabled with RBAC.</p>
</blockquote>
<p>I donâ€™t know how to fix this except disabling the sandboxing which would worsen security.</p>
<p>We could ask the upstream apparmor and systemd devs.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T15:45:30Z' class='post-time'>
                December 7, 2019,  3:45pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T15:45:30Z'>
          <span itemprop='position'>#182</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Yes, please ask.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="8339fdfa.html?page=8">â† previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="83391448.html?page=10">next page â†’</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
