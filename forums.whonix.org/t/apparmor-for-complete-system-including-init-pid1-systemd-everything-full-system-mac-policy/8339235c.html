<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy - AppArmor - Whonix Forum</title>
    <meta name="description" content="Currently, Whonix only has AppArmor profiles for a few high-risk applications. This isn’t the best. It would be much better to have everything confined by default, including init which would greatly increase security. 
T&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="8339235c.html?page=7" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy&#39;" href="8339.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339?page=7" />
<meta name="twitter:url" content="https://forums.whonix.org/t/apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339?page=7" />
<meta property="og:title" content="AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy" />
<meta name="twitter:title" content="AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy" />
<meta property="og:description" content="Oh, I didn’t think of that. Removing apparmor-profile-everything won’t work as those files are already protected but I didn’t think of protecting the apparmor binaries/libraries. We’ll need to figure out exactly which files apparmor uses. But, this will break apparmor updates. We could just only allow apparmor updates when apparmor is disabled.  Alternatively (or both for defense in depth), we can make the initramfs hook check if the needed files are there and if not, shuts down." />
<meta name="twitter:description" content="Oh, I didn’t think of that. Removing apparmor-profile-everything won’t work as those files are already protected but I didn’t think of protecting the apparmor binaries/libraries. We’ll need to figure out exactly which files apparmor uses. But, this will break apparmor updates. We could just only allow apparmor updates when apparmor is disabled.  Alternatively (or both for defense in depth), we can make the initramfs hook check if the needed files are there and if not, shuts down." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="97 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="496 ❤" />
<meta property="article:published_time" content="2019-11-19T17:12:04+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="8339c575.html?page=6">
        <link rel="next" href="8339fdfa.html?page=8">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="8339.html">AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/apparmor/14.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #12A89D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>AppArmor</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T17:12:04Z' class='post-time'>
                November 19, 2019,  5:12pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T17:12:04Z'>
          <span itemprop='position'>#122</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="121" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>How would <code>dangerous-files</code> block <code>sudo apt purge apparmor</code> ?</p>
</blockquote>
</aside>
<p>Oh, I didn’t think of that. Removing apparmor-profile-everything won’t work as those files are already protected but I didn’t think of protecting the apparmor binaries/libraries. We’ll need to figure out exactly which files apparmor uses. But, this will break apparmor updates. We could just only allow apparmor updates when apparmor is disabled.</p>
<p>Alternatively (or both for defense in depth), we can make the initramfs hook check if the needed files are there and if not, shuts down.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T17:37:57Z' class='post-time'>
                November 19, 2019,  5:37pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T17:37:57Z'>
          <span itemprop='position'>#123</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Files/folders AppArmor uses that I know of:</p>
<ul>
<li>/lib/apparmor/</li>
<li>/etc/apparmor/</li>
<li>/var/cache/apparmor/</li>
<li>/sys/module/apparmor/</li>
<li>/sbin/apparmor_parser</li>
<li>/usr/sbin/aa-*</li>
</ul>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T17:41:08Z' class='post-time'>
                November 19, 2019,  5:41pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T17:41:08Z'>
          <span itemprop='position'>#124</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-post="121" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<blockquote>
<p>Do we really need two? Could just be the same loop?</p>
</blockquote>
<p>How would that work? Especially for the packages.</p>
</blockquote>
<p>I’ll see if I can implement the wrapper. Secure, yet not breaking apt’s interface (except for non-whitelisted).</p>
</blockquote>
</aside>
<p>Work in progress but might be good enough for now, see TODO (expires in 90 days):<br>
<a href="../../../external.html?link=https://paste.debian.net/hidden/c49a90d2/" class="onebox" target="_blank">https://paste.debian.net/hidden/c49a90d2/</a></p>
<aside class="quote no-group" data-post="122" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Oh, I didn’t think of that. Removing apparmor-profile-everything won’t work as those files are already protected but I didn’t think of protecting the apparmor binaries/libraries. We’ll need to figure out exactly which files apparmor uses. But, this will break apparmor updates. We could just only allow apparmor updates when apparmor is disabled.</p>
</blockquote>
</aside>
<p>Does not sound great. Sounds like a blacklisting approach. Hard to get complete and hard to maintain long term.</p>
<aside class="quote no-group" data-post="122" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Alternatively (or both for defense in depth), we can make the initramfs hook check if the needed files are there and if not, shuts down.</p>
</blockquote>
</aside>
<p>Sounds much better.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T17:45:18Z' class='post-time'>
                November 19, 2019,  5:45pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T17:45:18Z'>
          <span itemprop='position'>#125</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="124" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Sounds like a blacklisting approach.</p>
</blockquote>
</aside>
<p>The alternative is finding every single file and folder used by every package in the debian repos and manually adding rules for them so apt can actually install them.</p>
<p>Stuff like this (apt) needs to be a blacklist.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T18:02:59Z' class='post-time'>
                November 19, 2019,  6:02pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T18:02:59Z'>
          <span itemprop='position'>#126</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="125" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Stuff like this (apt) needs to be a blacklist.</p>
</blockquote>
</aside>
<p>Why?<br>
Apt won’t be able to update itself?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T18:07:15Z' class='post-time'>
                November 19, 2019,  6:07pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T18:07:15Z'>
          <span itemprop='position'>#127</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="126" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Why?</p>
</blockquote>
</aside>
<p>Because:</p>
<blockquote>
<p>The alternative is finding every single file and folder used by every package in the debian repos and manually adding rules for them so apt can actually install them.</p>
</blockquote>
<p>We need apt to be able to install programs in whatever directories they need so we need to grant access to all of /lib, /etc, /bin etc.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T18:13:53Z' class='post-time'>
                November 19, 2019,  6:13pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T18:13:53Z'>
          <span itemprop='position'>#128</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Also, I think it would be a good idea for whonixcheck to check for any unconfined processes and warn the user about it if any are found. Grepping <code>ps auxZ</code> output should be fine for this.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/ThatNewDude'><span itemprop='name'>ThatNewDude</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T18:25:41Z' class='post-time'>
                November 19, 2019,  6:25pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T18:25:41Z'>
          <span itemprop='position'>#129</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I’m not a tech guy, so forgive me if this is a horrible concept. But would publishing a locked down version, with a Full MAC policy and that is not meant to be updated by the user, a viable option? Something along the lines of Tails releases. Have a standard Whonix OS, that we all use now and is updated, and a OS that is only updated for TOR Browser releases and other critical updates?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="3" />
           <span class='post-likes'>3 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T18:31:50Z' class='post-time'>
                November 19, 2019,  6:31pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T18:31:50Z'>
          <span itemprop='position'>#130</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Publishing more Whonix versions will make releases take far more effort and will give only a small subset of users these security enhancements.</p>
<p>Updates are very important. We can’t force users to use outdated software with known vulnerabilities.</p>
<p>The current policy already allows updating and it’s (mostly) fine. The problem is just locking this down further so it can’t be abused easily but even then, only an advanced and very targeted attack can really abuse this.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T19:46:21Z' class='post-time'>
                November 19, 2019,  7:46pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T19:46:21Z'>
          <span itemprop='position'>#131</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a> have you tested this on Qubes yet?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T22:38:53Z' class='post-time'>
                November 19, 2019, 10:38pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T22:38:53Z'>
          <span itemprop='position'>#132</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="125" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>The alternative is finding every single file and folder used by every package in the debian repos and manually adding rules for them so apt can actually install them.</p>
</blockquote>
</aside>
<p>Sounds impossible.</p>
<aside class="quote no-group" data-post="127" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We need apt to be able to install programs in whatever directories they need so we need to grant access to all of /lib, /etc, /bin etc.</p>
</blockquote>
</aside>
<p>Yes. The real APT should have unlimited write access to all the usual folders it writes to.</p>
<p>The real APT itself would not be executable by user. Restricted by apparmor. And restricted APT would filter insane commands. Only restricted APT would be allowed to call real APT.</p>
<p>(From user perspective, just a regular APT call. Wrapper magic.)</p>
<aside class="quote no-group quote-modified" data-post="122" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>How would <code>dangerous-files</code> block <code>sudo apt purge apparmor</code> ?</p>
</blockquote>
<p>Oh, I didn’t think of that. Removing apparmor-profile-everything won’t work as those files are already protected but I didn’t think of protecting the apparmor binaries/libraries. We’ll need to figure out exactly which files apparmor uses. But, this will break apparmor updates. We could just only allow apparmor updates when apparmor is disabled.</p>
</blockquote>
</aside>
<p>This does not seem reliable / stable. Better keep it simple. As little application / package specific as possible.</p>
<p>Removal of apparmor-profile-everything, apparmor and other essential packages could be added to a list packages_refuse_removal or so. And then restricted APT would refuse to remove these.</p>
<p>For example, essential packages list can be auto generated using using dpkg-query.</p>
<pre><code>dpkg-query -Wf '${Package} ${Essential}\n'
</code></pre>
<p>(<code>dpkg-query -Wf '${Package} ${Essential}\n' | grep yes</code>, but the parsing needs to be better.)</p>
<p>Enumerating packages we don’t want removed seems like a much more reliable / long term stable approach to me than listing the individual file names shipped by these packages. Also these packages we don’t want removed have dependencies. Messing with these could also break things.</p>
<p>For example we could add <code>linux-image-amd64</code> to <code>packages_refuse_removal</code>. <code>linux-image-amd64</code> only. Since that is a “top level package”. We would not add <code>linux-image-4.19.0-6-amd64</code> since that is a dependency of <code>linux-image-amd64</code>. Protecting the dependencies of “top level packages” such as <code>linux-image-amd64</code> from being removed would include protecting the specific current kernel package.</p>
<p>For that, we’d need to simulate apt output before running it. APT supports <code>--simulate</code>. Also <code>--quiet=2</code> to make it easier machine readable. For easier parsing. We could parse that. For example:</p>
<blockquote>
<p>apt-get --simulate --quiet=2 purge linux-image-4.19.0-6-amd64<br>
NOTE: This is only a simulation!<br>
apt-get needs root privileges for real execution.<br>
Keep also in mind that locking is deactivated,<br>
so don’t depend on the relevance to the real current situation!<br>
Purg linux-image-amd64 [4.19+105+deb10u1]<br>
Purg linux-image-4.19.0-6-amd64 [4.19.67-2+deb10u2]</p>
</blockquote>
<p>That one restricted APT should abort since it contains linux-image-amd64.</p>
<p>Maybe there are further apt command line parameters to make parsing even easier.</p>
<p>If we added <code>non-qubes-whonix-workstation-xfce</code> among other “Whonix top level packages” to <code>packages_refuse_removal</code>, that would go a long way. Would keep the system in a sane state with no critical packages removes. Just need to identify other “loose” packages such as <code>linux-image-amd64</code> which is not a dependency of <code>non-qubes-whonix-workstation-xfce</code>.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T23:21:07Z' class='post-time'>
                November 19, 2019, 11:21pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T23:21:07Z'>
          <span itemprop='position'>#133</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="132" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Sounds impossible.</p>
</blockquote>
</aside>
<p>It is. That’s why we need to blacklist.</p>
<aside class="quote no-group" data-post="132" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Removal of apparmor-profile-everything, apparmor and other essential packages could be added to a list packages_refuse_removal or so. And then restricted APT would refuse to remove these.</p>
</blockquote>
</aside>
<p>That sounds like a far better idea.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T23:29:52Z' class='post-time'>
                November 19, 2019, 11:29pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T23:29:52Z'>
          <span itemprop='position'>#134</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Glad you like it!</p>
<p>I couldn’t stop myself and implemented most of what I said in my previous post regarding restricted APT. Took the liberty to add to git.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/blob/master/usr/bin/rapt" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/blob/master/usr/bin/rapt" target="_blank">Whonix/apparmor-profile-everything/blob/master/usr/bin/rapt</a></h4>
<pre><code class="lang-">#!/usr/bin/env -S -i /bin/bash

set -e

## Wrapper for apt-get meant to be used with apparmor-profile-anondist
## to prevent an attacker abusing apt's command line arguments and the
## extra permissions granted in its AppArmor profile.
##
## For example this command can replace the kernel images:
## apt-get update -o APT::Update::Pre-Invoke::=/bin/mv /malicious_kernel /boot/vmlinuz
##
## /boot access is not allowed in the main profile but is allowed in the
## apt-get profile for kernel upgrades.

arch="$(dpkg --print-architecture)"
kernel_package="linux-image-${arch}"
header_package="linux-headers-${arch}"

## TODO
packages_refuse_removal="apparmor $kernel_package $header_package"
</code></pre>

  This file has been truncated. <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/blob/master/usr/bin/rapt" target="_blank">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Please have a look. I think I can do a good job wrt rapt, not so much inventing the apparmor stuff. Let me know any other requirements for rapt, I’ll see what I can do or send pull requests.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T23:39:30Z' class='post-time'>
                November 19, 2019, 11:39pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T23:39:30Z'>
          <span itemprop='position'>#135</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>It looks great!</p>
<p>Whenever running it with the <code>update</code> command or no command at all (just <code>./rapt</code>), I get this error:</p>
<pre><code>E: Command line option --simulate is not understood in combination with the other options
</code></pre>
<p>Also, in the top comment, it says “apparmor-profile-anondist” when it should be “apparmor-profile-everything”. That was my mistake.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-19T23:41:51Z' class='post-time'>
                November 19, 2019, 11:41pm
              </time>
              <meta itemprop='dateModified' content='2019-11-19T23:41:51Z'>
          <span itemprop='position'>#136</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="129" data-topic="8339" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/t/0ea827/40.png" class="avatar"> ThatNewDude:</div>
<blockquote>
<p>I’m not a tech guy, so forgive me if this is a horrible concept. But would publishing a locked down version, with a Full MAC policy and that is not meant to be updated by the user, a viable option? Something along the lines of Tails releases. Have a standard Whonix OS, that we all use now and is updated, and a OS that is only updated for TOR Browser releases and other critical updates?</p>
</blockquote>
</aside>
<p>A compromise would be having a static full system MAC mode in GRUB that’s not meant to support arbitrary application installs  for it to be more maintainable and not an entire separate spin.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-20T08:13:56Z' class='post-time'>
                November 20, 2019,  8:13am
              </time>
              <meta itemprop='dateModified' content='2019-11-20T08:13:56Z'>
          <span itemprop='position'>#137</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="135" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Whenever running it with the <code>update</code> command or no command at all (just <code>./rapt</code> ), I get this error:</p>
<pre><code class="lang-auto">E: Command line option --simulate is not understood in combination with the other options
</code></pre>
<p>Also, in the top comment, it says “apparmor-profile-anondist” when it should be “apparmor-profile-everything”. That was my mistake.</p>
</blockquote>
</aside>
<p>Fixed.</p>
<aside class="quote no-group" data-post="135" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>It looks great!</p>
</blockquote>
</aside>
<p>There might still be a ton of test cases… This also deserves unit tests for common apt commands.</p>
<p>What about exit codes for <code>rapt</code>? Usually, forward the exit code by real <code>apt</code>. But in case of <code>rapt</code> error out…? Start with exit code <code>150</code> (or else)? Then for each failure case exit with a different exit code?</p>
<p><a href="../../../external.html?link=http://tldp.org/LDP/abs/html/exitcodes.html" class="onebox" target="_blank">http://tldp.org/LDP/abs/html/exitcodes.html</a></p>
<p>That would be useful for the unit testing. To check if it exit with errors as expected for that test case.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-20T08:17:04Z' class='post-time'>
                November 20, 2019,  8:17am
              </time>
              <meta itemprop='dateModified' content='2019-11-20T08:17:04Z'>
          <span itemprop='position'>#138</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Please let me know</p>
<ul>
<li>all kinds of APT commands which should be restricted. (or not so much since we use white listing),</li>
<li>which ones should be permitted,</li>
<li>and a list of packages which should be refused removal.</li>
</ul>
<p>So I can implement and test.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-20T08:32:33Z' class='post-time'>
                November 20, 2019,  8:32am
              </time>
              <meta itemprop='dateModified' content='2019-11-20T08:32:33Z'>
          <span itemprop='position'>#139</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-post="136" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<blockquote>
<p>I’m not a tech guy, so forgive me if this is a horrible concept. But would publishing a locked down version, with a Full MAC policy and that is not meant to be updated by the user, a viable option? Something along the lines of Tails releases. Have a standard Whonix OS, that we all use now and is updated, and a OS that is only updated for TOR Browser releases and other critical updates?</p>
</blockquote>
<p>A compromise would be having a static full system MAC mode in GRUB that’s not meant to support arbitrary application installs for it to be more maintainable and not an entire separate spin.</p>
</blockquote>
</aside>
<p>More boot modes…? But it could get a bit convoluted. This was as far as it was discussed earlier:</p>
<hr>
<p>Alright. So for future when apparmor-profile-everything is ready…</p>
<ul>
<li>persistent + regular [apparmor-profile-everything]</li>
<li>persistent + full-root (DANGER!)</li>
<li>live + regular [apparmor-profile-everything]</li>
<li>persistent + full-root (DANGER!)</li>
</ul>
<p>And later if no-root gets implemented…</p>
<ul>
<li>persistent + no-root [apparmor-profile-everything]</li>
<li>persistent + root [apparmor-profile-everything]</li>
<li>persistent + full-root (DANGER!)</li>
<li>live + no-root [apparmor-profile-everything]</li>
<li>live + root [apparmor-profile-everything]</li>
<li>persistent + full-root (DANGER!)</li>
</ul>
<p>(Didn’t think much yet about the wording. Open for suggestions. Can be done when time has come.)</p>
<p>Related: <a href="../multiple-boot-modes-for-better-security-persistent-user-live-user-persistent-secureadmin-persistent-superadmin-persistent-recovery-mode/7708.html" class="inline-onebox">multiple boot modes for better security: persistent + root | persistent + noroot | live + root | live + noroot</a></p>
<hr>
<p>Now we have more suggestions which could be different boot modes.</p>
<ul>
<li>“read-only root” (no modifications at all) [0]</li>
<li>No arbitrary apt package installation.</li>
</ul>
<hr>
<p>[0] No apt package installation, removal, upgrades. Similar to “read-only root”. Not really “real” read-only root.</p>
<hr>
<aside class="quote no-group" data-post="136" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>A compromise would be having a static full system MAC mode in GRUB that’s not meant to support arbitrary application installs for it to be more maintainable and not an entire separate spin.</p>
</blockquote>
</aside>
<p>I am not sure “no arbitrary package installation” gives us any more flexibility / features than “read-only root”. At the same time “no arbitrary package installation” is probably more difficult to implement than “read-only root”. Or perhaps better called “no APT”.</p>
<p>I don’t know what <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/madaidan">@madaidan</a> thinks about a “no APT” or “no writing to /etc/ /usr/bin” or “non-admin” boot mode.</p>
<p>Perhaps this is the same as “noroot boot mode”? Perhaps the “noroot boot mode” should have a more restrictive full system apparmor profile?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-20T08:50:29Z' class='post-time'>
                November 20, 2019,  8:50am
              </time>
              <meta itemprop='dateModified' content='2019-11-20T08:50:29Z'>
          <span itemprop='position'>#140</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Probably best to develop this on plain Debian? (Non-Whonix) Worry about Whonix integration later. Does this work on Debian yet?</p>
<p>There is a lot of bad things a compromised root can do with <code>mount</code> such as remounting apt / rapt with a script of its choice. Not sure how this could be contained? Can you let the “system” use <code>mount</code> but any “users” (those using serial console, virtual terminal or ) not using <code>mount</code>?</p>
<p>Since initrd is unconfined for now… Are there things in initrd (processes) which are still lingering after boot and unconfined? Writing to the initrd (in memory, not disk image after booting is done shouldn’t have bad effects and is blocked anyhow?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-20T15:12:28Z' class='post-time'>
                November 20, 2019,  3:12pm
              </time>
              <meta itemprop='dateModified' content='2019-11-20T15:12:28Z'>
          <span itemprop='position'>#141</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="139" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>And later if no-root gets implemented…</p>
</blockquote>
</aside>
<p>Thinking about this to prevent choice proliferation:</p>
<p>What would be the use case for a root system <em>with</em> apparmor everything?</p>
<aside class="quote no-group" data-post="139" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Now we have more suggestions which could be different boot modes.</p>
<ul>
<li>“read-only root” (no modifications at all) [0]</li>
<li>No arbitrary apt package installation.</li>
</ul>
</blockquote>
</aside>
<p>You might as well make no-apt synonymous with apparmor-everything because there is no functional advantage to having apt on a system with apparmor-everything (unless you are editing system policy and adding support for more programs).</p>
<p>These are the only boot combinations that make sense to me:</p>
<p>persistent + full-root (DANGER!)<br>
persistent + no-root<br>
persistent + no-root [apparmor-profile-everything]<br>
live + root <strong>(*)</strong><br>
live + no-root<br>
live + no-root [apparmor-profile-everything]</p>
<p><strong>(*)</strong> I am not sure there’s any useful usecase for having full root in live mode since you can install stuff in no-root mode without needing the full root access.</p>
<aside class="quote no-group" data-post="139" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Perhaps this is the same as “noroot boot mode”? Perhaps the “noroot boot mode” should have a more restrictive full system apparmor profile?</p>
</blockquote>
</aside>
<p>On the contrary. This mode would be useful if a user wants to install and use arbitrary packages  from a safe source without risking full system compromise in case the software has a vuln. Apparmor-everything would make this impossible I think.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="8339c575.html?page=6">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="8339fdfa.html?page=8">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
