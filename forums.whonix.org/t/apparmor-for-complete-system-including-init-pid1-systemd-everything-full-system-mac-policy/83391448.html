<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy - AppArmor - Whonix Forum</title>
    <meta name="description" content="Currently, Whonix only has AppArmor profiles for a few high-risk applications. This isn‚Äôt the best. It would be much better to have everything confined by default, including init which would greatly increase security. 
T&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="83391448.html?page=10" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy&#39;" href="8339.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339?page=10" />
<meta name="twitter:url" content="https://forums.whonix.org/t/apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339?page=10" />
<meta property="og:title" content="AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy" />
<meta name="twitter:title" content="AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="97 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="496 ‚ù§" />
<meta property="article:published_time" content="2019-12-07T16:23:16+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="83390b08.html?page=9">
        <link rel="next" href="83391c8b.html?page=11">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="8339.html">AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/apparmor/14.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #12A89D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>AppArmor</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T16:23:16Z' class='post-time'>
                December 7, 2019,  4:23pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T16:23:16Z'>
          <span itemprop='position'>#183</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubissue">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/systemd/systemd/issues/14277" target="_blank">github.com/systemd/systemd</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewbox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/systemd/systemd/issues/14277" target="_blank">Systemd sandboxing fails when using a full system apparmor policy</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2019-12-07" data-time="16:22:46" data-timezone="UTC">04:22PM - 07 Dec 19 UTC</span>
      </div>


      <div class="user">
        <a href="../../../external.html?link=https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">systemd version the issue has been seen with
v241
Used distribution
Debian Buster
Expected behaviour you didn't see
Systemd services with sandboxing work fine when using...</p>
</div>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-07T23:26:26Z' class='post-time'>
                December 7, 2019, 11:26pm
              </time>
              <meta itemprop='dateModified' content='2019-12-07T23:26:26Z'>
          <span itemprop='position'>#184</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Which package should the whonix-shell-script profile be in?</p>
<p>I think we should remove the apparmor profiles in security-misc and add whonix-shell-script to apparmor-profile-everything.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-08T05:14:01Z' class='post-time'>
                December 8, 2019,  5:14am
              </time>
              <meta itemprop='dateModified' content='2019-12-08T05:14:01Z'>
          <span itemprop='position'>#185</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Can these all be in apparmor-profile-everything?<br>
apparmor-profile-anomdist abstractions/base longer requires modification?<br>
Then yes. All in apparmor-profile-everything.</p>
<p>Alternatively:<br>
The abstraction: apparmor-profile-anondist.<br>
The profiles: wherever the corresponding scripts reside.</p>
<p>Not whonix-shell-script. kicksecure-shell-script.</p>
<p>Trying to view this from perspective of third parties and customization. Allowing them to pull packages without unnecessary dependencies.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-08T06:25:11Z' class='post-time'>
                December 8, 2019,  6:25am
              </time>
              <meta itemprop='dateModified' content='2019-12-08T06:25:11Z'>
          <span itemprop='position'>#186</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-post="179" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>And <code>/etc/apparmor.d/apt-get</code> uses <code>#include &lt;abstractions/base&gt;</code> . Could that be the cause?</p>
</blockquote>
<p>That was the issue.</p>
</blockquote>
</aside>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-anondist/commit/a55417e067616f1cb5a1d64725f43c26b1a40de1" target="_blank">github.com/Whonix/apparmor-profile-anondist</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-anondist/commit/a55417e067616f1cb5a1d64725f43c26b1a40de1" target="_blank">remove</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2019-12-08" data-time="06:23:44" data-timezone="UTC">06:23AM - 08 Dec 19 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 0 additions and 3 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-anondist/commit/a55417e067616f1cb5a1d64725f43c26b1a40de1" target="_blank">
          <span class="added">+0</span>
          <span class="removed">-3</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">/usr/lib/security-misc/permission-lockdown rpx,
 /usr/lib/security-misc/pam_tally2-info rpx,
since already done in apparmor-profile-everything
https://forums.whonix.org/t/apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339/174</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-08T15:18:45Z' class='post-time'>
                December 8, 2019,  3:18pm
              </time>
              <meta itemprop='dateModified' content='2019-12-08T15:18:45Z'>
          <span itemprop='position'>#187</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="185" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Can these all be in apparmor-profile-everything?</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group" data-post="185" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>apparmor-profile-anomdist abstractions/base longer requires modification?</p>
</blockquote>
</aside>
<p>Why wouldn‚Äôt it?</p>
<aside class="quote no-group" data-post="185" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>The profiles: wherever the corresponding scripts reside.</p>
</blockquote>
</aside>
<p>There is only one profile that lists each script and there isn‚Äôt much point in splitting up 11 lines into 4 profiles.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-08T18:10:48Z' class='post-time'>
                December 8, 2019,  6:10pm
              </time>
              <meta itemprop='dateModified' content='2019-12-08T18:10:48Z'>
          <span itemprop='position'>#188</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/10" target="_blank">github.com/Whonix/apparmor-profile-everything</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/10" target="_blank">Deny access to kernel images and System.map files</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ‚Üê <code>madaidan:kernel-image</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2019-12-08" data-time="18:10:32" data-timezone="UTC">06:10PM - 08 Dec 19 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 5 additions and 0 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/10/files" target="_blank">
          <span class="added">+5</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-08T20:40:29Z' class='post-time'>
                December 8, 2019,  8:40pm
              </time>
              <meta itemprop='dateModified' content='2019-12-08T20:40:29Z'>
          <span itemprop='position'>#189</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<p><a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/pull/10">https://github.com/Whonix/apparmor-profile-everything/pull/10</a></p>
</blockquote>
<p>Merged.</p>
<p>Should also read access to all of /boot/* be prevented?</p>
<p>initrd containing anything sensitive? /boot/grub/grub.cfg worth being<br>
protected? /boot/config* sensitive? Anything else in /boot?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-08T21:02:29Z' class='post-time'>
                December 8, 2019,  9:02pm
              </time>
              <meta itemprop='dateModified' content='2019-12-08T21:02:29Z'>
          <span itemprop='position'>#190</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="189" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Should also read access to all of /boot/* be prevented?</p>
</blockquote>
</aside>
<p>It‚Äôs not allowed in the init-systemd profile anyway. That pull request was mainly about hiding other files like <code>/lib/modules/*/build/System.map</code> and not necessarily ones in /boot.</p>
<aside class="quote no-group" data-post="189" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>initrd containing anything sensitive?</p>
</blockquote>
</aside>
<p>Not that I‚Äôm aware of.</p>
<aside class="quote no-group" data-post="189" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>/boot/grub/grub.cfg worth being<br>
protected?</p>
</blockquote>
</aside>
<p>Write access? Yes.</p>
<p>Read access? Not much.</p>
<aside class="quote no-group" data-post="189" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>/boot/config* sensitive?</p>
</blockquote>
</aside>
<p>It can give an attacker a better idea of how the kernel is configured but hiding it would probably give a negligible gain, if any at all.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-09T07:12:19Z' class='post-time'>
                December 9, 2019,  7:12am
              </time>
              <meta itemprop='dateModified' content='2019-12-09T07:12:19Z'>
          <span itemprop='position'>#191</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-post="190" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>/boot/config* sensitive?</p>
</blockquote>
<p>It can give an attacker a better idea of how the kernel is configured but hiding it would probably give a negligible gain, if any at all.</p>
</blockquote>
</aside>
<p>I‚Äôd say lets remove it. Access to <code>/boot/config*</code> (kernel config), /boot/grub/grub.cfg (grub config) (i.e. all of <code>/boot</code> since we are at it, for consistency) as well as <code>/proc/cmdline</code> (among as much as sanely possible from <code>/proc</code> and <code>/sys</code> generally). The goal here would be to have (user or root) malware run ‚Äúin a vacuum‚Äù. Most applications would be able to run just fine ‚Äúin a vacuum‚Äù but malware trying ‚Äúweird‚Äù things could gather as little information (kernel config, kernel hardening settings, kernel pointer addresses) as possible to prevent it escalating from <code>user-&gt;root</code> or <code>root-&gt;kernel</code>.</p>
<p>Removing access to <code>/proc/cmdline</code> would break live mode indicator but perhaps live mode can be detected through some other way.</p>
<p>If apparmor-profile-everything already prevents reading kernel images (<a href="../../../external.html?link=https://phabricator.whonix.org/T943">https://phabricator.whonix.org/T943</a>) would it be worth to additionally remove read file system permission (<code>chmod o-r</code>) for kernel images (<a href="../../../external.html?link=https://phabricator.whonix.org/T937">https://phabricator.whonix.org/T937</a>) or would that be overkill? Maybe additionally adding the latter would be cleaner? Then those who want to read the kernel image for legitimate reasons (KVM kernel boot; security audit of our kernel, ‚Ä¶) would easier see why that is failing? They‚Äôd try to read the kernel image as non-root user - that works for most distributions. That would fail since blocked by file permissions. Easy to see. Then they‚Äôd try again as root which would also fail which would not be obvious that it‚Äôs apparmor-profile-everything blocking that.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-09T16:50:57Z' class='post-time'>
                December 9, 2019,  4:50pm
              </time>
              <meta itemprop='dateModified' content='2019-12-09T16:50:57Z'>
          <span itemprop='position'>#192</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="191" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I‚Äôd say lets remove it.</p>
</blockquote>
</aside>
<p>Maybe with something similar to <a href="../../../external.html?link=https://github.com/Whonix/security-misc/blob/master/usr/lib/security-misc/remove-system.map">https://github.com/Whonix/security-misc/blob/master/usr/lib/security-misc/remove-system.map</a>?</p>
<aside class="quote no-group" data-post="191" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>as well as <code>/proc/cmdline</code></p>
</blockquote>
</aside>
<p><code>/proc/cmdline</code> is used a lot and isn‚Äôt that dangerous.</p>
<aside class="quote no-group" data-post="191" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>among as much as sanely possible from <code>/proc</code> and <code>/sys</code> generally</p>
</blockquote>
</aside>
<p>There is already very little allowed.</p>
<aside class="quote no-group" data-post="191" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>If apparmor-profile-everything already prevents reading kernel images (<a href="../../../external.html?link=https://phabricator.whonix.org/T943">https://phabricator.whonix.org/T943</a>) would it be worth to additionally remove read file system permission ( <code>chmod o-r</code> ) for kernel images (<a href="../../../external.html?link=https://phabricator.whonix.org/T937">https://phabricator.whonix.org/T937</a>) or would that be overkill?</p>
</blockquote>
</aside>
<p>Yes, I think we should do both. Those can be restricted to root with permission-hardening e.g. <a href="../../../external.html?link=https://github.com/Whonix/security-misc/blob/master/etc/permission-hardening.conf#L9">https://github.com/Whonix/security-misc/blob/master/etc/permission-hardening.conf#L9</a></p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-09T22:54:55Z' class='post-time'>
                December 9, 2019, 10:54pm
              </time>
              <meta itemprop='dateModified' content='2019-12-09T22:54:55Z'>
          <span itemprop='position'>#193</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="191" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>The goal here would be to have (user or root) malware run ‚Äúin a vacuum‚Äù. Most applications would be able to run just fine ‚Äúin a vacuum‚Äù but malware trying ‚Äúweird‚Äù things could gather as little information (kernel config, kernel hardening settings, kernel pointer addresses) as possible to prevent it escalating from <code>user-&gt;root</code> or <code>root-&gt;kernel</code> .</p>
</blockquote>
</aside>
<p>I‚Äôm brainstorming ideas on how kernel information can be found.</p>
<p>We should remove access to all bootloader files like <code>/**/grub/</code> and <code>/**/grub.d/</code>. Currently, write access is denied to those directories but this should be further restricted so an attacker can‚Äôt learn about any hardening parameters.</p>
<p>All sysctl access should also be denied. This means denying access to <code>/**/sysctl.d/</code> and <code>/proc/sys/</code>. This would prevent attackers from learning about our stricter sysctl values and prevent them from changing sysctls to worsen security. I‚Äôve been planning to do this for a while but we first need to create a profile for systemd-sysctl so sysctl still works for us.</p>
<p>If we feel like disrupting kernel debugging, we can remove access to the kernel logs by denying access to <code>/proc/kmsg</code> and <code>/dev/ksmg</code>. We can also remove the CAP_SYSLOG capability as dmesg_restrict restricts dmesg to CAP_SYSLOG but that may be too disruptive.</p>
<p>All apparmor information can be denied too such as <code>/sys/kernel/security/apparmor/</code> and <code>/sys/module/apparmor/</code>. But, this will make it impossible for us to detect if apparmor is enabled or exactly what profiles are in use. Or, we can remove all <code>/sys/kernel/</code> and <code>/sys/module/</code> access entirely as they might contain some important kernel info.</p>
<p><code>/proc/modules</code> should go as it allows an attacker to see which modules are currently loaded. apparmor-profile-everything restricts this to root already but we can restrict it further. This will break <code>lsmod</code> and other things.</p>
<p><code>/lib/modules/</code> and <code>/usr/src/</code> should go.</p>
<p>Maybe <code>/etc/kernel/</code> and <code>/etc/os-release</code> should go.</p>
<p><code>uname</code> can also find kernel versions and other things. <code>uname</code> is its own syscall and doesn‚Äôt get info from a file so this probably can‚Äôt be solved with apparmor.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-09T23:28:39Z' class='post-time'>
                December 9, 2019, 11:28pm
              </time>
              <meta itemprop='dateModified' content='2019-12-09T23:28:39Z'>
          <span itemprop='position'>#194</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>If you run <code>sudo ps aux</code>,  you can see some kernel processes (the ones enclosed in square brackets). Looking at an strace of <code>ps aux</code>, some kernel processes have their own /proc entries.</p>
<p>I can‚Äôt find a way to hide kernel processes from userspace entirely, although, we can remove the CAP_SYS_PTRACE capability so <code>hidepid=2</code> will hide other processes from root which <em>might</em> include kernel processes. We should also deny access to /etc/fstab and other mount perms so root cannot undo this.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-10T06:41:48Z' class='post-time'>
                December 10, 2019,  6:41am
              </time>
              <meta itemprop='dateModified' content='2019-12-10T06:41:48Z'>
          <span itemprop='position'>#195</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Sounds really good overall.</p>
<aside class="quote no-group" data-post="193" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I‚Äôm brainstorming ideas on how kernel information can be found.</p>
<p>We should remove access to all bootloader files like <code>/**/grub/</code> and <code>/**/grub.d/</code> . Currently, write access is denied to those directories but this should be further restricted so an attacker can‚Äôt learn about any hardening parameters.</p>
<p>All sysctl access should also be denied. This means denying access to <code>/**/sysctl.d/</code> and <code>/proc/sys/</code> . This would prevent attackers from learning about our stricter sysctl values and prevent them from changing sysctls to worsen security. I‚Äôve been planning to do this for a while but we first need to create a profile for systemd-sysctl so sysctl still works for us.</p>
</blockquote>
</aside>
<p>Very good.</p>
<aside class="quote no-group" data-post="193" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>If we feel like disrupting kernel debugging, we can remove access to the kernel logs by denying access to <code>/proc/kmsg</code> and <code>/dev/ksmg</code> . We can also remove the CAP_SYSLOG capability as dmesg_restrict restricts dmesg to CAP_SYSLOG but that may be too disruptive.</p>
<p>All apparmor information can be denied too such as <code>/sys/kernel/security/apparmor/</code> and <code>/sys/module/apparmor/</code> . But, this will make it impossible for us to detect if apparmor is enabled or exactly what profiles are in use. Or, we can remove all <code>/sys/kernel/</code> and <code>/sys/module/</code> access entirely as they might contain some important kernel info.</p>
</blockquote>
</aside>
<p>It makes it hard to debug the system. Even for developers. How would I know when booting with apparmor-profile-everything that lkrg and tirdad are properly loaded? Disabling apparmor-profile-everything and then looking isn‚Äôt an option since this isn‚Äôt an equal test. It might be OK while apparmor-profile-everything is disabled but invisibly failing without ability to diagnose while apparmor-profile-everything is running.</p>
<p>Likely there is a solution for this. Didn‚Äôt grsecurity have a concept of <code>gadm</code>, grand admin, super root or something?</p>
<p>Can we add a linux user account and/or tool to become a fully unrestricted super root capability shell? Could be running under user <code>superadmin</code> but when <code>superadmin</code> uses <code>sudo</code> or uses <code>su</code> it would be ‚Äúfull‚Äù (traditional) root access. Such a user account could be locked by default. Enabling it could be done by booting into recovery mode from grub boot menu.</p>
<p>Implementation? Maybe another apparmor profile which restricts nothing for some process/user. But only <code>superadmin</code> allowed to execute that process. And execute, user authentication (password) needs to be successful. No default password. Locked by default. Enable through recovery mode. Maybe another case for pam_apparmor? Could we use pam_apparmor to allow <code>superadmin</code> to use an unrestricted apparmor profile or to run unrestricted?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-10T07:11:56Z' class='post-time'>
                December 10, 2019,  7:11am
              </time>
              <meta itemprop='dateModified' content='2019-12-10T07:11:56Z'>
          <span itemprop='position'>#196</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>pam_apparmor packaging / PAM integration done but no user profiles added.</p>
<ul>
<li><a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/commit/b8eeed45334e5797c124d2c91c44a87fb2b9a80c">https://github.com/Whonix/apparmor-profile-everything/commit/b8eeed45334e5797c124d2c91c44a87fb2b9a80c</a></li>
<li><a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything/blob/master/usr/share/pam-configs/apparmor-profile-everything">https://github.com/Whonix/apparmor-profile-everything/blob/master/usr/share/pam-configs/apparmor-profile-everything</a></li>
</ul>
<hr>
<pre><code>sudo apt install libpam-apparmor
</code></pre>
<p>(Already a dependency of <code>apparmor-profile-everything</code>.)</p>
<p>Not default yet. Can swap <code>Default: no</code> to <code>Default: yes</code> for package <code>apparmor-profile-everything</code> whenever you consider it good enough.</p>
<p>To enable/disable, interactive (this is what users could use):</p>
<pre><code>sudo pam-auth-update
</code></pre>
<p>To enable/disable, in scripts:</p>
<pre><code>sudo pam-auth-update --enable apparmor-profile-everything
</code></pre>
<p>For now using <code>optional</code>.</p>
<pre><code>optional	pam_apparmor.so debug
</code></pre>
<p>Quote <a href="../../../external.html?link=https://gitlab.com/apparmor/apparmor/wikis/pam_apparmor">https://gitlab.com/apparmor/apparmor/wikis/pam_apparmor</a></p>
<blockquote>
<p>If you make the pam_apparmor module ‚Äòrequired‚Äô instead of ‚Äòoptional‚Äô, the session will abort if pam_apparmor is not able to successfully find a hat to change_hat into. Be careful when making it required; it is possible to cause all attempted logins to the service to fail if the apparmor policy is insufficient.</p>
</blockquote>
<p>We can change to <code>required</code> whenever you think it‚Äôs good enough.</p>
<p>It will add an entry to file <code>/etc/pam.d/common-session</code> but it could also be made <code>/etc/pam.d/common-session-noninteractive</code>.</p>
<p>Please see file <code>/etc/pam.d/common-session</code>.</p>
<pre><code>cat /etc/pam.d/common-session
</code></pre>
<p>At which position do you want <code>pam_apparmor</code>?</p>
<p>Quote <a href="../../../external.html?link=https://gitlab.com/apparmor/apparmor/wikis/pam_apparmor">https://gitlab.com/apparmor/apparmor/wikis/pam_apparmor</a></p>
<blockquote>
<p>Likely you will to want add the pam_apparmor module after other<br>
session management modules.</p>
</blockquote>
<p>Which I understand as ‚Äúlow priority‚Äù which results in ‚Äúall the way down, last pam module to process‚Äù. This is what is implemented now. Speculation: By loading pam_apparmor earlier, let‚Äôs say before <code>pam_systemd.so</code> you might have to add all the apparmor profile rules that <code>pam_systemd.so</code> requires which is unwanted for a more restricted user profile.</p>
<p>Maybe have a look at folder <code>/usr/share/pam-configs</code>.<br>
Maybe compare <code>/etc/pam.d</code> folder before and after enabling <code>apparmor-profile-everything</code> to see how it changes.</p>
<p>PAM integration based on this:<br>
<a href="../../../external.html?link=https://wiki.ubuntu.com/PAMConfigFrameworkSpec" class="onebox" target="_blank">https://wiki.ubuntu.com/PAMConfigFrameworkSpec</a></p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-10T17:47:49Z' class='post-time'>
                December 10, 2019,  5:47pm
              </time>
              <meta itemprop='dateModified' content='2019-12-10T17:47:49Z'>
          <span itemprop='position'>#197</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="195" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It makes it hard to debug the system. Even for developers. How would I know when booting with apparmor-profile-everything that lkrg and tirdad are properly loaded? Disabling apparmor-profile-everything and then looking isn‚Äôt an option since this isn‚Äôt an equal test. It might be OK while apparmor-profile-everything is disabled but invisibly failing without ability to diagnose while apparmor-profile-everything is running.</p>
<p>Likely there is a solution for this.</p>
</blockquote>
</aside>
<p>We can add something like a debug boot mode. Android does something similar where a lot of debugging functionality is not included in default user builds but are available in userdebug builds.</p>
<aside class="quote no-group" data-post="195" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Didn‚Äôt grsecurity have a concept of <code>gadm</code> , grand admin, super root or something?</p>
</blockquote>
</aside>
<p>I think you mean gradm. That was just the tool to parse the policies.</p>
<p><a href="../../../external.html?link=https://en.wikibooks.org/wiki/Grsecurity/The_Administration_Utility" class="onebox" target="_blank">https://en.wikibooks.org/wiki/Grsecurity/The_Administration_Utility</a></p>
<aside class="quote no-group" data-post="195" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Can we add a linux user account and/or tool to become a fully unrestricted super root capability shell? Could be running under user <code>superadmin</code> but when <code>superadmin</code> uses <code>sudo</code> or uses <code>su</code> it would be ‚Äúfull‚Äù (traditional) root access. Such a user account could be locked by default. Enabling it could be done by booting into recovery mode from grub boot menu.</p>
</blockquote>
</aside>
<p>That would add far too large attack surface that I‚Äôm not really comfortable with. A debug boot mode or similar like I‚Äôve described above would be a far better approach.</p>
<aside class="quote no-group" data-post="196" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>At which position do you want <code>pam_apparmor</code> ?</p>
</blockquote>
</aside>
<p>The bottom as per the wiki.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-10T18:46:58Z' class='post-time'>
                December 10, 2019,  6:46pm
              </time>
              <meta itemprop='dateModified' content='2019-12-10T18:46:58Z'>
          <span itemprop='position'>#198</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Following the <a href="../../../external.html?link=https://gitlab.com/apparmor/apparmor/wikis/Pam_apparmor_example">pam_apparmor example</a>, only <code>/bin/su</code> is being confined. I think I might need to confine more things in /etc/apparmor.d/pam_binaries but I don‚Äôt know what to confine. What program starts the user‚Äôs session?</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-10T19:22:20Z' class='post-time'>
                December 10, 2019,  7:22pm
              </time>
              <meta itemprop='dateModified' content='2019-12-10T19:22:20Z'>
          <span itemprop='position'>#199</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<p>What program starts the user‚Äôs session?</p>
</blockquote>
<p>Everything in <code>/etc/pam.d</code> folder (except shared files such as<br>
<code>common-session</code> which are imported by others for ‚Äúcode sharing‚Äù) can<br>
start a session.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-10T20:10:16Z' class='post-time'>
                December 10, 2019,  8:10pm
              </time>
              <meta itemprop='dateModified' content='2019-12-10T20:10:16Z'>
          <span itemprop='position'>#200</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="199" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Everything in <code>/etc/pam.d</code> folder (except shared files such as<br>
<code>common-session</code> which are imported by others for ‚Äúcode sharing‚Äù) can start a session.</p>
</blockquote>
</aside>
<p>I meant a program. So I can confine it which would hopefully confine everything else in the user‚Äôs session (like how confining init confines the whole system).</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-11T00:46:25Z' class='post-time'>
                December 11, 2019, 12:46am
              </time>
              <meta itemprop='dateModified' content='2019-12-11T00:46:25Z'>
          <span itemprop='position'>#201</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-post="200" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>Everything in <code>/etc/pam.d</code> folder (except shared files such as<br>
<code>common-session</code> which are imported by others for ‚Äúcode sharing‚Äù) can start a session.</p>
</blockquote>
<p>I meant a program. So I can confine it which would hopefully confine everything else in the user‚Äôs session (like how confining init confines the whole system).</p>
</blockquote>
</aside>
<aside class="quote no-group" data-post="198" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>What program starts the user‚Äôs session?</p>
</blockquote>
</aside>
<p>There might be no single program which can start user sessions. There are probably many programs that start sessions. For that, I had a look here‚Ä¶</p>
<pre><code>ls /etc/pam.d/
</code></pre>
<p>Here is a limited selection:</p>
<p>/etc/pam.d/cron<br>
/etc/pam.d/su<br>
/etc/pam.d/login<br>
/etc/pam.d/sudo<br>
/etc/pam.d/lightdm</p>
<p>These pam file names can be used to deduct which programs can start user sessions. Among these are cron, su, login, sudo and lightdm.</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8339.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-11T08:43:49Z' class='post-time'>
                December 11, 2019,  8:43am
              </time>
              <meta itemprop='dateModified' content='2019-12-11T08:43:49Z'>
          <span itemprop='position'>#202</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<aside class="quote no-group" data-post="195" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It makes it hard to debug the system. Even for developers. How would I know when booting with apparmor-profile-everything that lkrg and tirdad are properly loaded? Disabling apparmor-profile-everything and then looking isn‚Äôt an option since this isn‚Äôt an equal test. It might be OK while apparmor-profile-everything is disabled but invisibly failing without ability to diagnose while apparmor-profile-everything is running.</p>
<p>Likely there is a solution for this.</p>
</blockquote>
</aside>
<p>We can add something like a debug boot mode.</p>
</blockquote>
<p>Alright. And how would that debug mode boot mode work?</p>
<p>The debug mode needs to be somewhat close to a non-debug boot. Otherwise<br>
it doesn‚Äôt make a fair comparison. apparmor-profile-everything needs to<br>
be active during debug mode boot. Then how could any kernel boot<br>
parameter result in the ability to open a superroot shell?</p>
<p>If a specific kernel boot parameter is set, allow some application<br>
(terminal emulator) to run apparmor unconfined. Otherwise not.</p>
<p>If a specific kernel boot parameter is set, copy some apparmor profile<br>
which allows some some application (terminal emulator) to run apparmor<br>
unconfined. Otherwise, <code>rm -f /path/to/debug-shell-profile</code>.</p>
<p>Then apparmor-profile-everything would have to protect tampering with<br>
/proc/cmdline (writing to, mounting over with malicious version,<br>
deletion, symlinking with something else).</p>
<blockquote>
<aside class="quote no-group" data-post="196" data-topic="8339">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>At which position do you want <code>pam_apparmor</code> ?</p>
</blockquote>
</aside>
<p>The bottom as per the wiki.</p>
</blockquote>
<p>Alright, perfect. So current pam file priority stay as is at <code>0</code> (lowest<br>
priority).</p>
        </div>

        <meta itemprop='headline' content='AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="83390b08.html?page=9">‚Üê previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="83391c8b.html?page=11">next page ‚Üí</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
