<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Derivative Maker Automated CI Builder - Development - Whonix Forum</title>
    <meta name="description" content="Per request of @Patrick , I created a CI integration for the derivative-maker repository. 

What it does
This tool runs a Github Actions workflow when a commit is pushed. 
The workflow runs an automation suite on a rem&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="14468fdb0.html?page=4" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Derivative Maker Automated CI Builder&#39;" href="14468.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/derivative-maker-automated-ci-builder/14468?page=4" />
<meta name="twitter:url" content="https://forums.whonix.org/t/derivative-maker-automated-ci-builder/14468?page=4" />
<meta property="og:title" content="Derivative Maker Automated CI Builder" />
<meta name="twitter:title" content="Derivative Maker Automated CI Builder" />
<meta property="og:description" content="Still running in to some very frustrating issues with the mount point being busy. Not sure why. I restarted, unmounted everything, etc  $ cat /etc/os-release PRETTY_NAME=&quot;Debian GNU/Linux 11 (bullseye)&quot; NAME=&quot;Debian GNU/Linux&quot; VERSION_ID=&quot;11&quot; VERSION=&quot;11 (bullseye)&quot; VERSION_CODENAME=bullseye ID=debian HOME_URL=&quot;https://www.debian.org/&quot; SUPPORT_URL=&quot;https://www.debian.org/support&quot; BUG_REPORT_URL=&quot;https://bugs.debian.org/&quot;  $ sudo umount /home/ansible/derivative-binary/Whonix-Gateway-XFCE_image um..." />
<meta name="twitter:description" content="Still running in to some very frustrating issues with the mount point being busy. Not sure why. I restarted, unmounted everything, etc  $ cat /etc/os-release PRETTY_NAME=&quot;Debian GNU/Linux 11 (bullseye)&quot; NAME=&quot;Debian GNU/Linux&quot; VERSION_ID=&quot;11&quot; VERSION=&quot;11 (bullseye)&quot; VERSION_CODENAME=bullseye ID=debian HOME_URL=&quot;https://www.debian.org/&quot; SUPPORT_URL=&quot;https://www.debian.org/support&quot; BUG_REPORT_URL=&quot;https://bugs.debian.org/&quot;  $ sudo umount /home/ansible/derivative-binary/Whonix-Gateway-XFCE_image um..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="35 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="90 ❤" />
<meta property="article:published_time" content="2022-09-07T22:16:46+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="144689ba9.html?page=3">
        <link rel="next" href="14468af4d.html?page=5">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="14468.html">Derivative Maker Automated CI Builder</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-07T22:16:46Z' class='post-time'>
                September 7, 2022, 10:16pm
              </time>
              <meta itemprop='dateModified' content='2022-09-07T22:16:46Z'>
          <span itemprop='position'>#61</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Still running in to some very frustrating issues with the mount point being busy. Not sure why. I restarted, unmounted everything, etc</p>
<pre><code class="lang-auto">$ cat /etc/os-release
PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
NAME="Debian GNU/Linux"
VERSION_ID="11"
VERSION="11 (bullseye)"
VERSION_CODENAME=bullseye
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"

$ sudo umount /home/ansible/derivative-binary/Whonix-Gateway-XFCE_image
umount: /home/ansible/derivative-binary/Whonix-Gateway-XFCE_image: target is busy.
</code></pre>
<aside class="quote no-group" data-username="Patrick" data-post="54" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Can you unmount /home/ansible/derivative-binary/Whonix-Gateway-XFCE_image somehow?</p>
</blockquote>
</aside>
<p>Sure if I add a <code>-f</code> or <code>-l</code> flag</p>
<p>but if I unmount I still see</p>
<pre><code class="lang-auto">$ sudo losetup -a
/dev/loop0: [65025]:1312560 (/home/ansible/derivative-binary/ae1f3d469da21e5532573f32b0f9415e14d849e8/Whonix-Gateway-XFCE-ae1f3d469da21e5532573f32b0f9415e14d849e8.Intel_AMD64.raw (deleted))
</code></pre>
<p>running <code>sudo losetup -D</code> does not detach it, but when I reboot the machine, <code>sudo losetup -a</code> shows nothing (so restarting does in fact kill the losetup, but only after the force umount)</p>
<p>I am not sure how all this stuff works. I love linux, but really feelin like a dumb webdev right now <img src="../../images/emoji/twitter/laughinge5bf.png?v=12" title=":laughing:" class="emoji" alt=":laughing:"></p>
<p>About to rerun the build for new logs</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-07T22:17:14Z' class='post-time'>
                September 7, 2022, 10:17pm
              </time>
              <meta itemprop='dateModified' content='2022-09-07T22:17:14Z'>
          <span itemprop='position'>#62</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>sorry to keep buggin ya <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a>, I am trying</p>
<p>Logs should be here after the build fails</p><aside class="onebox githubactions" data-onebox-src="../../../external.html?link=https://github.com/Mycobee/derivative-maker/actions/runs/2986664249">
  <header class="source">

      <a href="../../../external.html?link=https://github.com/Mycobee/derivative-maker/actions/runs/2986664249" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">

      <svg width="24" height="24" class="github-icon github-icon-pending" viewbox="0 0 24 24" aria-hidden="true"><path d="M12 18a6 6 0 100-12 6 6 0 000 12z"></path></svg>


  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Mycobee/derivative-maker/actions/runs/2986664249" target="_blank" rel="noopener nofollow ugc">Add automated_builder ansible suite to CI</a>
    </h4>

      <div class="github-info">
        Build Commit VMs <span class="github-run-number">#69</span>
      </div>
  </div>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-08T11:09:22Z' class='post-time'>
                September 8, 2022, 11:09am
              </time>
              <meta itemprop='dateModified' content='2022-09-08T11:09:22Z'>
          <span itemprop='position'>#63</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>There used to be an obscure but in kpartx that was probably not really cleanly fixed:<br>
<a href="../../../external.html?link=http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=734794" class="onebox" target="_blank" rel="noopener">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=734794</a></p>
<p>Could either be the same issue here or something similar. Whatever that might be…</p>
<hr>
<p>Can we automate rebooting the server? I am asking, because I’d like to iterate faster here.</p>
<p>If I detect a stale mount and folder /home/ansible exists can I tell the build script just the reboot the server? Then I could do more builds in quick succession.</p>
<p>I would also temporarily change the build script to a simpler state that does not create a full build but just to quickly debug the mount issue.</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-08T19:55:15Z' class='post-time'>
                September 8, 2022,  7:55pm
              </time>
              <meta itemprop='dateModified' content='2022-09-08T20:26:16Z'>
          <span itemprop='position'>#66</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>If we are going to check for the stray mounts in the <code>derivative-maker</code> scripts, here is a solution I came up with to umount.</p>
<pre><code class="lang-auto">STRAY_MOUNT=$(df -h | grep 'ansible\/derivative-binary')

if [ -n "$STRAY_MOUNT" ]; then
  MOUNTED_FOLDER=$(echo $STRAY_MOUNT | awk '{print $6}')
  $SUDO_TO_ROOT umount -l $MOUNTED_FOLDER
fi
</code></pre>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-08T20:21:21Z' class='post-time'>
                September 8, 2022,  8:21pm
              </time>
              <meta itemprop='dateModified' content='2022-09-08T20:21:21Z'>
          <span itemprop='position'>#67</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Okay so now CI always reboot the VPS before running the <code>derivative-maker</code> build step. This should fix the issue with <code>sudo losetup --all</code> having a lingering loopback</p>
<p>I think mount steps above can fix the issue with the mounted volume, if necessary.</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T04:08:40Z' class='post-time'>
                September 9, 2022,  4:08am
              </time>
              <meta itemprop='dateModified' content='2022-09-09T04:15:05Z'>
          <span itemprop='position'>#68</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>With the reboot implemented, the same issue is occuring with the umount</p><aside class="onebox githubactions" data-onebox-src="../../../external.html?link=https://github.com/Mycobee/derivative-maker/actions/runs/3018043263">
  <header class="source">

      <a href="../../../external.html?link=https://github.com/Mycobee/derivative-maker/actions/runs/3018043263" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">


      <svg width="24" height="24" class="github-icon github-icon-failure" viewbox="0 0 24 24" aria-hidden="true"><path d="M1 12C1 5.925 5.925 1 12 1s11 4.925 11 11-4.925 11-11 11S1 18.075 1 12zm8.036-4.024a.75.75 0 00-1.06 1.06L10.939 12l-2.963 2.963a.75.75 0 101.06 1.06L12 13.06l2.963 2.964a.75.75 0 001.061-1.06L13.061 12l2.963-2.964a.75.75 0 10-1.06-1.06L12 10.939 9.036 7.976z"></path></svg>

  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Mycobee/derivative-maker/actions/runs/3018043263" target="_blank" rel="noopener nofollow ugc">Add automated_builder ansible suite to CI</a>
    </h4>

      <div class="github-info">
        Build Commit VMs <span class="github-run-number">#72</span>
      </div>
  </div>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>I think the above solution I posted with the <code>umount -l</code> could potentially fix it</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T11:10:13Z' class='post-time'>
                September 9, 2022, 11:10am
              </time>
              <meta itemprop='dateModified' content='2022-09-09T11:10:13Z'>
          <span itemprop='position'>#69</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="bee" data-post="66" data-topic="14468" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/bee/40/2338_2.jpg" class="avatar"> bee:</div>
<blockquote>
<p>If we are going to check for the stray mounts in the <code>derivative-maker</code> scripts, here is a solution I came up with to umount.</p>
<pre><code class="lang-auto">STRAY_MOUNT=$(df -h | grep 'ansible\/derivative-binary')

if [ -n "$STRAY_MOUNT" ]; then
  MOUNTED_FOLDER=$(echo $STRAY_MOUNT | awk '{print $6}')
  $SUDO_TO_ROOT umount -l $MOUNTED_FOLDER
fi
</code></pre>
</blockquote>
</aside>
<p>If the build script and/or the CI scripts check for stray mounts, I guess is best if you decide.</p>
<p>The build script will check for stray mounts anyhow because non-CI builds should get a build error early when there is a stray mount. That test can stay independent from any potential test by the CI scripts.</p>
<p>The tests that I am currently using:</p>
<ul>
<li><a href="../../../external.html?link=https://github.com/derivative-maker/derivative-maker/blob/master/build-steps.d/1100_sanity-tests#L73">https://github.com/derivative-maker/derivative-maker/blob/master/build-steps.d/1100_sanity-tests#L73</a></li>
<li><a href="../../../external.html?link=https://github.com/derivative-maker/derivative-maker/blob/master/build-steps.d/1100_sanity-tests#L109">https://github.com/derivative-maker/derivative-maker/blob/master/build-steps.d/1100_sanity-tests#L109</a></li>
</ul>
<p>Usually a CI sets environment variable <code>CI=true</code>. And depending on that, the build script could perform some action it does not do outside of CI.</p>
<p>But if the build script is a clean place to say “please reboot the CI” that is highly questionable.  Could be a rather unclean hack.</p>
<aside class="quote no-group" data-username="bee" data-post="66" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/bee/40/2338_2.jpg" class="avatar"> bee:</div>
<blockquote>
<p><code>  $SUDO_TO_ROOT umount -l $MOUNTED_FOLDER</code></p>
</blockquote>
</aside>
<p>I guess <a href="../../../external.html?link=https://manpages.debian.org/bullseye/mount/umount.8.en.html#l"><strong>-l</strong>, <strong>–lazy</strong></a> won’t help much here. The mount is probably staying forever until reboot.</p>
<aside class="quote no-group" data-username="bee" data-post="66" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/bee/40/2338_2.jpg" class="avatar"> bee:</div>
<blockquote>
<p><code>STRAY_MOUNT=$(df -h | grep 'ansible\/derivative-binary')</code></p>
</blockquote>
</aside>
<p>Sure, if that works.</p>
<p>An additional test that would probably be useful in the CI scripts (similar to the test already in the build script):</p>
<pre><code class="lang-auto">   losetup_output=$($SUDO_TO_ROOT losetup --all)

   if [ "$losetup_output" = "" ]; then
      true "INFO: Output of losetup_output is empty. No stray loop devices, OK."
      return 0
   else
      error TODO bail out here and reboot CI server
   fi
</code></pre>
<aside class="quote no-group" data-username="bee" data-post="67" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/bee/40/2338_2.jpg" class="avatar"> bee:</div>
<blockquote>
<p>Okay so now CI always reboot the VPS before running the <code>derivative-maker</code> build step. This should fix the issue with <code>sudo losetup --all</code> having a lingering loopback</p>
</blockquote>
</aside>
<p>That is probably ideal and better than what I said above.</p>
<aside class="quote no-group" data-username="bee" data-post="68" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/bee/40/2338_2.jpg" class="avatar"> bee:</div>
<blockquote>
<p>I think the above solution I posted with the <code>umount -l</code> could potentially fix it</p>
</blockquote>
</aside>
<p>Does it work for you if you run that command manually? I mean, the command will exit without error but will the mount point be unmounted indeed? If yes, I’ll happily add it to the build script.<br>
Actually, I might just try that now.</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T14:40:38Z' class='post-time'>
                September 9, 2022,  2:40pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T14:40:38Z'>
          <span itemprop='position'>#70</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="69" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does it work for you if you run that command manually? I mean, the command will exit without error but will the mount point be unmounted indeed? If yes, I’ll happily add it to the build script.</p>
</blockquote>
</aside>
<p>Yup</p>
<pre><code class="lang-auto">ansible@host:~$ df -h
Filesystem           Size  Used Avail Use% Mounted on
udev                 974M     0  974M   0% /dev
tmpfs                199M  540K  198M   1% /run
/dev/vda1             50G   17G   31G  35% /
tmpfs                992M     0  992M   0% /dev/shm
tmpfs                5.0M     0  5.0M   0% /run/lock
/dev/vda15           124M  5.9M  118M   5% /boot/efi
/dev/mapper/loop0p1   98G  2.8G   91G   4% /home/ansible/derivative-binary/Whonix-Gateway-XFCE_image
tmpfs                199M     0  199M   0% /run/user/1001

ansible@host:~$ sudo umount -l /home/ansible/derivative-binary/Whonix-Gateway-XFCE_image

ansible@host:~$ df -h
Filesystem      Size  Used Avail Use% Mounted on
udev            974M     0  974M   0% /dev
tmpfs           199M  540K  198M   1% /run
/dev/vda1        50G   17G   31G  35% /
tmpfs           992M     0  992M   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
/dev/vda15      124M  5.9M  118M   5% /boot/efi
tmpfs           199M     0  199M   0% /run/user/1001
</code></pre>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:00:14Z' class='post-time'>
                September 9, 2022,  3:00pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:00:14Z'>
          <span itemprop='position'>#71</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I am very surprised a normal umount doesn’t work but umount with -l / --lazy works. Yeah, then that would mean there’s some sort of bug in umount or some other low level tool or even the kernel.</p>
<p>Therefore I’ve already rewritten for more  defensive unmount.<br>
<a href="../../../external.html?link=https://github.com/derivative-maker/derivative-maker/blob/master/help-steps/unmount-helper">https://github.com/derivative-maker/derivative-maker/blob/master/help-steps/unmount-helper</a></p>
<p>It also attempts <code>umount --lazy</code>.</p>
<p>Not yet tested but I guess that’s what the CI is for.</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:00:58Z' class='post-time'>
                September 9, 2022,  3:00pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:00:58Z'>
          <span itemprop='position'>#72</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="71" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Not yet tested but I guess that’s what the CI is for.</p>
</blockquote>
</aside>
<p>yes it is <img src="../../images/emoji/twitter/slight_smilee5bf.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Thanks !</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:10:07Z' class='post-time'>
                September 9, 2022,  3:10pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:10:07Z'>
          <span itemprop='position'>#73</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>As for file <a href="../../../external.html?link=https://github.com/Mycobee/derivative-maker/pull/1/files#diff-58b9c6a3d968a59c827abab44137adbb96f030890df6eb9d0de622fffb84d9bb">automated_builder/tasks/create_vm.yml</a> may I suggest keeping the actual clean and build commands out of the CI?</p>
<p>There are various CI scirpts in <a href="../../../external.html?link=https://github.com/Mycobee/derivative-maker/tree/master/help-steps" class="inline-onebox">derivative-maker/help-steps at master · Mycobee/derivative-maker · GitHub</a> (those starting with <code>ci_</code>) but these can probably all be deleted since nowadays defunct.</p>
<p>The help-steps folder however could be the place where we a short or several short scripts which contain the actual build command.</p>
<p>Or better, let’s add a <code>ci</code> sub folder in the derivative-maker repository where the small scripts that define the actual clean and build command reside?</p>
<p>Reason: if the mount continues to make issues, I would use simpler build commands to just focus on the mount issue in quicker iteration.</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:15:00Z' class='post-time'>
                September 9, 2022,  3:15pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:15:00Z'>
          <span itemprop='position'>#74</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>The following…</p>
<pre><code class="lang-auto">- name: Build new gateway VM
  shell: "dist_build_non_interactive=true /home/ansible/derivative-maker/derivative-maker --flavor whonix-gateway-xfce --target virtualbox --build &gt;&gt; /home/ansible/build.log 2&gt;&amp;1"
</code></pre>
<p>Would stay mostly the same. Just it would do something like this:</p>
<pre><code class="lang-auto">- name: Build new gateway VM
  shell: "/home/ansible/derivative-maker/derivative-maker/ci/build-gateway &gt;&gt; /home/ansible/build.log 2&gt;&amp;1"
</code></pre>
<p>(<code>dist_build_non_interactive=true</code> would be set within <code>ci/build-gateway</code>.)</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:16:19Z' class='post-time'>
                September 9, 2022,  3:16pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:16:19Z'>
          <span itemprop='position'>#75</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Yup I will do that <img src="../../images/emoji/twitter/slight_smilee5bf.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:17:04Z' class='post-time'>
                September 9, 2022,  3:17pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:17:04Z'>
          <span itemprop='position'>#76</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <pre><code class="lang-auto">---
- name: Clean existing gateway VM
  shell: "dist_build_non_interactive=true /home/ansible/derivative-maker/derivative-maker --flavor whonix-gateway-xfce --target virtualbox --clean &gt; /home/ansible/build.log 2&gt;&amp;1"

- name: Clean existing workstation VM
  shell: "dist_build_non_interactive=true /home/ansible/derivative-maker/derivative-maker --flavor whonix-workstation-xfce --target virtualbox --clean &gt;&gt; /home/ansible/build.log 2&gt;&amp;1"

- name: Reboot VPS for stray loop devices
  reboot:
    reboot_timeout: 60
  become: true

- name: Build new gateway VM
  shell: "dist_build_non_interactive=true /home/ansible/derivative-maker/derivative-maker --flavor whonix-gateway-xfce --target virtualbox --build &gt;&gt; /home/ansible/build.log 2&gt;&amp;1"

- name: Build new workstation VM
  shell: "dist_build_non_interactive=true /home/ansible/derivative-maker/derivative-maker --flavor whonix-workstation-xfce --target virtualbox --build &gt;&gt; /home/ansible/build.log 2&gt;&amp;1"
</code></pre>
<p>Not sure it would be wise to combine all of them to a single script in <code>ci</code> folder?</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:17:52Z' class='post-time'>
                September 9, 2022,  3:17pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:17:52Z'>
          <span itemprop='position'>#77</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Except <code>- name: Reboot VPS for stray loop devices</code> that might make more sense for the CI to take care of.</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:21:15Z' class='post-time'>
                September 9, 2022,  3:21pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:21:15Z'>
          <span itemprop='position'>#78</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>How about:</p>
<ol>
<li>ansible calls script in <code>ci</code> folder to clean vms</li>
<li>ansible reboots machine for loop devices</li>
<li>ansible call script in <code>ci</code> folder to build vms</li>
</ol>
<p>I agree that leaving reboot functionality in ansible is a good idea so ansible knows to expect connection to the machine to break during reboot</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:27:52Z' class='post-time'>
                September 9, 2022,  3:27pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:27:52Z'>
          <span itemprop='position'>#79</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>For longer term maintenance, I have a question.</p>
<p>Is there any way to speed up the builds to only run the relevant steps that have been affected in the code changes?</p>
<p>i.e. - Do we need to build <code>../monero-gui_0.18.1.0-1_all.deb</code> when you only change a few things in the help steps or something?</p>
<p>Would be nice to have a “light” build or something for iterating more quickly. Currently it takes over 1.5 hours to build fresh workstation and gateway VMs. I’d love it if we could make it where you have the ability to get feedback more quickly</p>
<p>I guess though when troubleshooting you can always just SSH in to the VPS and run the troublesome build step manually and see what is causing the problem. Just a thought though, I want this CI feature to make your life easier <img src="../../images/emoji/twitter/man_shrugginge5bf.png?v=12" title=":man_shrugging:" class="emoji" alt=":man_shrugging:"></p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:54:00Z' class='post-time'>
                September 9, 2022,  3:54pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:54:00Z'>
          <span itemprop='position'>#80</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>We have this thingy here: <a href="../whonix-build-script-now-optionally-supports-installing-packages-from-whonix-remote-repository-rather-than-building-packages-locally/8107.html" class="inline-onebox">Whonix build script now optionally supports installing packages from Whonix remote repository rather than building packages locally</a></p>
<p>So just by adding…</p>
<pre><code>--remote-derivative-packages true
</code></pre>
<p>No packages should be built and all packages would be downloaded from the Whonix binary repository. It would skip all the lengthy package creation.</p>
<p>How does that sounds?</p>
<p>How often will we use <code>--remote-derivative-packages true</code>? Maybe for git commits, use it. For git tags, do it “proper” and drop it?</p>
<p>Though, when using <code>--remote-derivative-packages true</code> we would not notice when package builds fail. But that isn’t very likely since if packages are updated, I need to build them locally anyhow.</p>
<aside class="quote no-group" data-username="bee" data-post="79" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/bee/40/2338_2.jpg" class="avatar"> bee:</div>
<blockquote>
<p>I’d love it if we could make it where you have the ability to get feedback more quickly</p>
</blockquote>
</aside>
<p>Absolutely makes sense. In my previous build, a rookie mistake for forgetting <code>$SUDO_TO_ROOT</code> has lead to a failed build. Another 40 minutes to wait for me now until I can see if that is fixed now - unless I do a local build with local hacks which with the CI we’re trying to avoid.</p>
<p>That’s also why I suggested <a href="14468/74.html" class="inline-onebox">Derivative Maker Automated CI Builder - #74 by Patrick</a> - because then I would hack the build command to a much simpler various to a point where only a minimal raw image gets created with even nothing useful inside just to test various mount / umount to quickly get that fixed.</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T15:59:03Z' class='post-time'>
                September 9, 2022,  3:59pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T15:59:03Z'>
          <span itemprop='position'>#81</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>My latest commit <a href="../../../external.html?link=https://github.com/derivative-maker/derivative-maker/commit/03f64961c116172cbc311b7c87fc55dbd595462c" class="inline-onebox">fix · derivative-maker/derivative-maker@03f6496 · GitHub</a> didn’t get picked up by the CI on <a href="../../../external.html?link=https://github.com/Mycobee/derivative-maker/actions" class="inline-onebox">Actions · Mycobee/derivative-maker · GitHub</a> yet.</p>
<p>Last time that was faster, I think. I am not complaining about the speed. Just thinking if that commit got lost, not there yet, it will never come.</p>
<p>Maybe the automated CI reboots could leak to some commits overlooked by the CI?</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/bee'><span itemprop='name'>bee</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="14468.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-09T16:31:34Z' class='post-time'>
                September 9, 2022,  4:31pm
              </time>
              <meta itemprop='dateModified' content='2022-09-09T16:31:34Z'>
          <span itemprop='position'>#82</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="81" data-topic="14468">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>commits overlooked by the CI?</p>
</blockquote>
</aside>
<p>This happened because I rebased and pushed pretty quickly after you commented, and didn’t give enough time for you to finish your stuff.</p>
<p>It isn’t an issue with CI or anything, simply me being a bit too trigger happy and pushing without rebasing <code>03f64961</code> yet</p>
        </div>

        <meta itemprop='headline' content='Derivative Maker Automated CI Builder'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="144689ba9.html?page=3">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="14468af4d.html?page=5">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
