<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Using apparmor-profile-everything on Debian Buster - News - Whonix Forum</title>
    <meta name="description" content="I have been keeping up with @madaidan‚Äôs and @Patrick‚Äôs ongoing development of apparmor-profile-everything. So far, their efforts have led to a system of total confinement aptly named apparmor-profile-everything. 
This is&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="8650.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Using apparmor-profile-everything on Debian Buster&#39;" href="8650.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/using-apparmor-profile-everything-on-debian-buster/8650" />
<meta name="twitter:url" content="https://forums.whonix.org/t/using-apparmor-profile-everything-on-debian-buster/8650" />
<meta property="og:title" content="Using apparmor-profile-everything on Debian Buster" />
<meta name="twitter:title" content="Using apparmor-profile-everything on Debian Buster" />
<meta property="og:description" content="I have been keeping up with @madaidan‚Äôs and @Patrick‚Äôs ongoing development of apparmor-profile-everything. So far, their efforts have led to a system of total confinement aptly named apparmor-profile-everything.  This is not simply a single profile but a series of profiles, system files, and related scripting. Together these elements work as one to confine the user‚Äôs system starting from init onward. The confinements include: the systemd init process and any children it spawns, the apt-get proce..." />
<meta name="twitter:description" content="I have been keeping up with @madaidan‚Äôs and @Patrick‚Äôs ongoing development of apparmor-profile-everything. So far, their efforts have led to a system of total confinement aptly named apparmor-profile-everything.  This is not simply a single profile but a series of profiles, system files, and related scripting. Together these elements work as one to confine the user‚Äôs system starting from init onward. The confinements include: the systemd init process and any children it spawns, the apt-get proce..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="7 ‚ù§" />
<meta property="article:published_time" content="2019-12-19T01:46:27+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="8650.html">Using apparmor-profile-everything on Debian Buster</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/news/21.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>News</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/anontor'><span itemprop='name'>anontor</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8650.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T01:46:27Z' class='post-time'>
                December 19, 2019,  1:46am
              </time>
              <meta itemprop='dateModified' content='2019-12-19T07:41:40Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I have been keeping up with <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/madaidan">@madaidan</a>‚Äôs and <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/patrick">@Patrick</a>‚Äôs ongoing development of <a href="../../../external.html?link=https://github.com/Whonix/apparmor-profile-everything" rel="nofollow noopener"><code>apparmor-profile-everything</code></a>. So far, their efforts have led to a system of total confinement aptly named <code>apparmor-profile-everything</code>.</p>
<p>This is not simply a single profile but a series of profiles, system files, and related scripting. Together these elements work as one to confine the user‚Äôs system starting from <code>init</code> onward. The confinements include: the systemd init process and any children it spawns, the <code>apt-get</code> processes through a wrapper named <code>rapt</code>, and a lockdown of files and directories that could pose significant security risks if they were to be exploited.</p>
<p>The <code>initramfs</code> is made aware through a hook so that the <code>init-systemd</code> AppArmor profile is executed right before systemd starts parsing. This is proven through simple examination of the boot log information (<code>journalctl</code>).</p>
<p>This was tested on a Debian Buster host with kernel <code>4.19.0-6-amd64</code> fully updated. Since Debian ships AppArmor as default, and it is already active, no kernel boot parameter is necessary. There is a very convenient way to add this profile to your system by simply obtaining it from the official Whonix repository.</p>
<pre><code>sudo apt-get install apparmor-profile-everything
</code></pre>
<p>That will install the package onto your machine.</p>
<p>The <code>rapt</code> application was very interesting because it completely confined <code>apt-get</code> while at the same time allowing for normal use. It acts as a wrapper for <code>apt</code>, similar in function to how <a href="../../../external.html?link=https://github.com/Whonix/uwt" rel="nofollow noopener"><code>uwt</code></a> acts as a wrapper for <code>torsocks</code> in Whonix. <code>rapt</code> protects your system and a review of the code shows that it specifically works with and for <code>apparmor-profile-everything</code> to make sure an attacker or malicious script cannot simply remove packages to bypass protections.</p>
<p>The <code>initramfs-tools</code> hook is simple enough to understand. Its purpose is to make sure that the <code>initramfs</code> knows to initiate the <code>init-systemd</code> AppArmor profile before systemd. The log confirms this:</p>
<blockquote>
<p>Dec 19 00:16:08 host kernel: audit: type=1400 audit(1576714567.608:2): apparmor=‚ÄúSTATUS‚Äù operation=‚Äúprofile_load‚Äù profile=‚Äúunconfined‚Äù name=‚Äúinit-systemd‚Äù pid=211 comm=‚Äúapparmor_parser‚Äù</p>
</blockquote>
<p>then immediately after:</p>
<blockquote>
<p>Dec 19 00:16:08 host systemd[1]: systemd 241 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP</p>
</blockquote>
<p>the <code>/usr/bin/rapt</code> profile parses as well:</p>
<blockquote>
<p>Dec 19 00:16:08 host kernel: audit: type=1400 audit(1576714568.800:4): apparmor=‚ÄúSTATUS‚Äù operation=‚Äúprofile_load‚Äù profile=‚Äúunconfined‚Äù name="/usr/bin/rapt" pid=308 comm=‚Äúapparmor_parser‚Äù</p>
</blockquote>
<p>Now, it is important to note that this particular system is a torified and hardened workstation. No clearnet allowed. My permissions are not identical to those of Whonix, but they are similar. I can only report on my own system, so your mileage may vary. That would not be a problem though, because (if you know what you are doing) AppArmor is very flexible and still very secure. If my testing continues as smoothly as it has so far, my plan is to implement <code>apparmor-profile-everything</code> on all my systems.</p>
<p>There are no errors with System Tor (<code>4.1.6</code>) or the Tor Browser (<code>9.02</code>).<br>
I have not tested UDP, but TCP is fine OpenVPN works. Both as <code>openvpn@server</code> and as a client connecting to that server. No interruptions or permissions issues found. Performance is as expected. OpenVPN works both with TCP and UDP, and ports are flexible. Used in TCP mode, no errors are experienced.<br>
Monero cli wallet works. Electrum works.<br>
Normal day to day tasks also work with no issue. Specifically: browsing, coding and compiling (with minor tweaks),<br>
There was an error regarding GPG that wanted access to <code>/proc/sys/crypto/fips_enabled</code>. It was not an impediment however. I did not adjust any permissions, and the error proved harmless. (This error was generated by the <code>/usr/bin/rapt</code> profile and recorded by audit in <code>dmesg</code>)<br>
Other than that, there have been no issues!</p>
<p>Apparmor is a versatile and powerful system that can provide formidable protections and be a substantial if not insurmountable obstacle to any misbehaving program or malware. Profiles are straightforward and rely on absolute paths. Some commands to get you started in AppArmor:<br>
with <code>sudo</code> privileges:</p>
<pre><code>sudo aa-status
</code></pre>
<p>shows you the list of profiles on the system. Shows you how many are loaded, being enforced, are complaining, active processes and associated profiles, and unconfined but with a profile.</p>
<pre><code>sudo aa-enforce
</code></pre>
<p>make a new profile go into ‚Äúenforce‚Äù mode right away<br>
This command needs the <code>apparmor-utils</code> package.</p>
<pre><code>sudo systemctl status apparmor
</code></pre>
<p>shows if AppArmor is active, when it was started and its process ID number</p>
<pre><code>sudo systemctl restart apparmor
</code></pre>
<p>restarts AppArmor and its profiles.</p>
<hr>
<p>Edit by Patrick:<br>
Formatting changes.</p>
<p>                    <a href="../../../external.html?link=https://www.whonix.org/w/images/c/cf/Shield.png" target="_blank" class="onebox" rel="nofollow noopener">
            <img src="../../../external.html?link=https://www.whonix.org/w/images/c/cf/Shield.png" width="128" height="128">
          </a>

</p>
        </div>

        <meta itemprop='headline' content='Using apparmor-profile-everything on Debian Buster'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="3" />
           <span class='post-likes'>3 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../qubes-whonix-security-disadvantages-help-wanted/8581.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../qubes-whonix-security-disadvantages-help-wanted/8581.html'>
                      <span itemprop='name'>Qubes-Whonix Security Disadvantages - Help Wanted!</span>
                    </a>
                    <meta itemprop='position' content='4'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../installing-apparmor-profile-everything/9019/3.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../installing-apparmor-profile-everything/9019/3.html'>
                      <span itemprop='name'>installing apparmor-profile-everything</span>
                    </a>
                    <meta itemprop='position' content='5'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339/441.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339/441.html'>
                      <span itemprop='name'>AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy</span>
                    </a>
                    <meta itemprop='position' content='6'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../full-system-apparmor-policy-testers-wanted/10381.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../full-system-apparmor-policy-testers-wanted/10381.html'>
                      <span itemprop='name'>Full System AppArmor Policy - Testers Wanted!</span>
                    </a>
                    <meta itemprop='position' content='7'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8650.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T07:44:21Z' class='post-time'>
                December 19, 2019,  7:44am
              </time>
              <meta itemprop='dateModified' content='2019-12-19T07:44:21Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Made some formatting edits. And moved to news section.</p>
<p>Note: apparmor-profile-everything is still under development. While it might already break some malware, we don‚Äôt have it block dangerous file edits by default yet. Stay tuned. We‚Äôll post an update when ready.</p>
        </div>

        <meta itemprop='headline' content='Using apparmor-profile-everything on Debian Buster'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="8650.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T16:41:42Z' class='post-time'>
                December 19, 2019,  4:41pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T16:41:42Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>A great advertisement for a cool feature.</p>
        </div>

        <meta itemprop='headline' content='Using apparmor-profile-everything on Debian Buster'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
