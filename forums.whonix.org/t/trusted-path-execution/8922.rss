<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Trusted Path Execution</title>
    <link>http://forums.whonix.org/t/trusted-path-execution/8922</link>
    <description>Trusted Path Execution (TPE) prevents users from executing any binaries that are writable by any user other than root. This makes it far harder for unprivileged attackers to execute any of their own code.

There&#39;s different ways this can be implemented. Grsecurity had a GRKERNSEC_TPE option and there is a kernel module that does this, somewhat similar to LKRG https://github.com/cormander/tpe-lkm

I don&#39;t really like the look of tpe-lkm though as it&#39;s only been tested on really old kernels and it adds a bunch of other extra, unrelated and poorly implemented features (e.g. restricting /proc/kallsyms, restricting /proc/modules, restricting ptrace etc.). The only potentially useful parts of the extra features are already part of the vanilla kernel.

I can maybe work on porting GRKERNSEC_TPE if you want as that seems to be the best approach. There was some work on that already https://github.com/AndroidHardeningArchive/linux-hardened/pull/32/commits/5af947c0a4c43256188c85f4220af145cb5d3d99

A huge issue with TPE in general though is interpreters as they can bypass the restrictions so we&#39;d need &quot;interpreter lock&quot; https://phabricator.whonix.org/T941

Alternatively, see the [shebang LSM](https://patchwork.kernel.org/patch/9547405/) to restrict interpreters.</description>
    <language>en</language>
    <lastBuildDate>Thu, 13 Feb 2020 18:30:59 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/trusted-path-execution/8922.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Trusted Path Execution</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>It’s a bit early to tell. Can be tested once available. We can aim for<br>
the strictest setting and then back down if required.</p>
          <p><a href="http://forums.whonix.org/t/trusted-path-execution/8922/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/trusted-path-execution/8922/6</link>
        <pubDate>Thu, 13 Feb 2020 18:30:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8922-6</guid>
        <source url="http://forums.whonix.org/t/trusted-path-execution/8922.rss">Trusted Path Execution</source>
      </item>
      <item>
        <title>Trusted Path Execution</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/anthraxx/linux-hardened/pull/25" target="_blank">github.com/anthraxx/linux-hardened</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/anthraxx/linux-hardened/pull/25" target="_blank">Implement Trusted Path Execution</a>
    </h4>

    <div class="branches">
      <code>anthraxx:master</code> ← <code>madaidan:tpe</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-02-12" data-time="23:14:23" data-timezone="UTC">11:14PM - 12 Feb 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="1 commits changed 7 files with 249 additions and 1 deletions">
        <a href="https://github.com/anthraxx/linux-hardened/pull/25/files" target="_blank">
          <span class="added">+249</span>
          <span class="removed">-1</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/trusted-path-execution/8922/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/trusted-path-execution/8922/5</link>
        <pubDate>Wed, 12 Feb 2020 23:16:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8922-5</guid>
        <source url="http://forums.whonix.org/t/trusted-path-execution/8922.rss">Trusted Path Execution</source>
      </item>
      <item>
        <title>Trusted Path Execution</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>We need to decide how we’re going to configure TPE. It has multiple ways it can be used.</p>
<ol>
<li>
<p>The default: all users in the “untrusted” group are under the TPE restriction and can only execute files that are writable only by root.</p>
</li>
<li>
<p>tpe_invert: the opposite of (1). Only users in the “trusted” group are exempt from the restriction. All other non-root users are under the TPE restriction. The trusted group can be left empty and we will have a system-wide TPE restriction.</p>
</li>
<li>
<p>tpe_restrict_all: all non-root users will be covered under a weaker TPE restriction. This doesn’t have a trusted/untrusted group. All non-root users will only be allowed to execute files only they or root can write to i.e. they can execute their own and root’s files but not other users’ files.</p>
</li>
</ol>
<p>The strictest configuration is (2) but we might not want it that strict.</p>
<p>All of this can be configured at runtime via the fs.tpe* sysctls.</p>
          <p><a href="http://forums.whonix.org/t/trusted-path-execution/8922/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/trusted-path-execution/8922/4</link>
        <pubDate>Wed, 12 Feb 2020 22:07:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8922-4</guid>
        <source url="http://forums.whonix.org/t/trusted-path-execution/8922.rss">Trusted Path Execution</source>
      </item>
      <item>
        <title>Trusted Path Execution</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="8922">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I can maybe work on porting GRKERNSEC_TPE if you want as that seems to be the best approach. There was some work on that already <a href="https://github.com/AndroidHardeningArchive/linux-hardened/pull/32/commits/5af947c0a4c43256188c85f4220af145cb5d3d99">https://github.com/AndroidHardeningArchive/linux-hardened/pull/32/commits/5af947c0a4c43256188c85f4220af145cb5d3d99</a></p>
</blockquote>
</aside>
<p>Awesome. Looking forward to that.</p>
          <p><a href="http://forums.whonix.org/t/trusted-path-execution/8922/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/trusted-path-execution/8922/3</link>
        <pubDate>Wed, 12 Feb 2020 15:11:30 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8922-3</guid>
        <source url="http://forums.whonix.org/t/trusted-path-execution/8922.rss">Trusted Path Execution</source>
      </item>
      <item>
        <title>Trusted Path Execution</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>I’ve ported GRKERNSEC_TPE but I haven’t tested it yet. I’ll create a PR to linux-hardened if it goes well.</p>
          <p><a href="http://forums.whonix.org/t/trusted-path-execution/8922/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/trusted-path-execution/8922/2</link>
        <pubDate>Tue, 11 Feb 2020 22:04:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8922-2</guid>
        <source url="http://forums.whonix.org/t/trusted-path-execution/8922.rss">Trusted Path Execution</source>
      </item>
      <item>
        <title>Trusted Path Execution</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>Trusted Path Execution (TPE) prevents users from executing any binaries that are writable by any user other than root. This makes it far harder for unprivileged attackers to execute any of their own code.</p>
<p>There’s different ways this can be implemented. Grsecurity had a GRKERNSEC_TPE option and there is a kernel module that does this, somewhat similar to LKRG <a href="https://github.com/cormander/tpe-lkm">https://github.com/cormander/tpe-lkm</a></p>
<p>I don’t really like the look of tpe-lkm though as it’s only been tested on really old kernels and it adds a bunch of other extra, unrelated and poorly implemented features (e.g. restricting /proc/kallsyms, restricting /proc/modules, restricting ptrace etc.). The only potentially useful parts of the extra features are already part of the vanilla kernel.</p>
<p>I can maybe work on porting GRKERNSEC_TPE if you want as that seems to be the best approach. There was some work on that already <a href="https://github.com/AndroidHardeningArchive/linux-hardened/pull/32/commits/5af947c0a4c43256188c85f4220af145cb5d3d99">https://github.com/AndroidHardeningArchive/linux-hardened/pull/32/commits/5af947c0a4c43256188c85f4220af145cb5d3d99</a></p>
<p>A huge issue with TPE in general though is interpreters as they can bypass the restrictions so we’d need “interpreter lock” <a href="https://phabricator.whonix.org/T941">https://phabricator.whonix.org/T941</a></p>
<p>Alternatively, see the <a href="https://patchwork.kernel.org/patch/9547405/">shebang LSM</a> to restrict interpreters.</p>
          <p><a href="http://forums.whonix.org/t/trusted-path-execution/8922/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/trusted-path-execution/8922/1</link>
        <pubDate>Tue, 11 Feb 2020 18:43:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8922-1</guid>
        <source url="http://forums.whonix.org/t/trusted-path-execution/8922.rss">Trusted Path Execution</source>
      </item>
  </channel>
</rss>
