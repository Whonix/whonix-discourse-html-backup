<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Have firewall accept ICMP Fragmentation Needed - #4 by HulaHoop - Development - Whonix Forum</title>
    <meta name="description" content="I opened a pull request. 


But was told that the requested change needs to be discussed here first. So, here we go. 
Let’s just start off with the commit message from my pull requests: 

We want certain related packages&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../10233.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Have firewall accept ICMP Fragmentation Needed&#39;" href="../10233.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/have-firewall-accept-icmp-fragmentation-needed/10233/4" />
<meta name="twitter:url" content="https://forums.whonix.org/t/have-firewall-accept-icmp-fragmentation-needed/10233/4" />
<meta property="og:title" content="Have firewall accept ICMP Fragmentation Needed" />
<meta name="twitter:title" content="Have firewall accept ICMP Fragmentation Needed" />
<meta property="og:description" content="Generally, using any ICMP opens users to the possibility of a sidechannel - CPU has a very visible effect on ICMP packet latency.  Second. If we have to make decisions based on security vs performance tradeoff we will choose security almost every time if there isn’t a crippling effect on usability.   We disable connection tracking by default so there would be added attack surface." />
<meta name="twitter:description" content="Generally, using any ICMP opens users to the possibility of a sidechannel - CPU has a very visible effect on ICMP packet latency.  Second. If we have to make decisions based on security vs performance tradeoff we will choose security almost every time if there isn’t a crippling effect on usability.   We disable connection tracking by default so there would be added attack surface." />
<meta property="article:published_time" content="2020-09-07T18:19:04+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../10233.html">Have firewall accept ICMP Fragmentation Needed</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/pege'><span itemprop='name'>pege</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-09-07T12:54:48Z' class='post-time'>
                September 7, 2020, 12:54pm
              </time>
              <meta itemprop='dateModified' content='2021-10-06T08:50:03Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I opened a pull request.</p>
<aside class="onebox githubpullrequest">
  <header class="source">

      <a href="../../../../external.html?link=https://github.com/Whonix/whonix-firewall/pull/7" target="_blank" rel="noopener nofollow ugc">github.com/Whonix/whonix-firewall</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../../external.html?link=https://github.com/Whonix/whonix-firewall/pull/7" target="_blank" rel="noopener nofollow ugc">Allow related in addition to established connections</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>pgerber:related</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-09-05" data-time="18:37:54" data-timezone="UTC">06:37PM - 05 Sep 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../../external.html?link=https://github.com/pgerber" target="_blank" rel="noopener nofollow ugc">
          <img alt="pgerber" src="../../../../external.html?link=https://avatars.githubusercontent.com/u/11895833?v=4" class="onebox-avatar-inline" width="20" height="20">
          pgerber
        </a>
      </div>

      <div class="lines" title="1 commits changed 3 files with 4 additions and 4 deletions">
        <a href="../../../../external.html?link=https://github.com/Whonix/whonix-firewall/pull/7/files" target="_blank" rel="noopener nofollow ugc">
          <span class="added">+4</span>
          <span class="removed">-4</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">We want certain related packages to be accepted. In particular,
I've run into i<span class="show-more-container"><a href="../../../../external.html?link=https://github.com/Whonix/whonix-firewall/pull/7" target="_blank" rel="noopener nofollow ugc" class="show-more">…</a></span><span class="excerpt hidden">ssues using a VPN in front of a Whonix Gateway. This
because the related Fragmentation Needed packages get dropped:

 1780 280.196298  10.137.0.31 → 10.137.0.19  ICMP 590 Destination unreachable (Fragmentation needed)

With those packages not being delivered, a connection can be
established and works fine until a large package is sent. However,
once that happens no more packages can be delivered and the
connection times out after a while.

There is probably also a bunch of other, related packages that
we want to be delivered. ICMP host unreachable comes to mind, for
instance. Without it being delivered, one has to wait for
the connection attempt to timeout.

Note: Related connections appear to have been disabled in
414c2105149e02 but with no clear indication to why.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>But was told that the requested change needs to be discussed here first. So, here we go.</p>
<p>Let’s just start off with the commit message from my pull requests:</p>
<blockquote>
<p>We want certain related packages to be accepted. In particular,<br>
I’ve run into issues using a VPN in front of a Whonix Gateway. This<br>
because the related Fragmentation Needed packages get dropped:</p>
<p>1780 280.196298 10.137.0.31 → 10.137.0.19 ICMP 590 Destination unreachable (Fragmentation needed)</p>
<p>With those packages not being delivered, a connection can be<br>
established and works fine until a large package is sent. However,<br>
once that happens no more packages can be delivered and the<br>
connection times out after a while.</p>
<p>There is probably also a bunch of other, related packages that<br>
we want to be delivered. ICMP host unreachable comes to mind, for<br>
instance. Without it being delivered, one has to wait for<br>
the connection attempt to timeout.</p>
<p>Note: Related connections appear to have been disabled in<br>
414c2105149e02dcff82303e4c5b2dcd60ebbd29 but with no clear indication to why.</p>
</blockquote>
<p>I do think it’s reasonable to adjust the firewall to ensure ICMP Fragmentation Needed packages are delivered. A hop with a lower MTU somewhere in the network should simply not break the network connection, at least in my opinion. Of course, there are other ways to allow Fragmentation Needed packages than just allowing RELATED packages but I’d like to hear any concerns about using this approach first before looking into how those concerns can be addressed.</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../flushing-iptables-once-else-no-connection/10420/14.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../flushing-iptables-once-else-no-connection/10420/14.html'>
                      <span itemprop='name'>Flushing iptables once, else no connection</span>
                    </a>
                    <meta itemprop='position' content='4'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../icmp-support-is-required-for-networking-in-some-cases/12503/2.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../icmp-support-is-required-for-networking-in-some-cases/12503/2.html'>
                      <span itemprop='name'>ICMP support is required for networking in some cases</span>
                    </a>
                    <meta itemprop='position' content='5'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../sys-whonix-16-inconsistent-connectivity-issues-q4-0-and-q4-1/13008/13.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../sys-whonix-16-inconsistent-connectivity-issues-q4-0-and-q4-1/13008/13.html'>
                      <span itemprop='name'>sys-whonix 16 inconsistent connectivity issues (Q4.0 AND Q4.1)</span>
                    </a>
                    <meta itemprop='position' content='6'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-09-07T14:07:35Z' class='post-time'>
                September 7, 2020,  2:07pm
              </time>
              <meta itemprop='dateModified' content='2020-09-07T14:07:35Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>We drop all ICMP by default anyhow.</p>
<p>Reason for removal of <code>RELATED</code>:</p>
<ul>
<li><a href="../../../../external.html?link=https://lists.autistici.org/message/20141203.172230.8dcda825.en.html">https://lists.autistici.org/message/20141203.172230.8dcda825.en.html</a></li>
<li><a href="../../../../external.html?link=https://lists.autistici.org/thread/20141203.172230.8dcda825.en.html#i20141203.172230.8dcda825">https://lists.autistici.org/thread/20141203.172230.8dcda825.en.html#i20141203.172230.8dcda825</a></li>
</ul>
<p>Reason to be cautious:</p>
<ul>
<li><a href="../../../../external.html?link=https://lists.torproject.org/pipermail/tor-talk/2014-March/032503.html">https://lists.torproject.org/pipermail/tor-talk/2014-March/032503.html</a></li>
</ul>
<p>Reasons for not enabling <code>RELATED</code> by default:</p>
<ul>
<li>works great for years, nobody ever noticed</li>
<li><a href="../../../../external.html?link=https://www.whonix.org/wiki/Tunnels/Introduction">https://www.whonix.org/wiki/Tunnels/Introduction</a></li>
</ul>
<p>//cc <a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/pege'><span itemprop='name'>pege</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-09-07T16:13:11Z' class='post-time'>
                September 7, 2020,  4:13pm
              </time>
              <meta itemprop='dateModified' content='2020-09-07T16:13:11Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Perhaps, we could create a more explicit rule. Something like:</p>
<pre><code class="lang-auto">iptables -I INPUT --proto icmp --icmp-type destination-unreachable -m state --state RELATED -j ACCEPT
</code></pre>
<p>Worst case, we’d let through a <em>destination-unreachable</em> package that’s not actually associated with a connection. In that case, it’d simply be discarded upon reception.</p>
<p>As for the danger of adding additional complexity because of the additional parsing required. As I understand it, this will happen here anyway in order for connection tracking to assign <a href="../../../../external.html?link=https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#STATEMACHINE" rel="nofollow noopener">one of the NEW, ESTABLISHED, RELATED or INVALID states</a>. Whether we use the state information doesn’t matter. (Of course, if connection tracking was disabled entirely or if additional conntrack helpers were in use, this wouldn’t hold true.)</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../running-whonix-on-kvm-in-linux-containers/14048.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../running-whonix-on-kvm-in-linux-containers/14048.html'>
                      <span itemprop='name'>Running Whonix on KVM in Linux containers</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-09-07T18:19:04Z' class='post-time'>
                September 7, 2020,  6:19pm
              </time>
              <meta itemprop='dateModified' content='2020-09-07T18:19:04Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Generally, using any ICMP opens users to the possibility of a sidechannel - CPU has a very visible effect on ICMP packet latency.</p>
<p>Second. If we have to make decisions based on security vs performance tradeoff we will choose security almost every time if there isn’t a crippling effect on usability.</p>
<aside class="quote no-group" data-username="pege" data-post="3" data-topic="10233">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/p/f1d935/40.png" class="avatar"> pege:</div>
<blockquote>
<p>(Of course, if connection tracking was disabled entirely or if additional conntrack helpers were in use, this wouldn’t hold true.)</p>
</blockquote>
</aside>
<p>We disable connection tracking by default so there would be added attack surface.</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../../icmp-support-is-required-for-networking-in-some-cases/12503.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../../icmp-support-is-required-for-networking-in-some-cases/12503.html'>
                      <span itemprop='name'>ICMP support is required for networking in some cases</span>
                    </a>
                    <meta itemprop='position' content='1'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-09-10T10:22:53Z' class='post-time'>
                September 10, 2020, 10:22am
              </time>
              <meta itemprop='dateModified' content='2020-09-10T10:22:53Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>The ability to customize Whonix firewall is pretty good already, I hope. It supports a configuration drop-in folder.</p>
<p>Related:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="../../../../external.html?link=https://www.whonix.org/wiki/Configuration_Files" target="_blank" title="11:42PM - 19 June 2020">Whonix – 19 Jun 20</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/73;"><img src="../../../../external.html?link=https://www.whonix.org/w/images/3/3b/Five-elements-379106640.jpg" class="thumbnail" width="110" height="73"></div>

<h3><a href="../../../../external.html?link=https://www.whonix.org/wiki/Configuration_Files" target="_blank">Configuration Files - Whonix</a></h3>

<p>Everything you should know about Configuration Drop-in Folders and Files.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>There is a setting <code>GATEWAY_ALLOW_INCOMING_ICMP=1</code> which would prevent addition of this iptables rule:</p>
<blockquote>
<p><code>$iptables_cmd -A INPUT -p icmp -j DROP</code></p>
</blockquote>
<p>Also could could overwrite whole function <code>ipv4_input_rules</code>  (or any other function) by supplying your own version in config.</p>
<p>As for <code>ESTABLISHED</code> vs <code>ESTABLISHED,RELATED</code> I would accept a patch to make that a variable in the usual script style. Default to <code>ESTABLISHED</code> and possibly overwrite as variable in config.</p>
<p>If you have other suggestions to make Whonix firewall easier customizable please discuss.</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/aurin04'><span itemprop='name'>aurin04</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-06T03:12:41Z' class='post-time'>
                October 6, 2021,  3:12am
              </time>
              <meta itemprop='dateModified' content='2021-10-06T03:12:41Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>To head off claims I didn’t check first, I’m just not sure what the rules for necroing are on this forum. There is a thread titled “Have firewall accept ICMP Fragmentation Needed” about this.</p>
<p>I recently had to deal with the infamous “Tor stuck at 45% forever and not connecting” problem. This turned out to be because of misconfigured hardware ISP-side advertising an MTU lower than Whonix assumes (1500).</p>
<p>If Whonix bothered to actually accept “Destination Unreachable” ICMP messages, it would have quickly noticed the need to fragment the packets so that Tor could even get started working. In fact, specifically adding a rule to accept those “miraculously” fixed the issue, as one would expect. It later turned out that my connection <em>does</em> support higher MTUs despite the ISP’s DHCP options, but that’s just luck.</p>
<p>This also means that Whonix is fundamentally unusable by users stuck on subpar networking links such as dialup when using its default settings (unless they know to manually adjust the MTU of interfaces in the Whonix VM), which is still in use in my country, especially in rural areas.</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="4" data-topic="10233">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>If we have to make decisions based on security vs performance tradeoff we will choose security almost every time if there isn’t a crippling effect on usability.</p>
</blockquote>
</aside>
<p>I think this qualifies as a crippling effect on usability.</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-06T10:07:42Z' class='post-time'>
                October 6, 2021, 10:07am
              </time>
              <meta itemprop='dateModified' content='2021-10-06T10:07:42Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Does <a href="../../../../external.html?link=https://www.whonix.org/wiki/Troubleshooting#ICMP_Fix">ICMP Fix</a> help? Documented just now.</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/aurin04'><span itemprop='name'>aurin04</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-10T23:39:50Z' class='post-time'>
                October 10, 2021, 11:39pm
              </time>
              <meta itemprop='dateModified' content='2021-10-10T23:39:50Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I have since fixed the issue on my end by ignoring the ISP’s advertised limits, but if this does what I think and simply allows all ICMP messages, then that would have the same effect as my whitelisting of ICMP which I had found during debugging.</p>
<p>I think just whitelisting the specific messages related to link quality would also work with lesser security implications, but as noted that is not currently implemented. In any case, good to have it documented.</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../10233.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-13T14:33:33Z' class='post-time'>
                October 13, 2021,  2:33pm
              </time>
              <meta itemprop='dateModified' content='2021-10-13T14:33:33Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="aurin04" data-post="8" data-topic="10233">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/a/34f0e0/40.png" class="avatar"> aurin04:</div>
<blockquote>
<p>I have since fixed the issue on my end by ignoring the ISP’s advertised limits</p>
</blockquote>
</aside>
<p>How?</p>
        </div>

        <meta itemprop='headline' content='Have firewall accept ICMP Fragmentation Needed'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
