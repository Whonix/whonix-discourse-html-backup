<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
    <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147</link>
    <description>Don&#39;t know if it was this what you wanted, because it seems this issue could be separated in two:

1 - updates proxy network policy
2 - netvm policy for anon-vm

n2:
 https://github.com/QubesOS/qubes-issues/issues/3994#issuecomment-1180249009</description>
    <language>en</language>
    <lastBuildDate>Fri, 15 Jul 2022 11:15:38 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="nyxnor" data-post="4" data-topic="14147">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>When <strong>None</strong> is mentioned, it refer to the value <code>None</code>, as in not networked.</p>
</blockquote>
</aside>
<p>Yes. Would be good to use capitalized and <code>code tags</code>.</p>
<aside class="quote no-group" data-username="nyxnor" data-post="4" data-topic="14147">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>So it would be the equivalent of:</p>
<pre><code class="lang-auto">qubes-prefs default_netvm ''
</code></pre>
<p>But being set as default for new installations.</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group" data-username="nyxnor" data-post="4" data-topic="14147">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>And qubes created by default should have netvm set to sys-firewall by default or None?</p>
</blockquote>
</aside>
<p><code>None</code></p>
<aside class="quote no-group" data-username="nyxnor" data-post="6" data-topic="14147">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>QubesOS default installation qubes should not be connected to ther internet by default, manual configuration to set the netvm for all qubes.<br>
Of course anyone can change the qubes-prefs default_netvm later.</p>
<p>Is that it?</p>
</blockquote>
</aside>
<p>Yes. However, should be added:</p>
<p>For some VMs, the such as perhaps the <code>untrusted</code> VM supposed to be used for untrusted web browsing (according to <a href="https://www.qubes-os.org/attachment/doc/r4.0-snapshot_40.png">screenshot</a>) would then be set to <code>sys-firewall</code> by higher level tools (preconfiguration tool Qubes salt).</p>
<aside class="quote no-group" data-username="nyxnor" data-post="6" data-topic="14147">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>Make users explictly set the netvm everytime, unless of course it was preferred otherwise in qubes-prefs.</p>
</blockquote>
</aside>
<p>Yes.</p>
          <p><a href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/7</link>
        <pubDate>Fri, 15 Jul 2022 11:15:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-14147-7</guid>
        <source url="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</source>
      </item>
      <item>
        <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>My understanding of <a href="https://github.com/QubesOS/qubes-issues/issues/7614#issuecomment-1183584016" rel="noopener nofollow ugc">https://github.com/QubesOS/qubes-issues/issues/7614#issuecomment-1183584016</a></p>
<p>Set default_netvm to None by default.<br>
QubesOS default installation qubes should not be connected to ther internet by default, manual configuration to set the netvm for all qubes.<br>
Of course anyone can change the qubes-prefs default_netvm later.</p>
<p>Is that it?</p>
<p>Argument:<br>
Avoid a default netvm, set it to None by default, this avoids qubes getting a network on creation.</p>
<p>Make users explictly set the netvm everytime, unless of course it was preferred otherwise in qubes-prefs.</p>
          <p><a href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/6</link>
        <pubDate>Wed, 13 Jul 2022 21:39:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-14147-6</guid>
        <source url="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</source>
      </item>
      <item>
        <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://github.com/QubesOS/qubes-issues/issues/3994#issuecomment-1183592432" rel="noopener nofollow ugc">https://github.com/QubesOS/qubes-issues/issues/3994#issuecomment-1183592432</a></p>
<blockquote>
<p>Let’s see…<br>
…<br>
Do you understand it now better?</p>
</blockquote>
<p>Is something missing in the middle?</p>
          <p><a href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/5</link>
        <pubDate>Wed, 13 Jul 2022 20:34:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-14147-5</guid>
        <source url="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</source>
      </item>
      <item>
        <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>When <strong>None</strong> is mentioned, it refer to the value <code>None</code>, as in not networked.<br>
When <strong>none</strong> is mentioned, it is the normal English word. Or possibly I forgot to capitalize the N when I wanted to refer to non-networked.</p>
<aside class="quote no-group" data-username="Patrick" data-post="2" data-topic="14147">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>The Qubes default should be that all VMs (non-Whonix and Whonix) are non-networked by default. That is to avoid that any VM accidentally gets network access.</p>
</blockquote>
</aside>
<p>qubes netvm policy to be non-networked by default is the summary?</p>
<p>So it would be the equivalent of:</p>
<pre><code class="lang-auto">qubes-prefs default_netvm ''
</code></pre>
<p>But being set as default for new installations.<br>
And qubes created by default should have netvm set to sys-firewall by default or None?</p>
          <p><a href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/4</link>
        <pubDate>Wed, 13 Jul 2022 19:56:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-14147-4</guid>
        <source url="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</source>
      </item>
      <item>
        <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>Sorry  but really couldn’t understand that point from reading the issue on github.</p>
<p>An another note, I will redact that comment and put it in another issue.</p>
          <p><a href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/3</link>
        <pubDate>Mon, 11 Jul 2022 18:48:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-14147-3</guid>
        <source url="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</source>
      </item>
      <item>
        <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue" data-onebox-src="https://github.com/QubesOS/qubes-issues/issues/3994">
  <header class="source">

      <a href="https://github.com/QubesOS/qubes-issues/issues/3994" target="_blank" rel="noopener">github.com/QubesOS/qubes-issues</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/QubesOS/qubes-issues/issues/3994" target="_blank" rel="noopener">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2018-06-14" data-time="09:02:13" data-timezone="UTC">09:02AM - 14 Jun 18 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          T: enhancement
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          C: core
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          P: major
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          privacy
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          C: Whonix
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">### Qubes OS version:
R4 and above
### Affected component(s): 
dom0, Whonix
<span class="show-more-container"><a href="http://forums.whonix.org" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">### Steps to reproduce the behavior:
Set NetVM of anon-whonix to default (sys-net).

Then use system default networking `curl.anondist-orig https://check.torproject.org` or otherwise to connect to clearnet.
### Expected behavior:
Secure defaults. No clearnet connections possible through small user configuration mistake / oversight.
### Actual behavior:
Insecure defaults. Clearnet leak.
### General notes:
Qubes UpdatesProxy mechanism currently is more likely to produce a leak in future. A leak as in a user expecting to have connections torified while these are over clearnet.

The problem is, that https://github.com/QubesOS/qubes-core-admin/blob/master/qubes-rpc-policy/qubes.UpdatesProxy.policy by default says `$type:TemplateVM $default allow,target=sys-net`. And sys-net traffic isn't torified by default. Therefore, if any of the following goes wrong (salt / tags / qvm-features maybe / qubes-core-admin-addon-whonix), Whonix TemplateVMs might connect through clearnet. Would be better if `qubes.UpdatesProxy.policy` only included `$anyvm $anyvm deny` and then opt-in each and every TemplateVM rather than an opt-out approach.

When the user wants torification, the default non-torification setting needs to be overwritten. This is done by salt:

* https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/template-whonix-gw.sls - which depends on `tag:whonix-updatevm`
* https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/updates-via-whonix.sls

And then there is also https://github.com/QubesOS/qubes-core-admin-addon-whonix.

The user accidentally setting a whonix-ws based AppVM such as anon-whonix to NetVM default (sys-net) results in `curl.anondist-orig https://check.torproject.org` being able to reach it over clearnet. This is a huge disadvantage over the VirtualBox version of Whonix where such mistakes are very very unlikely to happen. (Because the Whonix-Workstation VirtualBox version of Whonix has only an internal network card (in internal network `whonix`) - which cannot accidentally connect to clearnet.)

----

Qubes-Whonix has code to detect wrongly configured Qubes updates proxy settings and refuses to upgrade but that's just a workaround and more complexity (possible including bugs leading to situations where users cannot upgrade or false-positive warnings).

* https://github.com/Whonix/qubes-whonix/blob/master/etc/uwt.d/40_qubes.conf
* https://github.com/Whonix/qubes-whonix/blob/master/usr/lib/qubes-whonix/init/torified-updates-proxy-check
* https://github.com/Whonix/qubes-whonix/blob/master/lib/systemd/system/qubes-whonix-torified-updates-proxy-check.service

There's also `whonixcheck --leak-tests`.

It's not a real fix, not as strong as a technical guarantee as it could be.

----

It's a complex design and interaction. Hard to fully understand (more so the more time passes). Prone for bugs in future or user mistake.

In summary, Qubes default and technical design currently is: network-enabled, clearnet, options to change to network-disabled or torified

For better control of connections the technical design should be: non-networked by default and then opt-in networking by using salt / core-admin-addon's.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Tthis ticket isn’t a small bug in qubes-core-admin. It’s about a suggestion to change the global Qubes defaults. The Qubes default should be that all VMs (non-Whonix and Whonix) are non-networked by default. That is to avoid that any VM accidentally gets network access. The user wouldn’t notice any defaults since the default setup scripts would still allow the standard Qubes created VMs to have network by default. However, internally a safer non-networked default would make Qubes-Whonix more leak-proof.</p>
<p>Non-Qubes-Whonix is unaffected.</p>
<p>Related:</p>
<ul>
<li>
<a href="https://www.whonix.org/wiki/Dev/VirtualBox#Whonix_VirtualBox_versus_Other_Virtualizers">Whonix VirtualBox versus Other Virtualizers</a>
<ul>
<li><a href="https://www.whonix.org/wiki/Dev/VirtualBox#Why_use_VirtualBox_over_KVM?">Why use VirtualBox over KVM?</a></li>
<li><a href="https://www.whonix.org/wiki/Dev/VirtualBox#Why_use_VirtualBox_over_Qubes?">Why use VirtualBox over Qubes?</a></li>
<li><a href="https://www.whonix.org/wiki/Dev/VirtualBox#Whonix_VirtualBox_Security">Whonix VirtualBox Security</a></li>
</ul>
</li>
</ul>
          <p><a href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/2</link>
        <pubDate>Mon, 11 Jul 2022 17:59:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-14147-2</guid>
        <source url="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</source>
      </item>
      <item>
        <title>change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>Don’t know if it was this what you wanted, because it seems this issue could be separated in two:</p>
<p>1 - updates proxy network policy<br>
2 - netvm policy for anon-vm</p>
<p>n2:<br>
<a href="https://github.com/QubesOS/qubes-issues/issues/3994#issuecomment-1180249009" rel="noopener nofollow ugc">https://github.com/QubesOS/qubes-issues/issues/3994#issuecomment-1180249009</a></p>
          <p><a href="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147/1</link>
        <pubDate>Mon, 11 Jul 2022 10:59:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-14147-1</guid>
        <source url="http://forums.whonix.org/t/change-qubes-network-policy-updatesproxy-to-network-disabled-by-default-for-better-leak-proofness/14147.rss">change Qubes network policy, UpdatesProxy to network disabled by default for better leak-proofness</source>
      </item>
  </channel>
</rss>
