<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>kernel recompilation for better hardening - Development - Whonix Forum</title>
    <meta name="description" content="https://docs.clip-os.org/clipos/kernel.html 


These both look interesting. They‚Äôre mainly for kernel compile options though. 
Is there any way to build Whonix with custom kernel configurations? Or will kernels have to b&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="7598e4a7.html?page=21" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;kernel recompilation for better hardening&#39;" href="7598.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598?page=21" />
<meta name="twitter:url" content="https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598?page=21" />
<meta property="og:title" content="kernel recompilation for better hardening" />
<meta name="twitter:title" content="kernel recompilation for better hardening" />
<meta property="og:description" content="madaidan via Whonix Forum:   Also, instead of trying to patch out dmesg, we can try just disabling CONFIG_PRINTK.   I don‚Äôt think it‚Äôs a good since it makes debugging almost impossible.  Quote https://cateee.net/lkddb/web-lkddb/PRINTK.html   This option enables normal printk support. Removing it eliminates most  of the message strings from the kernel image and makes the kernel more  or less silent. As this makes it very difficult to diagnose system  problems, saying N here is strongly discourage..." />
<meta name="twitter:description" content="madaidan via Whonix Forum:   Also, instead of trying to patch out dmesg, we can try just disabling CONFIG_PRINTK.   I don‚Äôt think it‚Äôs a good since it makes debugging almost impossible.  Quote https://cateee.net/lkddb/web-lkddb/PRINTK.html   This option enables normal printk support. Removing it eliminates most  of the message strings from the kernel image and makes the kernel more  or less silent. As this makes it very difficult to diagnose system  problems, saying N here is strongly discourage..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="105 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="608 ‚ù§" />
<meta property="article:published_time" content="2020-02-26T10:47:33+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="7598f62c.html?page=20">
        <link rel="next" href="75983c09.html?page=22">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="7598.html">kernel recompilation for better hardening</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../tag/status_open_issue_todo.html' class='discourse-tag' rel="tag">status_open_issue_todo</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-26T10:47:33Z' class='post-time'>
                February 26, 2020, 10:47am
              </time>
              <meta itemprop='dateModified' content='2020-02-26T10:47:33Z'>
          <span itemprop='position'>#404</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<p>Also, instead of trying to patch out dmesg, we can try just disabling <code>CONFIG_PRINTK</code>.</p>
</blockquote>
<p>I don‚Äôt think it‚Äôs a good since it makes debugging almost impossible.</p>
<p>Quote <a href="../../../external.html?link=https://cateee.net/lkddb/web-lkddb/PRINTK.html">https://cateee.net/lkddb/web-lkddb/PRINTK.html</a></p>
<blockquote>
<p>This option enables normal printk support. Removing it eliminates most<br>
of the message strings from the kernel image and makes the kernel more<br>
or less silent. As this makes it very difficult to diagnose system<br>
problems, saying N here is strongly discouraged.</p>
</blockquote>
<p><a href="../../../external.html?link=https://phabricator.whonix.org/T950">https://phabricator.whonix.org/T950</a> seems like a better way forward.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>
          <meta itemprop='keywords' content='component_security, status_open_issue_todo'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-26T11:01:58Z' class='post-time'>
                February 26, 2020, 11:01am
              </time>
              <meta itemprop='dateModified' content='2020-02-26T11:01:58Z'>
          <span itemprop='position'>#405</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I reverted the revert. As per expert input</p>
<aside class="quote quote-modified" data-post="397" data-topic="7598">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar">
    <a href="7598/397.html">kernel recompilation for better hardening</a> <a class="badge-wrapper  bullet" href="../../c/development/8.html"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    Got reply. 
smuellerDD: 

Am Dienstag, 25. Februar 2020, 07:36:52 CET schrieb Patrick Schleizer: 
Hi Patrick, 

We are using kernel command line random.trust_cpu=off to distrust / not 
credit randomness sourced from CPU‚Äôs RDRAND. 
(<a href="../../../external.html?link=https://www.whonix.org/wiki/Dev/Entropy#RDRAND">rationale</a>) 
Now we are wondering about the following kernel compile configuration 
changes: 
Old: 
CONFIG_HW_RANDOM=m
CONFIG_HW_RANDOM_INTEL=m
CONFIG_HW_RANDOM_AMD=m
CONFIG_HW_RANDOM_VIA=m

New: 
CONFIG_HW_RANDOM=y
CONFIG_HW_RANDOM_INTEL=y
CONFIG_HW_RANDOM_AMD=y
CONFI‚Ä¶
  </blockquote>
</aside>

<p>there is no indication of this being a bad idea. In other words</p>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/44" target="_blank">github.com/Whonix/hardened-kernel</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/44" target="_blank">Compile HWRNGs as built-in</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ‚Üê <code>madaidan:rng</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-02-21" data-time="18:20:17" data-timezone="UTC">06:20PM - 21 Feb 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="1 commits changed 2 files with 8 additions and 8 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/44/files" target="_blank">
          <span class="added">+8</span>
          <span class="removed">-8</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>is now merged.</p>
<aside class="quote no-group" data-username="madaidan" data-post="400" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/46">Compile only virtio-rng as built-in</a></p>
</blockquote>
</aside>
<p>Merged but didn‚Äôt actually change something due to above.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-26T11:18:55Z' class='post-time'>
                February 26, 2020, 11:18am
              </time>
              <meta itemprop='dateModified' content='2020-02-26T11:18:55Z'>
          <span itemprop='position'>#406</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>We don‚Äôt have any real data. Can only speculate. A google search for the name of the wifi device plus ‚Äúlinux forum‚Äù brings up lots of search results. Search terms:</p>
<ul>
<li>‚ÄúRTL8192U‚Äù linux forum</li>
<li>‚ÄúRTL8188EU‚Äù linux forum</li>
<li>‚ÄúRTL8712U‚Äù linux forum</li>
<li>‚ÄúRTL8723BS‚Äù linux forum</li>
<li>‚ÄúRTL8192E‚Äù linux forum</li>
</ul>
<p>People are using these devices. Therefore I think it‚Äôs better to keep these modules for wifi devices.</p>
<p>That also shows that the approach of 1 kernel config for the host (and another 1 for all VMs) covering it all cannot be perfect. Either hardware support becomes more broken than Debian default (which is already not working for many people) or it‚Äôs not a minimal amount of kernel modules.</p>
<p>Maybe the Clip OS approach of generating the kernel config on the user‚Äôs system (?) would bring more optional results. But probably also at higher development and maintenance efforts. And even then we‚Äôd have to decide on a default which gets used when users boot the system for the very first time.</p>
<p>For hosts: Maybe kernel re-compilation could be done at first boot of system or during installation to be tailored for the system. But all of this is far fetched in future.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-26T13:07:03Z' class='post-time'>
                February 26, 2020,  1:07pm
              </time>
              <meta itemprop='dateModified' content='2020-02-26T13:07:03Z'>
          <span itemprop='position'>#407</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="madaidan" data-post="402" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><code>CONFIG_EFI_VARS</code> might be good to disable in the host kernel. It exposes a lot of attack surface as it allows you to mess with EFI variables.</p>
<p><a href="../../../external.html?link=https://github.com/torvalds/linux/blob/master/drivers/firmware/efi/Kconfig">https://github.com/torvalds/linux/blob/master/drivers/firmware/efi/Kconfig</a></p>
<p>There have been cases of people bricking their computers by accidentally deleting EFI variables. An attacker might be able to do far more by writing specific things to them.</p>
<p>CLIP OS disables this.</p>
<p><a href="../../../external.html?link=https://github.com/clipos/src_platform_config-linux-hardware/blob/master/kernel_config/blacklist#L60">https://github.com/clipos/src_platform_config-linux-hardware/blob/master/kernel_config/blacklist#L60</a></p>
</blockquote>
</aside>
<p>EFI can be used to backdoor a system. I don‚Äôt like it. Though <a href="../../../external.html?link=https://fedoraproject.org/wiki/Features/EFI">https://fedoraproject.org/wiki/Features/EFI</a> and <a href="../../../external.html?link=https://unix.stackexchange.com/questions/49165/can-grub2-share-the-efi-system-partition-with-windows/49269#49269">https://unix.stackexchange.com/questions/49165/can-grub2-share-the-efi-system-partition-with-windows/49269#49269</a> imply that this kernel config is required for EFI booting. We shouldn‚Äôt break EFI booting / EFI bootmanger upgrade. Can you test these things?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-26T18:17:33Z' class='post-time'>
                February 26, 2020,  6:17pm
              </time>
              <meta itemprop='dateModified' content='2020-02-26T18:17:33Z'>
          <span itemprop='position'>#408</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="404" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I don‚Äôt think it‚Äôs a good since it makes debugging almost impossible.</p>
</blockquote>
</aside>
<p>That‚Äôd be no different than patching out dmesg AFAIK. I guess the only advantage with patching it out is we can add a sysctl for superroot to change it at runtime.</p>
<aside class="quote no-group" data-username="Patrick" data-post="404" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><a href="../../../external.html?link=https://phabricator.whonix.org/T950">https://phabricator.whonix.org/T950</a> seems like a better way forward.</p>
</blockquote>
</aside>
<p>That won‚Äôt prevent root from using <code>dmesg</code>.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-26T18:22:04Z' class='post-time'>
                February 26, 2020,  6:22pm
              </time>
              <meta itemprop='dateModified' content='2020-02-26T18:22:04Z'>
          <span itemprop='position'>#409</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="407" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Though <a href="../../../external.html?link=https://fedoraproject.org/wiki/Features/EFI">https://fedoraproject.org/wiki/Features/EFI</a> and <a href="../../../external.html?link=https://unix.stackexchange.com/questions/49165/can-grub2-share-the-efi-system-partition-with-windows/49269#49269">https://unix.stackexchange.com/questions/49165/can-grub2-share-the-efi-system-partition-with-windows/49269#49269</a> imply that this kernel config is required for EFI booting.</p>
</blockquote>
</aside>
<p>It only seems to be required for installation. As long as grub isn‚Äôt installed while using hardened-kernel it should be alright?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-26T18:26:06Z' class='post-time'>
                February 26, 2020,  6:26pm
              </time>
              <meta itemprop='dateModified' content='2020-02-26T18:26:06Z'>
          <span itemprop='position'>#410</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>There appears to be 2 ways to modify EFI variables. <code>CONFIG_EFI_VARS</code> and <code>CONFIG_EFIVAR_FS</code>.</p>
<p><a href="../../../external.html?link=https://github.com/torvalds/linux/blob/master/fs/efivarfs/Kconfig">https://github.com/torvalds/linux/blob/master/fs/efivarfs/Kconfig</a></p>
<p>From the kconfig, it looks like <code>CONFIG_EFI_VARS</code> is legacy.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-27T07:04:22Z' class='post-time'>
                February 27, 2020,  7:04am
              </time>
              <meta itemprop='dateModified' content='2020-02-27T07:04:22Z'>
          <span itemprop='position'>#411</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="407" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Though <a href="../../../external.html?link=https://fedoraproject.org/wiki/Features/EFI">https://fedoraproject.org/wiki/Features/EFI</a> and <a href="../../../external.html?link=https://unix.stackexchange.com/questions/49165/can-grub2-share-the-efi-system-partition-with-windows/49269#49269">https://unix.stackexchange.com/questions/49165/can-grub2-share-the-efi-system-partition-with-windows/49269#49269</a> imply that this kernel config is required for EFI booting.</p>
</blockquote>
</aside>
<p>It only seems to be required for installation.</p>
</blockquote>
<p>We need reasonable certainties. Otherwise we‚Äôd produce stuff which is<br>
later going to be unusable. EFI booting is hard on its own. Adding<br>
disabling of kernel EFI config to the mix makes it even harder.</p>
<blockquote>
<p>As long as grub isn‚Äôt installed while using hardened-kernel it should<br>
be alright?</p>
</blockquote>
<p>How would grub not be installed? It‚Äôs a default package in Debian,<br>
Whonix, Kicksecure. You probably mean only required during<br>
<code>grub-install</code>? Well, at some point one needs to run <code>grub-install</code>. For<br>
example when booting a Whonix or Kicksecure Live ISO (to be created in<br>
future) it would hopefully boot a hardened kernel. When then running the<br>
installer, <code>grub-install</code> needs to function. Otherwise at that point<br>
there would be a hard to debug and fix issue.</p>
<p>I see a lot other stuff more important before a hardened kernel can take<br>
off or details such as EFI variables kernel config become a question.</p>
<ul>
<li>packaging <a href="../../../external.html?link=https://phabricator.whonix.org/T960">https://phabricator.whonix.org/T960</a>
</li>
<li>automated builds and tests of kernel (boot in VM and also on bare<br>
metal, run tests, aka automated test suite, for both BIOS and EFI boot,<br>
such a installation, upgrades, whatnot) - if that was sorted, if the<br>
testing process was automated and robust, if we knew if changes break<br>
things, it would be a lot easier to make more changes.</li>
</ul>
<p>I‚Äôd say better get it widely deployed first and then do fine tuning.<br>
Otherwise if we ship something that doesn‚Äôt work for most users we end<br>
up keeping using the standard kernel.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-27T07:29:23Z' class='post-time'>
                February 27, 2020,  7:29am
              </time>
              <meta itemprop='dateModified' content='2020-02-27T07:29:23Z'>
          <span itemprop='position'>#412</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="404" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I don‚Äôt think it‚Äôs a good since it makes debugging almost impossible.</p>
</blockquote>
</aside>
<p>That‚Äôd be no different than patching out dmesg AFAIK. I guess the only advantage with patching it out is we can add a sysctl for superroot to change it at runtime.</p>
</blockquote>
<p>I see. I don‚Äôt remember discussing patching out dmesg though.</p>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="404" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><a href="../../../external.html?link=https://phabricator.whonix.org/T950">https://phabricator.whonix.org/T950</a> seems like a better way forward.</p>
</blockquote>
</aside>
<p>That won‚Äôt prevent root from using <code>dmesg</code>.</p>
</blockquote>
<p>I see. Would it suffice to prohibit executing <code>dmesg</code> using<br>
apparmor-profile-everything for all users except superroot?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-27T17:16:09Z' class='post-time'>
                February 27, 2020,  5:16pm
              </time>
              <meta itemprop='dateModified' content='2020-02-27T17:16:09Z'>
          <span itemprop='position'>#413</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="412" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I see. I don‚Äôt remember discussing patching out dmesg though.</p>
</blockquote>
</aside>
<aside class="quote" data-post="307" data-topic="8339">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar">
    <a href="../apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339/307.html">AppArmor for Complete System - Including init, PID1, Systemd, Everything! - Full System MAC policy</a> <a class="badge-wrapper  bullet" href="../../c/apparmor/14.html"><span class="badge-category-bg" style="background-color: #12A89D;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Discussion of Whonix AppArmor Profiles for better security. (devs)">AppArmor</span></a>
  </div>
  <blockquote>
    It might be better to just fix this directly in the kernel with a patch adding a kernel.dmesg_restrict=2 sysctl rather than trying to hack our way around it.
  </blockquote>
</aside>

<aside class="quote no-group" data-username="Patrick" data-post="412" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Would it suffice to prohibit executing <code>dmesg</code> using apparmor-profile-everything for all users except superroot?</p>
</blockquote>
</aside>
<p>That doesn‚Äôt stop the attacker from using their own program. They can copy/paste the <code>dmesg</code> source code.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-28T18:57:36Z' class='post-time'>
                February 28, 2020,  6:57pm
              </time>
              <meta itemprop='dateModified' content='2020-02-28T18:57:36Z'>
          <span itemprop='position'>#414</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/49" target="_blank">github.com/Whonix/hardened-kernel</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/49" target="_blank">Disable device coredump</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ‚Üê <code>madaidan:dev_coredump</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-02-28" data-time="18:57:27" data-timezone="UTC">06:57PM - 28 Feb 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="4 commits changed 4 files with 5 additions and 3 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/49/files" target="_blank">
          <span class="added">+5</span>
          <span class="removed">-3</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-28T19:10:04Z' class='post-time'>
                February 28, 2020,  7:10pm
              </time>
              <meta itemprop='dateModified' content='2020-02-28T19:10:04Z'>
          <span itemprop='position'>#415</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/50" target="_blank">github.com/Whonix/hardened-kernel</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/50" target="_blank">Disable HDLC in host kernel</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ‚Üê <code>madaidan:hdlc</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-02-28" data-time="19:09:47" data-timezone="UTC">07:09PM - 28 Feb 20 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 2 additions and 16 deletions">
        <a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/50/files" target="_blank">
          <span class="added">+2</span>
          <span class="removed">-16</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T08:33:50Z' class='post-time'>
                February 29, 2020,  8:33am
              </time>
              <meta itemprop='dateModified' content='2020-02-29T08:33:50Z'>
          <span itemprop='position'>#416</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="madaidan" data-post="414" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/49">Disable device coredump</a></p>
</blockquote>
</aside>
<p>Merged.</p>
<aside class="quote no-group" data-username="madaidan" data-post="415" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><a href="../../../external.html?link=https://github.com/Whonix/hardened-kernel/pull/50">Disable HDLC in host kernel</a></p>
</blockquote>
</aside>
<p>Can you find if this would be needed for something? <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T08:39:57Z' class='post-time'>
                February 29, 2020,  8:39am
              </time>
              <meta itemprop='dateModified' content='2020-02-29T08:39:57Z'>
          <span itemprop='position'>#417</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-username="Patrick" data-post="412" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<p>I see. I don‚Äôt remember discussing patching out dmesg though.</p>
</blockquote>
<blockquote>
<p>It might be better to just fix this directly in the kernel with a patch adding a kernel.dmesg_restrict=2 sysctl rather than trying to hack our way around it.</p>
</blockquote>
<blockquote>
<p>Would it suffice to prohibit executing <code>dmesg</code> using apparmor-profile-everything for all users except superroot?</p>
</blockquote>
<p>That doesn‚Äôt stop the attacker from using their own program. They can copy/paste the <code>dmesg</code> source code.</p>
</blockquote>
</aside>
<p>I see. No log access for root at all then as a development goal?</p>
<p>Could capabilities be used instead to prevent access to dmesg for root?</p>
<p>Worst case scenario I see here that our initial version of hardened kernel won‚Äôt even boot after it gets widely deployed - without easy debug - while the debug kernel might actually boot.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T12:53:30Z' class='post-time'>
                February 29, 2020, 12:53pm
              </time>
              <meta itemprop='dateModified' content='2020-02-29T12:53:30Z'>
          <span itemprop='position'>#418</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="416" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Can you find if this would be needed for something? <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
</blockquote>
</aside>
<p>We already blacklist the module in security-misc anyway. If it was needed for something, we‚Äôd know by now.</p>
<aside class="quote no-group" data-username="Patrick" data-post="417" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>No log access for root at all then as a development goal?</p>
</blockquote>
</aside>
<p>Yes. The kernel logs can be very useful to an attacker hence why the dmesg_restrict sysctl exists to restrict it to root. There have been many cases of kernel pointer leaks, bypassing kptr_restrict for example.</p>
<aside class="quote no-group" data-username="Patrick" data-post="417" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could capabilities be used instead to prevent access to dmesg for root?</p>
</blockquote>
</aside>
<p>Yes. dmesg_restrict restricts it to CAP_SYSLOG so we can probably remove that capability but CAP_SYSLOG is used for a lot of other functionality so it might break things.</p>
<aside class="quote no-group" data-username="Patrick" data-post="417" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Worst case scenario I see here that our initial version of hardened kernel won‚Äôt even boot after it gets widely deployed - without easy debug - while the debug kernel might actually boot.</p>
</blockquote>
</aside>
<p>If we do decide to extend the dmesg_restrict sysctl, the user can just use superroot and disable the restrictions.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T14:43:28Z' class='post-time'>
                February 29, 2020,  2:43pm
              </time>
              <meta itemprop='dateModified' content='2020-02-29T14:43:28Z'>
          <span itemprop='position'>#419</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="madaidan" data-post="357" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We can use <code>CONFIG_CMDLINE</code> for this. Set <code>CONFIG_CMDLINE="hardened-kernel"</code> or similar then grep /proc/cmdline in security-misc.</p>
</blockquote>
</aside>
<p>Instead, we can set <code>CONFIG_CMDLINE="slub_debug=FZ page_poison=0"</code> and then enable <code>CONFIG_CMDLINE_OVERRIDE</code> so these cannot be overridden by the bootloader.</p>
<p>Although, <code>CONFIG_CMDLINE_OVERRIDE</code> seems to disallow <em>all</em> bootloader arguments.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-29T19:19:56Z' class='post-time'>
                February 29, 2020,  7:19pm
              </time>
              <meta itemprop='dateModified' content='2020-02-29T19:19:56Z'>
          <span itemprop='position'>#420</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="416" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Can you find if this would be needed for something? <a class="mention" href="../../../external.html?link=https://forums.whonix.org/u/hulahoop">@HulaHoop</a></p>
</blockquote>
</aside>
<p>Nothing we would care about:</p>
<blockquote>
<p>HDLC was the inspiration for the <a href="../../../external.html?link=https://en.wikipedia.org/wiki/IEEE_802.2">IEEE 802.2</a> <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Logical_Link_Control">LLC</a> protocol, and it is the basis for the framing mechanism used with the <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Point-to-Point_Protocol">PPP</a> on synchronous lines, as used by many servers to connect to a <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Wide_area_network">WAN</a>, most commonly the <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Internet">Internet</a>.</p>
</blockquote>
<p>In other words, it was an inspiration for more widely used protocols and after skimming a very long page about it, there was no mention of a real world use for it.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-01T11:37:50Z' class='post-time'>
                March 1, 2020, 11:37am
              </time>
              <meta itemprop='dateModified' content='2020-03-01T11:37:50Z'>
          <span itemprop='position'>#421</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-username="madaidan" data-post="357" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>We can use <code>CONFIG_CMDLINE</code> for this. Set <code>CONFIG_CMDLINE="hardened-kernel"</code> or similar then grep /proc/cmdline in security-misc.</p>
</blockquote>
<p>Instead, we can set <code>CONFIG_CMDLINE="slub_debug=FZ page_poison=0"</code> and then enable <code>CONFIG_CMDLINE_OVERRIDE</code> so these cannot be overridden by the bootloader.</p>
<p>Although, <code>CONFIG_CMDLINE_OVERRIDE</code> seems to disallow <em>all</em> bootloader arguments.</p>
</blockquote>
</aside>
<p>Same comment as <a href="7598/358.html" class="inline-onebox">kernel recompilation for better hardening</a> applies?</p>
<aside class="quote no-group" data-username="madaidan" data-post="419" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>then enable <code>CONFIG_CMDLINE_OVERRIDE</code> so these cannot be overridden by the bootloader.</p>
</blockquote>
</aside>
<p>What‚Äô the threat model for preventing the bootloader from modifying kernel commandline?</p>
<p>Ticket <a href="../../../external.html?link=https://phabricator.whonix.org/T940">grub boot password</a> would be a user freedom preserving solution for bootloader security that allows for customization / debugging in a safe way.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-01T14:35:29Z' class='post-time'>
                March 1, 2020,  2:35pm
              </time>
              <meta itemprop='dateModified' content='2020-03-01T14:35:29Z'>
          <span itemprop='position'>#422</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Patrick" data-post="421" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Same comment as <a href="7598/358.html">kernel recompilation for better hardening</a> applies?</p>
</blockquote>
</aside>
<p>No. I‚Äôm not saying to check <code>/proc/cmdline</code> in security-misc. This would set <code>slub_debug=FZ</code> and <code>page_poison=0</code> by default in the kernel and make sure security-misc can‚Äôt override it.</p>
<aside class="quote no-group" data-username="Patrick" data-post="421" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What‚Äô the threat model for preventing the bootloader from modifying kernel commandline?</p>
</blockquote>
</aside>
<p>It‚Äôs not a security issue. It‚Äôs to prevent security-misc from overriding the parameters. If we set <code>CONFIG_CMDLINE="slub_debug=FZ"</code> and prevent it from being overridden, then security-misc setting <code>slub_debug=FZP</code> will have no effect (as it can‚Äôt be overridden).</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-01T20:36:00Z' class='post-time'>
                March 1, 2020,  8:36pm
              </time>
              <meta itemprop='dateModified' content='2020-03-01T20:36:00Z'>
          <span itemprop='position'>#423</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Currently, we‚Äôre using GCC to compile the kernel but I think we should consider switching to Clang.</p>
<p>If we switch to Clang, we‚Äôd lose GCC plugins (RANDSTRUCT, STRUCTLEAK, LATENT_ENTROPY and in the future, STACKLEAK) but we‚Äôd gain <code>CONFIG_INIT_STACK_ALL</code> (essentially a stronger alternative to STRUCTLEAK) and <code>CONFIG_LOCAL_INIT</code> (part of linux-hardened).</p>
<p>LATENT_ENTROPY isn‚Äôt that important so the only big losses would be RANDSTRUCT and STACKLEAK.</p>
<p>Clang RANDSTRUCT is being worked on though <a href="../../../external.html?link=https://reviews.llvm.org/D59254">https://reviews.llvm.org/D59254</a></p>
<p>There is also work on implementing Clang Control-Flow Integrity (CFI) and ShadowCallStack (SCS). Currently this is only available on Google Pixels but the KSPP is working on upstreaming it.</p>
<p>Google seems to value CFI/SCS over RANDSTRUCT/STACKLEAK <a href="../../../external.html?link=https://android-developers.googleblog.com/2018/10/control-flow-integrity-in-android-kernel.html">https://android-developers.googleblog.com/2018/10/control-flow-integrity-in-android-kernel.html</a></p>
<p>This isn‚Äôt as big of an issue now as Clang‚Äôs benefits aren‚Äôt as major in our kernel version but in the future, once CFI/SCS are a thing, we should probably switch.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="7598f62c.html?page=20">‚Üê previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="75983c09.html?page=22">next page ‚Üí</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
