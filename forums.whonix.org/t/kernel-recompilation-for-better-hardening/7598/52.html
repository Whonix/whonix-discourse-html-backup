<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>kernel recompilation for better hardening - #52 by Patrick - Development - Whonix Forum</title>
    <meta name="description" content="https://docs.clip-os.org/clipos/kernel.html 


These both look interesting. They’re mainly for kernel compile options though. 
Is there any way to build Whonix with custom kernel configurations? Or will kernels have to b&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../75989ba9.html?page=3" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;kernel recompilation for better hardening&#39;" href="../7598.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598/52" />
<meta name="twitter:url" content="https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598/52" />
<meta property="og:title" content="kernel recompilation for better hardening" />
<meta name="twitter:title" content="kernel recompilation for better hardening" />
<meta property="og:description" content="In doubt lets start simple, see how things go and more hardening later? Otherwise, if someone experiences instability, it may be hard to pinpoint what the cause is.   That might actually be less secure then.   This will probably be contested.   Understood. Makes sense. Package name: hardened-vm-kernel or something like that? (“hardened vm kernel” might have some search results, hopefully we’re not reinventing here. I remember Ubuntu years ago had a VM specialized kernel.)   Yes.   Module loadin..." />
<meta name="twitter:description" content="In doubt lets start simple, see how things go and more hardening later? Otherwise, if someone experiences instability, it may be hard to pinpoint what the cause is.   That might actually be less secure then.   This will probably be contested.   Understood. Makes sense. Package name: hardened-vm-kernel or something like that? (“hardened vm kernel” might have some search results, hopefully we’re not reinventing here. I remember Ubuntu years ago had a VM specialized kernel.)   Yes.   Module loadin..." />
<meta property="article:published_time" content="2019-11-03T19:36:05+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="../75984658.html?page=2">
        <link rel="next" href="../7598fdb0.html?page=4">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7598.html">kernel recompilation for better hardening</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../../tag/status_open_issue_todo.html' class='discourse-tag' rel="tag">status_open_issue_todo</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T18:35:14Z' class='post-time'>
                November 3, 2019,  6:35pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T18:35:14Z'>
          <span itemprop='position'>#47</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Should I also get rid of kernel modules entirely (unset CONFIG_MODULES)?</p>
<p>All needed modules can be built into the kernel directly by switching them to <code>y</code> options instead of <code>m</code>.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>
          <meta itemprop='keywords' content='component_security, status_open_issue_todo'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T18:51:36Z' class='post-time'>
                November 3, 2019,  6:51pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T18:51:36Z'>
          <span itemprop='position'>#48</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="47" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Should I also get rid of kernel modules entirely (unset CONFIG_MODULES)?</p>
</blockquote>
</aside>
<p>Breaks virtualbox guest additions?</p>
<p>There are some interesting modules which I didn’t get to yet such as LKRG: <a href="../../../../external.html?link=https://openwall.com/lkrg/">https://openwall.com/lkrg/</a></p>
<p>Also another maybe upcoming kernel module related to kernel ISN (<a href="../../../../external.html?link=https://trac.torproject.org/projects/tor/ticket/16659">https://trac.torproject.org/projects/tor/ticket/16659</a>).</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T18:53:10Z' class='post-time'>
                November 3, 2019,  6:53pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T18:53:10Z'>
          <span itemprop='position'>#49</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>We can likely compile those directly into the kernel rather than using loadable modules.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T19:15:12Z' class='post-time'>
                November 3, 2019,  7:15pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T19:15:12Z'>
          <span itemprop='position'>#50</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Does this make things more fragile, likely to break? Speculate not many people built-in virtualbox guest addition modules or other modules.</p>
<p>(And host kernel including virtualbox host module build-in? If we want to maintain just one kernel (enough…) then built in virtualbox guest and host module?)</p>
<p>Do we gain security by using a kernel without module support compared to non-module support?</p>
<p>As of now, not all modules are load all the time. But without module load support, is everything load all the time?</p>
<p>Then we’d need a virtualbox and a non-virtualbox kernel? Or non-virtualbox VMs are just to bite the bullet of having a useless built-in module?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T19:26:39Z' class='post-time'>
                November 3, 2019,  7:26pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T19:26:39Z'>
          <span itemprop='position'>#51</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="50" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does this make things more fragile, likely to break? Speculate not many people built-in virtualbox guest addition modules or other modules.</p>
</blockquote>
</aside>
<p>Not sure.</p>
<aside class="quote no-group" data-post="50" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>(And host kernel including virtualbox host module build-in? If we want to maintain just one kernel (enough…) then built in virtualbox guest and host module?)</p>
</blockquote>
</aside>
<p>This kernel won’t be able to be used on hosts. Otherwise we’d need to enable all hardware config options which would drastically increase the time needed to compile and add attack surface.</p>
<p>This is for VMs only. We can make a kernel for hosts if you want which would be separate from VMs but that’d take too long to compile and won’t be able to be compiled during package upgrades. It’d have to be pre-compiled.</p>
<aside class="quote no-group" data-post="50" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Do we gain security by using a kernel without module support compared to non-module support?</p>
</blockquote>
</aside>
<p>Yes, it prevents loading any module to add attack surface or load a malicious module.</p>
<aside class="quote no-group" data-post="50" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>As of now, not all modules are load all the time. But without module load support, is everything load all the time?</p>
</blockquote>
</aside>
<p>I think so. Not sure.</p>
<aside class="quote no-group" data-post="50" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Or non-virtualbox VMs are just to bite the bullet of having a useless built-in module?</p>
</blockquote>
</aside>
<p>Yes. The built-in module doesn’t add much and shouldn’t be a problem for non-virtualbox VMs.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T19:36:05Z' class='post-time'>
                November 3, 2019,  7:36pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T19:36:05Z'>
          <span itemprop='position'>#52</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group quote-modified" data-post="51" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>Does this make things more fragile, likely to break? Speculate not many people built-in virtualbox guest addition modules or other modules.</p>
</blockquote>
<p>Not sure.</p>
</blockquote>
</aside>
<p>In doubt lets start simple, see how things go and more hardening later? Otherwise, if someone experiences instability, it may be hard to pinpoint what the cause is.</p>
<aside class="quote no-group quote-modified" data-post="51" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>As of now, not all modules are load all the time. But without module load support, is everything load all the time?</p>
</blockquote>
<p>I think so. Not sure.</p>
</blockquote>
</aside>
<p>That might actually be less secure then.</p>
<aside class="quote no-group quote-modified" data-post="51" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>Or non-virtualbox VMs are just to bite the bullet of having a useless built-in module?</p>
</blockquote>
<p>Yes. The built-in module doesn’t add much and shouldn’t be a problem for non-virtualbox VMs.</p>
</blockquote>
</aside>
<p>This will probably be contested.</p>
<aside class="quote no-group" data-post="51" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>This kernel won’t be able to be used on hosts. Otherwise we’d need to enable all hardware config options which would drastically increase the time needed to compile and add attack surface.</p>
<p>This is for VMs only.</p>
</blockquote>
</aside>
<p>Understood. Makes sense. Package name: hardened-vm-kernel or something like that? (“hardened vm kernel” might have some search results, hopefully we’re not reinventing here. I remember Ubuntu years ago had a VM specialized kernel.)</p>
<aside class="quote no-group" data-post="51" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We can make a kernel for hosts if you want which would be separate from VMs but that’d take too long to compile and won’t be able to be compiled during package upgrades. It’d have to be pre-compiled.</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group quote-modified" data-post="51" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>Do we gain security by using a kernel without module support compared to non-module support?</p>
</blockquote>
<p>Yes, it prevents loading any module to add attack surface or load a malicious module.</p>
</blockquote>
</aside>
<p>Module loading requires root. “trusted” root. But root could as well as modify the kernel on the disk so next reboot something else will be booted? This would be far more useful if at reboot there was an integrity check which would refuse to boot any tampered kernel images. Related to <code>verified boot</code>:</p>
<ul>
<li><a href="../../../../external.html?link=https://www.whonix.org/wiki/Verified_Boot">https://www.whonix.org/wiki/Verified_Boot</a></li>
<li><a href="../../enable-linux-kernel-gpg-verification-in-grub-and-or-enable-secure-boot-by-default/7894.html" class="inline-onebox">enable Linux kernel gpg verification in grub and/or enable Secure Boot by default</a></li>
</ul>
<p>As an alternative to make all modules built-in rather than dynamically load… What about loading all modules at early boot time and then disabling module loading? Would that be as good as disabling module loading at kernel compile time?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T19:51:33Z' class='post-time'>
                November 3, 2019,  7:51pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T19:51:33Z'>
          <span itemprop='position'>#53</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="52" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>In doubt lets start simple, see how things go and more hardening later? Otherwise, if someone experiences instability, it may be hard to pinpoint what the cause is.</p>
</blockquote>
</aside>
<p>Sure. I was only giving ideas.</p>
<aside class="quote no-group" data-post="52" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>That might actually be less secure then.</p>
</blockquote>
</aside>
<p>Only the needed modules will be compiled so it might not be.</p>
<aside class="quote no-group" data-post="52" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Understood. Makes sense. Package name: hardened-vm-kernel or something like that? (“hardened vm kernel” might have some search results, hopefully we’re not reinventing here. I remember Ubuntu years ago had a VM specialized kernel.)</p>
</blockquote>
</aside>
<p>hardened-vm-kernel sounds good. I don’t think we’re reinventing. I’ve never heard of a hardened kernel designed for virtual machines before that isn’t grsec.</p>
<aside class="quote no-group" data-post="52" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Module loading requires root. “trusted” root.</p>
</blockquote>
</aside>
<p>I think we should still protect the kernel from the root user.</p>
<aside class="quote no-group" data-post="52" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But root could as well as modify the kernel on the disk so next reboot something else will be booted?</p>
</blockquote>
</aside>
<p>We can fix that with the system wide MAC policy or verified boot.</p>
<aside class="quote no-group" data-post="52" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What about loading all modules at early boot time and then disabling module loading? Would that be as good as disabling module loading at kernel compile time?</p>
</blockquote>
</aside>
<p>Not sure. Needs more research.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-03T21:54:31Z' class='post-time'>
                November 3, 2019,  9:54pm
              </time>
              <meta itemprop='dateModified' content='2019-11-03T21:54:31Z'>
          <span itemprop='position'>#54</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Would <a href="../../../../external.html?link=https://en.wikipedia.org/wiki/Real-time_clock">RTC</a> and audio be needed in VMs?</p>
<p>I can remove both of them to reduce compilation time.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-04T06:09:12Z' class='post-time'>
                November 4, 2019,  6:09am
              </time>
              <meta itemprop='dateModified' content='2019-11-04T06:09:12Z'>
          <span itemprop='position'>#55</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="53" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I’ve never heard of a hardened kernel designed for virtual machines before that isn’t grsec.</p>
</blockquote>
</aside>
<p>Maybe not hardened but specialized kernels for VM did and do exist.</p>
<ul>
<li>
<p><a href="../../../../external.html?link=https://packages.debian.org/buster/linux-image-cloud-amd64">https://packages.debian.org/buster/linux-image-cloud-amd64</a> as mentioned here: <a href="../../kernel-versions-and-security-debian-backports/5791/5.html" class="inline-onebox">Kernel versions and security</a></p>
</li>
<li>
<p>Ubuntu had something. Search term:</p>
<p>“linux-kernel-virtual” “ubuntu”</p>
</li>
</ul>
<p>But Ubuntu thing was a thing of 2013 or earlier. Might have been a whole distribution flavor only for virtual machines.</p>
<aside class="quote no-group quote-modified" data-post="53" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>But root could as well as modify the kernel on the disk so next reboot something else will be booted?</p>
</blockquote>
<p>We can fix that with the system wide MAC policy or verified boot.</p>
</blockquote>
</aside>
<p>But <a href="../../apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339.html">System wide MAC policy</a> or <a href="../../../../external.html?link=https://www.whonix.org/wiki/Verified_Boot">verified boot</a> would also prevent <code>modprobe</code> anyway? Hence no extra advantage by disabling module loading during compile time?</p>
<aside class="quote no-group" data-post="54" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Would <a href="../../../../external.html?link=https://en.wikipedia.org/wiki/Real-time_clock">RTC </a> and audio be needed in VMs?</p>
</blockquote>
</aside>
<p>audio: workstation yes, gateway no.</p>
<p>RTC: Not sure.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/Whonix/blob/master/build-steps.d/2600_create-vbox-vm#L103-L107" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="../../../../external.html?link=https://github.com/Whonix/Whonix/blob/master/build-steps.d/2600_create-vbox-vm#L103-L107" target="_blank">Whonix/Whonix/blob/master/build-steps.d/2600_create-vbox-vm#L103-L107</a></h4>
<pre class="onebox"><code class="lang-d/2600_create-vbox-vm"><ol class="start lines" start="103" style="counter-reset: li-counter 102 ;">
<li>## Set system clock of VM to UTC.</li>
<li>## When VirtualBox starts it looks up date and time of the host, i.e. "JAN 15 2012 00:00:00"</li>
<li>## and sets the VM clock to that date and time. The following option translates the date</li>
<li>## and time to UTC, thus hiding the hosts timezone from the guest.</li>
<li>sudo $SUDO_OPTS VBoxManage modifyvm "$VMNAME" --rtcuseutc on</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>We need a hardware clock for sure? Otherwise when VM would start it would not have any clock except perhaps some hardcoded time/date information at all? But not necessarily an RTC? Dunno if VirtualBox provides an RTC and a hardware clock or only an hardware clock which is also an RTC. Search term:</p>
<pre><code>site:virtualbox.org real time clock
site:virtualbox.org RTC
</code></pre>
<p>Haven’t found something relevant yet.</p>
<p>I haven’t found any “relevant” disadvantages of not having an RTC yet. Only of not having no hardware clock at all.</p>
<aside class="onebox stackexchange">
  <header class="source">
      <a href="../../../../external.html?link=https://stackoverflow.com/questions/36161221/does-the-raspberry-pi-2-model-b-v1-1-have-an-internal-rtc" target="_blank">stackoverflow.com</a>
  </header>
  <article class="onebox-body">
      <a href="../../../../external.html?link=https://stackoverflow.com/users/6045528/samah" target="_blank">
    <img alt="Samah" src="../../../../external.html?link=https://i.stack.imgur.com/rFxnq.jpg?s=128&amp;g=1" class="thumbnail onebox-avatar" width="60" height="60">
  </a>
<h4>
  <a href="../../../../external.html?link=https://stackoverflow.com/questions/36161221/does-the-raspberry-pi-2-model-b-v1-1-have-an-internal-rtc" target="_blank">Does the Raspberry Pi 2 model B v1.1 have an internal RTC?</a>
</h4>

<div class="tags">
  <strong>python, raspberry-pi, raspbian</strong>
</div>

<div class="date">
  asked by
  
  <a href="../../../../external.html?link=https://stackoverflow.com/users/6045528/samah" target="_blank">
    Samah
  </a>
  on <a href="../../../../external.html?link=https://stackoverflow.com/questions/36161221/does-the-raspberry-pi-2-model-b-v1-1-have-an-internal-rtc" target="_blank">05:26PM - 22 Mar 16 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Could just try if anything breaks without RTC?</p>
<p>Best tested in non-Whonix / non-Kicksecure, plain Debian VM. At boot, time without help of any network synchronization daemons need to be somewhat correct. Shouldn’t rely on internet to fetch. Without any initial time, it’s hard/impossible to securely fetch time from remote. Opens up for many attacks as per:</p>
<ul>
<li><a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/TimeSync">https://www.whonix.org/wiki/Dev/TimeSync</a></li>
<li><a href="../../../../external.html?link=https://www.whonix.org/wiki/Time_Attacks">https://www.whonix.org/wiki/Time_Attacks</a></li>
</ul>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-04T08:41:43Z' class='post-time'>
                November 4, 2019,  8:41am
              </time>
              <meta itemprop='dateModified' content='2019-11-04T08:41:43Z'>
          <span itemprop='position'>#56</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="39" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><a href="../../../../external.html?link=https://debian-handbook.info/browse/stable/sect.kernel-compilation.html">https://debian-handbook.info/browse/stable/sect.kernel-compilation.html </a> and <a href="../../../../external.html?link=https://debian-handbook.info/browse/stable/sect.kernel-installation.html">https://debian-handbook.info/browse/stable/sect.kernel-installation.html</a></p>
</blockquote>
</aside>
<p>Could you please (based on above perhaps) provide instructions on how to compile the kernel with your custom kernel config? That would allow me and perhaps others to test this sooner rather than later.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-04T17:01:04Z' class='post-time'>
                November 4, 2019,  5:01pm
              </time>
              <meta itemprop='dateModified' content='2019-11-04T17:01:04Z'>
          <span itemprop='position'>#57</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>IMO we should limit the custom kernel to the WS as the risk of leaks would be too great if we applied it to the GW too. We simply don’t know what every module does or how they interact with each other to deliver the same leak protection we have now.</p>
<p>No untrusted software should be running there so there’s no danger of some disabled module being enabled without users’ consent.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-04T17:05:24Z' class='post-time'>
                November 4, 2019,  5:05pm
              </time>
              <meta itemprop='dateModified' content='2019-11-04T17:05:24Z'>
          <span itemprop='position'>#58</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I think the kernel config package should be replicated once for each different hypervisor to keep things clean and simple.</p>
<p>There’s no reason to have modules relevant to VBox and Xen enabled for KVM users and vice versa. If we’re about decreasing attack surface let’s go all the way.</p>
<p><a class="mention" href="../../../../external.html?link=https://forums.whonix.org/u/madaidan">@madaidan</a> How active is Linux-Hardened upstream? How much can we rely on it’s author to keep maintaining his fork until KSPP merges the missing features? There’s nothing worse than doing a bunch of effort based on someone’s dead code.</p>
<p>Do the patches work with Debian vanilla source tarball? We should not base on <a href="../../../../external.html?link=http://kernel.org/">kernel.org</a>’s code.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-04T17:35:00Z' class='post-time'>
                November 4, 2019,  5:35pm
              </time>
              <meta itemprop='dateModified' content='2019-11-05T15:05:41Z'>
          <span itemprop='position'>#59</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="55" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But <a href="../../apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339.html">System wide MAC policy</a> or <a href="../../../../external.html?link=https://www.whonix.org/wiki/Verified_Boot">verified boot</a> would also prevent <code>modprobe</code> anyway?</p>
</blockquote>
</aside>
<p>The MAC policy can prevent module loading but currently it doesn’t. Verified boot doesn’t disable module loading.</p>
<aside class="quote no-group" data-post="56" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could you please (based on above perhaps) provide instructions on how to compile the kernel with your custom kernel config? That would allow me and perhaps others to test this sooner rather than later.</p>
</blockquote>
</aside>
<ol>
<li>
<p>Install needed packages:</p>
<pre><code>sudo apt-get install linux-source build-essential libssl-dev libncurses-dev fakeroot libelf-dev
</code></pre>
</li>
<li>
<p>Create directory ~/kernel/ and switch to it</p>
</li>
</ol>
<p><code>mkdir -p ~/kernel &amp;&amp; cd ~/kernel</code></p>
<ol start="3">
<li>
<p>Extract the kernel source:</p>
<pre><code>tar -xaf /usr/src/linux-source-4.19.tar.xz
</code></pre>
</li>
<li>
<p>Switch to the ~/kernel/linux-source-4.19/ directory.</p>
</li>
</ol>
<p><code>cd ~/kernel/linux-source-4.19/</code></p>
<ol start="5">
<li>
<p>Apply the debian kernel patches:</p>
<pre><code>xzcat /usr/src/linux-patch-4.19-rt.patch.xz | patch -p1
</code></pre>
</li>
<li>
<p>Create the file <code>.config</code> and add the config I sent above. <a href="44.html" class="inline-onebox">kernel recompilation for better hardening</a></p>
</li>
<li>
<p>Run <code>make menuconfig</code>, load the <code>.config</code> file and save it. This is needed as my config doesn’t include a whole bunch of <code># CONFIG_X is not set</code> lines for simplicity but those are needed for compiling.</p>
</li>
<li>
<p>Compile it as a Debian package:</p>
<pre><code>make deb-pkg
</code></pre>
</li>
<li>
<p>Install the kernel</p>
<pre><code>sudo dpkg -i ../linux-libc-dev_4.19.67-rt24-1_amd64.deb
sudo dpkg -i ../linux-headers-4.19.67-rt24_4.19.67-rt24-1_amd64.deb
sudo dpkg -i ../linux-image-4.19.67-rt24_4.19.67-rt24-1_amd64.deb
</code></pre>
</li>
</ol>
<aside class="quote no-group" data-post="57" data-topic="7598" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>IMO we should limit the custom kernel to the WS as the risk of leaks would be too great if we applied it to the GW too. We simply don’t know what every module does or how they interact with each other to deliver the same leak protection we have now.</p>
<p>No untrusted software should be running there so there’s no danger of some disabled module being enabled without users’ consent.</p>
</blockquote>
</aside>
<p>Are you talking about including every module directly in the kernel rather than using loadable modules? That probably isn’t going to actually be done. It was just an idea. Currently loadable modules are still a thing in the config.</p>
<aside class="quote no-group" data-post="58" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>I think the kernel config package should be replicated once for each different hypervisor to keep things clean and simple.</p>
<p>There’s no reason to have modules relevant to VBox and Xen enabled for KVM users and vice versa. If we’re about decreasing attack surface let’s go all the way.</p>
</blockquote>
</aside>
<p>IMO it’d be simpler to just create one config. There are very little vbox/xen/kvm specific options. The different configs would only have a difference of about ~10 lines.</p>
<aside class="quote no-group" data-post="58" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>How active is Linux-Hardened upstream? How much can we rely on it’s author to keep maintaining his fork until KSPP merges the missing features? There’s nothing worse than doing a bunch of effort based on someone’s dead code.</p>
</blockquote>
</aside>
<p>It’s not that active. I’ve spoken with the devs of it and it’s kinda dead due to lack of interest. New features aren’t exactly being developed. It mostly just adds stricter defaults than the vanilla kernel.</p>
<p>There are some important patches in the linux-hardened kernel that aren’t in vanilla though.</p>
<p>It’d be a long time before the KSPP merges all the missing features upstream. One of the main points of linux-hardened was to accept KSPP patches that weren’t accepted upstream.</p>
<aside class="quote no-group" data-post="58" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Do the patches work with Debian vanilla source tarball? We should not base on <a href="../../../../external.html?link=http://kernel.org/">kernel.org</a>’s code.</p>
</blockquote>
</aside>
<p>They should work fine. I haven’t tested them though.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-05T12:39:02Z' class='post-time'>
                November 5, 2019, 12:39pm
              </time>
              <meta itemprop='dateModified' content='2019-11-05T12:39:02Z'>
          <span itemprop='position'>#60</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="59" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Are you talking about including every module directly in the kernel rather than using loadable modules? That probably isn’t going to actually be done. It was just an idea. Currently loadable modules are still a thing in the config.</p>
</blockquote>
</aside>
<p>Module or built-in is besides the point. What I mean is: no vulnerable code is loaded by the GW and there is no way it can be so making a custom slimmed down kernel is not necessary to shrink attack surface.</p>
<aside class="quote no-group" data-post="59" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>IMO it’d be simpler to just create one config. There are very little vbox/xen/kvm specific options. The different configs would only have a difference of about ~10 lines.</p>
</blockquote>
</aside>
<p>I see.</p>
<aside class="quote no-group" data-post="59" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>There are some important patches in the linux-hardened kernel that aren’t in vanilla though.</p>
<p>It’d be a long time before the KSPP merges all the missing features upstream. One of the main points of linux-hardened was to accept KSPP patches that weren’t accepted upstream.</p>
</blockquote>
</aside>
<p>I see.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-05T14:10:09Z' class='post-time'>
                November 5, 2019,  2:10pm
              </time>
              <meta itemprop='dateModified' content='2019-11-05T14:10:09Z'>
          <span itemprop='position'>#61</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="58" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>I think the kernel config package should be replicated once for each different hypervisor to keep things clean and simple.</p>
<p>There’s no reason to have modules relevant to VBox and Xen enabled for KVM users and vice versa. If we’re about decreasing attack surface let’s go all the way.</p>
</blockquote>
</aside>
<p>Sounds good in theory but I vary the maintenance overhead.</p>
<aside class="quote no-group quote-modified" data-post="59" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<blockquote>
<p>But <a href="../../apparmor-for-complete-system-including-init-pid1-systemd-everything-full-system-mac-policy/8339.html">System wide MAC policy</a> or <a href="../../../../external.html?link=https://www.whonix.org/wiki/Verified_Boot">verified boot</a> would also prevent <code>modprobe</code> anyway?</p>
</blockquote>
<p>The MAC policy can prevent module loading but currently it doesn’t.</p>
</blockquote>
</aside>
<p>Then let’s use MAC policy to prevent module loading so we don’t have to disable module support in kernel? Seems like a more popular, tested path rather than disabling module loading. Therefore should hopefully be more stable.</p>
<aside class="quote no-group" data-post="59" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Run <code>make menuconfig</code> , load the <code>.config</code> file and save it. This is needed as my config doesn’t include a whole bunch of <code># CONFIG_X is not set</code> lines for simplicity but those are needed for compiling.</p>
</blockquote>
</aside>
<p>Any way to make that non-interactive? Wouldn’t know what options to choose. Just nothing?, go with defaults? Non-interactive also needed for later automation.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-05T15:05:17Z' class='post-time'>
                November 5, 2019,  3:05pm
              </time>
              <meta itemprop='dateModified' content='2019-11-05T15:05:17Z'>
          <span itemprop='position'>#62</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>
<p>error: Cannot generate ORC metadata for CONFIG_UNWINDER_ORC=y, please install libelf-dev, libelf-devel or elfutils-libelf-devel</p>
</blockquote>
<p>Installing <code>libelf-dev</code> helped. Edited your post. Compiling.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-05T16:12:42Z' class='post-time'>
                November 5, 2019,  4:12pm
              </time>
              <meta itemprop='dateModified' content='2019-11-05T16:12:42Z'>
          <span itemprop='position'>#63</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Compilation with your config was successful but took ~ 1 hour in a Qubes VM. Did not test yet if the kernel boots. Due to long compile time, sounds more like a package to be added to Whonix repository?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-05T16:36:35Z' class='post-time'>
                November 5, 2019,  4:36pm
              </time>
              <meta itemprop='dateModified' content='2019-11-05T16:36:35Z'>
          <span itemprop='position'>#64</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="60" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Module or built-in is besides the point. What I mean is: no vulnerable code is loaded by the GW and there is no way it can be so making a custom slimmed down kernel is not necessary to shrink attack surface.</p>
</blockquote>
</aside>
<p>I’m not sure what you mean. How would slimming the kernel config make the GW load vulnerable code?</p>
<aside class="quote no-group" data-post="61" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Then let’s use MAC policy to prevent module loading so we don’t have to disable module support in kernel? Seems like a more popular, tested path rather than disabling module loading. Therefore should hopefully be more stable.</p>
</blockquote>
</aside>
<p>It would be a better approach although we’d need to create a systemd-modules-load profile so necessary modules can still be loaded at boot.</p>
<aside class="quote no-group" data-post="61" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Any way to make that non-interactive? Wouldn’t know what options to choose. Just nothing?, go with defaults? Non-interactive also needed for later automation.</p>
</blockquote>
</aside>
<p><code>make menuconfig</code> generates a new <code>.config</code> file with all the <code># X is not needed</code> lines that we can use for the next time. I just use the config without all those lines for working on it.</p>
<p>You don’t need to chose any options. They’re all already chosen.</p>
<aside class="quote no-group" data-post="63" data-topic="7598" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Compilation with your config was successful but took ~ 1 hour in a Qubes VM. Did not test yet if the kernel boots. Due to long compile time, sounds more like a package to be added to Whonix repository?</p>
</blockquote>
</aside>
<p>It took around an hour for me too. The config can still be slimmed down further and hopefully we can get it to compile faster.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-05T17:08:05Z' class='post-time'>
                November 5, 2019,  5:08pm
              </time>
              <meta itemprop='dateModified' content='2019-11-05T17:08:05Z'>
          <span itemprop='position'>#65</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Quote <a href="../../../../external.html?link=https://wiki.debian.org/BuildADebianKernelPackage">https://wiki.debian.org/BuildADebianKernelPackage</a></p>
<blockquote>
<p>Using your current Debian kernel configuration as a starting point</p>
<p>Alternatively, you can use the configuration from a Debian-built kernel that you already have installed by copying the /boot/config-* file to .config and then running make oldconfig to only answer new questions.</p>
</blockquote>
<p>When you’re ready… Could you please create a package <code>hardened-vm-config</code> (or so)… Then first add/commit the Debian default <code>.config</code>. Then another commit to make the changes? This is to illustrate in how far our config is different from Debian config. If that makes sense? Or compare with some other starting point?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-11-06T15:07:56Z' class='post-time'>
                November 6, 2019,  3:07pm
              </time>
              <meta itemprop='dateModified' content='2019-11-06T15:07:56Z'>
          <span itemprop='position'>#66</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="64" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I’m not sure what you mean. How would slimming the kernel config make the GW load vulnerable code?</p>
</blockquote>
</aside>
<p>Let’s say an iptables module that is activated when some ruleset is triggered is not loaded by default and only happens when a some network pattern is detected. In a normal kernel it will be there, however with a slimmed down kernel where we haven’t tested every possible behavior/codepath it won’t and there is the hypothetical possibility of failing open.</p>
<p>Also we want to transition to nftables in the medium future and that requires a different set of modules.</p>
<aside class="quote no-group" data-post="64" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>It took around an hour for me too. The config can still be slimmed down further and hopefully we can get it to compile faster.</p>
</blockquote>
</aside>
<p>You want to make it use all available cores if not already.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="../75984658.html?page=2">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="../7598fdb0.html?page=4">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
