<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>kernel recompilation for better hardening - #157 by Patrick_mobile - Development - Whonix Forum</title>
    <meta name="description" content="https://docs.clip-os.org/clipos/kernel.html 


These both look interesting. They’re mainly for kernel compile options though. 
Is there any way to build Whonix with custom kernel configurations? Or will kernels have to b&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../7598fdfa.html?page=8" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../../c/news/21.html">NEWS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;kernel recompilation for better hardening&#39;" href="../7598.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598/157" />
<meta name="twitter:url" content="https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598/157" />
<meta property="og:title" content="kernel recompilation for better hardening" />
<meta name="twitter:title" content="kernel recompilation for better hardening" />
<meta property="og:description" content="Signing yes. If you can create that code to do singing, please turn on. Otherwise, meanwhile please turn off.  This also needs to integrated with DKMS.  Since the essence of DKMS is a single contained bash script, we could safely ship a newer version which supports module signing. See: enforce kernel module software signature verification [module signing] / disallow kernel module loading by default  But even while the newer version of DKMS supports module singing, modules such as virtualbox do n..." />
<meta name="twitter:description" content="Signing yes. If you can create that code to do singing, please turn on. Otherwise, meanwhile please turn off.  This also needs to integrated with DKMS.  Since the essence of DKMS is a single contained bash script, we could safely ship a newer version which supports module signing. See: enforce kernel module software signature verification [module signing] / disallow kernel module loading by default  But even while the newer version of DKMS supports module singing, modules such as virtualbox do n..." />
<meta property="article:published_time" content="2019-12-19T05:15:53+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="../7598235c.html?page=7">
        <link rel="next" href="../75980b08.html?page=9">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../../index.html">
          <img src="../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../7598.html">kernel recompilation for better hardening</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../../external.html?link=http://schema.org/ListItem">
            <a href="../../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../../tag/status_open_issue_todo.html' class='discourse-tag' rel="tag">status_open_issue_todo</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-18T20:19:18Z' class='post-time'>
                December 18, 2019,  8:19pm
              </time>
              <meta itemprop='dateModified' content='2019-12-18T20:19:18Z'>
          <span itemprop='position'>#152</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="151" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t get any prompts. Are you sure the config is at <code>.config</code> in the kernel source directory?</p>
</blockquote>
</aside>
<p>Yes, I am sure.</p>
<pre><code>diff usr/share/hardened-vm-kernel/kernel-config ~/kernel/linux-source-4.19/.config ; echo $?
</code></pre>
<blockquote>
<p>0</p>
</blockquote>
<aside class="quote no-group" data-post="151" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>We can just copy/paste all that into our package. So users will just need to install hardened-vm-kernel and it will handle everything rather than needing to use wrappers or other things.</p>
</blockquote>
</aside>
<p>I don’t know if that is possible without using a package. For example to trigger DKMS, a new kernel package needs to be installed. It may be possible to reinvent all of this (call DKMS ourselfes) but the bigger the hack, the more likely it will have bugs.</p>
<p>question | with a package | without a package<br>
What kernel version is installed? | Check kernel package version. | ?<br>
How to remove that kernel? | apt purge… | ?</p>
<p>By not using a package many things get messy / lots of code duplication / bugs.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>
          <meta itemprop='keywords' content='component_security, status_open_issue_todo'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-18T21:00:43Z' class='post-time'>
                December 18, 2019,  9:00pm
              </time>
              <meta itemprop='dateModified' content='2019-12-18T21:00:43Z'>
          <span itemprop='position'>#153</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="152" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Yes, I am sure.</p>
</blockquote>
</aside>
<p>I can’t reproduce this. Exactly which of the config options does it prompt you about? Is it all of the ones you said or where some automatically selected?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-18T21:10:28Z' class='post-time'>
                December 18, 2019,  9:10pm
              </time>
              <meta itemprop='dateModified' content='2019-12-18T21:10:28Z'>
          <span itemprop='position'>#154</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="150" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Preemption Model 1. No Forced Preemption (Server) (PREEMPT_NONE) &gt; 2. Voluntary Kernel Preemption (Desktop) (PREEMPT_VOLUNTARY) 3. Preemptible Kernel (Low-Latency Desktop) (PREEMPT__LL) (NEW) 4. Preemptible Kernel (Basic RT) (PREEMPT_RTB) (NEW) 5. Fully Preemptible Kernel (RT) (PREEMPT_RT_FULL) (NEW) choice[1-5?]:</p>
</blockquote>
</aside>
<p>Just one question. Just exactly that. That’s it.<br>
Deleted working folder? That state. That might make the difference.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-18T21:16:21Z' class='post-time'>
                December 18, 2019,  9:16pm
              </time>
              <meta itemprop='dateModified' content='2019-12-18T21:16:21Z'>
          <span itemprop='position'>#155</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>That’s weird. CONFIG_PREEMPT_VOLUNTARY is already enabled <a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/kernel-config#L89">https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/kernel-config#L89</a></p>
<p>Same as the default Debian config.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-18T22:35:36Z' class='post-time'>
                December 18, 2019, 10:35pm
              </time>
              <meta itemprop='dateModified' content='2019-12-18T22:35:36Z'>
          <span itemprop='position'>#156</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="75" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Also don’t use kernel signing / module signing during build?</p>
</blockquote>
</aside>
<p>I think we should sign all modules during build. After the build, we can sign lkrg, vbox guest additions etc. with <code>scripts/sign-file</code>, then we can destroy the private key with <code>shred -zu</code> in <code>certs/</code> and enforce only signed module loading. This way, only signed modules can load, vbox won’t break and we don’t need to worry about a private key.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T05:15:53Z' class='post-time'>
                December 19, 2019,  5:15am
              </time>
              <meta itemprop='dateModified' content='2019-12-19T05:15:53Z'>
          <span itemprop='position'>#157</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Signing yes. If you can create that code to do singing, please turn on. Otherwise, meanwhile please turn off.</p>
<p>This also needs to integrated with DKMS.</p>
<p>Since the essence of DKMS is a single contained bash script, we could safely ship a newer version which supports module signing. See: <a href="../../enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/53.html" class="inline-onebox">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</a></p>
<p>But even while the newer version of DKMS supports module singing, modules such as virtualbox do not make use of it. Automated module signing during kernel upgrade and module upgrade is still a non-trivial challenge.</p>
<p>When modules are upgraded, these need to be recompiled. This happens automatic by DKMS (but not yet with module signing). Therefore we cannot delete the signing key. But we could restrict signing key access with appaprmor-profile-everything.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T13:11:50Z' class='post-time'>
                December 19, 2019,  1:11pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T13:11:50Z'>
          <span itemprop='position'>#158</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="146" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/pull/11">Disable debugfs</a></p>
</blockquote>
</aside>
<p>That is about <code>/sys/kernel/debug</code> folder? Perhaps better to restrict that through security-misc (permission hardening) and/or apparmor-profile-everything? Why? Maybe same as this very post: <a href="139.html" class="inline-onebox">kernel recompilation for better hardening</a></p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T13:59:24Z' class='post-time'>
                December 19, 2019,  1:59pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T13:59:24Z'>
          <span itemprop='position'>#159</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="155" data-topic="7598" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>That’s weird. CONFIG_PREEMPT_VOLUNTARY is already enabled <a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/kernel-config#L89">https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/kernel-config#L89</a></p>
<p>Same as the default Debian config.</p>
</blockquote>
</aside>
<p>Added CI support in git master.</p>
<ul>
<li><a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/blob/master/.travis.yml">https://github.com/Whonix/hardened-vm-kernel/blob/master/.travis.yml</a></li>
<li><a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/ci_test">https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/ci_test</a></li>
<li><a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/build">https://github.com/Whonix/hardened-vm-kernel/blob/master/usr/share/hardened-vm-kernel/build</a></li>
</ul>
<p>But Travis CI is Ubuntu based. Not sure it is worth the effort making the CI build compatible with Ubuntu. Did run into some issues due to version differences (Linux 4.15 vs 4.19) but now fixed. I don’t know if there is a Debian <code>buster</code> based CI. Inquired just now:</p>
<p><a href="../../../../external.html?link=https://github.com/lamby/travis.debian.net/issues/62#issuecomment-567490264">https://github.com/lamby/travis.debian.net/issues/62#issuecomment-567490264</a></p>
<p>Otherwise I’d be happy to use any other CI service.</p>
<p><a href="../../../../external.html?link=https://travis-ci.com/Whonix/hardened-vm-kernel" class="onebox" target="_blank">https://travis-ci.com/Whonix/hardened-vm-kernel</a></p>
<p>The current build hangs.</p>
<p><a href="../../../../external.html?link=https://travis-ci.com/Whonix/hardened-vm-kernel/builds/141763417">https://travis-ci.com/Whonix/hardened-vm-kernel/builds/141763417</a></p>
<p>But this is not a “perfect proof” since running on Ubuntu with older kernel version.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T14:21:04Z' class='post-time'>
                December 19, 2019,  2:21pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T14:21:04Z'>
          <span itemprop='position'>#160</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>The differences interactive vs non-interactive could be a result of different installed packages / programs on the build machine.</p>
<p>Fixed this on my local machine.</p>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/commit/3ee2b48aedde922c5466675023754ac5611db8d7" target="_blank">github.com/Whonix/hardened-vm-kernel</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewbox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/commit/3ee2b48aedde922c5466675023754ac5611db8d7" target="_blank">fix non-interactive build issue</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2019-12-19" data-time="14:14:30" data-timezone="UTC">02:14PM - 19 Dec 19 UTC</span>
      </div>

      <div class="user">
        <a href="../../../../external.html?link=https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 4 additions and 1 deletions">
        <a href="../../../../external.html?link=https://github.com/Whonix/hardened-vm-kernel/commit/3ee2b48aedde922c5466675023754ac5611db8d7" target="_blank">
          <span class="added">+4</span>
          <span class="removed">-1</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598/159</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Please review that change. Please check best settings for prempt on everything.</p>
<p><code>CONFIG_HAVE_PREEMPT_LAZY=y</code> is getting enabled either way by running <code>make deb-pkg</code>. Even if set to</p>
<p><code> # CONFIG_HAVE_PREEMPT_LAZY is not set</code></p>
<p>Or</p>
<p><code>CONFIG_HAVE_PREEMPT_LAZY=n</code></p>
<p>Please compare <code>.config</code> prior <code>make deb-pkg</code> with <code>.config</code> after <code>make deb-pkg</code>. It changes. And that I find very unusual, weird (not implying malicious, just saying to not have this misinterpreted / misquoted by third parties).</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T14:32:16Z' class='post-time'>
                December 19, 2019,  2:32pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T14:32:16Z'>
          <span itemprop='position'>#161</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Latest CI build <a href="../../../../external.html?link=https://travis-ci.com/Whonix/hardened-vm-kernel/builds/141767669">https://travis-ci.com/Whonix/hardened-vm-kernel/builds/141767669</a> hangs at <code>Cross-compiler tool prefix (CROSS_COMPILE) [] (NEW)</code>. Not sure it’s worth fixing Ubuntu based CI? Maybe time to revisit <a href="../../../../external.html?link=https://www.whonix.org/wiki/Dev/Continuous_Integration">https://www.whonix.org/wiki/Dev/Continuous_Integration</a> or look if there are new CI services now.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T16:39:52Z' class='post-time'>
                December 19, 2019,  4:39pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T16:39:52Z'>
          <span itemprop='position'>#162</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="158" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>That is about <code>/sys/kernel/debug</code> folder? Perhaps better to restrict that through security-misc (permission hardening) and/or apparmor-profile-everything? Why? Maybe same as this very post: <a href="139.html">kernel recompilation for better hardening</a></p>
</blockquote>
</aside>
<p><code>/sys/kernel/debug/</code> is the usual mount point for it and it’s already restricted to root in Debian by default so we can’t do any permission hardening with it in security-misc.</p>
<p>We can’t just restrict this with apparmor-profile-everything. debugfs doesn’t have to be at <code>/sys/kernel/debug/</code>. An attacker can mount it anywhere. For example, run</p>
<pre><code>mount -t debugfs none /mnt
</code></pre>
<p>Now there is a debugfs mounted at /mnt. If apparmor-profile-everything denied access to <code>/sys/kernel/debug/</code>, it will do nothing to stop the attacker from just accessing this new mount at /mnt.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T16:50:07Z' class='post-time'>
                December 19, 2019,  4:50pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T16:50:07Z'>
          <span itemprop='position'>#163</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="160" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Please compare <code>.config</code> prior <code>make deb-pkg</code> with <code>.config</code> after <code>make deb-pkg</code> . It changes. And that I find very unusual, weird (not implying malicious, just saying to not have this misinterpreted / misquoted by third parties).</p>
</blockquote>
</aside>
<p>I’m not seeing anything except the header change.</p>
<pre><code class="lang-auto">user@host:~/kernel/linux-source-4.19$ diff -u ../config .config
--- ../config
+++ .config
@@ -1,6 +1,5 @@
 #
-# Whonix custom kernel configuration
-# Optimized for virtual machines and security
+# Automatically generated file; DO NOT EDIT.
 # Linux/x86 4.19.67 Kernel Configuration
 #
 
user@host:~/kernel/linux-source-4.19$
</code></pre>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-19T16:50:54Z' class='post-time'>
                December 19, 2019,  4:50pm
              </time>
              <meta itemprop='dateModified' content='2019-12-19T16:50:54Z'>
          <span itemprop='position'>#164</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>apparmor-profile-everything is going to restrict <code>mount</code> anyhow since that command can be abused for many very bad things.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-21T21:14:53Z' class='post-time'>
                December 21, 2019,  9:14pm
              </time>
              <meta itemprop='dateModified' content='2019-12-21T21:14:53Z'>
          <span itemprop='position'>#165</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="51" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>This kernel won’t be able to be used on hosts. Otherwise we’d need to enable all hardware config options which would drastically increase the time needed to compile and add attack surface.</p>
</blockquote>
</aside>
<p>Unless, during the install we find out what hardware the user uses, select config options based on that and compile the kernel although this can easily go very wrong.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-22T06:44:11Z' class='post-time'>
                December 22, 2019,  6:44am
              </time>
              <meta itemprop='dateModified' content='2019-12-22T06:44:11Z'>
          <span itemprop='position'>#166</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Better to rename from hardened-vm-kernel to hardened-kernel? Reason is the compile script and install hacks might be shared. Ideally for host kernel we’d offer precompiled but with a drop-in config snippet we’ll let the user opt-in for local self-compilation. Using all the same code but just some variables change depending on VM or host.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-22T13:48:05Z' class='post-time'>
                December 22, 2019,  1:48pm
              </time>
              <meta itemprop='dateModified' content='2019-12-22T13:48:05Z'>
          <span itemprop='position'>#167</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="166" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Better to rename from hardened-vm-kernel to hardened-kernel?</p>
</blockquote>
</aside>
<p>Sure if we do decide to try and make a host kernel.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-22T14:41:05Z' class='post-time'>
                December 22, 2019,  2:41pm
              </time>
              <meta itemprop='dateModified' content='2019-12-22T14:41:05Z'>
          <span itemprop='position'>#168</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Awesome. Will rename now as later package rename and migration is a nontrivial, error prone process for users who upgrade.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-23T12:59:10Z' class='post-time'>
                December 23, 2019, 12:59pm
              </time>
              <meta itemprop='dateModified' content='2019-12-23T12:59:10Z'>
          <span itemprop='position'>#169</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Patrick_mobile via Whonix Forum:</p>
<blockquote>
<p>Awesome. Will rename now as later package rename and migration is a nontrivial, error prone process for users who upgrade.</p>
</blockquote>
<p>Initial packaging is done:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../../external.html?link=https://github.githubassets.com/favicon.ico" class="site-icon" width="32" height="32">
      <a href="../../../../external.html?link=https://github.com/Whonix/hardened-kernel" target="_blank">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="../../../../external.html?link=https://avatars3.githubusercontent.com/u/4500165?s=400&amp;v=4" class="thumbnail onebox-avatar" width="400" height="400">

<h3><a href="../../../../external.html?link=https://github.com/Whonix/hardened-kernel" target="_blank">Whonix/hardened-kernel</a></h3>

<p>Hardened kernel configuration optimized for virtual machines. - https://forums.whonix.org/t/kernel-recompilation-for-better-hardening/7598 - Whonix/hardened-kernel</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-23T14:17:05Z' class='post-time'>
                December 23, 2019,  2:17pm
              </time>
              <meta itemprop='dateModified' content='2019-12-23T14:17:05Z'>
          <span itemprop='position'>#170</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>madaidan via Whonix Forum:</p>
<blockquote>
<p>Should <code>CONFIG_PROC_PAGE_MONITOR</code> be disabled?</p>
<p><a href="../../../../external.html?link=https://github.com/torvalds/linux/blob/master/fs/proc/Kconfig#L83">https://github.com/torvalds/linux/blob/master/fs/proc/Kconfig#L83</a></p>
<blockquote>
<p>Various /proc files exist to monitor process memory utilization:<br>
/proc/pid/smaps, /proc/pid/clear_refs, /proc/pid/pagemap,<br>
/proc/kpagecount, and /proc/kpageflags. Disabling these<br>
interfaces will reduce the size of the kernel by approximately 4kb.</p>
</blockquote>
<p>It was called “brain-dead” and a security risk by grsecurty.</p>
<p>It was also used in exploiting rowhammer to gain kernel privileges.</p>
<p><a href="../../../../external.html?link=https://googleprojectzero.blogspot.com/2015/03/exploiting-dram-rowhammer-bug-to-gain.html">https://googleprojectzero.blogspot.com/2015/03/exploiting-dram-rowhammer-bug-to-gain.html</a></p>
</blockquote>
<p>Better disable read/write access with apparmor-profile-everything instead?</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../7598.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-23T14:32:17Z' class='post-time'>
                December 23, 2019,  2:32pm
              </time>
              <meta itemprop='dateModified' content='2019-12-23T14:32:17Z'>
          <span itemprop='position'>#171</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="170" data-topic="7598">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Better disable read/write access with apparmor-profile-everything instead?</p>
</blockquote>
</aside>
<p>It’s just going to add compile time then.</p>
        </div>

        <meta itemprop='headline' content='kernel recompilation for better hardening'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="../7598235c.html?page=7">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="../75980b08.html?page=9">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
