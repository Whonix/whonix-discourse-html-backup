<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
    <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973</link>
    <description>dnsmasq on the host operating system is increasing the attack surface.

How did I find that out?

1. Install Debian.

2. Check open ports and write them to a file.

    &gt; sudo netstat -tulpen &gt; old

3. Install packages required for Whonix KVM according to Whonix KVM documentation.

4. Check open ports again and write them to a different file.

    &gt; sudo netstat -tulpen &gt; new

5. Use any (graphical) diff viewer of your choice.

    &gt; meld old new

6. Result:

dnsmasq opens a listen port on the host operating system that is reachable from LAN and from the Internet (if not using a NAT router or host operating system firewall)

&gt; tcp        0      0 0.0.0.0:53              0.0.0.0:*               LISTEN      0          19969      1975/dnsmasq        

&gt; tcp6       0      0 :::53                   :::*                    LISTEN      0          19971      1975/dnsmasq        

Whonix KVM TODO: Include instructions how to configure dnsmasq to listen on localhost only (if no way to get rid of it completely).

----

NOTE: I am not a maintainer of Whonix KVM.</description>
    <language>en</language>
    <lastBuildDate>Mon, 21 Nov 2022 09:43:41 +0000</lastBuildDate>
    <category>KVM</category>
    <atom:link href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I saw some instructions for running a Debian host with KVM and a Debian guest inside a KVM VM. And some of these instructions didn’t require dnsmasq.</p>
<p>Maybe dnsmasq is required as per, quote <a href="https://wiki.libvirt.org/page/Libvirtd_and_dnsmasq" class="inline-onebox">Libvirtd and dnsmasq - Libvirt Wiki</a></p>
<blockquote>
<p>On linux host servers, libvirtd uses dnsmasq to service the virtual networks, such as the <a href="https://wiki.libvirt.org/page/Networking">default network</a>. A new instance of dnsmasq is started for each virtual network, only accessible to guests in that specific network.</p>
</blockquote>
<p>But that doesn’t sound like the host dnsmasq systemd unit is required. Could you test please to disable the host dnsmasq systemd unit? (The package dnsmasq can remain being installed.)</p>
<p>Check if running:</p>
<pre><code>sudo systemctl status dnsmasq
</code></pre>
<p>Then stop it.</p>
<pre><code>sudo systemctl stop dnsmasq
</code></pre>
<p>Does that break Whonix-Gateway connectivity?<br>
Does that break Whonix-Workstation connectivity?</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/13</link>
        <pubDate>Mon, 21 Nov 2022 09:43:41 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-13</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="11" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>So I don’t understand why Whonix KVM requires dnsmasq.</p>
</blockquote>
</aside>
<p>KVM needs it by default. not really a Whonix thing. We already recommend installing a firewall in the host hardening guide. I’m not sure that requiring users to take extra steps on their hosts is conducive to a good first time user experience nor scaring them away by saying the hypervisor installs unsafe packages (which it isn’t from a security perspective because no one can connect to it) makes any sense. Putting a dozen caveats and warnings on a download page will make people ignore the project and leave.</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/12</link>
        <pubDate>Mon, 21 Nov 2022 08:47:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-12</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="HulaHoop" data-post="8" data-topic="15973" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<aside class="quote no-group" data-username="anon12802191" data-post="7" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/f0a364/40.png" class="avatar"> anon12802191:</div>
<blockquote>
<p>Some tight dictatorship countries, especially during times of unrest <strong>will</strong> arrest you incase they suspect even slightest of “above average technical ability” e.g. running Linux host and running virtual machines on it.</p>
</blockquote>
</aside>
<p>I hate to be the bearer of bad news, but our security choices and improvements do have a unique fingerprint on the network for those who want to look. The fact we disable TCP timestamps and remove TCP ISNs is readily apparent. Rather than stick to the less secure defaults that can endanger users in other ways, we have chosen to move ahead and adopt these improvements.<br>
.<br>
If having a firewall solves this - which I think Patrick said, then the solution is easy enough to apply and I hope satisfactory</p>
</blockquote>
</aside>
<p>Unfortunately I have to raise one point here. We could make a meaningful distinction between:</p>
<ul>
<li>
<strong>A)</strong> ISP level network fingerprint analysis versus leaking “user of dnsmasq or something similar, maybe a Whonix user?” versus,</li>
<li>
<strong>B)</strong> Leaking that information to anyone who can use a port scanner over LAN (if using a WiFi hotspot or big LAN or LAN based ISP) or even over WAN (if not using a NAT router and/or compromised NAT router).</li>
</ul>
<p>We cannot do anything about A) (as per <a href="https://forums.whonix.org/t/tcp-linux-hardened-fingerprinting/15992" class="inline-onebox">TCP linux-hardened fingerprinting</a>) but B) is avoidable. For that, either</p>
<ul>
<li>
<strong>1)</strong> dnsmasq would need to be avoided, or</li>
<li>
<strong>2)</strong> Whonix KVM documentation could include instructions on how to setup a host firewall since specifically important due to dnsmasq.</li>
</ul>
<p>Whonix-Gateway requires neither</p>
<ul>
<li>
<strong>X)</strong> DHCP, nor</li>
<li>
<strong>Y)</strong> DNS.</li>
</ul>
<p>DHCP:<br>
DHCP isn’t needed by Whonix-Gateway because <a href="https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/network/interfaces.d/30_non-qubes-whonix" class="inline-onebox">whonix-gw-network-conf/30_non-qubes-whonix at master · Whonix/whonix-gw-network-conf · GitHub</a> is using static networking - no DHCP needed since many Whonix versions.</p>
<p>DNS:<br>
DNS isn’t needed by Whonix-Gateway because Tor does not require DNS.<br>
(Except perhaps for some pluggable transports<br>
Related: <a href="https://www.whonix.org/wiki/Whonix-Gateway_System_DNS" class="inline-onebox">Whonix-Gateway System DNS - Whonix</a></p>
<aside class="onebox githubblob" data-onebox-src="https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/resolv.conf.whonix#L21-L35">
  <header class="source">

      <a href="https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/resolv.conf.whonix#L21-L35" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/whonix-gw-network-conf/blob/master/etc/resolv.conf.whonix#L21-L35" target="_blank" rel="noopener">Whonix/whonix-gw-network-conf/blob/master/etc/resolv.conf.whonix#L21-L35</a></h4>



    <pre class="onebox">      <code class="lang-whonix">
        <ol class="start lines" start="21" style="counter-reset: li-counter 20 ;">
            <li>## Gateway own System DNS Clearnet Setting.</li>
            <li>##</li>
            <li>## If the user wants Gateway's own DNS to use clearnet DNS,</li>
            <li>## comment out the torified DNS server above (already by default), and</li>
            <li>## comment in the clearnet DNS server below.</li>
            <li>##</li>
            <li>## This has nothing to do with Workstation's DNS.</li>
            <li>##</li>
            <li>## Save to comment out. The only thing that breaks when commenting out is</li>
            <li>## the meek lite pluggable transport.</li>
            <li>##</li>
            <li>## https://www.whonix.org/wiki/Whonix-Gateway_System_DNS</li>
            <li>##</li>
            <li>## VirtualBox Clearnet DNS:</li>
            <li>#nameserver 10.0.2.3</li>
        </ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>So I don’t understand why Whonix KVM requires dnsmasq.</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/11</link>
        <pubDate>Sun, 20 Nov 2022 15:12:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-11</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Forum moderation:</p>
<p>You’re raising the fingerprinting point here already:</p>
<aside class="quote" data-post="1" data-topic="15992">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="20" height="20" src="/letter_avatar_proxy/v4/letter/a/f0a364/40.png" class="avatar">
    <a href="https://forums.whonix.org/t/tcp-linux-hardened-fingerprinting/15992">TCP linux-hardened fingerprinting</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development/8"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of components looking for maintainer)">Development</span></a>
  </div>
  <blockquote>
    The negatives of having TCP timestamps disabled (and other default TCP kernel options), especially in Gateway, is fingerprinting of linux-hardened users. 
This is mainly problematic in Gateway since it is able to tie IPs to Whonix users by time sources, guard node or apt mirrors, but is also able to fingerprint Workstation to a lesser degree 
This should be re-enabled but I would love to be proven wrong
  </blockquote>
</aside>

<p>Please do not duplicate the same discussion in multiple forum threads.</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/10</link>
        <pubDate>Sun, 20 Nov 2022 07:34:20 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-10</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[anon12802191]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="HulaHoop" data-post="8" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>but our security choices and improvements do have a unique fingerprint on the network for those who want to look.</p>
</blockquote>
</aside>
<p>That is in the VMs and not the host (dnsmasq fingerprinting) correct?</p>
<p>The TCP timestamps being disabled is only <strong>inside</strong> of the VM, however the dnsmasq is on the <strong>host</strong> so it should still be considered. Just because Whonix has some obvious fingerprint able properties in exchange for security, does not mean you should allow <strong>more</strong> fingerprints, especially ones that are unnecessary like in this case of dnsmasq exposing it’s self on the host.</p>
<hr>
<aside class="quote no-group" data-username="HulaHoop" data-post="8" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>The fact we disable TCP timestamps and remove TCP ISNs is readily apparent.</p>
</blockquote>
</aside>
<p>This is interesting because AFAIK Whonix disables these in linux-harden kernel which I thought is in use only in Workstation and not Gateway and I assumed that means no fingerprint (at least outside of tor) or does Gateway and workstation both use same kernel with same options? if so that could be an improvement to disable some hardening kernel features in Gateway, no?</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/9</link>
        <pubDate>Sat, 19 Nov 2022 21:32:26 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-9</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="anon12802191" data-post="7" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="20" height="20" src="/letter_avatar_proxy/v4/letter/a/f0a364/40.png" class="avatar"> anon12802191:</div>
<blockquote>
<p>Some tight dictatorship countries, especially during times of unrest <strong>will</strong> arrest you incase they suspect even slightest of “above average technical ability” e.g. running Linux host and running virtual machines on it.</p>
</blockquote>
</aside>
<p>I hate to be the bearer of bad news, but our security choices and improvements do have a unique fingerprint on the network for those who want to look. The fact we disable TCP timestamps and remove TCP ISNs is readily apparent. Rather than stick to the less secure defaults that can endanger users in other ways, we have chosen to move ahead and adopt these improvements.<br>
.<br>
If having a firewall solves this - which I think Patrick said, then the solution is easy enough to apply and I hope satisfactory</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/8</link>
        <pubDate>Sat, 19 Nov 2022 19:12:52 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-8</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[anon12802191]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="HulaHoop" data-post="5" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<aside class="quote no-group" data-username="Patrick" data-post="4" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Even the information “port 53 tcpwrapped” should not be leaked over the LAN or internet. Could even be deducted “Maybe it’s a Whonix KVM user”.</p>
</blockquote>
</aside>
<p>Note this is not specific to Whonix and could be interpreted as Linux host running libvirt, This is already discoverable and hard to hide the type of OS running on a network because of the different ways they react.</p>
</blockquote>
</aside>
<p>I see your point of view but I agree with <a class="mention" href="http://forums.whonix.org/u/patrick">@Patrick</a> on this one.<br>
Your point heavily assumes “Linux machine running a KVM machine is not that suspicious” is entirely in context of specific countries in specific times.</p>
<p>Some tight dictatorship countries, especially during times of unrest <strong>will</strong> arrest you incase they suspect even slightest of “above average technical ability” e.g. running Linux host and running virtual machines on it.</p>
<p>Their mindset would be “this person or group is running Linux, people run Linux because they have something to hide! oh and on top of that he is running a virtual machine! what is he scared of so much”</p>
<p>This sounds comical but There are countless arrests or interrogations based solely on this “logic” and I should mention that “arrests” in those countries means torture to death</p>
<p>A more tangible issue for other countries is fingerprinting. They don’t have to be sure that a Whonix VM was started or is installed, they just have to know that a VM is there and it is enough to narrow down the search considerably</p>
<p>Do not undermine value of metadata, a lot of people die every day because of it. <a href="https://www.youtube.com/watch?v=tL8_caB35Pg" rel="noopener nofollow ugc">We kill people based on metadata</a></p>
<p>So, optimally the host should not leak information on whether or not they have VMs/dnsmasq or anything out of ordinary</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/7</link>
        <pubDate>Fri, 18 Nov 2022 15:27:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-7</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Does ufwall change nmap results?</p>
</blockquote>
</aside>
<p>Try?<br>
Probably I think.</p>
<p>Maybe <a href="https://www.whonix.org/wiki/KVM" class="inline-onebox">Whonix ™ for KVM</a> should advice to setup a host firewall beforehand.</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.whonix.org/wiki/Host_Firewall">
  <header class="source">
      <img src="https://www.whonix.org/w/images/a/a4/Whonix-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="https://www.whonix.org/wiki/Host_Firewall" target="_blank" rel="noopener" title="07:43PM - 13 August 2022">Whonix – 13 Aug 22</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:640/384;"><img src="https://www.whonix.org/w/images/e/e1/Hostfirewall213213.jpg?version=e2bbd888cc717e86a4ca390272be28df" class="thumbnail" width="640" height="384"></div>

<h3><a href="https://www.whonix.org/wiki/Host_Firewall" target="_blank" rel="noopener">Host Firewall</a></h3>

  <p>Host Firewall Settings and Testing</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.kicksecure.com/wiki/Host_Firewall_Basics">
  <header class="source">
      <img src="https://www.kicksecure.com/w/images/4/45/Kicksecure-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="https://www.kicksecure.com/wiki/Host_Firewall_Basics" target="_blank" rel="noopener" title="01:36PM - 23 August 2022">Kicksecure – 23 Aug 22</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:466/500;"><img src="https://www.kicksecure.com/w/images/9/9e/Firewall-34227640.png" class="thumbnail" width="466" height="500"></div>

<h3><a href="https://www.kicksecure.com/wiki/Host_Firewall_Basics" target="_blank" rel="noopener">Host Firewall Basics</a></h3>

  <p>Host Firewall Installation and Configuration</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-username="HulaHoop" data-post="5" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>or is it using raw ports?</p>
</blockquote>
</aside>
<p>I doubt that. Raw ports is mostly only a DHCP thing. But this is DNS. Not DHCP.</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/6</link>
        <pubDate>Fri, 18 Nov 2022 10:59:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-6</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="4" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Even the information “port 53 tcpwrapped” should not be leaked over the LAN or internet. Could even be deducted “Maybe it’s a Whonix KVM user”.</p>
</blockquote>
</aside>
<p>Note this is not specific to Whonix and could be interpreted as Linux host running libvirt, This is already discoverable and hard to hide the type of OS running on a network because of the different ways they react.</p>
<aside class="quote no-group" data-username="Patrick" data-post="4" data-topic="15973">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>We still don’t want a TCP handshake to be completed because unsolicited incoming connections have a higher attack surface than not allowing unsolicited incoming connections.</p>
</blockquote>
</aside>
<p>Binding to localhost would break it because the whole point is to have it listening on whatever arbitrary internal LAN IP ranges libvirt binds it to on the fly. OP can go ahead and try to uninstall it and deal with the fallout, but as a default option this is unworkable.</p>
<p>Does ufwall change nmap results? or is it using raw ports?</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/5</link>
        <pubDate>Fri, 18 Nov 2022 08:31:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-5</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="anon12802191" data-post="22" data-topic="15912">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="20" height="20" src="/letter_avatar_proxy/v4/letter/a/f0a364/40.png" class="avatar"><a href="//forums.whonix.org/t/how-to-disable-dhcp-in-whonix-and-ensure-no-leaks/15912/22">How to disable DHCP in Whonix and ensure no leaks</a>
</div>
<blockquote>
<p>Your thread is not needed, please see <a href="https://www.whonix.org/wiki/KVM#cite_note-21">Whonix ™ for KVM</a></p>
</blockquote>
</aside>
<p>I think it’s needed. More on <code>tcpwrapped</code>:</p>
<aside class="onebox stackexchange" data-onebox-src="https://security.stackexchange.com/questions/23407/how-to-bypass-tcpwrapped-with-nmap-scan">
  <header class="source">

      <a href="https://security.stackexchange.com/questions/23407/how-to-bypass-tcpwrapped-with-nmap-scan" target="_blank" rel="noopener">security.stackexchange.com</a>
  </header>

  <article class="onebox-body">
      <a href="https://security.stackexchange.com/users/6454/king-sabri" target="_blank" rel="noopener">
    <img alt="KING SABRI" src="https://www.gravatar.com/avatar/2636e8a6703c49f66027361402ab0261?s=256&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="256" height="256">
  </a>

<h4>
  <a href="https://security.stackexchange.com/questions/23407/how-to-bypass-tcpwrapped-with-nmap-scan" target="_blank" rel="noopener">How to bypass tcpwrapped with nmap scan</a>
</h4>

<div class="tags">
  <strong>firewalls, nmap</strong>
</div>

<div class="date">
  asked by
  
  <a href="https://security.stackexchange.com/users/6454/king-sabri" target="_blank" rel="noopener">
    KING SABRI
  </a>
  on <a href="https://security.stackexchange.com/questions/23407/how-to-bypass-tcpwrapped-with-nmap-scan" target="_blank" rel="noopener">11:43PM - 30 Oct 12 UTC</a>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<blockquote>
<p>Specifically, it means that a full TCP handshake was completed, but the remote host closed the connection without receiving any data.</p>
</blockquote>
<p>So two things here:</p>
<ul>
<li>We still don’t want a TCP handshake to be completed because unsolicited incoming connections have a higher attack surface than not allowing unsolicited incoming connections.</li>
<li>Even the information “port 53 tcpwrapped” should not be leaked over the LAN or internet. Could even be deducted “Maybe it’s a Whonix KVM user”.</li>
</ul>
<p>related:<br>
A writeup on “unsolicited incoming connections” → <a href="https://www.whonix.org/wiki/Ports" class="inline-onebox">Ports - Whonix</a>.</p>
<p>I don’t know which one would be applicable here, but here’s a long list of dnsmasq CVEs to review:</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.cvedetails.com/vulnerability-list/vendor_id-8351/product_id-14557/Thekelleys-Dnsmasq.html">
  <header class="source">

      <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-8351/product_id-14557/Thekelleys-Dnsmasq.html" target="_blank" rel="noopener">cvedetails.com</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://www.cvedetails.com/vulnerability-list/vendor_id-8351/product_id-14557/Thekelleys-Dnsmasq.html" target="_blank" rel="noopener">Thekelleys Dnsmasq : List of security vulnerabilities</a></h3>

  <p>Security vulnerabilities of Thekelleys Dnsmasq : List of all related CVE security vulnerabilities.
			CVSS Scores, vulnerability details and links to full CVE details and references.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Potential solution, untested:</p>
<aside class="onebox stackexchange" data-onebox-src="https://serverfault.com/questions/799200/bind-dnsmasq-dns-to-just-localhost-127-0-0-1">
  <header class="source">

      <a href="https://serverfault.com/questions/799200/bind-dnsmasq-dns-to-just-localhost-127-0-0-1" target="_blank" rel="noopener">serverfault.com</a>
  </header>

  <article class="onebox-body">
      <a href="https://serverfault.com/users/372436/d-k" target="_blank" rel="noopener">
    <img alt="D.K." src="https://www.gravatar.com/avatar/9d4eddeba2017920ca104b5dafa1021a?s=256&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="256" height="256">
  </a>

<h4>
  <a href="https://serverfault.com/questions/799200/bind-dnsmasq-dns-to-just-localhost-127-0-0-1" target="_blank" rel="noopener">Bind dnsmasq DNS to just localhost (127.0.0.1)</a>
</h4>

<div class="tags">
  <strong>linux, domain-name-system, linux-networking, internal-dns</strong>
</div>

<div class="date">
  asked by
  
  <a href="https://serverfault.com/users/372436/d-k" target="_blank" rel="noopener">
    D.K.
  </a>
  on <a href="https://serverfault.com/questions/799200/bind-dnsmasq-dns-to-just-localhost-127-0-0-1" target="_blank" rel="noopener">12:15AM - 26 Aug 16 UTC</a>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/4</link>
        <pubDate>Fri, 18 Nov 2022 06:31:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-4</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Forum moderation:</p>
<p>Linking to footnotes is confusing because the numbering and therefore links to footnotes will change over time when new footnotes are added.</p>
<p>It gets more confusing due to oneboxing. → <a href="https://www.kicksecure.com/wiki/Forum_Best_Practices#Avoid_Oneboxing_for_Anchored_Links">Kicksecure ™ Forums Usage Instructions, Best Practices and FAQ chapter Avoid Oneboxing for Anchored Links in Kicksecure wiki</a></p>
<hr>
<p>Content:</p>
<p>Copying that footnote here for further discussion.</p>
<aside class="onebox stackexchange" data-onebox-src="https://unix.stackexchange.com/questions/256061/is-libvirt-dnsmasq-exposed-to-the-network-if-i-run-fedora-without-a-firewall">
  <header class="source">

      <a href="https://unix.stackexchange.com/questions/256061/is-libvirt-dnsmasq-exposed-to-the-network-if-i-run-fedora-without-a-firewall" target="_blank" rel="noopener">unix.stackexchange.com</a>
  </header>

  <article class="onebox-body">
      <a href="https://unix.stackexchange.com/users/29483/sourcejedi" target="_blank" rel="noopener">
    <img alt="sourcejedi" src="https://i.stack.imgur.com/CNmjQ.jpg?s=256&amp;g=1" class="thumbnail onebox-avatar" width="256" height="256">
  </a>

<h4>
  <a href="https://unix.stackexchange.com/questions/256061/is-libvirt-dnsmasq-exposed-to-the-network-if-i-run-fedora-without-a-firewall" target="_blank" rel="noopener">Is libvirt dnsmasq exposed to the network, if I run Fedora without a firewall?</a>
</h4>

<div class="tags">
  <strong>fedora, security, firewall, dnsmasq</strong>
</div>

<div class="date">
  asked by
  
  <a href="https://unix.stackexchange.com/users/29483/sourcejedi" target="_blank" rel="noopener">
    sourcejedi
  </a>
  on <a href="https://unix.stackexchange.com/questions/256061/is-libvirt-dnsmasq-exposed-to-the-network-if-i-run-fedora-without-a-firewall" target="_blank" rel="noopener">01:51PM - 18 Jan 16 UTC</a>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<blockquote>
<p>So I can see an open TCP port. However it responds as if it’s “tcpwrapped”. That implies if you connect over a different interface from virbr0 , dnsmasq closes the connection without reading any data. So data you send to it doesn’t matter; it can’t e.g. exploit a classic buffer overflow.</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/3</link>
        <pubDate>Fri, 18 Nov 2022 05:53:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-3</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[anon12802191]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox allowlistedgeneric" data-onebox-src="https://www.whonix.org/wiki/KVM#cite_note-21">
  <header class="source">
      <img src="https://www.whonix.org/w/images/a/a4/Whonix-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="https://www.whonix.org/wiki/KVM#cite_note-21" target="_blank" rel="noopener nofollow ugc" title="05:37PM - 16 November 2022">Whonix – 16 Nov 22</a>
  </header>

  <article class="onebox-body">
    <img src="https://www.whonix.org/w/images/0/0f/Kvm-new-logo.png?version=60934fd6e6a249d039291ddd586d1200" class="thumbnail onebox-avatar" width="500" height="500">

<h3><a href="https://www.whonix.org/wiki/KVM#cite_note-21" target="_blank" rel="noopener nofollow ugc">Whonix ™ for KVM</a></h3>

  <p>Using Whonix ™ with KVM (Kernel Virtual Machine)</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/2</link>
        <pubDate>Thu, 17 Nov 2022 19:06:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-2</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
      <item>
        <title>Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>dnsmasq on the host operating system is increasing the attack surface.</p>
<p>How did I find that out?</p>
<ol>
<li>
<p>Install Debian.</p>
</li>
<li>
<p>Check open ports and write them to a file.</p>
<blockquote>
<p>sudo netstat -tulpen &gt; old</p>
</blockquote>
</li>
<li>
<p>Install packages required for Whonix KVM according to Whonix KVM documentation.</p>
</li>
<li>
<p>Check open ports again and write them to a different file.</p>
<blockquote>
<p>sudo netstat -tulpen &gt; new</p>
</blockquote>
</li>
<li>
<p>Use any (graphical) diff viewer of your choice.</p>
<blockquote>
<p>meld old new</p>
</blockquote>
</li>
<li>
<p>Result:</p>
</li>
</ol>
<p>dnsmasq opens a listen port on the host operating system that is reachable from LAN and from the Internet (if not using a NAT router or host operating system firewall)</p>
<blockquote>
<p>tcp        0      0 0.0.0.0:53              0.0.0.0:*               LISTEN      0          19969      1975/dnsmasq</p>
</blockquote>
<blockquote>
<p>tcp6       0      0 :::53                   :::*                    LISTEN      0          19971      1975/dnsmasq</p>
</blockquote>
<p>Whonix KVM TODO: Include instructions how to configure dnsmasq to listen on localhost only (if no way to get rid of it completely).</p>
<hr>
<p>NOTE: I am not a maintainer of Whonix KVM.</p>
          <p><a href="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973/1</link>
        <pubDate>Thu, 17 Nov 2022 11:45:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-15973-1</guid>
        <source url="http://forums.whonix.org/t/whonix-kvm-dnsmasq-listen-port-on-host-operating-system-attack-surface-reduction/15973.rss">Whonix KVM dnsmasq - listen port on host operating system - attack surface reduction</source>
      </item>
  </channel>
</rss>
