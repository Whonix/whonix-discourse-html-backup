<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
    <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597</link>
    <description>[quote=&quot;madaidan, post:86, topic:7658&quot;]
Root (processes with at least CAP_SYS_ADMIN) can use TIOCSTI on whatever console though.
[/quote]

We can restrict this further with our own kernel patch if you want, following the &quot;untrusted root user&quot; idea.

https://paste.debian.net/hidden/f083278e/</description>
    <language>en</language>
    <lastBuildDate>Fri, 06 Dec 2019 15:33:28 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="92" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Then if/once we re-compile the kernel / use linux hardened, we’d also “just use CAP_SYS_ADMIN”. Good enough?</p>
</blockquote>
</aside>
<p>It would be alright but allows the root user to use TIOCSTI to compromise applications which might not be good within an untrusted root threat model (we’d also need to restrict ptrace from root and some other things).</p>
<aside class="quote no-group" data-post="92" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>do the same with Linux Hardened (I didn’t manage yet to use Debian’s packaging files in combination with Linux Hardened.)</p>
</blockquote>
</aside>
<p>The linux-hardened patches have tons of issues with the debian kernel sources. I’ve tried to fix it but it still wouldn’t work so I gave up (might try again some time though).</p>
<aside class="quote no-group" data-post="92" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>go beyond Linux Hardened, think about becoming even safer than Linux Hardened</p>
</blockquote>
</aside>
<p>We should stay as close to the main linux-hardened patch set as possible and try to get it to work for us. I’m already planning on submitting patches like <a href="https://github.com/anthraxx/linux-hardened/pull/19">https://github.com/anthraxx/linux-hardened/pull/19</a></p>
          <p><a href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/7</link>
        <pubDate>Thu, 05 Dec 2019 19:35:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8597-7</guid>
        <source url="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</source>
      </item>
      <item>
        <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Then if/once we re-compile the kernel / use linux hardened, we’d also “just use CAP_SYS_ADMIN”. Good enough?</p>
<aside class="quote no-group" data-post="91" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>They already restrict it to CAP_SYS_ADMIN and probably won’t want to restrict it further,</p>
</blockquote>
</aside>
<p>Perhaps just suggest it to them? Let’s see what they say. Since the patch is already done (looks like “90%” of the work), would be good to go a bit further and suggest it to them. Even if they say no, someone might look at the code and have a useful comment. Even in case of no comment could mean someone had a look and didn’t have anything negative to say. Then also we could know their reaction and wouldn’t need to assume it.</p>
<p>Also this seems rushing far ahead. The way I see it:</p>
<ol>
<li>figure out how to  automatically compile the kernel package on user’s machine during APT upgrades using Debian stock kernel at all</li>
<li>do the same with Linux Hardened (I didn’t manage yet to use Debian’s packaging files in combination with Linux Hardened.)</li>
<li>go beyond Linux Hardened, think about becoming even safer than Linux Hardened</li>
</ol>
<p>Looks like we’re discussing 3) while steps 1) and 2) are far away.</p>
          <p><a href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/6</link>
        <pubDate>Thu, 05 Dec 2019 19:27:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8597-6</guid>
        <source url="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</source>
      </item>
      <item>
        <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="90" data-topic="7658" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What about Linux Hardened? They might be interested to take the patch?</p>
</blockquote>
</aside>
<p>They already restrict it to CAP_SYS_ADMIN and probably won’t want to restrict it further,</p>
          <p><a href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/5</link>
        <pubDate>Thu, 05 Dec 2019 19:19:25 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8597-5</guid>
        <source url="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</source>
      </item>
      <item>
        <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>What about Linux Hardened? They might be interested to take the patch?</p>
          <p><a href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/4</link>
        <pubDate>Thu, 05 Dec 2019 19:14:08 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8597-4</guid>
        <source url="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</source>
      </item>
      <item>
        <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I cannot review kernel patches since I don’t speak C, let alone understand the kernel code good enough.</p>
</blockquote>
</aside>
<p>It’s really simple. It just makes any TIOCSTI call exit with <code>ENODEV</code> (“No such device”) if CONFIG_TIOCSTI_DISABLE is set.</p>
<aside class="quote no-group" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Reason, such an approach could lead to a similar situation as Debian/OpenSSL Fiasco. See <a href="https://research.swtch.com/openssl">Lessons from the Debian/OpenSSL Fiasco</a>.</p>
</blockquote>
</aside>
<p>This won’t lead to that. TIOCSTI is a known security risk and is rarely used and when it is used, it’s not for anything important like crypto. OpenBSD has even removed it entirely <a href="https://marc.info/?l=openbsd-cvs&amp;m=149870941319610">https://marc.info/?l=openbsd-cvs&amp;m=149870941319610</a></p>
<aside class="quote no-group" data-post="88" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Therefore, please discuss kernel patches please with upstream: <a href="http://kernel.org">kernel.org</a>; Linux Hardened; Debian.</p>
</blockquote>
</aside>
<p>Upstream will never accept this. They instantly shot down the patch to restrict it to CAP_SYS_ADMIN <a href="https://lkml.org/lkml/2017/5/10/552">https://lkml.org/lkml/2017/5/10/552</a></p>
<p>A patch to remove it entirely is never going to happen.</p>
          <p><a href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/3</link>
        <pubDate>Thu, 05 Dec 2019 18:37:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8597-3</guid>
        <source url="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</source>
      </item>
      <item>
        <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I cannot review kernel patches since I don’t speak C, let alone understand the kernel code good enough. And I shouldn’t carry such a patch guessing “looks and works good enough” approach. Reason, such an approach could lead to a similar situation as Debian/OpenSSL Fiasco. See <a href="https://research.swtch.com/openssl">Lessons from the Debian/OpenSSL Fiasco</a>.</p>
<p>Therefore, please discuss kernel patches please with upstream: <a href="http://kernel.org">kernel.org</a>; Linux Hardened; Debian.</p>
          <p><a href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/2</link>
        <pubDate>Thu, 05 Dec 2019 05:46:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8597-2</guid>
        <source url="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</source>
      </item>
      <item>
        <title>kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="86" data-topic="7658">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"><a href="//forums.whonix.org/t/restrict-root-access/7658/86">Restrict root access</a>
</div>
<blockquote>
<p>Root (processes with at least CAP_SYS_ADMIN) can use TIOCSTI on whatever console though.</p>
</blockquote>
</aside>
<p>We can restrict this further with our own kernel patch if you want, following the “untrusted root user” idea.</p>
<p><a href="https://paste.debian.net/hidden/f083278e/" class="onebox" target="_blank">https://paste.debian.net/hidden/f083278e/</a></p>
          <p><a href="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597/1</link>
        <pubDate>Wed, 04 Dec 2019 20:41:39 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-8597-1</guid>
        <source url="http://forums.whonix.org/t/kernel-patch-config-tiocsti-disable-to-further-restrict-root-cap-sys-admin/8597.rss">kernel patch CONFIG_TIOCSTI_DISABLE to further restrict root CAP_SYS_ADMIN</source>
      </item>
  </channel>
</rss>
