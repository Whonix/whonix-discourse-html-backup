<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Building Whonix in Qubes</title>
    <link>http://forums.whonix.org/t/building-whonix-in-qubes/647</link>
    <description>Following are instructions to build whonix-gateway and whonix-workstation templates within a Qubes AppVM.  Note that an install-able template will be available soon that you can install directly in dom0 using &#39;[font=courier]qubes-dom0-update[/font]&#39; instead of needing to build from source.

I just re-ran the following steps and confirm they worked for me:


[ul][li]First I suggest you start completely over with a brand new AppVM.  I named mine [i]development-qubes[/i].  Base it on the &#39;[i]Fedora-20-x64[/i]&#39; template.[/li]
[li]Start AppVM from Qubes Manager[/li]
[li]Start a [b]Dom0[/b] Konsole session[/li]
[li]Increase disk size to 10GB per VM you going to build, so in Dom0 Konsole type &#39;[font=courier]qvm-grow-private devleopment-qubes 25GB[/font]&#39;[/li]
[li]Start a Terminal session for new AppVM (development-qubes) and enter the following:[/li][/ul]


[code]
git clone https://github.com/nrgaway/qubes-builder
cd qubes-builder/
git fetch
git checkout whonix
./README.whonix
  - Answer y &lt;enter&gt; to yum update question
[/code]

Those steps will build both the gateway and workstation.  You can edit &#39;[font=courier]examples/whonix.conf[/font]&#39; (which will be linked as &#39;[font=courier]builder.conf[/font]&#39; after running script) to change build options to build wheezy or jessie or add gnome to those as well (just un-comment out lines you want to build).

There should be no issues listed previously in this thread for any distro except Whonix can not yet update from template and you SHOULD run both the gateway and workstation as standalone until the update situation is resolved.

So, once the templates are built, the last line explains how to get them to Dom0.  I actually save that line and created a script in Dom0 I use anytime I need to grab templates I built.  So you can edit a file named &#39;get-templates.sh&#39; on dom0 and include the following&quot;
[code]
#!/bin/bash

qvm-run --pass-io development-qubes &#39;cat /home/user/qubes-builder/qubes-src/linux-template-builder/rpm/install-templates.sh&#39; &gt; install-templates.sh
chmod a+x install-templates.sh
[/code]

Then make the file executable and run it to grab and install the templates on dom0
[code]
cd ~
mkdir bin
cd bin
vi get-templates.sh # Add text above
chattr a+x get-templates.sh
./get-templates.sh
cd /tmp
/home/user/bin/get-templates.sh # Grabs install script
./install-template.sh # Will download template rpm; remove old one (if installed); install new ones
[/code]

In order to get the text I listed to dom0, here is a trick I figured out.
[code]
- Highlight text you want to copy.
- Right click with mouse and select &#39;copy&#39;
- Press &lt;SHIFT&gt;+&lt;CTRL&gt;+&lt;C&gt;
- in dom0 Konsole type &#39;cat /run/qubes/qubes-clipboard.bin&#39;
- the text you just copied will be displayed in dom0 terminal so now you can highlight it from dom0 terminal and paste it where ever
[/code]

[HR]

Qubes manager options to select for gateway:

[ul][li]Name: whonix-gateway[/li]
[li]Template: whonix-gateway-experimental[/li]
[li]Type: Proxy VM[/li]
[li]NetVM: firewallvm[/li]
[li]Check Standalone[/li][/ul]



[ul][li]Name: whonix-workstation[/li]
[li]Template: whonix-workstation-experimental[/li]
[li]Type: AppVM[/li]
[li]NetVM: whonix-gateway[/li]
[li]Check Standalone[/li][/ul]


[HR]

Start the gateway from Qubes Manager.  The setup screen should come up and ask you about repo and starting Tor.  Note that the first two screens where it displays disclaimer that the buttons are not visible, so just press [font=courier]&lt;enter&gt;[/font], then [font=courier]&lt;enter&gt;[/font] again for second screen.  If you happen to not press [font=courier]&lt;enter&gt;[/font], or somehow focus gets messed up, VM will power off so you will need to try again.

When you are finished setup, if you get an error message from time proxy or that tor can not do a check since bootstrap not complete, try running &#39;[font=courier]whonixcheck[/font]&#39; again, and it should succeed.

Do same for Workstation.  Or you can use a regular AppVM and just select &#39;[font=courier]whonix-gateway[/font]&#39; as its netvm.

Note the first run dialog says the  password is &#39;[font=courier]changeme[/font]&#39; when there is actually no password as per Qubes defaults.

[HR]

Some issues with Whonix applications:

[ul][li]Some don&#39;t run maybe?[/li]
[li]Stuff like tor browser may need to be started from terminal at this point[/li]
[li]???[/li][/ul]


[HR]

[b]So now you have your whonix-gateway and whonix-workstation installed remember it is [u][i]experimental[/i][/u] at this point.[/b]  

[HR]

Test and keep a log of issues that need to be addressed and things that work compared to HVM version.

Do leak tests and report results.  This is important.

[b]Don&#39;t use it for anything important yet until leak tests, etc are confirmed.[/b]

Please post any build issues or questions in this thread.</description>
    <language>en</language>
    <lastBuildDate>Mon, 17 Nov 2014 22:29:59 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“nrgaway, post:19, topic:647”]At least now you won’t be needing to re-download the complete sources again although I wonder which build you have.</p>
<p>My latest one has Whonix 9.4 but I don’t think its pushed to the whonix branch; its in wheezy.[/quote]</p>
<p>Yeah, I believe it is Whonix 9.2 that installed for me using the “whonix” branch in your git repo.</p>
<p>[hr]</p>
<aside class="quote" data-post="19" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>I think it will all be merged soon with the Qubes repos.  Then maybe you can just download a rpm template from their community site.</p>
</blockquote>
</aside>
<p>Has this been talked about by the Qubes devs for your templates yet?</p>
<p>Do they plan to offer them in RPM community templates like this?</p>
<p>I remember a few months back Joanna saying a couple times on the Qubes mailing lists that she would like to at some point incorporate Whonix and TorVM into the official Qubes installer, pre-configured, with point and click ease.</p>
<p>[hr]</p>
<aside class="quote" data-post="19" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>Its been quiet around there so maybe Qubes R3 is days away?</p>
</blockquote>
</aside>
<p>Could be. Looking forward to Qubes R3 soon. I wonder if R3 architecture changes will affect your current Whonix implementation or not.</p>
<p>[hr]</p>
<aside class="quote" data-post="19" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>I have been running it for the last few days without any issues I could notice but I really don’t know what to use it for hehe.  I just like to know its there if I need it.</p>
</blockquote>
</aside>
<p>Wow. Amazing that you’ve developed and contributed this awesome new platform without a pressing personal need. Thank you! I personally am going to get a large amount of value from it, and know several others will to. Thank you! Thank you! Thank you! <img src="//forums.whonix.org/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>[hr]</p>
<aside class="quote" data-post="19" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>Let me know how your tests work out.  If you have the latest version both gateway and workstation can be setup as templates and update via tor (templates need to have netvm set to gateway).  It won’t let you update over clearnet unless you enable networking I would think.</p>
</blockquote>
</aside>
<p>Ok. Thanks.</p>
<p>[hr]</p>
<aside class="quote" data-post="19" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>We need to focus on leak testing too.</p>
</blockquote>
</aside>
<p>Yes. With leak testing, we will want to consider the state of leak testing results compared to updated source code or packaged versions.</p>
<p>For example, leak tests may check out right now, but new leaks could be opened through additional source code and/or Qubes dev packaging.</p>
<p>So just being conscious of versioning with leak testing and also considering workflow of when to do a full battery of leak tests. Whatever new major official or community releases are put out will likely warrant a new round of full leak testing.</p>
<p>[hr]</p>
<p>Also, some basic source code auditing should be done, for trust purposes, since new community code outside of Qubes and Whonix is being incorporated.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/20">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/20</link>
        <pubDate>Mon, 17 Nov 2014 22:29:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-20</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“WhonixQubes, post:18, topic:647”]Success! <img src="//forums.whonix.org/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>Today, I finally got a successful build and installation of the “whonix-gateway-experimental” and “whonix-workstation-experimental” VMs.[/quote]</p>
<p>Yeah! Finally <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>At least now you won’t be needing to re-download the complete sources again although I wonder which build you have.</p>
<p>My latest one has Whonix 9.4 but I don’t think its pushed to the whonix branch; its in wheezy.  I think it will all be merged soon with the Qubes repos.  Then maybe you can just download a rpm template from their community site.</p>
<p>Its been quiet around there so maybe Qubes R3 is days away?</p>
<blockquote>One code bug I noticed inside: install-templates.sh
<p>The VM name “development-qubes” is hardcoded into the script, where instead it should likely be ${name}.</p>
<pre><code class="lang-auto">qvm-run --pass-io development-qubes "cat ${path}/${file}" &gt; ${file}</code></pre>
<p>should likely be changed to:</p>
<p><code>
qvm-run --pass-io ${name} "cat ${path}/${file}" &gt; ${file}
</code></p>
</blockquote>
<p>Good catch.  Fixed.</p>
<blockquote>Quite excited to have these VMs up and running now! :D
<p>I will next proceed to further testing the Whonix-Gateway and Whonix-Workstation VMs.</p>
</blockquote>
<p>I have been running it for the last few days without any issues I could notice but I really don’t know what to use it for hehe.  I just like to know its there if I need it.</p>
<p>Let me know how your tests work out.  If you have the latest version both gateway and workstation can be setup as templates and update via tor (templates need to have netvm set to gateway).  It won’t let you update over clearnet unless you enable networking I would think.</p>
<p>We need to focus on leak testing too.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/19">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/19</link>
        <pubDate>Mon, 17 Nov 2014 21:44:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-19</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Success! <img src="//forums.whonix.org/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>Today, I finally got a successful build and installation of the “whonix-gateway-experimental” and “whonix-workstation-experimental” VMs.</p>
<p>[hr]</p>
<p>I discovered that part of the problem I was having before was that my physically isolated Whonix-Gateway, which I was building over Tor with, was constantly maxing out its CPU at 100%. This was causing very slow Tor download rates and potentially even dropped packets.</p>
<p>So I started using Qubes TorVM to build over Tor.</p>
<p>Using TorVM I still encountered and bypassed the same previously documented issues with “qubes-builder/qubes-src/vmm-xen/Makefile”:</p>
<ul>
<li>
<p>Changed “wget -qN” to “wget”.</p>
</li>
<li>
<p>Changed “<a href="http://forums.whonix.org">ftp://alpha.gnu.org/gnu/grub/grub-0.97.tar.gz</a>” to “<a href="http://alpha.gnu.org/gnu/grub/grub-0.97.tar.gz" rel="nofollow noopener">http://alpha.gnu.org/gnu/grub/grub-0.97.tar.gz</a>”.</p>
</li>
<li>
<p>Changed “<a href="http://forums.whonix.org">ftp://sources.redhat.com/pub/newlib/newlib-1.16.0.tar.gz</a>” to “<a href="http://xenbits.xen.org/xen-extfiles/newlib-1.16.0.tar.gz" rel="nofollow noopener">http://xenbits.xen.org/xen-extfiles/newlib-1.16.0.tar.gz</a>”.</p>
</li>
</ul>
<p>[hr]</p>
<p>The total build time for the default “README.whonix” build was about 11 hours, building over Tor with a HDD (non-SSD).</p>
<p>[hr]</p>
<p>One code bug I noticed inside: install-templates.sh</p>
<p>The VM name “development-qubes” is hardcoded into the script, where instead it should likely be ${name}.</p>
<pre><code class="lang-auto">qvm-run --pass-io development-qubes "cat ${path}/${file}" &gt; ${file}</code></pre>
<p>should likely be changed to:</p>
<pre><code class="lang-auto">qvm-run --pass-io ${name} "cat ${path}/${file}" &gt; ${file}</code></pre>
<p>[hr]</p>
<p>Quite excited to have these VMs up and running now! <img src="//forums.whonix.org/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>I will next proceed to further testing the Whonix-Gateway and Whonix-Workstation VMs.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/18">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/18</link>
        <pubDate>Mon, 17 Nov 2014 15:32:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-18</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“WhonixQubes, post:16, topic:647”]<a class="mention" href="http://forums.whonix.org/u/nrgaway">@nrgaway</a></p>
<p>I’m wondering what your experience has been as far as the amount of time it takes for you to run the complete build script from start to finish.</p>
<p>[hr]</p>
<p>Me:</p>
<p>I have a generally fast i7 machine, but am building over Tor and using a HDD (non-SSD).</p>
<p>Seems to be taking 4+ hours. Haven’t finished yet.</p>
<p>[hr]</p>
<p>Wondering about how long it has taken you to do a complete build over both Tor and over Clearnet?</p>
<p>Also, are you using HDD or SSD?</p>
<p>Thanks![/quote]</p>
<p>From a fresh clean AppVM takes aprox:<br>
make get-sources – 5 minutes<br>
make template-modules – ~20 minutes first run; 5 minutes once it has been run before<br>
make template – 40 minutes per VM</p>
<p>So about an hour per VM.  Usually I build about 6 of them before going to bed</p>
<p>I’m running on an i7 with SSD.  I think Tor took about 10 minutes for sources; I only built once over Tor.</p>
<p>I did not track how much longer it took to install the debootstraped images in Tor.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/17">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/17</link>
        <pubDate>Tue, 11 Nov 2014 21:06:02 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-17</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/nrgaway">@nrgaway</a></p>
<p>I’m wondering what your experience has been as far as the amount of time it takes for you to run the complete build script from start to finish.</p>
<p>[hr]</p>
<p>Me:</p>
<p>I have a generally fast i7 machine, but am building over Tor and using a HDD (non-SSD).</p>
<p>Seems to be taking 4+ hours. Haven’t finished yet.</p>
<p>[hr]</p>
<p>Wondering about how long it has taken you to do a complete build over both Tor and over Clearnet?</p>
<p>Also, are you using HDD or SSD?</p>
<p>Thanks!</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/16">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/16</link>
        <pubDate>Tue, 11 Nov 2014 16:51:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-16</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Strange…</p>
<p>So I just checked 3 new build VMs that I launched a few hours ago.</p>
<p>I did not modify the “qubes-builder” repo files in these at all. No “-qN” fix. Nothing modified in Makefile, etc.</p>
<p>Still building over Tor. And all 3 of them are well past all of the previous errors we’ve discussed.</p>
<p>So, this time, while building over Tor, 3 VMs were able to do so without encountering those previous errors.</p>
<p>[hr]</p>
<p>Now 2 out of 3 of them have erred out based on other packages and downloads further on in the build process.</p>
<p>But the 3rd VM is still going strong retrieving a bunch of Whonix packages.</p>
<p>[hr]</p>
<p>These results tell me that it is the individual Tor circuits or exit nodes that we connect through that make or break our build process when building over Tor.</p>
<p>Since now, with a different random Tor circuit, none of the past errors occurred for me.</p>
<p>So the issues seem to be with the Tor circuits and/or exit nodes, and not the build script.</p>
<p>Although workarounds like “-qN” might help massage uncooperative Tor circuits/nodes.</p>
<p>[hr]</p>
<p>I have my fingers crossed on this remaining 3rd VM still running the build script.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/15</link>
        <pubDate>Tue, 11 Nov 2014 16:42:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-15</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“nrgaway, post:12, topic:647”]I really don’t know why this is failing for you.  As I had previously stated I was able to build over Tor just by removing the [font=courier]-qN[/font] from the wget.</p>
<p>Seems like your Whonix gateway is not configured to allow ftp connections?[/quote]</p>
<p>Nope. Other FTP links work fine for me through my Whonix-Gateway.</p>
<aside class="quote" data-post="12" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>Try this link: <a href="http://pkgs.fedoraproject.org/repo/pkgs/xen/newlib-1.16.0.tar.gz/" data-bbcode="true" rel="nofollow noopener">http://pkgs.fedoraproject.org/repo/pkgs/xen/newlib-1.16.0.tar.gz</a> (replace in Makefile)</p>
</blockquote>
</aside>
<p>That link did not seem to point to a downloadable file. Rather a webpage.</p>
<p>Another alternative URL could be:</p>
<p><a href="http://xenbits.xen.org/xen-extfiles/newlib-1.16.0.tar.gz" class="onebox" target="_blank" rel="nofollow noopener">http://xenbits.xen.org/xen-extfiles/newlib-1.16.0.tar.gz</a></p>
<p>However, I’m wondering if alternative URLs might have problems with not providing expected signature files, as the original sources seem to.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/14</link>
        <pubDate>Tue, 11 Nov 2014 16:28:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-14</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="11" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>Were you able to successfully build both package yet?</p>
</blockquote>
</aside>
<p>Not yet.</p>
<p>[hr]</p>
<p>[quote=“nrgaway, post:11, topic:647”]Just so you know, the [font=courier]README.whonix[/font] is just a script that executes the [font=courier]Makefile[/font] process in  specific order, so after running it for the first time and you reach the spot that gives your your first error, you can manually choose to only run specific [font=courier]Makefile[/font] functions.  For example, once all the sources files are downloaded if you run the [font=courier]README.whonix[/font] again, it will attempt to download the sources again and merge them into existing sources (merged, not overwrite) but you can skip that step.</p>
<p>Following is a list of common [font=courier]Makefile[/font] commands:[/quote]</p>
<p>I had assumed something like this was the case. Just hadn’t looked into the internals much yet. Thanks for the tips!</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/13</link>
        <pubDate>Tue, 11 Nov 2014 16:18:57 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-13</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“WhonixQubes, post:10, topic:647”]Strange…</p>
<p>Still regarding <em>BUILDING OVER TOR</em> issues.</p>
<p>After addressing the “grub-0.97.tar.gz” package error with changing the ftp:// download link to http://…</p>
<p>The “grub-0.97.tar.gz” fatal error is still occurring, despite successful download over http with Tor.</p>
<p>However, another problem package that is not consistently downloading is “newlib-1.16.0.tar.gz”.</p>
<p>The download URL for this package is:</p>
<p><a href="http://forums.whonix.org">ftp://sources.redhat.com/pub/newlib/newlib-1.16.0.tar.gz</a></p>
<p>Unfortunately that server does not seem to accept alternative http:// URLs instead (Not Found: 404 Error).</p>
<p>Anyway, maybe this is a dependent or related package to grub?</p>
<p>Because upon “grub-0.97.tar.gz” downloading successfully, but “newlib-1.16.0.tar.gz” failing, the same fatal error as before is thrown:</p>
<aside class="quote">
<blockquote>
<p>make[1]: *** [grub-0.97.tar.gz] Error 4<br>
make: *** [get-sources] Error 1</p>
</blockquote>
</aside>
<p>I’ve seen this error scenario happen 10+ times now, but I think, if I recall, I have seen the “newlib-1.16.0.tar.gz” package go through over Tor once or twice before.</p>
<p>Maybe just fickle Tor blocking policies on web servers?</p>
<p>Maybe another source domain URL has to be found for me to correct this error.[/quote]</p>
<p>I really don’t know why this is failing for you.  As I had previously stated I was able to build over Tor just by removing the [font=courier]-qN[/font] from the wget.</p>
<p>Seems like your Whonix gateway is not configured to allow ftp connections?</p>
<p>Try this link: <a href="http://pkgs.fedoraproject.org/repo/pkgs/xen/newlib-1.16.0.tar.gz/" data-bbcode="true" rel="nofollow noopener">http://pkgs.fedoraproject.org/repo/pkgs/xen/newlib-1.16.0.tar.gz</a> (replace in Makefile)</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/12</link>
        <pubDate>Tue, 11 Nov 2014 12:12:36 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-12</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“WhonixQubes, post:9, topic:647”]Another <em>BUILDING OVER TOR</em> consistent fatal package error I receive is with the “grub-0.97.tar.gz” package.</p>
<aside class="quote">
<blockquote>
<p>GRUB_URL := <a href="http://forums.whonix.org">ftp://alpha.gnu.org/gnu/grub/$(GRUB_FILE)</a></p>
</blockquote>
</aside>
<p>to:</p>
<p>[quote]<br>
GRUB_URL := <a href="http://alpha.gnu.org/gnu/grub/%24(GRUB_FILE)" rel="nofollow noopener">http://alpha.gnu.org/gnu/grub/$(GRUB_FILE)</a><br>
[/quote][/quote]</p>
<p>Another strange error.  It did not happen for me but good to know you were able to work around it and you might as well just edit the file to make that change anyway while you are in it to remove the [font=courier]-qN.[/font]</p>
<p>Were you able to successfully build both package yet?</p>
<p>[HR]</p>
<p>Just so you know, the [font=courier]README.whonix[/font] is just a script that executes the [font=courier]Makefile[/font] process in  specific order, so after running it for the first time and you reach the spot that gives your your first error, you can manually choose to only run specific [font=courier]Makefile[/font] functions.  For example, once all the sources files are downloaded if you run the [font=courier]README.whonix[/font] again, it will attempt to download the sources again and merge them into existing sources (merged, not overwrite) but you can skip that step.</p>
<p>Following is a list of common [font=courier]Makefile[/font] commands:</p>
<p>To get the source files required to build templates.  If sources already exist and new changes will be merged with existing sources.  All source files (with exception to my personal branches which are not signed since they are temporary and will end up in Qubes repo) are verified automatically on download.  If verification fails, the download process will exit with an error stating as such.</p>
<pre><code class="lang-auto"></code></pre>
<p>To build the Qubes modules that are requires to allow Whonix to operate as an AppVM.  No harm in re-running this command either</p>
<pre><code class="lang-auto"></code></pre>
<p>To actually build the Whonix template (uses [font=courier]debootstrap[/font] to first download a base Debian system which is also verified, then load Whonix and finally the Qubes modules and then creates an RPM so you can install it via dom0).  If you are interested all the template code to build Whonix is located in ‘[font=courier]~/qubes-builder/qubes-src/linux-template-builder/scripts_debian[/font]’</p>
<pre><code class="lang-auto"></code></pre>
<p>Now, if you want to clean the sources, there are about 3 different commands you can you, each cleaning a bit more than the other</p>
<pre><code class="lang-auto">make clean
make mostlyclean
make clean-all</code></pre>
<p>[font=courier]clean[/font] just removes complied source code. [font=courier]mostlyclean[/font] pretty much removes everything except the downloaded source files. [font=courier]clean-all[/font], removes everything including source.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/11</link>
        <pubDate>Tue, 11 Nov 2014 12:00:44 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-11</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Strange…</p>
<p>Still regarding <em>BUILDING OVER TOR</em> issues.</p>
<p>After addressing the “grub-0.97.tar.gz” package error with changing the ftp:// download link to http://…</p>
<p>The “grub-0.97.tar.gz” fatal error is still occurring, despite successful download over http with Tor.</p>
<p>However, another problem package that is not consistently downloading is “newlib-1.16.0.tar.gz”.</p>
<p>The download URL for this package is:</p>
<p><a href="http://forums.whonix.org">ftp://sources.redhat.com/pub/newlib/newlib-1.16.0.tar.gz</a></p>
<p>Unfortunately that server does not seem to accept alternative http:// URLs instead (Not Found: 404 Error).</p>
<p>Anyway, maybe this is a dependent or related package to grub?</p>
<p>Because upon “grub-0.97.tar.gz” downloading successfully, but “newlib-1.16.0.tar.gz” failing, the same fatal error as before is thrown:</p>
<blockquote>make[1]: *** [grub-0.97.tar.gz] Error 4
make: *** [get-sources] Error 1</blockquote>
<p>I’ve seen this error scenario happen 10+ times now, but I think, if I recall, I have seen the “newlib-1.16.0.tar.gz” package go through over Tor once or twice before.</p>
<p>Maybe just fickle Tor blocking policies on web servers?</p>
<p>Maybe another source domain URL has to be found for me to correct this error.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/10</link>
        <pubDate>Tue, 11 Nov 2014 11:41:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-10</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Another <em>BUILDING OVER TOR</em> consistent fatal package error I receive is with the “grub-0.97.tar.gz” package.</p>
<blockquote>make[1]: *** [grub-0.97.tar.gz] Error 4
make: *** [get-sources] Error 1</blockquote>
<p>The URL used for downloading this package is:</p>
<p><a href="http://forums.whonix.org">ftp://alpha.gnu.org/gnu/grub/grub-0.97.tar.gz</a></p>
<p>This ftp;// URL and Tor do not work well together and I never got it to download successfully, even after the “-qN” fix.</p>
<p>[Note: Other ftp:// package URLs do successfully work in this build script, so might just be an issue with this “<a href="http://alpha.gnu.org" rel="nofollow noopener">alpha.gnu.org</a>” domain/website.]</p>
<p>Thankfully this can easily be solved by changing the URL to use the http:// protocol instead.</p>
<p>Documentation of process:</p>
<p>After running “qubes-builder/README.whonix” the first time, it generates the “qubes-builder/qubes-src/vmm-xen/” directories and files, and throws the fatal “grub-0.97.tar.gz” package error:</p>
<blockquote>make[1]: *** [grub-0.97.tar.gz] Error 4
make: *** [get-sources] Error 1</blockquote>
<p>After that, edit “qubes-builder/qubes-src/vmm-xen/Makefile”:</p>
<p>Change the following line from:</p>
<blockquote>GRUB_URL := ftp://alpha.gnu.org/gnu/grub/$(GRUB_FILE)</blockquote>
<p>to:</p>
<blockquote>GRUB_URL := http://alpha.gnu.org/gnu/grub/$(GRUB_FILE)</blockquote>
<p>Save change.</p>
<p>Then run the build script again: “qubes-builder/README.whonix”</p>
<p>Note: this can and should be done at the same time as doing the “xen-4.1.6.1.tar.gz” package “-qN” fix, described here: <a href="https://www.whonix.org/forum/index.php/topic,694.msg5407.html#msg5407" rel="nofollow noopener">https://www.whonix.org/forum/index.php/topic,694.msg5407.html#msg5407</a></p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/9</link>
        <pubDate>Tue, 11 Nov 2014 09:33:20 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-9</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“nrgaway, post:7, topic:647”]I did come across the same issue as you but was able to solve it and build successfully.</p>
<pre><code class="lang-auto"># Assuming you are already in the qubes-builder directory:
cd qubes-src/vmm-xen
vi Makefile  # Or use any editor like nano

# search for wget, there is only one and change it from:
@wget -qN  $(URL) $(U...
# to
@wget $(URL) $(U...

# And save the file</code></pre>
<p>So, really all I did was remove the -qN and it started to work.  N turns on time-stamping.  Really don’t know why it does not work with that option on, but it worked with it off.[/quote]</p>
<p>Confirmed. Removing -qN gets past that “xen-4.1.6.1.tar.gz” error for me as well when building over Tor. Thanks!</p>
<p>Documentation of process:</p>
<p>After running “qubes-builder/README.whonix” the first time, it generates the “qubes-builder/qubes-src/vmm-xen/” directories and files, and throws the fatal “xen-4.1.6.1.tar.gz” package error:</p>
<blockquote>--&gt; Downloading additional sources for vmm-xen...
+ make --quiet -C qubes-src/vmm-xen get-sources
make[1]: *** [xen-4.1.6.1.tar.gz] Error 4
make: *** [get-sources] Error 1
[user@appvm qubes-builder]$</blockquote>
<p>After that, edit “qubes-builder/qubes-src/vmm-xen/Makefile” with nrgaway’s instructions:</p>
<blockquote>Assuming you are already in the qubes-builder directory:
cd qubes-src/vmm-xen
vi Makefile  # Or use any editor like nano
<h1>search for wget, there is only one and change it from:</h1>
<p><span class="mention">@wget</span> -qN  $(URL) $(U…</p>
<h1>to</h1>
<p><span class="mention">@wget</span> $(URL) $(U…</p>
<h1>And save the file</h1>
</blockquote>
<p>Then run the build script again: “qubes-builder/README.whonix”</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/8</link>
        <pubDate>Tue, 11 Nov 2014 09:07:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-8</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>I finally had a bit of time to try building using the Qubes Whonix gateway.</p>
<p>I did come across the same issue as you but was able to solve it and build successfully.</p>
<pre><code class="lang-auto"># Assuming you are already in the qubes-builder directory:
cd qubes-src/vmm-xen
vi Makefile  # Or use any editor like nano

# search for wget, there is only one and change it from:
@wget -qN  $(URL) $(U...
# to
@wget $(URL) $(U...

# And save the file</code></pre>
<p>So, really all I did was remove the -qN and it started to work.  N turns on time-stamping.  Really don’t know why it does not work with that option on, but it worked with it off.</p>
<p>The gateway seems to be working nicely.  Only a few more issues to go then I will update it from 9.2.  One weird issue is that some process keeps turning IP forwarding back on.  I thought I had it sorted with Marek, but will have to dig a bit deeper.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/7</link>
        <pubDate>Mon, 10 Nov 2014 04:59:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-7</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>FYI: Error Observation…</p>
<p>Regarding the timeframe of behavior…</p>
<p>It usually takes about 15 to 20+ minutes between the beginning of this step:</p>
<blockquote>--&gt; Downloading additional sources for vmm-xen...
+ make --quiet -C qubes-src/vmm-xen get-sources</blockquote>
<p>and the fatal error output:</p>
<blockquote>make[1]: *** [xen-4.1.6.1.tar.gz] Error 4
make: *** [get-sources] Error 1</blockquote>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/6</link>
        <pubDate>Fri, 07 Nov 2014 04:23:11 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-6</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="4" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>Is your Tor netvm the Whonix gateway or the Qubes Tor gateway?</p>
</blockquote>
</aside>
<p>Different… Using Whonix-Gateway in a separate physically isolated box.</p>
<aside class="quote" data-post="4" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>Is transparent TransPort working in the AppVM?</p>
</blockquote>
</aside>
<p>Yes, via physical isolation.</p>
<aside class="quote" data-post="4" data-topic="647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/n/f17d59/40.png" class="avatar"> nrgaway:</div>
<blockquote>
<p>I will take a look later today building over Tor as I have not done so yet.</p>
</blockquote>
</aside>
<p>Ok, sounds good. Will be interested to see your results with this.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/5</link>
        <pubDate>Thu, 06 Nov 2014 23:50:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-5</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“WhonixQubes, post:2, topic:647”]Using latest “whonix” git branch, all my previous mentioned build errors are now gone.</p>
<p>Next fatal build error I’m now encountering…</p>
<p>I’ve tried building ~20 times and every time I get this fatal error:</p>
<aside class="quote">
<blockquote>
<p>–&gt; Downloading additional sources for vmm-xen…</p>
<ul>
<li>make --quiet -C qubes-src/vmm-xen get-sources<br>
make[1]: *** [xen-4.1.6.1.tar.gz] Error 4<br>
make: *** [get-sources] Error 1<br>
[user@appvm qubes-builder]$</li>
</ul>
</blockquote>
</aside>
<p>Difference experienced: Sometimes it’s “Error 4” or “Error 8” on that line…</p>
<aside class="quote">
<blockquote>
<p>make[1]: *** [xen-4.1.6.1.tar.gz] Error 4</p>
</blockquote>
</aside>
<aside class="quote">
<blockquote>
<p>make[1]: *** [xen-4.1.6.1.tar.gz] Error 8</p>
</blockquote>
</aside>
<p>[hr]</p>
<p>Speculative theory…</p>
<p>I’m building over Tor, so maybe that “xen-4.1.6.1.tar.gz” package is large and the script downloading it is not robust or patient enough for a Tor connection?</p>
<p>[FYI: Unrelated anecdotal: I was experiencing similar intermittent problems with packages not downloading over Tor upon first attempt with the Whonix --install-to-root, so Patrick built in an “auto retry” capability to help mitigate such fatal package download issues over Tor in Whonix 10 and beyond.]</p>
<p>I haven’t been able to look into it much yet, so that’s just my guess about what’s happening.</p>
<p>But 20 for 20 build attempts failed on this error for me so far.</p>
<p>Using:</p>
<ul>
<li>Qubes R2</li>
<li>Tor Connection</li>
<li>Clean AppVM</li>
<li>Fully Updated fedora-20-x64</li>
<li>Latest “whonix” Git Branch</li>
</ul>
<p>Build Steps:</p>
<p>[code]<br>
git clone <a href="https://github.com/nrgaway/qubes-builder" rel="nofollow noopener">https://github.com/nrgaway/qubes-builder</a><br>
cd qubes-builder/<br>
git fetch<br>
git checkout whonix<br>
./README.whonix</p>
<ul>
<li>Answer y  to yum update question<br>
[/code][/quote]</li>
</ul>
<p>Very strange.</p>
<p>Is your Tor netvm the Whonix gateway or the Qubes Tor gateway?</p>
<p>Is transparent TransPort working in the AppVM?</p>
<p>I will take a look later today building over Tor as I have not done so yet.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/4</link>
        <pubDate>Thu, 06 Nov 2014 17:23:29 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-4</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“WhonixQubes, post:2, topic:647”]Speculative theory…</p>
<p>I’m building over Tor, so maybe that “xen-4.1.6.1.tar.gz” package is large and the script downloading it is not robust or patient enough for a Tor connection?[/quote]</p>
<p>I just briefly looked inside the code to find the source of the “xen-4.1.6.1.tar.gz” package.</p>
<p>In “/qubes-builder/qubes-src/vmm-xen/Makefile” it shows the source URL as being:</p>
<p><a href="http://bits.xensource.com/oss-xen/release/4.1.6.1/xen-4.1.6.1.tar.gz" class="onebox" target="_blank" rel="nofollow noopener">http://bits.xensource.com/oss-xen/release/4.1.6.1/xen-4.1.6.1.tar.gz</a></p>
<p>That package is 9.9 MB, so it is at least not very large.</p>
<p>But it could take up to a few minutes based on the Tor connection.</p>
<p>Just tested: 2m 37s download over Tor using wget in a same build AppVM as error received.</p>
<p>I see in “/qubes-builder/qubes-src/vmm-xen/xen.spec” that primary xen package looks like the first download from that domain, so I wonder if the other packages would successfully download from that website over Tor if the script were to get past the first failed package. Might try out-commenting the first one and see about the remaining ones next.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/3</link>
        <pubDate>Thu, 06 Nov 2014 07:13:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-3</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[WhonixQubes]]></dc:creator>
        <description><![CDATA[
            <p>Using latest “whonix” git branch, all my previous mentioned build errors are now gone.</p>
<p>Next fatal build error I’m now encountering…</p>
<p>I’ve tried building ~20 times and every time I get this fatal error:</p>
<blockquote>--&gt; Downloading additional sources for vmm-xen...
+ make --quiet -C qubes-src/vmm-xen get-sources
make[1]: *** [xen-4.1.6.1.tar.gz] Error 4
make: *** [get-sources] Error 1
[user@appvm qubes-builder]$</blockquote>
<p>Difference experienced: Sometimes it’s “Error 4” or “Error 8” on that line…</p>
<blockquote>make[1]: *** [xen-4.1.6.1.tar.gz] Error 4</blockquote>
<blockquote>make[1]: *** [xen-4.1.6.1.tar.gz] Error 8</blockquote>
<p>[hr]</p>
<p>Speculative theory…</p>
<p>I’m building over Tor, so maybe that “xen-4.1.6.1.tar.gz” package is large and the script downloading it is not robust or patient enough for a Tor connection?</p>
<p>[FYI: Unrelated anecdotal: I was experiencing similar intermittent problems with packages not downloading over Tor upon first attempt with the Whonix --install-to-root, so Patrick built in an “auto retry” capability to help mitigate such fatal package download issues over Tor in Whonix 10 and beyond.]</p>
<p>I haven’t been able to look into it much yet, so that’s just my guess about what’s happening.</p>
<p>But 20 for 20 build attempts failed on this error for me so far.</p>
<p>Using:</p>
<ul>
<li>Qubes R2</li>
<li>Tor Connection</li>
<li>Clean AppVM</li>
<li>Fully Updated fedora-20-x64</li>
<li>Latest “whonix” Git Branch</li>
</ul>
<p>Build Steps:</p>
<pre><code class="lang-auto">git clone https://github.com/nrgaway/qubes-builder
cd qubes-builder/
git fetch
git checkout whonix
./README.whonix
  - Answer y &lt;enter&gt; to yum update question</code></pre>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/2</link>
        <pubDate>Thu, 06 Nov 2014 06:34:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-2</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
      <item>
        <title>Building Whonix in Qubes</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>Following are instructions to build whonix-gateway and whonix-workstation templates within a Qubes AppVM.  Note that an install-able template will be available soon that you can install directly in dom0 using ‘[font=courier]qubes-dom0-update[/font]’ instead of needing to build from source.</p>
<p>I just re-ran the following steps and confirm they worked for me:</p>
<p>[ul][li]First I suggest you start completely over with a brand new AppVM.  I named mine <span class="bbcode-i">development-qubes</span>.  Base it on the ‘<span class="bbcode-i">Fedora-20-x64</span>’ template.[/li]<br>
[li]Start AppVM from Qubes Manager[/li]<br>
[li]Start a <span class="bbcode-b">Dom0</span> Konsole session[/li]<br>
[li]Increase disk size to 10GB per VM you going to build, so in Dom0 Konsole type ‘[font=courier]qvm-grow-private devleopment-qubes 25GB[/font]’[/li]<br>
[li]Start a Terminal session for new AppVM (development-qubes) and enter the following:[/li][/ul]</p>
<pre><code class="lang-auto">git clone https://github.com/nrgaway/qubes-builder
cd qubes-builder/
git fetch
git checkout whonix
./README.whonix
  - Answer y &lt;enter&gt; to yum update question</code></pre>
<p>Those steps will build both the gateway and workstation.  You can edit ‘[font=courier]examples/whonix.conf[/font]’ (which will be linked as ‘[font=courier]builder.conf[/font]’ after running script) to change build options to build wheezy or jessie or add gnome to those as well (just un-comment out lines you want to build).</p>
<p>There should be no issues listed previously in this thread for any distro except Whonix can not yet update from template and you SHOULD run both the gateway and workstation as standalone until the update situation is resolved.</p>
<p>So, once the templates are built, the last line explains how to get them to Dom0.  I actually save that line and created a script in Dom0 I use anytime I need to grab templates I built.  So you can edit a file named ‘get-templates.sh’ on dom0 and include the following"</p>
<pre><code class="lang-auto">#!/bin/bash

qvm-run --pass-io development-qubes 'cat /home/user/qubes-builder/qubes-src/linux-template-builder/rpm/install-templates.sh' &gt; install-templates.sh
chmod a+x install-templates.sh</code></pre>
<p>Then make the file executable and run it to grab and install the templates on dom0</p>
<pre><code class="lang-auto">cd ~
mkdir bin
cd bin
vi get-templates.sh # Add text above
chattr a+x get-templates.sh
./get-templates.sh
cd /tmp
/home/user/bin/get-templates.sh # Grabs install script
./install-template.sh # Will download template rpm; remove old one (if installed); install new ones</code></pre>
<p>In order to get the text I listed to dom0, here is a trick I figured out.</p>
<pre><code class="lang-auto">- Highlight text you want to copy.
- Right click with mouse and select 'copy'
- Press &lt;SHIFT&gt;+&lt;CTRL&gt;+&lt;C&gt;
- in dom0 Konsole type 'cat /run/qubes/qubes-clipboard.bin'
- the text you just copied will be displayed in dom0 terminal so now you can highlight it from dom0 terminal and paste it where ever</code></pre>
<p>[HR]</p>
<p>Qubes manager options to select for gateway:</p>
<p>[ul][li]Name: whonix-gateway[/li]<br>
[li]Template: whonix-gateway-experimental[/li]<br>
[li]Type: Proxy VM[/li]<br>
[li]NetVM: firewallvm[/li]<br>
[li]Check Standalone[/li][/ul]</p>
<p>[ul][li]Name: whonix-workstation[/li]<br>
[li]Template: whonix-workstation-experimental[/li]<br>
[li]Type: AppVM[/li]<br>
[li]NetVM: whonix-gateway[/li]<br>
[li]Check Standalone[/li][/ul]</p>
<p>[HR]</p>
<p>Start the gateway from Qubes Manager.  The setup screen should come up and ask you about repo and starting Tor.  Note that the first two screens where it displays disclaimer that the buttons are not visible, so just press [font=courier][/font], then [font=courier][/font] again for second screen.  If you happen to not press [font=courier][/font], or somehow focus gets messed up, VM will power off so you will need to try again.</p>
<p>When you are finished setup, if you get an error message from time proxy or that tor can not do a check since bootstrap not complete, try running ‘[font=courier]whonixcheck[/font]’ again, and it should succeed.</p>
<p>Do same for Workstation.  Or you can use a regular AppVM and just select ‘[font=courier]whonix-gateway[/font]’ as its netvm.</p>
<p>Note the first run dialog says the  password is ‘[font=courier]changeme[/font]’ when there is actually no password as per Qubes defaults.</p>
<p>[HR]</p>
<p>Some issues with Whonix applications:</p>
<p>[ul][li]Some don’t run maybe?[/li]<br>
[li]Stuff like tor browser may need to be started from terminal at this point[/li]<br>
[li]???[/li][/ul]</p>
<p>[HR]</p>
<p><span class="bbcode-b">So now you have your whonix-gateway and whonix-workstation installed remember it is <span class="bbcode-u"><span class="bbcode-i">experimental</span></span> at this point.</span></p>
<p>[HR]</p>
<p>Test and keep a log of issues that need to be addressed and things that work compared to HVM version.</p>
<p>Do leak tests and report results.  This is important.</p>
<p><span class="bbcode-b">Don’t use it for anything important yet until leak tests, etc are confirmed.</span></p>
<p>Please post any build issues or questions in this thread.</p>
          <p><a href="http://forums.whonix.org/t/building-whonix-in-qubes/647/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/building-whonix-in-qubes/647/1</link>
        <pubDate>Wed, 05 Nov 2014 00:47:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-647-1</guid>
        <source url="http://forums.whonix.org/t/building-whonix-in-qubes/647.rss">Building Whonix in Qubes</source>
      </item>
  </channel>
</rss>
