<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor - Development - Whonix Forum</title>
    <meta name="description" content="I started on rewriting CPFP in python, based on the Tails script at https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/usr/local/sbin/tor-controlport-filter. 

Still at an early stage, but it looks pro&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="533fdb0.html?page=4" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor&#39;" href="533.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/control-port-filter-proxy-python-cpfpy-anon-ws-disable-stacked-tor/533?page=4" />
<meta name="twitter:url" content="https://forums.whonix.org/t/control-port-filter-proxy-python-cpfpy-anon-ws-disable-stacked-tor/533?page=4" />
<meta property="og:title" content="Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor" />
<meta name="twitter:title" content="Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor" />
<meta property="og:description" content="I think if we have to bend existing scripts that are users of python-stem just because we rewrote CPFP, then we’re doing something fatally wrong. That seems to mix up abstraction levels. CPFP is supposed to be as transparent as possible. So any application that makes use of Tor ControlPort, using python-stem or not, at best won’t even notice it. Any scripts / applications not developed by Whonix (ex: onionshare or whatever) should not need any further changes than the required white list additio..." />
<meta name="twitter:description" content="I think if we have to bend existing scripts that are users of python-stem just because we rewrote CPFP, then we’re doing something fatally wrong. That seems to mix up abstraction levels. CPFP is supposed to be as transparent as possible. So any application that makes use of Tor ControlPort, using python-stem or not, at best won’t even notice it. Any scripts / applications not developed by Whonix (ex: onionshare or whatever) should not need any further changes than the required white list additio..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="26 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />
<meta property="article:published_time" content="2014-10-07T20:57:15+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="5339ba9.html?page=3">
        <link rel="next" href="533af4d.html?page=5">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="533.html">Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-07T20:57:15Z' class='post-time'>
                October 7, 2014,  8:57pm
              </time>
              <meta itemprop='dateModified' content='2014-10-07T20:57:15Z'>
          <span itemprop='position'>#61</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I think if we have to bend existing scripts that are users of python-stem just because we rewrote CPFP, then we’re doing something fatally wrong. That seems to mix up abstraction levels. CPFP is supposed to be as transparent as possible. So any application that makes use of Tor ControlPort, using python-stem or not, at best won’t even notice it. Any scripts / applications not developed by Whonix (ex: onionshare or whatever) should not need any further changes than the required white list additions.</p>
<blockquote>It is necessary because stem being in CPFP, the Workstation was using stem over stem.</blockquote>
What's the issue with using python-stem over python-stem? If it's all rightly implemented, those implementations shouldn't notice or care?
<blockquote>If all requests were channeled through CPFP, the same, more robust exception handling would be used.</blockquote>
If we want the same error handling everywhere, we could go for a shared python file.
<blockquote>All exceptions are returned to the client, so may be some of them could be parsed in whonixcheck.</blockquote>
In it's default mode, it should mimic Tor's real ControlPort as closely as possible for 100% compatibility and not send extra messages. Non-standard messages cause confusing error messages (for example in Tor Browser). For applications that know CPFP (from anon-shared-helper-scripts), they could perhaps authenticate using a special authentication password/extra keyword or so, and then they could use the "extended protocol" with extra messages.
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-13T20:07:07Z' class='post-time'>
                October 13, 2014,  8:07pm
              </time>
              <meta itemprop='dateModified' content='2014-10-13T20:07:07Z'>
          <span itemprop='position'>#62</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Points taken. I realize that the modifications are going too far. We can fully mimic Tor control port. without extra error messages returned, and probably add some extended protocol for the anon-share-helper-scripts.</p>
<p>I am back to the original branch. Pushed a small modification (“request.startswith” for authentification). <a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/commit/6792958e1c7e47b8e87d4566a41aeff6c1e56a4d" rel="nofollow noopener">https://github.com/troubadoour/control-port-filter-python/commit/6792958e1c7e47b8e87d4566a41aeff6c1e56a4d</a>.</p>
<p>What could be done from now:</p>
<ul>
<li>check that the config folder exists.</li>
<li>handle parallel connections.</li>
<li>stem over stem (needs some testing).</li>
<li>extended protocol (to be defined), if we need any.</li>
</ul>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-13T22:32:04Z' class='post-time'>
                October 13, 2014, 10:32pm
              </time>
              <meta itemprop='dateModified' content='2014-10-13T22:32:04Z'>
          <span itemprop='position'>#63</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Sounds good.</p>
<p>I guess stem over stem will work just fine. If not, I would really wonder and that should be considered a bug.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-13T22:40:01Z' class='post-time'>
                October 13, 2014, 10:40pm
              </time>
              <meta itemprop='dateModified' content='2014-10-13T22:40:01Z'>
          <span itemprop='position'>#64</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>I guess stem over stem will work just fine. If not, I would really wonder and that should be considered a bug.</blockquote>
<p>stem over stem should work. It seems to be a matter of what command to use. “controller.GET_INFO(“request”)” does not give the same output format as “controller.msg(“GETINFO request”)”.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-13T22:56:09Z' class='post-time'>
                October 13, 2014, 10:56pm
              </time>
              <meta itemprop='dateModified' content='2014-10-13T22:56:09Z'>
          <span itemprop='position'>#65</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>The one is in parsed format, the other (from Damian’s mail) is raw format?</p>
<p>Anyhow. Existing anon-shared-helper-scripts from Whonix 9.x shouldn’t require changes because of replacing cpfp-bash with cpfp-python. Any improvements to them would be off-topic bonuses.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-15T21:20:18Z' class='post-time'>
                October 15, 2014,  9:20pm
              </time>
              <meta itemprop='dateModified' content='2014-10-15T21:20:18Z'>
          <span itemprop='position'>#66</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>The one is in parsed format, the other (from Damian's mail) is raw format?</blockquote>
<p>No, I rephrase: the format is the same, but the one from Damian adds a line “OK”, which confuses the anon-share-helper-scripts. But I’m not there yet.</p>
<p>If the configuration folder does not exist, do we stop CPFP or do we run it with a default hard coded configuration, the one in “30_controlportfilt_default”?</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-16T00:31:30Z' class='post-time'>
                October 16, 2014, 12:31am
              </time>
              <meta itemprop='dateModified' content='2014-10-16T00:31:30Z'>
          <span itemprop='position'>#67</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="66" data-topic="533">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/d9b06d/40.png" class="avatar"> troubadour:</div>
<blockquote>
<p>[quote]The one is in parsed format, the other (from Damian’s mail) is raw format?</p>
</blockquote>
</aside>
<p>No, I rephrase: the format is the same, but the one from Damian adds a line “OK”, which confuses the anon-share-helper-scripts. But I’m not there yet.[/quote]<br>
The “OK” line is Tor ControlPort’s raw answer. stem is only relaying this, I think.</p>
<p>If anon-share-helper-scripts (python-stem) gets confused by it, this is a bug in cpfp-python.</p>
<p>For debugging such bugs one developers-only option might help: disable all filtering. We can either add this as an option or temporary disable the related code during development phase ourselves.</p>
<p>As said earlier, the ultimate test for any cpfp for relying bug freeness is running <code>arm</code> trough it. (While having filtering temporarily disabled.) <code>Arm</code> is a much better test candidate than anon-shared-helper scripts, because <code>arm</code> is not written by us and because it is quite picky (knowing this from cpfp-bash development) (about things like a minor missing \r) and using a lot Tor ControlPort commands.</p>
<p>[Let cpfp listen on gateway only while having filtering disabled for better security during development.]</p>
<aside class="quote" data-post="66" data-topic="533">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/d9b06d/40.png" class="avatar"> troubadour:</div>
<blockquote>
<p>If the configuration folder does not exist, do we stop CPFP or do we run it with a default hard coded configuration, the one in “30_controlportfilt_default”?</p>
</blockquote>
</aside>
<p>Using hardcoded defaults is the proper and policy conform way to design (Debian) Linux daemons. (This is a small bug in cpfp-bash.) And as a bonus perhaps making a note in the log as part of the startup log message.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-16T19:47:26Z' class='post-time'>
                October 16, 2014,  7:47pm
              </time>
              <meta itemprop='dateModified' content='2014-10-16T19:47:26Z'>
          <span itemprop='position'>#68</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I changed the socket to a TCP server on the server side of CPFP. It should accept parallel connections.<br>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/commit/4deb3d30a1eb208480cedaca333ee815ad24500e" target="_blank" rel="nofollow noopener">github.com/troubadoour/control-port-filter-python</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/commit/4deb3d30a1eb208480cedaca333ee815ad24500e" target="_blank" rel="nofollow noopener">Replaced TCP socket with TCP server on the server side.</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2014-10-16" data-time="19:18:13" data-timezone="UTC">07:18PM - 16 Oct 14 UTC</span>
      </div>

      <div class="user">
        <a href="../../../external.html?link=https://github.com/troubadoour" target="_blank" rel="nofollow noopener">
          <img alt="troubadoour" src="../../../external.html?link=https://avatars0.githubusercontent.com/u/7442918?v=4" class="onebox-avatar-inline" width="20" height="20">
          troubadoour
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 186 additions and 209 deletions">
        <a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/commit/4deb3d30a1eb208480cedaca333ee815ad24500e" target="_blank" rel="nofollow noopener">
          <span class="added">+186</span>
          <span class="removed">-209</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">CPFP handles parallel connections.</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<blockquote>Using hardcoded defaults is the proper and policy conform way to design (Debian) Linux daemons. (This is a small bug in cpfp-bash.)</blockquote>
<p>Going to add the hardcoded defaults.</p>
<blockquote>And as a bonus perhaps making a note in the log as part of the startup log message.</blockquote>
<p>Do you mean a note telling the configuration used (default or from file)? And we do not have a log as such, it’s only a “print” statement.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-16T22:40:29Z' class='post-time'>
                October 16, 2014, 10:40pm
              </time>
              <meta itemprop='dateModified' content='2014-10-16T22:40:29Z'>
          <span itemprop='position'>#69</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="68" data-topic="533">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/d9b06d/40.png" class="avatar"> troubadour:</div>
<blockquote>
<p>Do you mean a note telling the configuration used (default or from file)?</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote" data-post="68" data-topic="533">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/d9b06d/40.png" class="avatar"> troubadour:</div>
<blockquote>
<p>And we do not have a log</p>
</blockquote>
</aside>
<p>Not yet, but it would be useful to have something similar to /var/log/controlportfilt.log.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-17T20:22:25Z' class='post-time'>
                October 17, 2014,  8:22pm
              </time>
              <meta itemprop='dateModified' content='2014-10-17T20:22:25Z'>
          <span itemprop='position'>#70</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Pushed <a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/commit/1ddf5df96e7879ae7b6b839cecf4f6a744dc8540" rel="nofollow noopener">https://github.com/troubadoour/control-port-filter-python/commit/1ddf5df96e7879ae7b6b839cecf4f6a744dc8540</a> (hardcoded configuration).</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-17T21:41:16Z' class='post-time'>
                October 17, 2014,  9:41pm
              </time>
              <meta itemprop='dateModified' content='2014-10-17T21:41:16Z'>
          <span itemprop='position'>#71</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I think there might be an issue with the “lie” around here:<br>
<a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/blob/master/usr/lib/cpfp.py#L75" class="onebox" target="_blank">https://github.com/troubadoour/control-port-filter-python/blob/master/usr/lib/cpfp.py#L75</a><br>
A socket has been opened above, but because of “return(‘250-net/listeners/socks=“127.0.0.1:9150”\n’)” it will never be closed below. I think moving the lie/return right below " with open(AUTH_COOKIE, “rb”) as f:" would solve this.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-17T21:58:29Z' class='post-time'>
                October 17, 2014,  9:58pm
              </time>
              <meta itemprop='dateModified' content='2014-10-17T21:58:29Z'>
          <span itemprop='position'>#72</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I distinguish between points,</p>
<ol>
<li>we really should do to have a robust implementation so cpfp-py can replace cpfp-bash, and</li>
<li>things that are minor/bonus, possible further work/patches welcome.</li>
</ol>
<p>[hr]</p>
<p>One minor/bonus point:<br>
This is a minor/bonus point, because cpfp-bash doesn’t do this either.</p>
<p>What is non-ideal at the moment, that for an open connection from a client, we read that line by line, and for each line that passes the white list we open a Tor ControlPort connection, authenticate, pass the request, read the answer, replay the answer to the client, then and close that ControlPort connection.</p>
<p>To be much more efficient, much better emulate Tor ControlPort, we would only open a Tor ControlPort connection once a client connects, and close that one once the client sends “QUIT” and/or disconnects. During that period we pass legitimate ControlPort commands to the already open and authenticated Tor ControlPort socket and relay the answer back to the client.</p>
<p>What would be the benefit? I think this is equired so clients could register for Tor ControlPort events. (Because I guess Tor does de-register the event as soon the related ControlPort connection is closed.)</p>
<p>When doing this, we would have to make sure that we are not mixing multiple client connections into the same Tor ControlPort connection.</p>
<p>Even if you don’t feel like implementing this, it would be good if we both understand what I am talking about here to better understand all this. Does that make sense?</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-18T18:37:56Z' class='post-time'>
                October 18, 2014,  6:37pm
              </time>
              <meta itemprop='dateModified' content='2014-10-18T18:37:56Z'>
          <span itemprop='position'>#73</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>[quote=“Patrick, post:71, topic:533”]I think there might be an issue with the “lie” around here:<br>
<a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/blob/master/usr/lib/cpfp.py#L75" class="onebox" target="_blank" rel="nofollow noopener">https://github.com/troubadoour/control-port-filter-python/blob/master/usr/lib/cpfp.py#L75</a><br>
A socket has been opened above, but because of “return(‘250-net/listeners/socks=“127.0.0.1:9150”\n’)” it will never be closed below. I think moving the lie/return right below " with open(AUTH_COOKIE, “rb”) as f:" would solve this.[/quote]</p>
<p>Yes, a design bug. I moved it before the “with…” block. <a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/commit/2174f9e6cad40fb55867bb0fe545372ec0cc32d5" rel="nofollow noopener">https://github.com/troubadoour/control-port-filter-python/commit/2174f9e6cad40fb55867bb0fe545372ec0cc32d5</a></p>
<p>Before answering you last post, I think I will add a parameter for disabling filtering, so that we can run arm through control port filter, as suggested in <a href="../../../external.html?link=https://www.whonix.org/forum/index.phptopic,560.msg4797.html#msg4797" rel="nofollow noopener">https://www.whonix.org/forum/index.phptopic,560.msg4797.html#msg4797</a>.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-18T23:09:46Z' class='post-time'>
                October 18, 2014, 11:09pm
              </time>
              <meta itemprop='dateModified' content='2014-10-18T23:09:46Z'>
          <span itemprop='position'>#74</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Sounds like a good approach.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-21T23:08:27Z' class='post-time'>
                October 21, 2014, 11:08pm
              </time>
              <meta itemprop='dateModified' content='2014-10-21T23:08:27Z'>
          <span itemprop='position'>#75</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Pushed <a href="../../../external.html?link=https://github.com/troubadoour/control-port-filter-python/commit/1358a3709c3f9afdc7d788cf38a9483bbf90bd67" rel="nofollow noopener">https://github.com/troubadoour/control-port-filter-python/commit/1358a3709c3f9afdc7d788cf38a9483bbf90bd67</a>.</p>
<p>Added CONTROL_PORT_FILTER_DISABLE_FILTERING. When set to ‘true’, all the request are passed to Tor control port and the answers are relayed back to the client transparently. I had to use ‘sock.recv’ instead the file like ‘sock.makefile’. When I started to test with arm, I was assuming that all the answers form control port where terminated with “250 OK”. It’s far from being the case, there are too many exceptions, hence ‘sock.recv’, which reads all the data available at once.</p>
<p>Except for an intermittent bug. Running several times “arm -i 10.152.152.10:9052” consecutively can crash arm. To reproduce it, you can run CPFP from kate, and run arm through CPFP several times. The requests and the answers are printed as they come.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-21T23:28:02Z' class='post-time'>
                October 21, 2014, 11:28pm
              </time>
              <meta itemprop='dateModified' content='2014-10-21T23:28:02Z'>
          <span itemprop='position'>#76</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>Even if you don't feel like implementing this, it would be good if we both understand what I am talking about here to better understand all this. Does that make sense?</blockquote>
<p>I believe I understand. First of all, I have removed the “QUIT” command form Tor control port side in CPFP. Everything works fine without it.</p>
<p>To make it by the book, I probably will have to send it from the anon-shared-helper-scripts, after the request. I 'll try to find out how TBB or arm handle that (how they supposedly de-register). For example, if a “QUIT” is sent when closing arm.</p>
<blockquote>When doing this, we would have to make sure that we are not mixing multiple client connections into the same Tor ControlPort connection.</blockquote>
<p>I guess the TCP server in CPFP is able to discriminate the connections. To be checked.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-21T23:51:32Z' class='post-time'>
                October 21, 2014, 11:51pm
              </time>
              <meta itemprop='dateModified' content='2014-10-21T23:51:32Z'>
          <span itemprop='position'>#77</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <ul>
<li>When clients write “QUIT”, CPFP should close the socket.</li>
<li>When clients close the socket without writing “QUIT”, CPFP should close the socket as well.</li>
</ul>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-22T14:51:38Z' class='post-time'>
                October 22, 2014,  2:51pm
              </time>
              <meta itemprop='dateModified' content='2014-10-22T14:51:38Z'>
          <span itemprop='position'>#78</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>- When clients write "QUIT", CPFP should close the socket.</blockquote>
<p>Since “QUIT” is in the whitelist, it’s passed to the control port as the other requests, closing the connection. But the “QUIT” catching in the handle function has to be removed.</p>
<pre><code class="lang-auto">            elif request == "QUIT":
                # Quit session (telnet...)
                self.wfile.write("250 Closing connection\n")
                break</code></pre>
<blockquote>- When clients close the socket without writing "QUIT", CPFP should close the socket as well.</blockquote>
<p>The control port socket is closed after each connection prior to returning the answer to the client.</p>
<pre><code class="lang-auto">            if DISABLE_FILTERING:
                # Some answers are longer than 8 Kb (arm).
                answer = sock.recv(16384)
            else:
                answer = sock.recv(MAX_LINESIZE)
            ~
            ~
            sock.close()

            return answer</code></pre>
<p>Writing “QUIT” looks redundant. It only returns “250 Closing connection” (with the above “QUIT” block commented out in “handle(self)”).</p>
<p>TBB and arm do not write “QUIT”.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-22T15:18:36Z' class='post-time'>
                October 22, 2014,  3:18pm
              </time>
              <meta itemprop='dateModified' content='2014-10-22T15:18:36Z'>
          <span itemprop='position'>#79</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Mistake, “QUIT” is not in the white list.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/troubadour'><span itemprop='name'>troubadour</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="533.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2014-10-22T15:41:13Z' class='post-time'>
                October 22, 2014,  3:41pm
              </time>
              <meta itemprop='dateModified' content='2014-10-22T15:41:13Z'>
          <span itemprop='position'>#80</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="78" data-topic="533">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/t/d9b06d/40.png" class="avatar"> troubadour:</div>
<blockquote>
<p>TBB and arm do not write “QUIT”.</p>
</blockquote>
</aside>
<p>But the anon-share-helper-scripts write “QUIT”, because of stem GETINFO.</p>
<p>Edit: if the request was successful.</p>
        </div>

        <meta itemprop='headline' content='Control Port Filter Proxy Python (cpfpy) / anon-ws-disable-stacked-tor'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="5339ba9.html?page=3">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="533af4d.html?page=5">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
