<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
    <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006</link>
    <description>Hello,

I have successfully [worked with](http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Separate_VPN-Gateway) a OpenVPN-over-Tor connection for quite a while with Qubes OS 4.0 and Whonix 15/16.
(NIC -&gt; Tor -&gt; VPN -&gt; Destination)

Unfortunately, with Qubes OS 4.1 there are issues. Other side effects can be excluded due to reproducible qubes installation. 

The issue also has been discussed in the Qubes forum in multiple posts:
- https://forum.qubes-os.org/t/user-tor-vpn-internet-4-1-broken
- https://forum.qubes-os.org/t/networking-broken-in-4-1-default-templates
- https://forum.qubes-os.org/t/tor-vpn-connection-issues-only-in-4-1-multiple-test-configurations-vpn-providers
- https://forum.qubes-os.org/t/r4-1-rc1-openvpn-issue-after-migration-from-r4-0

Fortunately, a user has [found](https://forum.qubes-os.org/t/user-tor-vpn-internet-4-1-broken/6900/5) a workaround:
&gt; TLDR: `sudo sysctl -w net.ipv4.ip_forward=1` in your whonix gateway will resolve it, until reboot. In your template, you can edit `/etc/sysctl.d/anonymizer-config-gateway.conf` and comment out the line `net.ipv4.ip_forward = 0`, and this should fix ARP requests not getting replies.

Now here comes my actual question (besides promoting some discussion about potential error causes):

**Do Whonix maintainers have any objections against this workaround from a privacy/security perspective?**

If OK, we might add this to the documentation http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Separate_VPN-Gateway for other users encountering same issue.

Thanks!</description>
    <language>en</language>
    <lastBuildDate>Fri, 22 Apr 2022 16:31:00 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
        <dc:creator><![CDATA[whonixfriend]]></dc:creator>
        <description><![CDATA[
            <p>Hi, apparently “vpn over tor” works in qubes - just put a firewall-qube between the vpn-proxy and the whonix-gateway.<br>
There was a post in the qubes-forum (<a href="https://forum.qubes-os.org/t/tor-vpn-connection-issues-only-in-4-1-multiple-test-configurations-vpn-providers/5606/13" class="inline-onebox" rel="noopener nofollow ugc">Tor &gt; VPN connection issues - only in 4.1 - multiple test configurations &amp; vpn providers - #13 by qubesfan35267 - 4.1 - Qubes OS Forum</a>).</p>
          <p><a href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/7</link>
        <pubDate>Fri, 22 Apr 2022 08:28:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13006-7</guid>
        <source url="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss">[Qubes 4.1] Tor -&gt; OpenVPN issues</source>
      </item>
      <item>
        <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Great research and bug report, thank you!</p>
          <p><a href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/6</link>
        <pubDate>Wed, 15 Dec 2021 15:09:32 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13006-6</guid>
        <source url="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss">[Qubes 4.1] Tor -&gt; OpenVPN issues</source>
      </item>
      <item>
        <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
        <dc:creator><![CDATA[unknown]]></dc:creator>
        <description><![CDATA[
            <p>Issue reported in <a href="https://github.com/QubesOS/qubes-issues/issues/7123" rel="noopener nofollow ugc">https://github.com/QubesOS/qubes-issues/issues/7123</a></p>
          <p><a href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/5</link>
        <pubDate>Wed, 15 Dec 2021 15:06:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13006-5</guid>
        <source url="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss">[Qubes 4.1] Tor -&gt; OpenVPN issues</source>
      </item>
      <item>
        <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Great finding!</p>
<p>You could report this issue on qubes-issues because nothing related in the Whonix configuration changed , no such issue with Non-Qubes-Whonix reported. Therefore some change between Qubes 4.0 and Qubes R4.1 might have caused this.</p>
<p>Might be a good idea to quote me on this so this doesn’t get assigned as a Qubes-Whonix specific bug.</p>
          <p><a href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/4</link>
        <pubDate>Wed, 15 Dec 2021 06:52:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13006-4</guid>
        <source url="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss">[Qubes 4.1] Tor -&gt; OpenVPN issues</source>
      </item>
      <item>
        <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
        <dc:creator><![CDATA[unknown]]></dc:creator>
        <description><![CDATA[
            <p>Thanks, this seems to be an important setting, if I understand you correctly.</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://forum.qubes-os.org/uploads/db3820/optimized/2X/5/55de5eaf64516902429c411f66491cc9db06c464_2_32x32.png" class="site-icon" width="16" height="16">

      <a href="https://forum.qubes-os.org/t/user-tor-vpn-internet-4-1-broken/6900/2?u=unknown" target="_blank" rel="noopener nofollow ugc" title="07:14PM - 14 October 2021">Qubes OS Forum – 14 Oct 21</a>
  </header>

  <article class="onebox-body">
    <img src="https://forum.qubes-os.org/uploads/db3820/original/1X/10549f9dff8a289d117f083e9f5155231c452db2.png" class="thumbnail onebox-avatar" width="24" height="24">

<h3><a href="https://forum.qubes-os.org/t/user-tor-vpn-internet-4-1-broken/6900/2?u=unknown" target="_blank" rel="noopener nofollow ugc">User -&gt; Tor -&gt; VPN -&gt; Internet - 4.1 broken?</a></h3>

  <p>I’ve found the solution! But unfortunately it isn’t a nice one. After starting openvpn session, we can see output of ip neigh:  bash-5.1# ip neigh show 10.137.0.6 dev eth0 lladdr fe:ff:ff:ff:ff:ff PERMANENT 212.129.0.80 dev eth0  INCOMPLETE   which...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>mentions a manual approach</p>
<pre><code class="lang-auto">ip neigh show
arp -s IP -i eth0 fe:ff:ff:ff:ff:ff
</code></pre>
<p>, which gets the job done, but needs intervention on each restart / server change.</p>
<p>I’ll add a post, if I should find out a better solution.</p>
          <p><a href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/3</link>
        <pubDate>Tue, 14 Dec 2021 22:07:06 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13006-3</guid>
        <source url="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss">[Qubes 4.1] Tor -&gt; OpenVPN issues</source>
      </item>
      <item>
        <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="unknown" data-post="1" data-topic="13006">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/u/4bbf92/40.png" class="avatar"> unknown:</div>
<blockquote>
<p><strong>Do Whonix maintainers have any objections against this workaround from a privacy/security perspective?</strong></p>
</blockquote>
</aside>
<p>Don’t use IP forwarding inside Whonix-Gateway. It’s a milestone that IP forwarding isn’t required and immensely reduces the risk of IP leaks. Elaborated here: <a href="https://www.whonix.org/wiki/Dev/Technical_Introduction#Security_Overview">Security Overview</a>, <a href="https://www.whonix.org/wiki/Dev/Technical_Introduction#With_more_technical_terms">With more technical terms</a>.</p>
          <p><a href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/2</link>
        <pubDate>Tue, 14 Dec 2021 18:57:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13006-2</guid>
        <source url="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss">[Qubes 4.1] Tor -&gt; OpenVPN issues</source>
      </item>
      <item>
        <title>[Qubes 4.1] Tor -&gt; OpenVPN issues</title>
        <dc:creator><![CDATA[unknown]]></dc:creator>
        <description><![CDATA[
            <p>Hello,</p>
<p>I have successfully <a href="http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Separate_VPN-Gateway" rel="noopener nofollow ugc">worked with</a> a OpenVPN-over-Tor connection for quite a while with Qubes OS 4.0 and Whonix 15/16.<br>
(NIC → Tor → VPN → Destination)</p>
<p>Unfortunately, with Qubes OS 4.1 there are issues. Other side effects can be excluded due to reproducible qubes installation.</p>
<p>The issue also has been discussed in the Qubes forum in multiple posts:</p>
<ul>
<li><a href="https://forum.qubes-os.org/t/user-tor-vpn-internet-4-1-broken" rel="noopener nofollow ugc">https://forum.qubes-os.org/t/user-tor-vpn-internet-4-1-broken</a></li>
<li><a href="https://forum.qubes-os.org/t/networking-broken-in-4-1-default-templates" rel="noopener nofollow ugc">https://forum.qubes-os.org/t/networking-broken-in-4-1-default-templates</a></li>
<li><a href="https://forum.qubes-os.org/t/tor-vpn-connection-issues-only-in-4-1-multiple-test-configurations-vpn-providers" rel="noopener nofollow ugc">https://forum.qubes-os.org/t/tor-vpn-connection-issues-only-in-4-1-multiple-test-configurations-vpn-providers</a></li>
<li><a href="https://forum.qubes-os.org/t/r4-1-rc1-openvpn-issue-after-migration-from-r4-0" rel="noopener nofollow ugc">https://forum.qubes-os.org/t/r4-1-rc1-openvpn-issue-after-migration-from-r4-0</a></li>
</ul>
<p>Fortunately, a user has <a href="https://forum.qubes-os.org/t/user-tor-vpn-internet-4-1-broken/6900/5" rel="noopener nofollow ugc">found</a> a workaround:</p>
<blockquote>
<p>TLDR: <code>sudo sysctl -w net.ipv4.ip_forward=1</code> in your whonix gateway will resolve it, until reboot. In your template, you can edit <code>/etc/sysctl.d/anonymizer-config-gateway.conf</code> and comment out the line <code>net.ipv4.ip_forward = 0</code>, and this should fix ARP requests not getting replies.</p>
</blockquote>
<p>Now here comes my actual question (besides promoting some discussion about potential error causes):</p>
<p><strong>Do Whonix maintainers have any objections against this workaround from a privacy/security perspective?</strong></p>
<p>If OK, we might add this to the documentation <a href="http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Separate_VPN-Gateway" rel="noopener nofollow ugc">http://www.dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Tunnels/Connecting_to_Tor_before_a_VPN#Separate_VPN-Gateway</a> for other users encountering same issue.</p>
<p>Thanks!</p>
          <p><a href="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006/1</link>
        <pubDate>Tue, 14 Dec 2021 17:12:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-13006-1</guid>
        <source url="http://forums.whonix.org/t/qubes-4-1-tor-openvpn-issues/13006.rss">[Qubes 4.1] Tor -&gt; OpenVPN issues</source>
      </item>
  </channel>
</rss>
