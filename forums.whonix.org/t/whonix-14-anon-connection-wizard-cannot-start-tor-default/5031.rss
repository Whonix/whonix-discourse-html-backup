<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
    <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031</link>
    <description>[Cannot copy and paste from VirtualBox -- please bear with me]

Anon Connection Wizard fails to connect to Tor.

From journalctl -xe:
`AVC apparmor=&quot;DENIED&quot; operation=&quot;open&quot; profile=&quot;system_tor&quot; name=&quot;/etc/torrc.d/95_whonix.conf&quot; pid=1029 comm=&quot;tor&quot; requested_mask=&quot;r&quot; denied_mask=&quot;r&quot; fsuid=0`
...
`Error reading included configuration file or directory: &quot;/etc/torrc.d/95_whonix.conf&quot;.
tor@default.service: Main process exited, code=exited, status=1/FAILURE
Failed to start Anonymizing overlay network for TCP.`

All Apparmor profiles and configurations are unchanged. This is a fresh upgrade to 14 from a newly imported Whonix Gateway 13.0.0.1.4 following the instructions at /wiki/Upgrading_Whonix_13_to_Whonix_14.</description>
    <language>en</language>
    <lastBuildDate>Mon, 02 Apr 2018 21:42:16 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[unman]]></dc:creator>
        <description><![CDATA[
            <p>You’re right, and it is now deprecated.<br>
I was fooled by the fact that editing and then reloading apparmor allowed the Connection Wizard to start.<br>
In fact, just reloading/restarting without editing the file has the same effect.</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/18">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/18</link>
        <pubDate>Mon, 02 Apr 2018 21:42:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-18</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>unman:</p>
<blockquote>
<p>On starting the gw after upgrade, the Tor connection is made and whonixcheck reports all well, <em>before</em> the wizard appears. How?</p>
</blockquote>
<p>Since</p>
<ul>
<li>
<p>Tor is still enabled in Tor config but how? /etc/tor/torrc should be<br>
no longer a bind-dirs covered file. (So Qubes-Whonix /etc/tor/torrc<br>
settings would be recoverable from <code>/rw/bind-dirs/etc/tor/torrc</code>.) but<br>
no longer being active in /etc/tor/torrc. Should equal<br>
<a href="https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/tor/torrc.anondist">https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/tor/torrc.anondist</a><br>
right?</p>
</li>
<li>
<p>Since ACW status file does no longer exist (Why?) or since ACW status<br>
file checking code broke?</p>
</li>
</ul>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/17">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/17</link>
        <pubDate>Mon, 02 Apr 2018 21:34:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-17</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><code>/etc/apparmor.d/system_tor</code> is referenced from the systemd unit file.</p>
<p>cat /lib/systemd/system/tor@default.service | grep -i apparmor</p>
<p>unman:</p>
<blockquote>
<p>If that include statement is activated then the Anon Connection Wizard works as expected.</p>
</blockquote>
<p>THAT is strange. Sure about that?</p>
<blockquote>
<p>I’m not sure whether this is best done in a package or as a manual step on the upgrade?</p>
</blockquote>
<p>Only required for upgrade?<br>
(Otherwise we shouldn’t ask everyone as part of initial Whonix setup to<br>
modify some file.)</p>
<p>Package anon-gw-anonymizer-config using config-package-dev displace.<br>
Only if we must. I hope not.</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/16">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/16</link>
        <pubDate>Mon, 02 Apr 2018 21:26:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-16</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>unman:</p>
<blockquote>
<p>I believe that the issue arises because the version of /etc/apparmor.d/system_tor installed with the tor package has the include statement commented out</p>
</blockquote>
<p>You sure it is out commented?</p>
<p>Survey says…</p>
<pre><code>grep -r include /etc/apparmor.d
</code></pre>
<p>They all use <code>#include</code> for everything. I don’t think <code>#</code> means comment<br>
here. (Would agree any second that this is weird syntax, bad design by<br>
the apparmor profile language.)</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/15</link>
        <pubDate>Mon, 02 Apr 2018 21:21:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-15</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[unman]]></dc:creator>
        <description><![CDATA[
            <p>Hi <a class="mention" href="http://forums.whonix.org/u/entr0py">@entr0py</a><br>
Yes, I’ve switched to Whonix in Qubes</p>
<p>I was misled here - if you restart apparmor after booting the upgraded GW, then the wizard works as expected.<br>
NB On starting the gw after upgrade, the Tor connection is made and whonixcheck reports all well, <em>before</em> the wizard appears. How?</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/14</link>
        <pubDate>Mon, 02 Apr 2018 18:50:29 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-14</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[entr0py]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/unman">@unman</a> good to see you here! I know you’ve used your own Tor gateway in the past - hope you’ll be using Whonix regularly.</p>
<aside class="quote" data-post="12" data-topic="5031">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/u/d78d45/40.png" class="avatar"> unman:</div>
<blockquote>
<p>I’m not sure these changes are required…</p>
</blockquote>
</aside>
<p>You’re probably right that it’s not the root cause of the issue (unable to test here). Still, it’s good form.</p>
<blockquote>
<p><a href="https://gitlab.com/apparmor/apparmor/wikis/QuickProfileLanguage">https://gitlab.com/apparmor/apparmor/wikis/QuickProfileLanguage</a> :<br>
For directories, read access ( r) allows reading of directory meta data (eg, owner) and reading of directory contents (ie listing) but is not needed for traversal. Write access (w) allows creation, deletion, and updating of directory meta data.</p>
</blockquote>
<aside class="quote" data-post="12" data-topic="5031">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/u/d78d45/40.png" class="avatar"> unman:</div>
<blockquote>
<p>the version of /etc/apparmor.d/system_tor installed with the tor package has the include statement commented out</p>
</blockquote>
</aside>
<p>Doesn’t tor 3.2.10 have <code>#include &lt;local/system_tor&gt;</code>. This should pull in local overrides unless <code>#include</code> has been deprecated.</p>
<blockquote>
<p>Policy files can include other files to share text segments. AppArmor includes follow the C include convention. They start with <span class="hashtag">#include</span> followed by either &lt; &gt; for text chucks relative to a set include directory or " " for files relative to the current file. The # is optional and shouldn’t be used in newer profiles.</p>
<p><span class="hashtag">#include</span> conflicts with commenting rules and takes precedence. The # and include must not be separated from the include with white space otherwise it is considered a comment</p>
</blockquote>
<p>Where is <code>system_tor</code> defined? Could root be executing /usr/sbin/tor?</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/13</link>
        <pubDate>Mon, 02 Apr 2018 18:17:03 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-13</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[unman]]></dc:creator>
        <description><![CDATA[
            <p>I’m not sure these changes are required…<br>
I believe that the issue arises because the version of /etc/apparmor.d/system_tor installed with the tor package has the include statement commented out, so that the local version is not consulted.<br>
If that include statement is activated then the Anon Connection Wizard works as expected.</p>
<p>I’m not sure whether this is best done in a package or as a manual step on the upgrade?</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/12</link>
        <pubDate>Mon, 02 Apr 2018 17:55:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-12</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>troubadour:</p>
<blockquote>
<p><a class="mention" href="http://forums.whonix.org/u/entr0py">@entr0py</a> You might be right. AppArmor permission w[write] is not required for a directory, and indeed can create a problem.</p>
<p>I have pushed an update to <code>anon-gw-anonymizer-config</code> modifying <code>/usr/local/etc/torrc.d/</code> too.</p>
<p><a href="https://github.com/troubadoour/anon-gw-anonymizer-config/commit/cd85983c9e61eacbf1e353de0d0aaf2e70bc1fd3">https://github.com/troubadoour/anon-gw-anonymizer-config/commit/cd85983c9e61eacbf1e353de0d0aaf2e70bc1fd3</a></p>
</blockquote>
<p>Merged. <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/11</link>
        <pubDate>Mon, 02 Apr 2018 10:55:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-11</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[troubadour]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/entr0py">@entr0py</a> You might be right. AppArmor permission w[write] is not required for a directory, and indeed can create a problem.</p>
<p>I have pushed an update to <code>anon-gw-anonymizer-config</code> modifying <code>/usr/local/etc/torrc.d/</code> too.</p>
<p><a href="https://github.com/troubadoour/anon-gw-anonymizer-config/commit/cd85983c9e61eacbf1e353de0d0aaf2e70bc1fd3" class="onebox" target="_blank" rel="nofollow noopener">https://github.com/troubadoour/anon-gw-anonymizer-config/commit/cd85983c9e61eacbf1e353de0d0aaf2e70bc1fd3</a></p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/10</link>
        <pubDate>Sun, 01 Apr 2018 20:06:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-10</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[entr0py]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="7" data-topic="5031">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/i/c5a1d2/40.png" class="avatar"> iry:</div>
<blockquote>
<p>The apparmor denied reading to /etc/torrc.d/95_whonix.conf:</p>
<p>But it seems it has been set to allowed to read and write:<br>
/etc/torrc.d/* rw,</p>
</blockquote>
</aside>
<p>Try giving read permissions to the directory also, not just contents of directory:</p>
<p><code>/etc/torrc.d/ r,</code></p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/9">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/9</link>
        <pubDate>Sun, 01 Apr 2018 19:18:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-9</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[torjunkie]]></dc:creator>
        <description><![CDATA[
            <p>No idea Iry - AppArmor issues are generally above my pay grade I’m afraid! <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/8">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/8</link>
        <pubDate>Sun, 01 Apr 2018 18:09:36 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-8</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <p>The apparmor denied reading to <code>/etc/torrc.d/95_whonix.conf</code>:</p>
<aside class="quote" data-post="4" data-topic="5031">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/h/ecd19e/40.png" class="avatar"> halo9en:</div>
<blockquote>
<p>Mar 27 16:26:30 host audit[2601]: AVC apparmor=“DENIED” operation=“open” profile=“system_tor” name="/etc/torrc.d/95_whonix.conf" pid=2601 comm=“tor” requested_mask=“r” denied_mask=“r” fsuid=0</p>
</blockquote>
</aside>
<p>But it seems it has been set to allowed to read and write:</p>
<aside class="quote" data-post="6" data-topic="5031">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/h/ecd19e/40.png" class="avatar"> halo9en:</div>
<blockquote>
<h2>anon-connection-wizard</h2>
<p>/etc/torrc.d/* rw,</p>
</blockquote>
</aside>
<p>Do you have any ideas on this, <a class="mention" href="http://forums.whonix.org/u/torjunkie">@torjunkie</a> , <a class="mention" href="http://forums.whonix.org/u/troubadour">@troubadour</a> ?</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/7">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/7</link>
        <pubDate>Sat, 31 Mar 2018 20:46:26 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-7</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[halo9en]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/troubadour">@troubadour</a> - yes, here:</p>
<pre><code class="lang-auto">user@host:/etc/apparmor.d/local$ cat /etc/apparmor.d/local/system_tor.anondist
## Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

## Begin Tor Local AppArmor Profile for Anonymity Distributions

## Workaround for: config-package-dev clashes with AppArmor profiles
## https://github.com/Whonix/Whonix/issues/66

## A profile /etc/apparmor.d/anondist could not cover the system_tor
## profile, since that is enforced by the Tor systemd unit file.
## https://github.com/Whonix/Whonix/issues/67

  ## Anonymity Distributions
  /etc/hosts.anondist r,
  /etc/resolv.conf.anondist r,
  /run/tor r,
  /run/tor/log rwk,

## Add permissions for obfsproxy and flashproxy.
## AUDIT:
## These profile rules may be too permissive. Needs audit and someone dedicated
## to work on AppArmor profiles. It's not a serious security issue in any case,
## because AppArmor isn't enabled by default in Debian stretch yet and little
## work is being done on it at time of writing. So it's a lax AppArmor profile
## versus no AppArmor at all.

  ## anon-connection-wizard
  /etc/ r,
  /etc/torrc.d/ rw,
  /etc/torrc.d/* rw,

  /usr/local/etc/torrc.d/ rw,
  /usr/local/etc/torrc.d/* rw,

  ## obfsproxy
  /usr/local/lib/python*/** r,
  /var/log/tor/log rw,
  /dev/urandom r,
  /dev/random r,
  /usr/** r,
  /etc/python*/sitecustomize.py r,
  ## https://forums.whonix.org/t/after-last-apt-get-upgrade-gateway-doesnt-connect-to-tor-anymore
  #/usr/bin/obfsproxy rix,

  ## flashproxy
  @{HOME}/.tb/tor-browser/App/flashproxy-client rix,
  @{HOME}/.tb/tor-browser/App/flashproxy-reg-appspot rix,
  @{HOME}/.tb/tor-browser/App/flashproxy-reg-url rix,
  @{HOME}/.tb/tor-browser/App/flashproxy-reg-http rix,
  @{HOME}/.tb/tor-browser/App/flashproxy-reg-email rix,
  @{HOME}/.tb/tor-browser/App/** rm,
  /usr/bin/python* rix,
  /usr/lib/python*/dist-packages/** m,
  /usr/lib/python*/lib-dynload/** m,
  /usr/lib/pyshared/python*/OpenSSL/** m,
  /usr/lib/python*/lib-dynload/** m,
  /usr/lib/pyshared/python*/numpy/** m,
  /proc/*/mounts r,

## End Tor Local AppArmor Profile for Anonymity Distributions</code></pre>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/6">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/6</link>
        <pubDate>Fri, 30 Mar 2018 00:47:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-6</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[troubadour]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/halo9en">@halo9en</a><br>
Could you post the content of<br>
<code>/etc/apparmor.d/local/system_tor.anondist</code></p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/5">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/5</link>
        <pubDate>Thu, 29 Mar 2018 22:25:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-5</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[halo9en]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="http://forums.whonix.org/u/iry">@iry</a> - my outputs were all identical</p>
<p><a class="mention" href="http://forums.whonix.org/u/0brand">@0brand</a> - my apparmor config files match the latest version from that thread.</p>
<p>Here’s some useful copy and pasted info:</p>
<pre><code class="lang-auto">$ journalctl -xe
-- 
-- Unit tor@default.service has begun starting up.
Mar 27 16:26:30 host tor[2597]: Mar 27 16:26:30.300 [notice] Tor 0.3.2.9 (git-64a719dd25a21acb) running on Linux with Libevent 2.0.21-stable, OpenSSL 1.1.0f, Zlib 1.2.8, Liblzma 5.2.2, and Lib
Mar 27 16:26:30 host tor[2597]: Mar 27 16:26:30.301 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Mar 27 16:26:30 host tor[2597]: Mar 27 16:26:30.301 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Mar 27 16:26:30 host tor[2597]: Mar 27 16:26:30.301 [notice] Read configuration file "/etc/tor/torrc".
Mar 27 16:26:30 host tor[2597]: Mar 27 16:26:30.304 [notice] You configured a non-loopback address '10.152.152.10:5300' for DNSPort. This allows everybody on your local network to use your mac
Mar 27 16:26:30 host tor[2597]: Mar 27 16:26:30.304 [notice] You configured a non-loopback address '10.152.152.10:9040' for TransPort. This allows everybody on your local network to use your m
Mar 27 16:26:30 host tor[2597]: Configuration was valid
Mar 27 16:26:30 host tor[2601]: Mar 27 16:26:30.429 [notice] Tor 0.3.2.9 (git-64a719dd25a21acb) running on Linux with Libevent 2.0.21-stable, OpenSSL 1.1.0f, Zlib 1.2.8, Liblzma 5.2.2, and Lib
Mar 27 16:26:30 host tor[2601]: Mar 27 16:26:30.429 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Mar 27 16:26:30 host tor[2601]: Mar 27 16:26:30.430 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Mar 27 16:26:30 host tor[2601]: Mar 27 16:26:30.430 [notice] Read configuration file "/etc/tor/torrc".
Mar 27 16:26:30 host audit[2601]: AVC apparmor="DENIED" operation="open" profile="system_tor" name="/etc/torrc.d/95_whonix.conf" pid=2601 comm="tor" requested_mask="r" denied_mask="r" fsuid=0 
Mar 27 16:26:30 host audit[2601]: SYSCALL arch=40000003 syscall=5 success=no exit=-13 a0=228dac0 a1=88000 a2=0 a3=b71eb000 items=1 ppid=1 pid=2601 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsu
Mar 27 16:26:30 host audit: CWD cwd="/"
Mar 27 16:26:30 host audit: PATH item=0 name="/etc/torrc.d/95_whonix.conf" inode=2361771 dev=08:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 nametype=NORMAL
Mar 27 16:26:30 host audit: PROCTITLE proctitle=2F7573722F62696E2F746F72002D2D64656661756C74732D746F727263002F7573722F73686172652F746F722F746F722D736572766963652D64656661756C74732D746F72726300
Mar 27 16:26:30 host tor[2601]: Mar 27 16:26:30.433 [warn] Could not open "/etc/torrc.d/95_whonix.conf": Permission denied
Mar 27 16:26:30 host tor[2601]: Mar 27 16:26:30.433 [warn] Error reading included configuration file or directory: "/etc/torrc.d/95_whonix.conf".
Mar 27 16:26:30 host tor[2601]: Mar 27 16:26:30.434 [err] Reading config failed--see warnings above.
Mar 27 16:26:30 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=tor@default comm="systemd" exe="/lib/systemd/systemd" hostname=? addr=? terminal=? res=failed'
Mar 27 16:26:30 host systemd[1]: tor@default.service: Main process exited, code=exited, status=1/FAILURE
Mar 27 16:26:30 host systemd[1]: Failed to start Anonymizing overlay network for TCP.
-- Subject: Unit tor@default.service has failed
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- Unit tor@default.service has failed.
-- 
-- The result is failed.
Mar 27 16:26:30 host systemd[1]: tor@default.service: Unit entered failed state.
Mar 27 16:26:30 host systemd[1]: tor@default.service: Failed with result 'exit-code'.
Mar 27 16:26:30 host audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=tor@default comm="systemd" exe="/lib/systemd/systemd" hostname=? addr=? terminal=? res=success
Mar 27 16:26:30 host audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=tor@default comm="systemd" exe="/lib/systemd/systemd" hostname=? addr=? terminal=? res=success'
Mar 27 16:26:30 host systemd[1]: tor@default.service: Service hold-off time over, scheduling restart.
Mar 27 16:26:30 host systemd[1]: brltty.service: Cannot add dependency job, ignoring: Unit brltty.service is masked.
Mar 27 16:26:30 host systemd[1]: Stopped Anonymizing overlay network for TCP.
-- Subject: Unit tor@default.service has finished shutting down
-- Defined-By: systemd
-- Support: https://www.debian.org/support
-- 
-- Unit tor@default.service has finished shutting down.
Mar 27 16:26:30 host systemd[1]: tor@default.service: Start request repeated too quickly.
Mar 27 16:26:30 host systemd[1]: Failed to start Anonymizing overlay network for TCP.
-- Subject: Unit tor@default.service has failed
-- Defined-By: systemd
user@host:/etc/apparmor.d/local$ ls -la /etc/torrc.d/
total 20
drwxr-xr-x   2 root root  4096 Mar 26 11:00 .
drwxr-xr-x 131 root root 12288 Mar 27 10:49 ..
-rw-r--r--   1 root root   243 Feb 22 01:59 95_whonix.conf
user@host:/etc/apparmor.d/local$ cat /etc/torrc.d/95_whonix.conf 
## Do not edit this file!
## Please create and add modifications to the following file instead:
## /usr/local/etc/torrc.d/50_user.conf
%include /usr/local/etc/torrc.d/40_anon_connection_wizard.conf
%include /usr/local/etc/torrc.d/50_user.conf
user@host:/etc/apparmor.d/local$ sudo --non-interactive /usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0 --verify-config
Mar 27 16:36:58.608 [notice] Tor 0.3.2.9 (git-64a719dd25a21acb) running on Linux with Libevent 2.0.21-stable, OpenSSL 1.1.0f, Zlib 1.2.8, Liblzma 5.2.2, and Libzstd 1.1.2.
Mar 27 16:36:58.608 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Mar 27 16:36:58.608 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Mar 27 16:36:58.608 [notice] Read configuration file "/etc/tor/torrc".
Mar 27 16:36:58.612 [notice] You configured a non-loopback address '10.152.152.10:5300' for DNSPort. This allows everybody on your local network to use your machine as a proxy. Make sure this is what you wanted.
Mar 27 16:36:58.612 [notice] You configured a non-loopback address '10.152.152.10:9040' for TransPort. This allows everybody on your local network to use your machine as a proxy. Make sure this is what you wanted.
Configuration was valid
user@host:/etc/apparmor.d/local$ echo $?
0</code></pre>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/4</link>
        <pubDate>Thu, 29 Mar 2018 04:03:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-4</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[iry]]></dc:creator>
        <description><![CDATA[
            <p>Hi <a class="mention" href="http://forums.whonix.org/u/halo9en">@halo9en</a> !</p>
<p>Thank you so much for reporting this!</p>
<aside class="quote" data-post="1" data-topic="5031">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/h/ecd19e/40.png" class="avatar"> halo9en:</div>
<blockquote>
<p>Cannot copy and paste from VirtualBox – please bear with me</p>
</blockquote>
</aside>
<p>I am sorry to hear that you have to type all the info manually. Do you mean the copy and paste does not work anymore since updating to Whonix 14? Were you able to do the operations in Whonix13?</p>
<hr>
<p>For the anon-connection-wizard failure, would you please check the output of the following commands? (I do not want you type all of them, so I am going to provide it here and you can just check against my output. )</p>
<p>Expected output (I guess yours will complain about the configuration error):</p>
<pre><code>user@host:~$ sudo --non-interactive /usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0 --verify-config
Mar 28 05:32:42.970 [notice] Tor 0.3.2.9 (git-64a719dd25a21acb) running on Linux with Libevent 2.0.21-stable, OpenSSL 1.1.0f, Zlib 1.2.8, Liblzma 5.2.2, and Libzstd 1.1.2.
Mar 28 05:32:42.970 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning
Mar 28 05:32:42.970 [notice] Read configuration file "/usr/share/tor/tor-service-defaults-torrc".
Mar 28 05:32:42.970 [notice] Read configuration file "/etc/tor/torrc".
Mar 28 05:32:42.973 [notice] You configured a non-loopback address '10.137.13.1:5300' for DNSPort. This allows everybody on your local network to use your machine as a proxy. Make sure this is what you wanted.
Mar 28 05:32:42.973 [notice] You configured a non-loopback address '10.137.13.1:9040' for TransPort. This allows everybody on your local network to use your machine as a proxy. Make sure this is what you wanted.
Configuration was valid
</code></pre>
<p>Check the chain of torrc files (lines starts with <code>#</code> can be ignored):</p>
<pre><code>user@host:~$ cat /etc/tor/torrc
%include /etc/torrc.d/95_whonix.conf

user@host:~$ cat /etc/torrc.d/95_whonix.conf
## Do not edit this file!
## Please create and add modifications to the following file instead:
## /usr/local/etc/torrc.d/50_user.conf
%include /usr/local/etc/torrc.d/40_anon_connection_wizard.conf
%include /usr/local/etc/torrc.d/50_user.conf

user@host:~$ cat /usr/local/etc/torrc.d/40_anon_connection_wizard.conf
# This file is generated by and should ONLY be used by anon-connection-wizard.
# User configuration should go to /usr/local/etc/torrc.d/50_user.conf, not here. Because:
#    1. This file can be easily overwritten by anon-connection-wizard.
#    2. Even a single character change in this file may cause error.
# However, deleting this file will be fine since a new plain file will be generated the next time you run anon-connection-wizard.
DisableNetwork 0

user@host:~$ cat /usr/local/etc/torrc.d/50_user.conf
## Tor user specific configuration file
##
## Add user modifications below this line:
############################################</code></pre>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/3</link>
        <pubDate>Wed, 28 Mar 2018 05:39:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-3</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[0brand]]></dc:creator>
        <description><![CDATA[
            <p>Looks like the problem you are having is addressed in these 2 threads. Same solution is in both threads but first one is where they first started troubleshooting the problem.</p>
<p><a href="https://forums.whonix.org/t/graphical-gui-whonix-setup-wizard-anon-connection-wizard-technical-discussion/650/396">https://forums.whonix.org/t/graphical-gui-whonix-setup-wizard-anon-connection-wizard-technical-discussion/650/396</a></p>
<p><a href="https://forums.whonix.org/t/anon-connection-wizard-apparmor/4665">https://forums.whonix.org/t/anon-connection-wizard-apparmor/4665</a></p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/2</link>
        <pubDate>Tue, 27 Mar 2018 23:10:15 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-2</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
      <item>
        <title>Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</title>
        <dc:creator><![CDATA[halo9en]]></dc:creator>
        <description><![CDATA[
            <p>[Cannot copy and paste from VirtualBox – please bear with me]</p>
<p>Anon Connection Wizard fails to connect to Tor.</p>
<p>From journalctl -xe:<br>
<code>AVC apparmor="DENIED" operation="open" profile="system_tor" name="/etc/torrc.d/95_whonix.conf" pid=1029 comm="tor" requested_mask="r" denied_mask="r" fsuid=0</code><br>
…<br>
<code>Error reading included configuration file or directory: "/etc/torrc.d/95_whonix.conf". tor@default.service: Main process exited, code=exited, status=1/FAILURE Failed to start Anonymizing overlay network for TCP.</code></p>
<p>All Apparmor profiles and configurations are unchanged. This is a fresh upgrade to 14 from a newly imported Whonix Gateway 13.0.0.1.4 following the instructions at /wiki/Upgrading_Whonix_13_to_Whonix_14.</p>
          <p><a href="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031/1</link>
        <pubDate>Tue, 27 Mar 2018 11:06:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-5031-1</guid>
        <source url="http://forums.whonix.org/t/whonix-14-anon-connection-wizard-cannot-start-tor-default/5031.rss">Whonix 14 (Anon Connection Wizard) - Cannot start tor@default</source>
      </item>
  </channel>
</rss>
