<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Whonix Gateway Networking - How does it work? - VirtualBox - Whonix Forum</title>
    <meta name="description" content="I would like to better understand how the Whonix Gateway manages the networking. I could not find answers in the Wiki documentation or elsewhere. 
So far, this is my understanding of the Gateway‚Äôs network organisation (p&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="4555.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Whonix Gateway Networking - How does it work?&#39;" href="4555.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/whonix-gateway-networking-how-does-it-work/4555" />
<meta name="twitter:url" content="https://forums.whonix.org/t/whonix-gateway-networking-how-does-it-work/4555" />
<meta property="og:title" content="Whonix Gateway Networking - How does it work?" />
<meta name="twitter:title" content="Whonix Gateway Networking - How does it work?" />
<meta property="og:description" content="I would like to better understand how the Whonix Gateway manages the networking. I could not find answers in the Wiki documentation or elsewhere.  So far, this is my understanding of the Gateway‚Äôs network organisation (please corrrect me if I am wrong):  The Gateway has two virtual network interfaces: eth0 and eth1.    eth0 ‚Äúgets‚Äù the internet from the host machine via the default virtualbox virtual NAT adapter, therefore sudo ifconfig returns 10.0.2.15  as its IP address (default VirtualBox NAT..." />
<meta name="twitter:description" content="I would like to better understand how the Whonix Gateway manages the networking. I could not find answers in the Wiki documentation or elsewhere.  So far, this is my understanding of the Gateway‚Äôs network organisation (please corrrect me if I am wrong):  The Gateway has two virtual network interfaces: eth0 and eth1.    eth0 ‚Äúgets‚Äù the internet from the host machine via the default virtualbox virtual NAT adapter, therefore sudo ifconfig returns 10.0.2.15  as its IP address (default VirtualBox NAT..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="3 ‚ù§" />
<meta property="article:published_time" content="2017-11-24T18:23:53+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="4555.html">Whonix Gateway Networking - How does it work?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/virtualbox/16.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #283890'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>VirtualBox</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-11-24T18:23:53Z' class='post-time'>
                November 24, 2017,  6:23pm
              </time>
              <meta itemprop='dateModified' content='2017-11-24T18:23:53Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I would like to better understand how the Whonix Gateway manages the networking. I could not find answers in the Wiki documentation or elsewhere.</p>
<p>So far, this is my understanding of the Gateway‚Äôs network organisation (please corrrect me if I am wrong):</p>
<p>The Gateway has two virtual network interfaces: eth0 and eth1.</p>
<ul>
<li>
<p>eth0 ‚Äúgets‚Äù the internet from the host machine via the default virtualbox virtual NAT adapter, therefore sudo ifconfig returns 10.0.2.15  as its IP address (default VirtualBox NAT settings)</p>
</li>
<li>
<p>eth1 is another virtualized interface running on the Gateway whose traffic is completly torrified and to which the Workstation (or any other VM) connects, hence the Workstation doesn‚Äôt ‚Äúknow‚Äù the clearnet address of the Gateway. This network is known as an Internal Network named ‚ÄúWhonix‚Äù in the VirtualBox network settings.</p>
</li>
</ul>
<p>What I don‚Äôt understand, is how exactly is this configured in the Gateway? The  /etc/network/interfaces.d/30_non-qubes-whonix file return a fairly simple configuration, with eth0 being inet dhcp (default Virtualbox setting), and the eth1 showing only</p>
<blockquote>
<pre><code>iface eth1 inet static
       address 10.152.152.10
       netmask 255.255.192.0
</code></pre>
</blockquote>
<p>How does the Gateway act as a router? Does it run a dhcp server? How is the internal network configured?</p>
<p>I am asking to have a depper understanding of how Whonix work and also to be able to reproduce a similar setting as I like the idea of having a virtualized router for other VMs, even for clearnet activities.</p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-11-24T18:50:05Z' class='post-time'>
                November 24, 2017,  6:50pm
              </time>
              <meta itemprop='dateModified' content='2017-11-24T18:50:05Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="1" data-topic="4555">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>How does the Gateway act as a router?</p>
</blockquote>
</aside>
<p>There is no IP forwarding.</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://assets-cdn.github.com/favicon.ico" class="site-icon" width="32" height="32">
      <a href="../../../external.html?link=https://github.com/Whonix/ipv4-forward-disable" target="_blank" rel="nofollow noopener">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="../../../external.html?link=https://avatars3.githubusercontent.com/u/4500165?s=400&amp;v=4" class="thumbnail onebox-avatar" width="400" height="400">

<h3><a href="../../../external.html?link=https://github.com/Whonix/ipv4-forward-disable" target="_blank" rel="nofollow noopener">Whonix/ipv4-forward-disable</a></h3>

<p>ipv4-forward-disable - Deactivates IPv4 forwarding using /etc/sysctl.d/ - As defense in depth to prevent leaks.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Tor is running on the gateway. It opens ports. The workstation can talk to these directly. (socksified)</p>
<p>System default traffic from the workstation (non-socksified), called transparent proxying, is redirected by <code>whonix-gw-firewall</code> to Tor‚Äôs <code>DnsPort</code> and Tor‚Äôs <code>TransPort</code>.</p>
<p>Whonix (previously called TorBOX) was based on <a href="../../../external.html?link=https://trac.torproject.org/projects/tor/wiki/doc/TransparentProxy#LocalRedirectionandAnonymizingMiddlebox">https://trac.torproject.org/projects/tor/wiki/doc/TransparentProxy#LocalRedirectionandAnonymizingMiddlebox</a>. That‚Äôs how it all started.</p>
<aside class="quote" data-post="1" data-topic="4555">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>Does it run a dhcp server</p>
</blockquote>
</aside>
<p>No, static networking.</p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../kernel-hardening/7296/44.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../kernel-hardening/7296/44.html'>
                      <span itemprop='name'>Kernel Hardening</span>
                    </a>
                    <meta itemprop='position' content='3'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/entr0py'><span itemprop='name'>entr0py</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-11-24T22:19:53Z' class='post-time'>
                November 24, 2017, 10:19pm
              </time>
              <meta itemprop='dateModified' content='2017-11-24T22:19:53Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote" data-post="1" data-topic="4555">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>I am asking to have a depper understanding of how Whonix work and also to be able to reproduce a similar setting as I like the idea of having a virtualized router for other VMs, even for clearnet activities.</p>
</blockquote>
</aside>
<p>Before you can understand how Whonix networking works, you need to have a basic understanding of Linux networking in general. Your first step should be to find a few basic tutorials on iptables and routes.</p>
<p>Your goal is to understand the output (on Whonix-Gateway) of:</p>
<pre><code class="lang-auto">sudo route -n
sudo iptables -nvL -t nat
sudo iptables -nvL
</code></pre>
<p>Then you‚Äôll see that Whonix uses iptables redirection and not forwarding.</p>
<p>Qubes OS is a great sandbox for testing virtual routers. You can also look at specialized distributions: <a href="../../../external.html?link=https://en.wikipedia.org/wiki/List_of_router_and_firewall_distributions">https://en.wikipedia.org/wiki/List_of_router_and_firewall_distributions</a></p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-11-25T08:06:02Z' class='post-time'>
                November 25, 2017,  8:06am
              </time>
              <meta itemprop='dateModified' content='2017-11-25T10:54:48Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks for your answers, really appreciated. You‚Äôre right I need to learn more about Linux networking and iptables, but I‚Äôd also like to understand how on the  software side the two VMs connect to each other, where are the configuration files they look at to establish the connection on the Whonix internal network? How the Gateway and the Workstation ‚Äúknow‚Äù that eth1/eth0 correspond to the Whonix internal network?</p>
<p>EDIT: I think I have figured it out. When creating an internal network, VMs automatically see it as a second eth network (enp0s8 in debian 9). I am now looking for information on Whonix iptables rulesests, but so far without much success‚Ä¶</p>
<p>EDIT2: after a few hours of (very interesting read), I could not find a satisfying answer to my question: how do I reliably reproduce the WG/WW networking system and more generally speaking how to reliably forward traffic from one VM to another VM using iptables‚Ä¶</p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-11-25T11:38:00Z' class='post-time'>
                November 25, 2017, 11:38am
              </time>
              <meta itemprop='dateModified' content='2017-11-25T11:38:00Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>onion_knight:</p>
<blockquote>
<p>Thanks for your answers, really appreciated. You‚Äôre right I need to learn more about Linux networking and iptables, but I‚Äôd also like to understand how on the  software side the two VMs connect to each other, where are the configuration files they look at to establish the connection on the Whonix internal network?</p>
</blockquote>
<p>Settings files: VirtualBox settings files.</p>
<p>These are auto generated from command line during Whonix build:</p>
<p><a href="../../../external.html?link=https://github.com/Whonix/Whonix/blob/master/build-steps.d/2600_create-vbox-vm">https://github.com/Whonix/Whonix/blob/master/build-steps.d/2600_create-vbox-vm</a></p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-11-25T12:38:49Z' class='post-time'>
                November 25, 2017, 12:38pm
              </time>
              <meta itemprop='dateModified' content='2017-11-25T12:38:49Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks for the link, now I know how to link VMs through internal network and ping/ssh each other, but I still can‚Äôt figure out how to use iptables to forward the traffic from VM-Workstation (with only internal network attached) to VM-Gateway (with NAT and internal network attached). I guess it is more a general question about VMs and iptables forwarding, but I don‚Äôt see how exactly it is achieved in Whonix either.</p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-11-25T12:41:00Z' class='post-time'>
                November 25, 2017, 12:41pm
              </time>
              <meta itemprop='dateModified' content='2017-11-25T12:41:00Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>onion_knight:</p>
<blockquote>
<p>Thanks for the link, now I know how to link VMs through internal network and ping/ssh each other, but I still can‚Äôt figure out how to use iptables to forward the traffic from VM-Workstation (with only internal network attached) to VM-Gateway (with NAT and internal network attached). I guess it is more a general question about VMs and iptables forwarding, but I don‚Äôt see how exactly it is achieved in Whonix either.</p>
</blockquote>
<p>It‚Äôs all here.</p>
<p><a href="../../../external.html?link=https://trac.torproject.org/projects/tor/wiki/doc/TransparentProxy">https://trac.torproject.org/projects/tor/wiki/doc/TransparentProxy</a></p>
<p><a href="../../../external.html?link=https://github.com/Whonix/whonix-gw-firewall/blob/master/usr/bin/whonix_firewall">https://github.com/Whonix/whonix-gw-firewall/blob/master/usr/bin/whonix_firewall</a></p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-12-25T22:58:53Z' class='post-time'>
                December 25, 2017, 10:58pm
              </time>
              <meta itemprop='dateModified' content='2017-12-25T22:58:53Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Merry Christmas!</p>
<p>I know that this is a bit off-topic, but I think that it can be of interest for Whonix users. Feel free to close the topic if you think otherwise.</p>
<p>So I have been playing around with iptables and VM networking and I was able to forward traffic from a proxy/gateway VM to another VM with this kind of rules:</p>
<pre><code>sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE
sudo iptables -A FORWARD -i enp0s3 -o enp0s8 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i enp0s8 -o enp0s3 -j ACCEPT
</code></pre>
<p>For VPN configuration, I just replace ‚Äúenp0s3‚Äù by ‚Äútun0‚Äù:</p>
<pre><code>iptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE
iptables -A FORWARD -i tun0 -o enp0s8 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i enp0s8 -o tun0 -j ACCEPT
</code></pre>
<p>However, this setting requires IP forwarding in order to work:</p>
<p><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p>
<p>How does the Whonix Gateway achieves this withouth IP forwarding? Is it Tor related? Or is there something else that I am missing?</p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-12-26T15:47:25Z' class='post-time'>
                December 26, 2017,  3:47pm
              </time>
              <meta itemprop='dateModified' content='2017-12-26T15:47:25Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>For socksified connections, you don‚Äôt need iptables rules at all.</p>
<aside class="quote" data-post="8" data-topic="4555">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v2/letter/o/f6c823/40.png" class="avatar"> onion_knight:</div>
<blockquote>
<p>How does the Whonix Gateway achieves this withouth IP forwarding? Is it Tor related?</p>
</blockquote>
</aside>
<p>Tor related. Fortunately Tor can be configured to open a <code>DnsPort</code> and a <code>TransPort</code> listening port. Then you can use iptables to redirect traffic to these ports.</p>
<p>See this short very chapter <code>Anonymizing Middlebox</code>:<br>
<a href="../../../external.html?link=https://trac.torproject.org/projects/tor/wiki/doc/TransparentProxy#AnonymizingMiddlebox" class="onebox" target="_blank">https://trac.torproject.org/projects/tor/wiki/doc/TransparentProxy#AnonymizingMiddlebox</a></p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/onion_knight'><span itemprop='name'>onion_knight</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="4555.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-12-31T01:11:44Z' class='post-time'>
                December 31, 2017,  1:11am
              </time>
              <meta itemprop='dateModified' content='2017-12-31T01:11:44Z'>
          <span itemprop='position'>#10</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks for your answer. It makes more sense now.</p>
        </div>

        <meta itemprop='headline' content='Whonix Gateway Networking - How does it work?'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
