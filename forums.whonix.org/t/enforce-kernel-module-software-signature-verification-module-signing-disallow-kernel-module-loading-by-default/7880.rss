<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
    <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880</link>
    <description>We can restrict kernel modules to only be loaded if they&#39;re signed by a valid key. This increases security by making it harder to load a malicious module. We can do this by adding `module.sig_enforce=1` as a kernel parameter.

https://www.kernel.org/doc/html/v4.19/admin-guide/module-signing.html

We can also prevent kernel modules from being loaded or unloaded after boot by setting `kernel.modules_disabled=1` with sysctl. I don&#39;t really see a point in this though as module loading requires root and if an attacker has root already, there&#39;s no point in attempting to load a module. Even if the attacker did need to load a module, they could just set `kernel.modules_disabled=0` with sysctl as they have root anyway. For some reason, the lockdown patch sets this but I don&#39;t see any real security advantage and only potential breakages.</description>
    <language>en</language>
    <lastBuildDate>Sun, 29 Aug 2021 15:46:45 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <blockquote>
<p><a href="https://github.com/openwall/lkrg/issues/113#issuecomment-903104743" class="inline-onebox">feature request: Debian package - kernel module signing for kernel_lockdown · Issue #113 · openwall/lkrg · GitHub</a></p>
</blockquote>
<p>Quote:</p>
<blockquote>
<p>Some time ago <a href="https://morfikov.github.io/post/automatyczne-podpisywanie-modulow-kernela-przez-dkms/">I wrote an article on this subject</a>. it’s in Polish, but all the necessary commands are in place and you will figure out how to make that setup work.</p>
</blockquote>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://morfikov.github.io/icons/16.png" class="site-icon" width="16" height="16">

      <a href="https://morfikov.github.io/post/automatyczne-podpisywanie-modulow-kernela-przez-dkms/" target="_blank" rel="noopener" title="04:10AM - 05 January 2019">morfikov.github.io – 5 Jan 19</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://morfikov.github.io/post/automatyczne-podpisywanie-modulow-kernela-przez-dkms/" target="_blank" rel="noopener">Automatyczne podpisywanie modułów kernela przez DKMS</a></h3>

  <p>Budując kernel linux'a trzeba zastanowić się nad kwestią modułów, które nie są wbudowane
bezpośrednio w samo jądro operacyjne. Nie chodzi tutaj bezpośrednio o funkcjonalność kernela,
którą można zbudować jako moduł w procesie jego kompilacji ale...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/60">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/60</link>
        <pubDate>Sun, 29 Aug 2021 15:46:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-60</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/3ba3b371873d221db6845fb0fe52191b8b349b0a" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/3ba3b371873d221db6845fb0fe52191b8b349b0a" target="_blank" rel="noopener">add `/etc/dkms/framework.conf.security-misc`</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2021-04-29" data-time="15:08:30" data-timezone="UTC">03:08PM - 29 Apr 21 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 32 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/3ba3b371873d221db6845fb0fe52191b8b349b0a" target="_blank" rel="noopener">
          <span class="added">+32</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">original, from
- https://github.com/dell/dkms/blob/master/dkms_framework.conf
- https://raw.githubusercontent.com/dell/dkms/master/dkms_framework.conf
https://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/58</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/e2afd00627b097f75467cd0e2fe7e15977141026" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/e2afd00627b097f75467cd0e2fe7e15977141026" target="_blank" rel="noopener">modify DKMS configuration file `/etc/dkms/framework.conf`</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2021-04-29" data-time="15:14:30" data-timezone="UTC">03:14PM - 29 Apr 21 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 32 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/e2afd00627b097f75467cd0e2fe7e15977141026" target="_blank" rel="noopener">
          <span class="added">+32</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">Lower parallel compilation jobs to 1 if less than 2 GB RAM to avoid freezing of virtual machines.
`parallel_jobs=1`
This does not necessarily...</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/6e759f9196412b1742db1e4c68a70867e1ad8629" target="_blank" rel="noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/6e759f9196412b1742db1e4c68a70867e1ad8629" target="_blank" rel="noopener">config-package-dev displace /etc/dkms/framework.conf</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2021-04-29" data-time="15:17:30" data-timezone="UTC">03:17PM - 29 Apr 21 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 1 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/6e759f9196412b1742db1e4c68a70867e1ad8629" target="_blank" rel="noopener">
          <span class="added">+1</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">https://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/58</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/59">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/59</link>
        <pubDate>Thu, 29 Apr 2021 15:19:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-59</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>DKMS getting module signing support.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/dell/dkms/blob/master/dkms_framework.conf#L30" target="_blank" rel="noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/dell/dkms/blob/master/dkms_framework.conf#L30" target="_blank" rel="noopener">dell/dkms/blob/master/dkms_framework.conf#L30</a></h4>
<pre class="onebox"><code class="lang-conf"><ol class="start lines" start="20" style="counter-reset: li-counter 19 ;">
<li>## symlink kernel modules (will be active if you set it to a non-null value)</li><li>## This creates symlinks from the install_tree into the dkms_tree instead of</li><li>## copying the modules. This preserves some space on the costs of being less</li><li>## safe.</li><li># symlink_modules=""</li><li></li><li>## Automatic installation and upgrade for all installed kernels (if set to a</li><li>## non-null value)</li><li># autoinstall_all_kernels=""</li><li></li><li class="selected">## Script to sign modules during build, script is called with kernel version</li><li>## and module name</li><li># sign_tool="/etc/dkms/sign_helper.sh"</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/dell/dkms/blob/master/sign_helper.sh" target="_blank" rel="noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/dell/dkms/blob/master/sign_helper.sh" target="_blank" rel="noopener">dell/dkms/blob/master/sign_helper.sh</a></h4>
<pre><code class="lang-sh">#!/bin/sh
/lib/modules/"$1"/build/scripts/sign-file sha512 /root/mok.priv /root/mok.der "$2"
</code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Dunno when this lands in Debian. Hopefully in Debian <code>bullseye</code>.</p>
<p>If so, since…</p>
<aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/dell/dkms/issues/116" target="_blank" rel="noopener">github.com/dell/dkms</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/dell/dkms/issues/116" target="_blank" rel="noopener">add /etc/dkms/framework.conf.d configuration file drop-in folder</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-01-19" data-time="12:55:48" data-timezone="UTC">12:55PM - 19 Jan 20 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Could you please add support for parsing /etc/dkms/framework.conf.d configuration file drop-in folder? Similar to /etc/dkms/framework.conf.
Use cases:
useful for derivative linux distribution
to work...</p>
</div>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>…isn’t implemented, package <code>security-misc</code> could <a href="https://www.whonix.org/wiki/Dev/About_Debian_Packaging#config-package-dev">config-package-dev</a> <code>displace</code></p>
<blockquote>
<p><code>/etc/dkms/framework.conf</code></p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/58">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/58</link>
        <pubDate>Thu, 29 Apr 2021 14:52:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-58</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Reconsidering.</p>
<aside class="quote no-group" data-username="Patrick" data-post="23" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Or better a more generic solution of signing all DKMS modules:</p>
<ul>
<li><a href="https://gist.github.com/dop3j0e/2a9e2dddca982c4f679552fc1ebb18df">https://gist.github.com/dop3j0e/2a9e2dddca982c4f679552fc1ebb18df </a></li>
</ul>
</blockquote>
</aside>
<aside class="quote no-group" data-username="madaidan" data-post="25" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t think this should be done.</p>
</blockquote>
</aside>
<p>Better to sign all kernel modules (this would be helpful for purpose of LKRG, tirdad and hardware comparability, namely compatibility with SecureBoot) than no progress in this ticket at all and no signing at all. A drop-in configuration <code>.d</code> folder where kernel modules are white listed opted in could be contributed later.</p>
<aside class="quote no-group" data-username="madaidan" data-post="25" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I think we should only allow the modules we need to make the chance something malicious is accidentally signed at a minimum.</p>
</blockquote>
</aside>
<p>Please describe the threat model. Folders where kernel modules are stored (and would be auto-signed) are writeable by (super)admin only anyhow. If an adversary gains write access there, it’s game over anyhow. Therefore I don’t see what is gained by white listing which kernel modules should be signed.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/57">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/57</link>
        <pubDate>Wed, 18 Nov 2020 07:48:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-57</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="55" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Where is the signing key stored?</p>
</blockquote>
</aside>
<p>/path/to/kernel_source/certs/signing_key.pem</p>
<aside class="quote no-group" data-post="55" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>OR: What is the full command line to sign a kernel module?</p>
</blockquote>
</aside>
<p><a href="https://www.kernel.org/doc/html/latest/admin-guide/module-signing.html#manually-signing-modules" class="onebox" target="_blank">https://www.kernel.org/doc/html/latest/admin-guide/module-signing.html#manually-signing-modules</a></p>
<p>So, for us, should be</p>
<pre><code>${kernel_source}/scripts/sign-file sha512 ${kernel_source}/certs/signing_key.pem ${kernel_source}/certs/signing_key.x509 module.ko</code></pre>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/56">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/56</link>
        <pubDate>Tue, 21 Jan 2020 16:56:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-56</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/Whonix/hardened-kernel/pull/36" target="_blank">github.com/Whonix/hardened-kernel</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/hardened-kernel/pull/36" target="_blank">Sign all kernel modules</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>madaidan:module_sig</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-01-20" data-time="17:33:13" data-timezone="UTC">05:33PM - 20 Jan 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="2 commits changed 2 files with 12 additions and 12 deletions">
        <a href="https://github.com/Whonix/hardened-kernel/pull/36/files" target="_blank">
          <span class="added">+12</span>
          <span class="removed">-12</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Where is the signing key stored? Where are the signature keys stored?</p>
<p>OR: What is the full command line to sign a kernel module?</p>
<p>Once I know that, should be possible to create an APT <code>DPkg::Post-Invoke</code> setting (similar to <a href="https://github.com/Whonix/apparmor-profile-everything/blob/master/etc/apt/apt.conf.d/50apparmor-profile-everything">this</a>) which signs these kernel modules.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/55">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/55</link>
        <pubDate>Tue, 21 Jan 2020 06:27:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-55</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/dell/dkms/issues/116" target="_blank">github.com/dell/dkms</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/dell/dkms/issues/116" target="_blank">add /etc/dkms/framework.conf.d configuration file drop-in folder</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-01-19" data-time="12:55:48" data-timezone="UTC">12:55PM - 19 Jan 20 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>
  </div>
</div>

<div class="github-row">
  <p class="github-content">Could you please add support for parsing /etc/dkms/framework.conf.d configuration file drop-in folder? Similar to /etc/dkms/framework.conf.
Use cases:
useful for derivative linux distribution
to work...</p>
</div>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/54">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/54</link>
        <pubDate>Sun, 19 Jan 2020 12:56:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-54</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>New versions of DKMS have a <code>SIGN_TOOL=</code> feature. Please have a look, see if that looks alright, and give feedback to the DKMS developers:</p>
<ul>
<li><a href="https://github.com/dell/dkms/issues/72">https://github.com/dell/dkms/issues/72</a></li>
<li><a href="https://github.com/dell/dkms/pull/87">https://github.com/dell/dkms/pull/87</a></li>
</ul>
<blockquote>
<p>SIGN_TOOL=</p>
</blockquote>
<blockquote>
<p>The module signing tool to be run at a build. Two arguments will be passed to the signing tool. The first argument is the target kernel version, the second is the module file path. If the tool exits with a non-zero value, the build will be aborted.</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/53">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/53</link>
        <pubDate>Fri, 06 Dec 2019 08:03:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-53</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://lists.archlinux.org/pipermail/arch-general/2015-July/039589.html" class="onebox" target="_blank" rel="nofollow noopener">https://lists.archlinux.org/pipermail/arch-general/2015-July/039589.html</a></p>
<blockquote>
<p>Signed modules don’t really offer any added security with a vanilla<br>
kernel because root still has full control over the kernel via other<br>
known mechanisms (i.e. no exploits necessary). The feature is mostly useful for enforcing a <em>policy</em> of not allowing third party modules, similar to the kernel taint bits which can be overwritten if you really feel like doing it.</p>
</blockquote>
<blockquote>
<p>It’s not a very compelling feature though because it’s only truly useful in combination with a fully read-only root and grsecurity’s romount_protect feature.</p>
</blockquote>
<blockquote>
<p>A strong MAC policy could also plug the other attack routes… but it’s also going to prevent loading modules for that role anyway.</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/52">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/52</link>
        <pubDate>Sat, 26 Oct 2019 18:42:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-52</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>The issue was closed.</p>
<p><a href="https://github.com/systemd/systemd/issues/13540#issuecomment-540471295" rel="nofollow noopener">https://github.com/systemd/systemd/issues/13540#issuecomment-540471295</a></p>
<blockquote>
<p>I don’t think this is for upstream systemd to manage. It may be possible to declare a static list of modules to load, but it is only possible in very specific circumstances, when you know exactly which hardware, which network devices, which network protocols, which encryption types, etc, etc, any given application will use. But even on a medium-sized distro this would be completely infeasible.</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/51">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/51</link>
        <pubDate>Thu, 10 Oct 2019 16:36:02 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-51</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="45" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><a href="https://github.com/systemd/systemd/issues/13540" rel="nofollow noopener">Issue: various applications broken with kernel.modules_disabled=1 - how should applications declare what kernel modules they require?</a></p>
</blockquote>
</aside>
<p>Got answer:</p>
<p><a href="https://github.com/systemd/systemd/issues/13540#issuecomment-539505897" rel="nofollow noopener">https://github.com/systemd/systemd/issues/13540#issuecomment-539505897</a></p>
<blockquote>
<p>Why would you turn off on-demand loading? Where is the difference of loading something ondemand vs explicitly when it comes to security? If you dont trust a module dont ship/install it. If you trust it it shouldnt mayter if you load it at boot or when actually used. What am I missing?</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/50">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/50</link>
        <pubDate>Tue, 08 Oct 2019 14:15:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-50</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="48" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>There is a currently unaccepted patch that restricts auto-loading of kernel modules to root only called the <a href="https://www.openwall.com/lists/kernel-hardening/2017/02/02/21" rel="nofollow noopener">Timgad LSM</a> though.</p>
</blockquote>
</aside>
<p>This is a much better and more recent version of the patch.</p>
<p><a href="https://lkml.org/lkml/2017/11/27/754" class="onebox" target="_blank" rel="nofollow noopener">https://lkml.org/lkml/2017/11/27/754</a></p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/49">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/49</link>
        <pubDate>Sat, 28 Sep 2019 15:07:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-49</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>It turns out, this won’t only be useful for the root user. Unprivileged users can still indirectly load kernel modules through auto-loading.</p>
<p>E.g. an attacker tries to use X protocol, the needed kernel module is auto-loaded even though the attacker is unprivileged and then the attacker exploits a vulnerability in X module.</p>
<p>Setting <code>kernel.modules_disabled=1</code> will prevent the module from being loaded regardless.</p>
<p>Blacklisting the modules in modprobe.d would also prevent auto-loading of that specific module as it makes run <code>/bin/false</code> instead of auto-loading it.</p>
<p>There is a currently unaccepted patch that restricts auto-loading of kernel modules to root only called the <a href="https://www.openwall.com/lists/kernel-hardening/2017/02/02/21" rel="nofollow noopener">Timgad LSM</a> though.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/48">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/48</link>
        <pubDate>Fri, 27 Sep 2019 18:39:59 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-48</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://packages.debian.org/buster/lockdown" rel="nofollow noopener">https://packages.debian.org/buster/lockdown</a> already invented disabling module after boot.</p>
<ul>
<li><a href="https://gitlab.com/taggart/lockdown" rel="nofollow noopener">https://gitlab.com/taggart/lockdown</a></li>
<li><a href="https://gitlab.com/taggart/lockdown/blob/master/lockdown" rel="nofollow noopener">https://gitlab.com/taggart/lockdown/blob/master/lockdown</a></li>
<li><a href="https://gitlab.com/taggart/lockdown/blob/master/debian/lockdown.service" rel="nofollow noopener">https://gitlab.com/taggart/lockdown/blob/master/debian/lockdown.service</a></li>
</ul>
<p>It could be improved to fine tune when module lockdown happens. At the moment execution time isn’t fixed.</p>
<p>Contacted <code>lockdown</code> and <code>hardening-runtime</code>.</p>
<blockquote>
<p>Package: hardening-runtime<br>
Severity: wishlist<br>
X-Debbugs-CC: <a href="mailto:whonix-devel@whonix.org">whonix-devel@whonix.org</a></p>
<p>We now have (at least) three very similar packages.</p>
<ul>
<li><a href="https://packages.debian.org/buster/lockdown" rel="nofollow noopener">https://packages.debian.org/buster/lockdown</a></li>
<li><a href="https://packages.debian.org/buster/hardening-runtime" rel="nofollow noopener">https://packages.debian.org/buster/hardening-runtime</a></li>
<li><a href="https://github.com/Whonix/security-misc" rel="nofollow noopener">https://github.com/Whonix/security-misc</a></li>
</ul>
<p>Let’s join forces before we independently reinvent everything.</p>
<p>Cheers,<br>
Patrick</p>
</blockquote>
<ul>
<li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=940310" rel="nofollow noopener">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=940310</a></li>
<li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=940311" rel="nofollow noopener">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=940311</a></li>
</ul>
<p>The idea is to have more eyes on this. And more benefit to more users. Therefore also beneficial due to wider testing.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/47">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/47</link>
        <pubDate>Sun, 15 Sep 2019 12:54:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-47</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="44" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What happened to <code>ModAutoRestrict LSM</code> ?</p>
</blockquote>
</aside>
<p>It probably got scrapped in favour of <code>kernel.modules_disabled=1</code>.</p>
<p>I have no idea why people try to make features like these LSMs. It’s just unneeded complexity for a simple option.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/46">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/46</link>
        <pubDate>Thu, 12 Sep 2019 17:08:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-46</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/systemd/systemd/issues/13540" target="_blank" rel="nofollow noopener">github.com/systemd/systemd</a>
  </header>
  <article class="onebox-body">
    <a href="https://github.com/adrelanos" rel="nofollow noopener">
<img src="https://avatars1.githubusercontent.com/u/1985040?v=2&amp;s=96" class="thumbnail onebox-avatar" width="60" height="60">
</a>

<h4><a href="https://github.com/systemd/systemd/issues/13540" target="_blank" rel="nofollow noopener">Issue: various applications broken with kernel.modules_disabled=1 - how should applications declare what kernel modules they require?</a></h4>

<div class="date" style="margin-top:10px;">
	<div class="user" style="margin-top:10px;">
	opened by <a href="https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
	on <a href="https://github.com/systemd/systemd/issues/13540" target="_blank" rel="nofollow noopener">2019-09-12</a>
	</div>
	<div class="user">
	</div>
</div>

<pre class="content" style="white-space: pre-wrap;">We've been contemplating to make use of linux kernel sysctl kernel.modules_disabled=1 for better kernel hardening by dropping a configuration snippet /etc/sysctl.d/module-loading.conf
kernel.modules_disabled=1
systemd-sysctl.service...</pre>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/45">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/45</link>
        <pubDate>Thu, 12 Sep 2019 11:19:12 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-45</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>What happened to <code>ModAutoRestrict LSM</code>?</p>
<p><a href="https://lwn.net/Articles/719385/" class="onebox" target="_blank" rel="nofollow noopener">https://lwn.net/Articles/719385/</a></p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/44">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/44</link>
        <pubDate>Thu, 12 Sep 2019 11:05:31 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-44</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="42" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Need to ask various upstream, not sure to whom this is up.</p>
</blockquote>
</aside>
<p>Probably systemd since it handles the module loading and sysctl.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/43">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/43</link>
        <pubDate>Wed, 11 Sep 2019 16:51:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-43</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>madaidan via Whonix Forum:</p>
<blockquote>
<aside class="quote no-group" data-post="40" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>However, I don’t think the current approach using <code>/usr/lib/modules-load.d</code> folder is a good implementation.</p>
</blockquote>
</aside>
<p>An alternative way would be to create a systemd service that runs after systemd-modules-load.service and sets <code>kernel.modules_disabled=1</code>.</p>
</blockquote>
<p>… and after systemd-sysctl.service (since that can be used to<br>
influence kernel module loading).</p>
<blockquote>
<p>This should make sure that all modules are loaded before we set that setting.&gt; I haven’t tested this though and it might lead to another error like<br>
with systemd-sysctl.</p>
</blockquote>
<p>Does not work for sure. <code>kloak</code> as is now would still fail to load since<br>
trying to autoload the <code>uinput</code> kernel module. We’d still need to use<br>
<code>/usr/lib/modules-load.d</code>.</p>
<p>Need to find out if there is a better way than requiring all upstreams<br>
to define their modules in <code>/usr/lib/modules-load.d</code>.</p>
<blockquote>
<aside class="quote no-group" data-post="40" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It would be better to load those systemd units that require kernel modules early enough before <code>systemd-sysctl.service</code> .</p>
</blockquote>
</aside>
<p>I don’t think that’s a good idea, systemd-sysctl is one of the first services to start. Starting a bunch of units before that would likely be way too early.</p>
</blockquote>
<p>Good point. Might be inappropriate for some services indeed. Need to ask<br>
various upstream, not sure to whom this is up. Looks like unchartered<br>
territory. Very few search results on search engines.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/42">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/42</link>
        <pubDate>Wed, 11 Sep 2019 07:42:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-42</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="40" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>However, I don’t think the current approach using <code>/usr/lib/modules-load.d</code> folder is a good implementation.</p>
</blockquote>
</aside>
<p>An alternative way would be to create a systemd service that runs after systemd-modules-load.service and sets <code>kernel.modules_disabled=1</code>.</p>
<p>This should make sure that all modules are loaded before we set that setting. I haven’t tested this though and it might lead to another error like with systemd-sysctl.</p>
<aside class="quote no-group" data-post="40" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It would be better to load those systemd units that require kernel modules early enough before <code>systemd-sysctl.service</code> .</p>
</blockquote>
</aside>
<p>I don’t think that’s a good idea, systemd-sysctl is one of the first services to start. Starting a bunch of units before that would likely be way too early.</p>
<aside class="quote no-group" data-post="40" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>A graphical session (perhaps X, XFCE and/or lightdm) automatically loads module <code>binfmt_misc</code> .</p>
</blockquote>
</aside>
<p>The official documentation is here <a href="https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html" rel="nofollow noopener">https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html</a></p>
<p>Not sure what it’s used for.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/41">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/41</link>
        <pubDate>Tue, 10 Sep 2019 19:34:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-41</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>For development / debugging it is useful to use <code>sort</code> to format the output of <code>lsmod</code> to make it easier readable and comparable. I.e.:</p>
<pre><code>sudo lsmod | sort
</code></pre>
<p>And write to a file.</p>
<pre><code>sudo lsmod | sort &gt; lsmod_before
</code></pre>
<p>Then disable module loading. And load some modules through <code>/usr/lib/modules-load.d</code> folder or so. Then look at lsmod again.</p>
<pre><code>sudo lsmod | sort &gt; lsmod_after
</code></pre>
<p>Then compare.</p>
<pre><code>meld lsmod_before lsmod_after
</code></pre>
<hr>
<p>Use of <code>kernel.modules_disabled=1</code> is now possible and initially documented:<br>
<a href="https://www.whonix.org/wiki/Operating_System_Hardening#Module_Loading" rel="nofollow noopener">https://www.whonix.org/wiki/Operating_System_Hardening#Module_Loading</a></p>
<p>However, I don’t think the current approach using <code>/usr/lib/modules-load.d</code> folder is a good implementation. Therefore not committed to git yet. Just a proof of concept. It would be better to load those systemd units that require kernel modules early enough before <code>systemd-sysctl.service</code>. Therefore we could avoid being the first distribution writing to <code>/usr/lib/modules-load.d</code> folder.</p>
<p>The problem with <code>/usr/lib/modules-load.d</code> is:</p>
<ul>
<li>non-standard</li>
<li>not yet discussed with any upstream</li>
<li>manually maintained module lists might get outdated after kernel upgrades, things might break</li>
</ul>
<p>We’re not the first ever to have this issue. Bug was reported here <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1198949" rel="nofollow noopener">https://bugzilla.redhat.com/show_bug.cgi?id=1198949</a> and then dismissed. That doesn’t discourage us discussing this elsewhere.</p>
<hr>
<p><code>lsmod</code> columns here:</p>
<blockquote>
<p>Module                  Size  Used by</p>
</blockquote>
<p>Modules have “dependency trees”. Therefore I skiped adding those modules to <code>/usr/lib/modules-load.d</code> which are not <code>Used by</code> other modules. The idea was to only add the “top level” modules and let dependencies resolve itself in case in later kernel versions dependencies change (less modules perhaps) no update of the file would be required.</p>
<hr>
<p>Working on this seems worthwhile. Thereby we can review what kernel modules are load, learn new things, perhaps reduce attack surface. For example:</p>
<p>A graphical session (perhaps X, XFCE and/or lightdm) automatically loads module <code>binfmt_misc</code>. Seems to be this:</p>
<aside class="onebox wikipedia">
  <header class="source">
      <a href="https://en.wikipedia.org/wiki/Binfmt_misc" target="_blank" rel="nofollow noopener">en.wikipedia.org</a>
  </header>
  <article class="onebox-body">
    

<h3><a href="https://en.wikipedia.org/wiki/Binfmt_misc" target="_blank" rel="nofollow noopener">binfmt_misc</a></h3>

<p>binfmt_misc is a capability of the Linux kernel which allows arbitrary executable file formats to be recognized and passed to certain user space applications, such as emulators and virtual machines. It is one of a number of binary format handlers in the kernel that are involved in preparing a user-space program to run. 
 The executable formats are registered through the special purpose file system binfmt_misc file-system interface (usually mounted under part of /proc). This is either done directl...</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Dunno yet if it is a good idea to have this in the kernel. It’s possible to avoid loading this module too but don’t know yet if it breaks anything.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/40">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/40</link>
        <pubDate>Tue, 10 Sep 2019 15:58:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-40</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/vmonaco/kloak/issues/16" target="_blank" rel="nofollow noopener">github.com/vmonaco/kloak</a>
  </header>
  <article class="onebox-body">
    <a href="https://github.com/adrelanos" rel="nofollow noopener">
<img src="https://avatars1.githubusercontent.com/u/1985040?v=2&amp;s=96" class="thumbnail onebox-avatar" width="60" height="60">
</a>

<h4><a href="https://github.com/vmonaco/kloak/issues/16" target="_blank" rel="nofollow noopener">Issue: fails to start when using linux kernel.modules_disabled=1 sysctl</a></h4>

<div class="date" style="margin-top:10px;">
	<div class="user" style="margin-top:10px;">
	opened by <a href="https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
	on <a href="https://github.com/vmonaco/kloak/issues/16" target="_blank" rel="nofollow noopener">2019-09-10</a>
	</div>
	<div class="user">
	</div>
</div>

<pre class="content" style="white-space: pre-wrap;">When using /etc/sysctl.d/module-loading.conf
kernel.modules_disabled=1
kloak fails to start.
Creating a file /usr/lib/modules-load.d/kloak.conf
uinput
fixes the issue.
But I don't know if that is a proper solution to...</pre>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/39">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/39</link>
        <pubDate>Tue, 10 Sep 2019 15:42:00 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-39</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="36" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Just nontrivial to know the name of the actual name of the module. Not same as <code>lsmod</code> .</p>
</blockquote>
</aside>
<p>Ah, that’s why it didn’t work for me the last time. I formatted the output of the two lsmods to get the list of modules.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/38">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/38</link>
        <pubDate>Mon, 09 Sep 2019 16:13:42 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-38</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>We might not have to invent a DKMS module signing mechanism.</p>
<p>The VirtualBox upgrade from <code>6.0.8</code> to <code>6.0.10</code> might have broken this.</p>
<p>As per: <a href="https://www.virtualbox.org/ticket/11577?cnum_edit=16#comment:26" rel="nofollow noopener">https://www.virtualbox.org/ticket/11577?cnum_edit=16#comment:26</a></p>
<p>Above says that reverting <a href="https://www.virtualbox.org/changeset/79186/vbox" rel="nofollow noopener">https://www.virtualbox.org/changeset/79186/vbox</a> fixed the issue.</p>
<p>I don’t know where to find that file on the disk. So can’t patch this.</p>
<p>Also that ticket seems to be about VirtualBox host modules but I guess the source code for module signing is being re-used for guest additions too. So still related.</p>
<hr>
<p>Btw this is the tool already on the drive which allows to sign modules.</p>
<pre><code>/usr/src/linux-headers-*/scripts/sign-file
</code></pre>
<p>Good to know but hopefully no need to use it for this very purpose.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/37">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/37</link>
        <pubDate>Mon, 09 Sep 2019 11:04:26 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-37</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
      <item>
        <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</title>
        <dc:creator><![CDATA[Patrick_mobile]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-post="22" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Approach to fix: Create a file <code>/usr/lib/modules-load.d/whonix-firewall.conf</code> with contents</p>
<pre><code class="lang-auto">nf_tables
</code></pre>
<p>more needed etc. etc. Help welcome.</p>
</blockquote>
</aside>
<p>This drop-in folder is functional. Tested. Module got load amd the error message was a different one. Just nontrivial to know the name of the actual name of the module. Not same as <code>lsmod</code>. Try to load it manually beforehand.</p>
          <p><a href="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/36">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880/36</link>
        <pubDate>Mon, 09 Sep 2019 03:46:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7880-36</guid>
        <source url="http://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880.rss">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</source>
      </item>
  </channel>
</rss>
