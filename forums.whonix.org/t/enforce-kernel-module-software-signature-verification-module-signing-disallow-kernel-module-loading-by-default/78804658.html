<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>enforce kernel module software signature verification [module signing] / disallow kernel module loading by default - Development - Whonix Forum</title>
    <meta name="description" content="We can restrict kernel modules to only be loaded if they’re signed by a valid key. This increases security by making it harder to load a malicious module. We can do this by adding module.sig_enforce=1 as a kernel paramet&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.9 - https://github.com/discourse/discourse version 1503ec07c57898a507395552b765b6808b4e1db9">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/2/222b7257d0600f2bc69cf77e6bc273aa0074ed4e_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="78804658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.whonix.org","potentialAction":{"@type":"SearchAction","target":"https://forums.whonix.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Whonix Forum Search">

      <link href="../../stylesheets/desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5.css_%3b%20filename_%3dUTF-8%27%27desktop_eaead85939ea2f99650f56b40c8681f4e1cb68d5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="../../stylesheets/desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6c.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_f7af26cfd21c1d79bdb82342526b638dccef9d6cd2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3" data-theme-name="header"/>
<link href="../../stylesheets/desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_4_56ca71d15f2048e2e474553f0c3928756f57aec5d2c8.css?__ws=forums.whonix.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4" data-theme-name="default"/>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/">HOME</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Download">DOWNLOAD</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Documentation">DOCS</a>]
[<a href="../../c/news/21.html">NEWS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Support">SUPPORT</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Forum_Best_Practices">TIPS</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Reporting_Bugs#Issue_Tracker">ISSUES</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contribute">CONTRIBUTE</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Donate">DONATE</a>]
</center>
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;enforce kernel module software signature verification [module signing] / disallow kernel module loading by default&#39;" href="7880.rss" />
    <meta property="og:site_name" content="Whonix Forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.whonix.org/uploads/default/original/2X/a/ac61071d4245560068a380cd1c08c97d1da2201d.jpeg" />
<meta property="og:image" content="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" />
<meta property="og:url" content="https://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880?page=2" />
<meta name="twitter:url" content="https://forums.whonix.org/t/enforce-kernel-module-software-signature-verification-module-signing-disallow-kernel-module-loading-by-default/7880?page=2" />
<meta property="og:title" content="enforce kernel module software signature verification [module signing] / disallow kernel module loading by default" />
<meta name="twitter:title" content="enforce kernel module software signature verification [module signing] / disallow kernel module loading by default" />
<meta property="og:description" content="Maybe these could be considered bugs in these packages? Perhaps packages should declare what modules they need somewhere so such things cannot happen?  To debug…  lsmod on a fully booted, functional system without kernel.modules_disabled=1. Save output.  Then boot with kernel.modules_disabled=1 and run lsmod again. Save output.  Compare the two outputs." />
<meta name="twitter:description" content="Maybe these could be considered bugs in these packages? Perhaps packages should declare what modules they need somewhere so such things cannot happen?  To debug…  lsmod on a fully booted, functional system without kernel.modules_disabled=1. Save output.  Then boot with kernel.modules_disabled=1 and run lsmod again. Save output.  Compare the two outputs." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="9 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="80 ❤" />
<meta property="article:published_time" content="2019-09-06T11:50:47+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="prev" href="7880.html">
        <link rel="next" href="78809ba9.html?page=3">

    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html" alt="Whonix Forum" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="7880.html">enforce kernel module software signature verification [module signing] / disallow kernel module loading by default</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/development/8.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/component_security.html' class='discourse-tag' rel="tag">component_security</a>, 
            <a href='../../tag/status_open_issue_todo.html' class='discourse-tag' rel="tag">status_open_issue_todo</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-06T11:50:47Z' class='post-time'>
                September 6, 2019, 11:50am
              </time>
              <meta itemprop='dateModified' content='2019-09-06T11:50:47Z'>
          <span itemprop='position'>#21</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="17" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Setting <code>kernel.modules_disabled=1</code> in /etc/sysctl.d broke a lot of things. whonix-firewall, onion-grater, kloak and some others all failed to start and the screen hanged.</p>
</blockquote>
</aside>
<p>Maybe these could be considered bugs in these packages? Perhaps packages should declare what modules they need somewhere so such things cannot happen?</p>
<p>To debug…</p>
<p><code>lsmod</code> on a fully booted, functional system without <code>kernel.modules_disabled=1</code>. Save output.</p>
<p>Then boot with <code>kernel.modules_disabled=1</code> and run <code>lsmod</code> again. Save output.</p>
<p>Compare the two outputs.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>
          <meta itemprop='keywords' content='component_security, status_open_issue_todo'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T05:34:08Z' class='post-time'>
                September 7, 2019,  5:34am
              </time>
              <meta itemprop='dateModified' content='2019-09-07T05:34:08Z'>
          <span itemprop='position'>#22</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Failing systemd unit files using <code>kernel.modules_disabled=1</code>:</p>
<ul>
<li><code>kloak</code></li>
<li><code>whonix-firewall</code></li>
<li><code>virtualbox-guest-utils</code></li>
<li>
<code>lightdm</code> - this may or may not be just a follow up issue of <code>virtualbox-guest-utils</code> failing.</li>
</ul>
<p>This is fixable in principle. Modules can be declared by dropping <code>/usr/lib/modules-load.d</code> snippets. These will be load in time before <code>kernel.modules_disabled=1</code> kicks in. Tested.</p>
<p><a href="../../../external.html?link=https://www.freedesktop.org/software/systemd/man/modules-load.d.html" class="onebox" target="_blank" rel="nofollow noopener">https://www.freedesktop.org/software/systemd/man/modules-load.d.html</a></p>
<p>Approach to fix: Create a file <code>/usr/lib/modules-load.d/whonix-firewall.conf</code> with contents</p>
<pre><code>nf_tables
</code></pre>
<p>more needed etc. etc. Help welcome.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T05:37:36Z' class='post-time'>
                September 7, 2019,  5:37am
              </time>
              <meta itemprop='dateModified' content='2019-12-06T08:30:05Z'>
          <span itemprop='position'>#23</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="1" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><code>module.sig_enforce=1</code></p>
</blockquote>
</aside>
<p>This broke starting a graphical desktop environment in VirtualBox when upgrading Whonix 15.0.0.3.3 from Whonix stable repository.</p>
<blockquote>
<p>sudo modprobe vboxdrv<br>
modprobe: ERROR: could not insert ‘vboxdrv’: Required key not available</p>
</blockquote>
<p>Upstream bug reports:</p>
<ul>
<li><a href="../../../external.html?link=https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=935961">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=935961</a></li>
<li><a href="../../../external.html?link=https://www.virtualbox.org/ticket/11577">https://www.virtualbox.org/ticket/11577</a></li>
</ul>
<p>Will therefore revert.</p>
<p>Fixing this for real should be possible by either just signing the VirtualBox guest additions modules:</p>
<ul>
<li><a href="../../../external.html?link=https://github.com/ivan-californias/vbox-sign-modules">https://github.com/ivan-californias/vbox-sign-modules</a></li>
<li><a href="../../../external.html?link=https://github.com/Majal/maj-scripts/blob/master/vboxsign">https://github.com/Majal/maj-scripts/blob/master/vboxsign</a></li>
<li><a href="../../../external.html?link=https://gist.github.com/reillysiemens/ac6bea1e6c7684d62f544bd79b2182a4">https://gist.github.com/reillysiemens/ac6bea1e6c7684d62f544bd79b2182a4</a></li>
</ul>
<p>Or better a more generic solution of signing all DKMS modules:</p>
<ul>
<li><a href="../../../external.html?link=https://gist.github.com/dop3j0e/2a9e2dddca982c4f679552fc1ebb18df">https://gist.github.com/dop3j0e/2a9e2dddca982c4f679552fc1ebb18df</a></li>
</ul>
<p>Once this is sorted, can be re-enabled.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="4" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../whonix-virtualbox-vms-no-longer-boot-after-updating/8035/4.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../whonix-virtualbox-vms-no-longer-boot-after-updating/8035/4.html'>
                      <span itemprop='name'>Whonix VirtualBox VMs no longer boot after updating</span>
                    </a>
                    <meta itemprop='position' content='7'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../kernel-recompilation-for-better-hardening/7598/77.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../kernel-recompilation-for-better-hardening/7598/77.html'>
                      <span itemprop='name'>kernel recompilation for better hardening</span>
                    </a>
                    <meta itemprop='position' content='8'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T05:42:11Z' class='post-time'>
                September 7, 2019,  5:42am
              </time>
              <meta itemprop='dateModified' content='2019-09-07T05:42:11Z'>
          <span itemprop='position'>#24</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubcommit">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/Whonix/security-misc/commit/661bcd8603425934188cf139f33e20675ff4b765" target="_blank" rel="nofollow noopener">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
      <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">
    <img alt="adrelanos" src="../../../external.html?link=https://avatars3.githubusercontent.com/u/1985040?v=4" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="../../../external.html?link=https://github.com/Whonix/security-misc/commit/661bcd8603425934188cf139f33e20675ff4b765" target="_blank" rel="nofollow noopener">allow loading unsigned modules due to issues</a>
</h4>

  <pre class="message" style="white-space: normal;">https://forums.whonix.org/t/allow-loading-signed-kernel-modules-by-default-disallow-kernel-module-loading-by-default/7880/23</pre>

<div class="date">
  by <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
  on <a href="../../../external.html?link=https://github.com/Whonix/security-misc/commit/661bcd8603425934188cf139f33e20675ff4b765" target="_blank" rel="nofollow noopener">05:39AM - 07 Sep 19 UTC</a>
</div>

<div class="github-commit-stats">
  changed <strong>3 files</strong>
  with <strong>3 additions</strong>
  and <strong>9 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T15:23:47Z' class='post-time'>
                September 7, 2019,  3:23pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T15:23:47Z'>
          <span itemprop='position'>#25</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="23" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Or better a more generic solution of signing all DKMS modules:</p>
</blockquote>
</aside>
<p>I don’t think this should be done. I think we should only allow the modules we need to make the chance something malicious is accidentally signed at a minimum.</p>
<p>Can we just add the scripts to sign the virtualbox modules to a systemd service and make it run at first boot or does it not work that way?</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="3" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T16:15:05Z' class='post-time'>
                September 7, 2019,  4:15pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T16:15:05Z'>
          <span itemprop='position'>#26</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>40 kernel modules failed to load when setting <code>kernel.modules_disabled=1</code> in virtualbox for me. A list of them all is <a href="../../../external.html?link=https://pastebin.com/HfMYWRk0" rel="nofollow noopener">here</a>.</p>
<p>Putting them in /usr/lib/modules-load.d didn’t work. Creating a systemd service that loads every needed module and runs before systemd-sysctl.service worked fine.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/HulaHoop'><span itemprop='name'>HulaHoop</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T17:41:11Z' class='post-time'>
                September 7, 2019,  5:41pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T17:41:11Z'>
          <span itemprop='position'>#27</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="25" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t think this should be done. I think we should only allow the modules we need to make the chance something malicious is accidentally signed at a minimum.</p>
</blockquote>
</aside>
<p>Anyhing that break VBox an something as critical as Kloak is a no go.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T17:48:49Z' class='post-time'>
                September 7, 2019,  5:48pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T17:48:49Z'>
          <span itemprop='position'>#28</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="27" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Anyhing that break VBox an something as critical as Kloak is a no go.</p>
</blockquote>
</aside>
<p>Yes, I meant we only allow the needed modules like vbox and kloak instead of just allowing all DKMS modules.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T17:54:53Z' class='post-time'>
                September 7, 2019,  5:54pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T17:54:53Z'>
          <span itemprop='position'>#29</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="25" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t think this should be done. I think we should only allow the modules we need to make the chance something malicious is accidentally signed at a minimum</p>
</blockquote>
</aside>
<p>Ok. A generic mechanism but no auto signing all.</p>
<aside class="quote no-group" data-post="25" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Can we just add the scripts to sign the virtualbox modules to a systemd service and make it run at first boot or does it not work that way?</p>
</blockquote>
</aside>
<p>Might work. Yes, has to be done at first boot. Can’t do at build time likely? Vs signing key.<br>
Also has to be done automatically after DKMS so it does not break during vbox guest additions upgrades.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T18:00:49Z' class='post-time'>
                September 7, 2019,  6:00pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T18:00:49Z'>
          <span itemprop='position'>#30</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="29" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Also has to be done automatically after DKMS so it does not break during vbox guest additions upgrades.</p>
</blockquote>
</aside>
<p>Would using /etc/kernel/postinst.d work for this or no?</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T18:04:11Z' class='post-time'>
                September 7, 2019,  6:04pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T18:04:11Z'>
          <span itemprop='position'>#31</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Might work.</p>
<p>Dunno yet if there are DKMS hooks to sign after module build.</p>
<p>Good point. Might need to hook both. Kernel upgrades and vbox guest additions upgrades because each can receive updates independently and then requiring rebuild.</p>
<p>I guess DKMS runs anyhow on kernel upgrade.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T18:18:47Z' class='post-time'>
                September 7, 2019,  6:18pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T18:18:47Z'>
          <span itemprop='position'>#32</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="31" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Dunno yet if there are DKMS hooks to sign after module build.</p>
</blockquote>
</aside>
<p>Would an apt hook be sufficient?</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-07T19:07:25Z' class='post-time'>
                September 7, 2019,  7:07pm
              </time>
              <meta itemprop='dateModified' content='2019-09-07T19:07:25Z'>
          <span itemprop='position'>#33</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="26" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Creating a systemd service that loads every needed module and runs before systemd-sysctl.service worked fine.</p>
</blockquote>
</aside>
<p>It turns out, this actually prevents systemd-sysctl.service from starting. I tried adding <code>Before=systemd-sysctl.service</code> to my own systemd service and tried adding <code>After=systemd-sysctl.service</code> to systemd-sysctl but neither worked. Systemd skips it because of some ordering cycle. This prevents any sysctl modifications like the files in /etc/sysctl.d from taking effect.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-08T03:53:54Z' class='post-time'>
                September 8, 2019,  3:53am
              </time>
              <meta itemprop='dateModified' content='2019-09-08T03:53:54Z'>
          <span itemprop='position'>#34</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="32" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Would an apt hook be sufficient?</p>
</blockquote>
</aside>
<p>There are no apt hooks. Dpkg hooks maybe. And dpkg triggers.</p>
<p>Foremost though, for trigger DKMS has to be exhausted.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-08T17:35:12Z' class='post-time'>
                September 8, 2019,  5:35pm
              </time>
              <meta itemprop='dateModified' content='2019-09-08T17:35:12Z'>
          <span itemprop='position'>#35</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Looking at the <a href="../../../external.html?link=https://manpages.ubuntu.com/manpages/precise/man8/dkms.8.html" rel="nofollow noopener">DKMS manpage</a>, the POST and PRE options look interesting.</p>
<p>Also see the dkms.conf overrides sections.</p>
<p>It looks like we can just create a file /etc/dkms/virtualbox-guest.conf that has <code>POST_BUILD=command</code> or <code>PRE_INSTALL=command</code> in it. “command” being the script used to sign the module.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick_mobile'><span itemprop='name'>Patrick_mobile</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-09T03:46:10Z' class='post-time'>
                September 9, 2019,  3:46am
              </time>
              <meta itemprop='dateModified' content='2019-09-09T03:46:10Z'>
          <span itemprop='position'>#36</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="22" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Approach to fix: Create a file <code>/usr/lib/modules-load.d/whonix-firewall.conf</code> with contents</p>
<pre><code class="lang-auto">nf_tables
</code></pre>
<p>more needed etc. etc. Help welcome.</p>
</blockquote>
</aside>
<p>This drop-in folder is functional. Tested. Module got load amd the error message was a different one. Just nontrivial to know the name of the actual name of the module. Not same as <code>lsmod</code>. Try to load it manually beforehand.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-09T11:04:26Z' class='post-time'>
                September 9, 2019, 11:04am
              </time>
              <meta itemprop='dateModified' content='2019-09-09T11:04:26Z'>
          <span itemprop='position'>#37</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>We might not have to invent a DKMS module signing mechanism.</p>
<p>The VirtualBox upgrade from <code>6.0.8</code> to <code>6.0.10</code> might have broken this.</p>
<p>As per: <a href="../../../external.html?link=https://www.virtualbox.org/ticket/11577?cnum_edit=16#comment:26" rel="nofollow noopener">https://www.virtualbox.org/ticket/11577?cnum_edit=16#comment:26</a></p>
<p>Above says that reverting <a href="../../../external.html?link=https://www.virtualbox.org/changeset/79186/vbox" rel="nofollow noopener">https://www.virtualbox.org/changeset/79186/vbox</a> fixed the issue.</p>
<p>I don’t know where to find that file on the disk. So can’t patch this.</p>
<p>Also that ticket seems to be about VirtualBox host modules but I guess the source code for module signing is being re-used for guest additions too. So still related.</p>
<hr>
<p>Btw this is the tool already on the drive which allows to sign modules.</p>
<pre><code>/usr/src/linux-headers-*/scripts/sign-file
</code></pre>
<p>Good to know but hopefully no need to use it for this very purpose.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/madaidan'><span itemprop='name'>madaidan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-09T16:13:42Z' class='post-time'>
                September 9, 2019,  4:13pm
              </time>
              <meta itemprop='dateModified' content='2019-09-09T16:13:42Z'>
          <span itemprop='position'>#38</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="36" data-topic="7880">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/p/898d66/40.png" class="avatar"> Patrick_mobile:</div>
<blockquote>
<p>Just nontrivial to know the name of the actual name of the module. Not same as <code>lsmod</code> .</p>
</blockquote>
</aside>
<p>Ah, that’s why it didn’t work for me the last time. I formatted the output of the two lsmods to get the list of modules.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-10T15:42:00Z' class='post-time'>
                September 10, 2019,  3:42pm
              </time>
              <meta itemprop='dateModified' content='2019-09-10T15:42:00Z'>
          <span itemprop='position'>#39</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="onebox githubissue">
  <header class="source">
      <a href="../../../external.html?link=https://github.com/vmonaco/kloak/issues/16" target="_blank" rel="nofollow noopener">github.com/vmonaco/kloak</a>
  </header>
  <article class="onebox-body">
    <a href="../../../external.html?link=https://github.com/adrelanos" rel="nofollow noopener">
<img src="../../../external.html?link=https://avatars1.githubusercontent.com/u/1985040?v=2&amp;s=96" class="thumbnail onebox-avatar" width="60" height="60">
</a>

<h4><a href="../../../external.html?link=https://github.com/vmonaco/kloak/issues/16" target="_blank" rel="nofollow noopener">Issue: fails to start when using linux kernel.modules_disabled=1 sysctl</a></h4>

<div class="date" style="margin-top:10px;">
	<div class="user" style="margin-top:10px;">
	opened by <a href="../../../external.html?link=https://github.com/adrelanos" target="_blank" rel="nofollow noopener">adrelanos</a>
	on <a href="../../../external.html?link=https://github.com/vmonaco/kloak/issues/16" target="_blank" rel="nofollow noopener">2019-09-10</a>
	</div>
	<div class="user">
	</div>
</div>

<pre class="content" style="white-space: pre-wrap;">When using /etc/sysctl.d/module-loading.conf
kernel.modules_disabled=1
kloak fails to start.
Creating a file /usr/lib/modules-load.d/kloak.conf
uinput
fixes the issue.
But I don't know if that is a proper solution to...</pre>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
            <meta itemprop='name' content='Whonix - Anonymous Operating System'>
              <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
                <meta itemprop='url' content='../../uploads/default/original/2X/d/d66e6a1341d872ca984eb1f23d30009afef57a4c.html'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
            <a itemprop="url" href='../../../external.html?link=https://forums.whonix.org/u/Patrick'><span itemprop='name'>Patrick</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7880.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-10T15:58:45Z' class='post-time'>
                September 10, 2019,  3:58pm
              </time>
              <meta itemprop='dateModified' content='2019-09-10T15:58:45Z'>
          <span itemprop='position'>#40</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>For development / debugging it is useful to use <code>sort</code> to format the output of <code>lsmod</code> to make it easier readable and comparable. I.e.:</p>
<pre><code>sudo lsmod | sort
</code></pre>
<p>And write to a file.</p>
<pre><code>sudo lsmod | sort &gt; lsmod_before
</code></pre>
<p>Then disable module loading. And load some modules through <code>/usr/lib/modules-load.d</code> folder or so. Then look at lsmod again.</p>
<pre><code>sudo lsmod | sort &gt; lsmod_after
</code></pre>
<p>Then compare.</p>
<pre><code>meld lsmod_before lsmod_after
</code></pre>
<hr>
<p>Use of <code>kernel.modules_disabled=1</code> is now possible and initially documented:<br>
<a href="../../../external.html?link=https://www.whonix.org/wiki/Operating_System_Hardening#Module_Loading" rel="nofollow noopener">https://www.whonix.org/wiki/Operating_System_Hardening#Module_Loading</a></p>
<p>However, I don’t think the current approach using <code>/usr/lib/modules-load.d</code> folder is a good implementation. Therefore not committed to git yet. Just a proof of concept. It would be better to load those systemd units that require kernel modules early enough before <code>systemd-sysctl.service</code>. Therefore we could avoid being the first distribution writing to <code>/usr/lib/modules-load.d</code> folder.</p>
<p>The problem with <code>/usr/lib/modules-load.d</code> is:</p>
<ul>
<li>non-standard</li>
<li>not yet discussed with any upstream</li>
<li>manually maintained module lists might get outdated after kernel upgrades, things might break</li>
</ul>
<p>We’re not the first ever to have this issue. Bug was reported here <a href="../../../external.html?link=https://bugzilla.redhat.com/show_bug.cgi?id=1198949" rel="nofollow noopener">https://bugzilla.redhat.com/show_bug.cgi?id=1198949</a> and then dismissed. That doesn’t discourage us discussing this elsewhere.</p>
<hr>
<p><code>lsmod</code> columns here:</p>
<blockquote>
<p>Module                  Size  Used by</p>
</blockquote>
<p>Modules have “dependency trees”. Therefore I skiped adding those modules to <code>/usr/lib/modules-load.d</code> which are not <code>Used by</code> other modules. The idea was to only add the “top level” modules and let dependencies resolve itself in case in later kernel versions dependencies change (less modules perhaps) no update of the file would be required.</p>
<hr>
<p>Working on this seems worthwhile. Thereby we can review what kernel modules are load, learn new things, perhaps reduce attack surface. For example:</p>
<p>A graphical session (perhaps X, XFCE and/or lightdm) automatically loads module <code>binfmt_misc</code>. Seems to be this:</p>
<aside class="onebox wikipedia">
  <header class="source">
      <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Binfmt_misc" target="_blank" rel="nofollow noopener">en.wikipedia.org</a>
  </header>
  <article class="onebox-body">
    

<h3><a href="../../../external.html?link=https://en.wikipedia.org/wiki/Binfmt_misc" target="_blank" rel="nofollow noopener">binfmt_misc</a></h3>

<p>binfmt_misc is a capability of the Linux kernel which allows arbitrary executable file formats to be recognized and passed to certain user space applications, such as emulators and virtual machines. It is one of a number of binary format handlers in the kernel that are involved in preparing a user-space program to run. 
 The executable formats are registered through the special purpose file system binfmt_misc file-system interface (usually mounted under part of /proc). This is either done directl...</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Dunno yet if it is a good idea to have this in the kernel. It’s possible to avoid loading this module too but don’t know yet if it breaks anything.</p>
        </div>

        <meta itemprop='headline' content='enforce kernel module software signature verification [module signing] / disallow kernel module loading by default'>

        <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../sysrq-magic-sysrq-key/8079/38.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../sysrq-magic-sysrq-key/8079/38.html'>
                      <span itemprop='name'>SysRq (Magic SysRq key)</span>
                    </a>
                    <meta itemprop='position' content='4'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                    <a href="../kernel-hardening/7296/193.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='../kernel-hardening/7296/193.html'>
                      <span itemprop='name'>Kernel Hardening</span>
                    </a>
                    <meta itemprop='position' content='5'>
                  </div>
            </div>
      </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><a rel="prev" itemprop="url" href="7880.html">← previous page</a></span>
        <span itemprop='name'><b><a rel="next" itemprop="url" href="78809ba9.html?page=3">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../../external.html?link=https://forums.whonix.org/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <center>
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Imprint">Imprint</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Privacy_Policy">Privacy Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Cookie_Policy">Cookie Policy</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Terms_of_Use">Terms of Use</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/E-Sign_Consent">E-Sign Consent</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/DMCA">DMCA</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Contributors">Contributors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Investors">Investors</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Priority_Support">Priority Support</a>]
[<a href="../../../external.html?link=https://www.whonix.org/wiki/Professional_Support">Professional Support</a>]
</center>
    
  </body>
  
</html>
