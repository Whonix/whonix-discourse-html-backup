<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Improve Onion Service Usability by Script / GUI</title>
    <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117</link>
    <description>I don&#39;t approve of the attitude of the forum thread starter but this again highlights usability issues.

While usability for onion services has room for improvement, on the other thand this applies to other aspects of Whonix too. Understanding what Whonix is and Installation of Whonix is still something most people fail at. Whonix-Host will help with usability since Whonix becomes a &quot;standard conformant&quot; Linux distribution available as iso. It also helps with security since then host security improvements are easy to deploy as probably few follow all host hardening instructions.

[quote=&quot;onion_knight, post:50, topic:9042&quot;]
Having an automatic system to create onion and web services integrated into Whonix, or at least a simpler way of doing it, could be a great idea.
[/quote]
I was thinking about this.

There are some issues with scripts for improved usability. These add a level of mysticism as people start to think the functionality is dependent on the functionality of the scripts. Things the script does not ever then starts to seem impossible. Technical background that was previously simple gets mystified. People stop looking at the actual generated configuration files.

For example for https://forums.whonix.org/t/onion-services-authentication/975 which is probably too difficult to manually set up, I created some scripts:

* [anon-auth-autogen](https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/bin/anon-auth-autogen)
* [anon-server-to-client-install](https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/usr/bin/anon-server-to-client-install)
* [man anon-auth-autogen](https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/man/anon-auth-autogen.8.ronn)
* [man anon-server-to-client-install](https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/man/anon-server-to-client-install.8.ronn)

But in case that breaks in future or doesn&#39;t work in some case, can someone look at the actual config files or even send bug fixes for these scripts?

Also the bug of duplicate parsing of torrc in this thread wasn&#39;t caught by anyone which was caused by anon-connection-wizard modifying Tor config files.

An onion services usability script... Where does it start and where does it end? Should it support just 1 thing. Onion web server? Server on non-standard ports? Onion services authentication? I am wondering what&#39;s the best way to implement this? Related to https://forums.whonix.org/t/focus-on-low-effort-maintainability/9067.

* Implement declarative? I.e. Tor config file snippets which get copied [or symlinked if that is possible]) once the script runs? That is easier code, easier to review/understand but more limited as only a few use cases could be simplified that way before too many config snippets get hard to manage / too much.
  * `sudo apt install anon-gw-onion-server-web` - that package shipping the required config snippets? That would allow for an easy/clean implementation but there can&#39;t be thousands of packages supporting all use cases.
   * If going that way, there then could be a companion package `sudo apt install anon-ws-onion-server-web`.
* Implement functional? I.e. similar to anon-auth-autogen? Then any non-standard things (non-standard ports, something other than default webserver port) requires the script to be run with a parameter. And this script will become more complex/lengthy since it has to handle these variables.
  * Similar to `sudo virtport=80 hsport=80 hsname=hidden_service client=1 anon-auth-autogen`.
  * Users would then more or less mindlessly copy/paste such commands from the wiki. But would that effort be useful? If it&#39;s a copy/paste job anyhow, could instead could also just provide one-liners in the wiki. See https://forums.whonix.org/t/to-use-or-to-not-use-one-liners-this-is-the-question/4824. And then the effort for the script could be saved.

As for onion services usability GUI... Well, I regard a GUI a frontend. Before frontend development makes sense, there needs be a backend, the script. If the script isn&#39;t easy to use, then it&#39;s also not easy to write a mostly bug free GUI. By separating backend and frontend also debugging gets easier and hopefully things are also easier to understand.</description>
    <language>en</language>
    <lastBuildDate>Mon, 19 Sep 2022 17:35:36 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>Hm.</p>
<p>I think it should be on the <code>Onion Services</code> whonix page, but not get rid of it.</p>
<p>It can reliably and completely do all of the steps shown on that page.</p>
<p>But that guide is useful if someone wants to learn how to do it, instead of just running a script that does every step.</p>
<p>So I think it is best to add a section of <code>automated onion service management</code> instead of replacing the manual steps.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/59">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/59</link>
        <pubDate>Mon, 19 Sep 2022 17:35:36 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-59</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Now on a second thought, once review is done and onionjugger is installed by default, would it be better to edit <a href="https://www.whonix.org/wiki/Onion_Services" class="inline-onebox">Onion Services - Whonix</a> instead? Then the current manual instructions could be moved to wiki/Deprecated/Onion_Services.</p>
<p>That is only if onionjugger could completely (and reliably) replace the manual onion setup instructions currently on wiki/Onion_Services. (Not a problem is not.)</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/58">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/58</link>
        <pubDate>Mon, 19 Sep 2022 17:13:38 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-58</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>I have to update the readme…</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="56" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<blockquote>
<p>WARNING: do not trust this repo yet, backup your hs keys in another location. This project has not been released and should be considered for development only.</p>
</blockquote>
<p>Does this still apply?</p>
</blockquote>
</aside>
<p>No, the problem was that the TUI was buggy when the dialog was missing options, making the service name appear wrong, and could lead to wrong purging of keys.</p>
<p>This passed but I didn’t remove the warning because, well, it is better if someone else then me test, because developers are normally blind on the code they see everyday.</p>
<p>Using onionjuggler on Whonix made I improve onionjuggler usability overall by separating scripts and manuals to different files instead of one big file as it was in the beginning. So I’d say it is running smoothly for me, but if you find any problems, comment.</p>
<aside class="quote no-group" data-username="Patrick" data-post="56" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does the command <code>backup</code> work in Whonix?</p>
<p>What would the <code>vanguards</code> command do inside Whonix?</p>
</blockquote>
</aside>
<p>Photos need to be updated also, it still looks like that, but without the <code>vanguards</code> and <code>backup</code>. I removed them</p>
<ul>
<li>vanguards had no recently signed git tag</li>
<li>backup was too difficult to manage, to reintegrate mostly without overwriting files.</li>
</ul>
<aside class="quote no-group" data-username="Patrick" data-post="56" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What about other commands?</p>
<p>Always with the question in mind for each command, what if the user runs that command in the wrong VM? WIll onionjuggler bail out with an error message?</p>
</blockquote>
</aside>
<p>Yes, <a href="https://github.com/Whonix/anon-apps-config/blob/master/etc/onionjuggler/conf.d/30_whonix.conf#L29" class="inline-onebox" rel="noopener nofollow ugc">anon-apps-config/30_whonix.conf at master · Whonix/anon-apps-config · GitHub</a><br>
<a href="https://github.com/Whonix/anon-apps-config/blob/master/etc/onionjuggler/conf.d/30_whonix.conf#L54" class="inline-onebox" rel="noopener nofollow ugc">anon-apps-config/30_whonix.conf at master · Whonix/anon-apps-config · GitHub</a></p>
<p>Only the enabled plugins will be able to run, if not, exit with error message that plugin is deactivated.</p>
<p>onion authentication via files can’t be run from the workstation, just the gateway.</p>
<p>web (nginx) script is enforced via that config to only run on the workstation, because as it is a simple script to create a webserver, if user really wants to create it on the gateway, then that is their task to do it manually.</p>
<aside class="quote no-group" data-username="Patrick" data-post="56" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>What about other commands?</p>
</blockquote>
</aside>
<p>Everything that can be run from the cli, can be run from the tui.<br>
This is a design goal and is actually difficult to make because the TUI  has to adapt depending on what scripts are available, which services, files, authorizations exist.</p>
<p>I’d say the the CLI is pumping but the TUI needs some work on the code, although it is working, it needs to use more functions to return instead of large if else statements.</p>
<aside class="quote no-group" data-username="Patrick" data-post="56" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Also helpful would be a wiki page in Whonix wiki. Should I create one and could you document some examples please?</p>
</blockquote>
</aside>
<p>Yes, I can document all examples.<br>
The commands are almost the same as on plain debian, except the target host that is most of the times the workstation or enforce to run service on the gateway with the <code>--gateway</code> option.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/57">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/57</link>
        <pubDate>Mon, 19 Sep 2022 16:46:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-57</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>That’s quite a big contribution and will take some time to review.</p>
<p>Non-Qubes-Whonix would need at least some basic support. In worst case it would say it doesn’t work on Non-Qubes-Whonix but I guess Non-Qubes-Whonix will already have similar functionality to Qubes-Whonix wrt to onionjuggler.</p>
<p>Quote <a href="https://github.com/nyxnor/onionjuggler" class="inline-onebox">GitHub - nyxnor/onionjuggler: Manage your Onion Services via CLI or TUI on Unix-like operating system with a POSIX compliant shell.</a></p>
<blockquote>
<p>WARNING: do not trust this repo yet, backup your hs keys in another location. This project has not been released and should be considered for development only.</p>
</blockquote>
<p>Does this still apply?</p>
<p><a href="https://github.com/nyxnor/onionjuggler/raw/main/images/tui-whiptail.png">https://github.com/nyxnor/onionjuggler/raw/main/images/tui-whiptail.png</a> looks nice.</p>
<p><a href="https://github.com/nyxnor/onionjuggler/raw/main/images/cli.png">https://github.com/nyxnor/onionjuggler/raw/main/images/cli.png</a> looks also nice.</p>
<p>Does the command <code>backup</code> work in Whonix?</p>
<p>What would the <code>vanguards</code> command do inside Whonix?</p>
<p>What about other commands?</p>
<p>Always with the question in mind for each command, what if the user runs that command in the wrong VM? WIll onionjuggler bail out with an error message?</p>
<p>Also helpful would be a wiki page in Whonix wiki. Should I create one and could you document some examples please?</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/56">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/56</link>
        <pubDate>Mon, 19 Sep 2022 15:19:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-56</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>fixed issue with qube whonix file persistence to support <code>/usr/local/etc</code>.</p>
<p>Patrick,<br>
Is there a plan to include onionjuggler to Whonix packages or is something you feel the advantages vs disadvantages of packaging and guiding?</p>
<p>I only tested on qube-whonix and plain debian, but it might be function on non-qubes-whonix.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/55">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/55</link>
        <pubDate>Thu, 15 Sep 2022 16:03:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-55</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>updated the design above to explain about saving files and signaling tor.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/54">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/54</link>
        <pubDate>Wed, 24 Aug 2022 11:56:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-54</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="52" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Tor parses <code>*.conf</code>. I didn’t test if that would also match <code>*.conf-orig</code></p>
</blockquote>
</aside>
<p>It does not match <code>*.conf-orig</code>. It would match if the include line was <code>%include *.conf*</code>, with an extra <code>*</code> as the end, but that would be wrong anyway and the correct is <code>*.conf</code>.</p>
<aside class="quote no-group" data-username="Patrick" data-post="52" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>best to avoid <code>.conf</code> inside temporary or backup files altogether?</p>
</blockquote>
</aside>
<p>Tor doesn’t parse hidden files unless explictly set to:<br>
man torrc</p>
<pre><code class="lang-auto">       The supported wildcards are * meaning any number of characters including none and ? meaning exactly one character.
       These characters can be escaped by preceding them with a backslash, except on Windows. Files starting with a dot are
       not matched when expanding wildcards unless the starting dot is explicitly in the pattern, except on Windows.
</code></pre>
<p>So unless the include pattern is <code>%include .*.conf</code> (notice the dot in the beginning, it won’t parse hidden files because whonix include is <code>%include *.conf</code>.</p>
<p>Then tor wouldn’t parse that file and it would be verified, and that is the problem, what is why it needs <code>.conf</code>.<br>
Previously I was not using that for the temporary file and the verify config was not working because of that, the temporary file was not being included.<br>
Anyway, to reasons not to worry about that:</p>
<ul>
<li>there is a fail safe trap for all possible signals EXIT INT QUIT TERM</li>
</ul>
<aside class="onebox githubblob" data-onebox-src="https://github.com/nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L312">
  <header class="source">

      <a href="https://github.com/nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L312" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L312" target="_blank" rel="noopener nofollow ugc">nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L312</a></h4>



    <pre class="onebox">      <code class="lang-sh">
        <ol class="start lines" start="302" style="counter-reset: li-counter 301 ;">
            <li>          notice "File ${file_name_tmp} differs from ${file_tmp_orig}"</li>
            <li>          notice "Moving temporary ${file_name_tmp} back to its original location ${file}"</li>
            <li>          mv "${file_name_tmp}" "${file}"</li>
            <li>          notice "Removing original file that was made hidden ${file_tmp_orig}"</li>
            <li>          rm -f "${file_tmp_orig}"</li>
            <li>        fi</li>
            <li>      done</li>
            <li>    ;;</li>
            <li>  esac</li>
            <li>
            </li>
<li class="selected">  trap 'trap_exit_all' EXIT INT QUIT TERM</li>
            <li>}</li>
            <li>
            </li>
<li>
            </li>
<li># shellcheck disable=SC2086</li>
            <li>trap_exit_all(){</li>
            <li>  trap_exit_restore ${exit_restore_file}</li>
            <li>  notice "Removing temporary files"</li>
            <li>  rm -fv ${exit_remove_file}</li>
            <li>}</li>
            <li>
        </li>
</ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<ul>
<li>
<p>It is not possible to trap KILL signal, so unless you get the onionjuggler pid of a script that takes less than 2 seconds to run and kill it, certainly improbable.</p>
</li>
<li>
<p>if for whatever reason, the trap fails (if you can make it fail, let me know, I already tried), the temporary file has a distinctive name <code>ORIGINALFILENAME.XXXXXX.tmp.conf</code>, where XXXXXX is generated by mktemp a random string. And the original file name will be hidden  with name <code>.ORIGINALFILENAME-orig</code> but can be found with <code>ls -a</code>.</p>
</li>
</ul>
<p>But again, this is never necessary because the trap works.</p>
<aside class="quote no-group" data-username="Patrick" data-post="52" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>This file extension <code>.conf</code> should with certainty be avoided for temporary files.</p>
</blockquote>
</aside>
<p>The same way tor wouldn’t include files without <code>*.conf</code>, it wouldn’t verify the temporary file without the <code>*.conf</code>, so it is necessary.</p>
<p>Modify this line to remove the file suffix and see what happens  with <code>set -x</code></p><aside class="onebox githubblob" data-onebox-src="https://github.com/nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L274">
  <header class="source">

      <a href="https://github.com/nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L274" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L274" target="_blank" rel="noopener nofollow ugc">nyxnor/onionjuggler/blob/main/usr/share/onionjuggler/defaults.sh#L274</a></h4>



    <pre class="onebox">      <code class="lang-sh">
        <ol class="start lines" start="264" style="counter-reset: li-counter 263 ;">
            <li>## create an empty file if not existent</li>
            <li>if test -f "${file}"; then</li>
            <li>  file_tmp_orig_suffix="orig"</li>
            <li>else</li>
            <li>  file_tmp_orig_suffix="new"</li>
            <li>  notice "Creating empty file on ${file}"</li>
            <li>  touch "${file}"</li>
            <li>fi</li>
            <li>file_tmp_orig="${file_dir}/.${file_name}-${file_tmp_orig_suffix}"</li>
            <li>file_tmp_pattern="${file_name}.XXXXX.tmp"</li>
            <li class="selected">test -n "${file_suffix}" &amp;&amp; file_tmp_pattern="${file_tmp_pattern}.${file_suffix}"</li>
            <li>file_name_tmp="$(mktemp "${file_dir}/${file_tmp_pattern}")"</li>
            <li>notice "Saving a copy of ${file} to ${file_name_tmp}"</li>
            <li>chown "${tor_conf_user_group}" "${file_name_tmp}"</li>
            <li>## copy preserving mode</li>
            <li>cp -p "${file}" "${file_name_tmp}"</li>
            <li>## tor won't parse a hidden file</li>
            <li>notice "Moving original file ${file} to ${file_tmp_orig}"</li>
            <li>mv "${file}" "${file_tmp_orig}"</li>
            <li>## delete temp file. Also, if the hidden file still exists, means it wasn't saved,</li>
            <li>## so move it back to original location.</li>
        </ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Also read <a href="https://github.com/nyxnor/onionjuggler/issues/66#issuecomment-1212480961" rel="noopener nofollow ugc">https://github.com/nyxnor/onionjuggler/issues/66#issuecomment-1212480961</a></p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/53">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/53</link>
        <pubDate>Wed, 24 Aug 2022 11:53:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-53</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="nyxnor" data-post="51" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p><code>.40_onionjuggler.conf-orig</code> (it needs to have a dot to be hidden and tor not parse it twice.</p>
</blockquote>
</aside>
<p>Tor parses <code>*.conf</code>. I didn’t test if that would also match <code>*.conf-orig</code> but if it does, perhaps best to avoid <code>.conf</code> inside temporary or backup files altogether?</p>
<aside class="quote no-group" data-username="nyxnor" data-post="51" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>move the original file to the same path under the name <code>40_onionjuggler.conf.XXXXXX.tmp.conf</code>.</p>
</blockquote>
</aside>
<p>This file extension <code>.conf</code> should with certainty be avoided for temporary files.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/52">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/52</link>
        <pubDate>Wed, 24 Aug 2022 10:21:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-52</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>With the auto complete feature, it can list enabled servers with TABTAB</p><aside class="onebox githubissue" data-onebox-src="https://github.com/nyxnor/onionjuggler/issues/10">
  <header class="source">

      <a href="https://github.com/nyxnor/onionjuggler/issues/10" target="_blank" rel="noopener nofollow ugc">github.com/nyxnor/onionjuggler</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/nyxnor/onionjuggler/issues/10" target="_blank" rel="noopener nofollow ugc">[FEATURE REQUEST] - shell completion</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2021-11-18" data-time="19:23:38" data-timezone="UTC">07:23PM - 18 Nov 21 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/nyxnor" target="_blank" rel="noopener nofollow ugc">
          <img alt="nyxnor" src="https://avatars.githubusercontent.com/u/69700936?v=4" class="onebox-avatar-inline" width="20" height="20">
          nyxnor
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          enhancement
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">**Is your feature request related to a problem? Please describe.**

Those are <span class="show-more-container"><a href="http://forums.whonix.org" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">the most used shells and known to me that have completion (more to come if someone helps), I want that to be improved.
* https://github.com/nyxnor/onionservice/blob/main/etc/bash_completion/onionservice-cli
* https://github.com/nyxnor/onionservice/tree/main/etc/zsh_completion

**Describe the solution you'd like**

* Bash completion [official package](https://github.com/scop/bash-completion/) and [debian guide](http://web.archive.org/web/20200507173259/https://debian-administration.org/article/317/An_introduction_to_bash_completion_part_2)

**Additional context**

Low priority, it will be very useful but not intrinsic required.

- only bash, https://unix.stackexchange.com/a/158523
- https://maskedbyte.com/how-to-create-a-custom-bash-completion-script/</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Just to give an overview of the project:</p>
<ul>
<li>I didn’t have a basis for the project as I don’t see any prominent tor related project trying to handle the torrc, they normally interact with the controller that has expected responses, and onion services created on the controller don’t have to deal with the file system, but they disappear on every tor start, which then the user would have to load the private key of the service every time tor is restarted. You can test this as instructed in <a href="https://github.com/nyxnor/tor-ctrl/issues/17" rel="noopener nofollow ugc">https://github.com/nyxnor/tor-ctrl/issues/17</a>
</li>
<li>So there may be a simpler an easier way to do what onionjuggler is doing and not break the torrc with an invalid configuration, but I don’t know how.</li>
<li>onionjuggler tries its best to filter user input to avoid special characters, avoid wrong paths, avoid wrong ports, wrong client keys, because even though there is a fail mechanism that if tor fails to --verify-config, it will restore the original file, it is a last resort and sometimes not informative of the problem, so I prefer the method fail fast, so the user is informed about the problem.</li>
</ul>
<h2>
<a name="design-1" class="anchor" href="http://forums.whonix.org#design-1"></a>Design</h2>
<ul>
<li>check if tor configuration is valid before running anything
<ul>
<li>if not, warn about it and exit</li>
<li>if not but you believe you know the problem and want to restore with onionjuggler, then there is an env variable for it documented on the manual.</li>
</ul>
</li>
<li>check user input
<ul>
<li>if service configuration already exist when creating one with the same name, warn and error out</li>
<li>if ports are not valid, warn and error out</li>
<li>if client keys, config or onion is not valid, warn and error out</li>
</ul>
</li>
<li>safe_edit():
<ul>
<li>copy the orignal torrc (/usr/loca/etc/torrc.d/40_onionjuggler.conf) to the same path under the name <code>.40_onionjuggler.conf-orig</code> (it needs to have a dot to be hidden and tor not parse it twice.</li>
<li>move the original file to the same path under the name <code>40_onionjuggler.conf.XXXXXX.tmp.conf</code>. The suffix <code>.conf</code> is dynamic, it works for client files with <code>.auth</code> and <code>.auth_private</code>. This temporary file will be parsed.</li>
</ul>
</li>
<li>echo user input to temporary file.</li>
<li>verify_config_tor():
<ul>
<li>verify configuration including all configuraitons so it can be valid, with debian and derived including whonix, it runs <code>tor -f /etc/tor/torrc --defaults-torrc /usr/share/tor/tor-service-defaults-torrc --verify-config hush</code>, so the <code>.tmp.conf</code> is included and is parsed because it ends with <code>.conf</code>.</li>
<li>if verification fails, move <code>-orig</code> to orignal location, remove <code>.tmp.conf</code>.</li>
<li>if  verification succeeds, move <code>.tmp.conf</code> to original location, remove <code>-orig</code>.</li>
</ul>
</li>
<li>safe_edit save:
<ul>
<li>now that it didn’t exit on the verify config, save modified temp file to original location and remove <code>.file-orig</code>.</li>
</ul>
</li>
<li>signal_tor:
<ul>
<li>signal tor to reload (default), restart, none. The <code>reload</code> is all you normally need. The <code>restart</code> is only if the config was previously broken and you need to restart it. The <code>none</code> is for when running a lot of time and you don’t want to reload tor because it will signal newnym tons of times and will overload the guards and you will loose connection.</li>
</ul>
</li>
<li>ending with info:
<ul>
<li>at the end, important info will be printed, to which file the data was inserted, the full data that was inserted, how to connect etc.</li>
</ul>
</li>
</ul>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/51">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/51</link>
        <pubDate>Wed, 24 Aug 2022 09:59:11 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-51</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Merged, thanks!</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/50">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/50</link>
        <pubDate>Mon, 22 Aug 2022 10:59:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-50</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest" data-onebox-src="https://github.com/Whonix/anon-apps-config/pull/2">
  <header class="source">

      <a href="https://github.com/Whonix/anon-apps-config/pull/2" target="_blank" rel="noopener">github.com/Whonix/anon-apps-config</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/anon-apps-config/pull/2" target="_blank" rel="noopener">add onionjuggler whonix conf</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>nyxnor:onionjuggler-inclusion</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-08-17" data-time="20:08:34" data-timezone="UTC">08:08PM - 17 Aug 22 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/nyxnor" target="_blank" rel="noopener">
          <img alt="nyxnor" src="https://avatars.githubusercontent.com/u/69700936?v=4" class="onebox-avatar-inline" width="20" height="20">
          nyxnor
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 63 additions and 0 deletions">
        <a href="https://github.com/Whonix/anon-apps-config/pull/2/files" target="_blank" rel="noopener">
          <span class="added">+63</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">This is the only command that needs to be done to update the conf if ever change<span class="show-more-container"><a href="https://github.com/Whonix/anon-apps-config/pull/2" target="_blank" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">d upstream:
```sh
cp onionjuggler/etc/onionjuggler/anon.conf anon-apps-config/etc/onionjuggler/conf.d/30_whonix.conf
```</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/49">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/49</link>
        <pubDate>Mon, 22 Aug 2022 10:59:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-49</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>The port syntax is the same as SSH tunnel handler and qvm-connect-tcp</p>
<p>Examples of the same syntax:</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.whonix.org/wiki/File_Transfer#Setup_Host">
  <header class="source">
      <img src="https://www.whonix.org/w/images/a/a4/Whonix-home-favicon.ico" class="site-icon" width="32" height="32">

      <a href="https://www.whonix.org/wiki/File_Transfer#Setup_Host" target="_blank" rel="noopener nofollow ugc" title="02:51PM - 12 August 2022">Whonix – 12 Aug 22</a>
  </header>

  <article class="onebox-body">
    <img src="https://www.whonix.org/w/images/2/2c/Filetransfer-2126883640.png" class="thumbnail onebox-avatar" width="500" height="500">

<h3><a href="https://www.whonix.org/wiki/File_Transfer#Setup_Host" target="_blank" rel="noopener nofollow ugc">File Transfer</a></h3>

  <p>Copying files into and out of Whonix ™ Virtual Machines.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.qubes-os.org/doc/firewall/#opening-a-single-tcp-port-to-other-network-isolated-qube">
  <header class="source">
      <img src="https://www.qubes-os.org/attachment/icons/512x512/apps/qubes-logo-icon.png" class="site-icon" width="500" height="500">

      <a href="https://www.qubes-os.org/doc/firewall/#opening-a-single-tcp-port-to-other-network-isolated-qube" target="_blank" rel="noopener nofollow ugc">Qubes OS</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/362;"><img src="https://www.qubes-os.org/attachment/icons/qubes-logo-icon-name-slogan-fb.png" class="thumbnail" width="690" height="362"></div>

<h3><a href="https://www.qubes-os.org/doc/firewall/#opening-a-single-tcp-port-to-other-network-isolated-qube" target="_blank" rel="noopener nofollow ugc">Firewall</a></h3>

  <p>Understanding firewalling in Qubes Every qube in Qubes is connected to the network via a FirewallVM, which is used to enforce network-level policies. By default there is one default FirewallVM, but the user is free to create more, if needed. For more...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/48">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/48</link>
        <pubDate>Fri, 19 Aug 2022 09:26:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-48</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="45" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I haven’t looked deep enough yet. Hence, skipped this question for now. I didn’t find <code>--gateway</code> in the man page. Therefore not sure I understand the question good enough.</p>
</blockquote>
</aside>
<aside class="onebox githubblob" data-onebox-src="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md">
  <header class="source">

      <a href="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md" target="_blank" rel="noopener nofollow ugc">nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md</a></h4>


      <pre><code class="lang-md">% ONIONJUGGLER-CLI(8) Dinamically juggle with onion services with a POSIX compliant shell
% Written by nyxnor (nyxnor@protonmail.com)
% default_date

# NAME

onionjuggler-cli - Dinamically juggle with onion services with a POSIX compliant shell


# SYNOPSIS

**onionjuggler-cli** [**--option**&lt;=*ARGUMENT*&gt;]\
**onionjuggler-cli --on** [**--service** &lt;*SERVICE*&gt;] [**--version** &lt;*VERSION*&gt;] [**--socket** &lt;*tcp*&gt;] [**--port** &lt;*VIRTPORT*[:*TARGET*],[*VIRTPORTn*][:*TARGETn*]&gt;] [**--gateway**]\
**onionjuggler-cli --on**  [**--service** &lt;*SERVICE*&gt;] [**--version** &lt;*VERSION*&gt;] [**--socket** &lt;*unix*&gt;] [**--port** [*VIRTPORT*,[*VIRTPORT2*]&gt;]\
**onionjuggler-cli --off** [**--service** &lt;*SERV1*,*SERV2*,*...*&gt;] [**--purge**]\
**onionjuggler-cli --list** [**--service** &lt;*@all*|*SERV1*,*SERV2*,*...*&gt;] [**--quiet**]\
**onionjuggler-cli --renew** [**--service** &lt;*@all*|*SERV1*,*SERV2*,*...*&gt;]\
**onionjuggler-cli [-V|--version]**\
**onionjuggler-cli [--getconf]**\
**onionjuggler-cli [--getopt]** [**--service** &lt;*SERVICE*&gt;]\
</code></pre>



  This file has been truncated. <a href="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-username="Patrick" data-post="45" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>For a cli tool, I don’t know any easy option. In the default setup without multiple workstation, that’s easier, since IP could be hardcoded. So a low level CLI tool probably shouldn’t have a hardcoded default. But any higher level usability tools on top could guide through that by asking that as a question (“Do you use multiple Whonix-Workstation behind the same Whonix-Gateway?” or “Did you change Whonix-Workstation internal IP address? In doubt, say no”)</p>
</blockquote>
</aside>
<p>It doesn’t have that, for now, if Qubes-Whonix user doesn’t modify the target on the onionjuggler configuration or on the cli, it will error out.</p>
<pre><code class="lang-auto">$ sudo ./onionjuggler-cli --on --service abc --port 6000
Saving a copy of /usr/local/etc/torrc.d/40_onionjuggler.conf to /usr/local/etc/torrc.d/40_onionjuggler.conf.afaqv.conf
Moving original file /usr/local/etc/torrc.d/40_onionjuggler.conf to /usr/local/etc/torrc.d/.40_onionjuggler.conf-orig
Including Hidden Service configuration to /usr/local/etc/torrc.d/40_onionjuggler.conf.afaqv.conf

HiddenServiceDir /var/lib/tor/services/abc
HiddenServiceVersion 3
error: Option '--gateway' was not specified but target was set to 127.0.0.1. Either set the Workstation Qube IP address using the option 'tor_hiddenserviceport_target_addr' on /etc/onionjuggler/conf.d/*.conf to target a WS or use the gateway option to enforce a service to be run on the GW

Restoring /usr/local/etc/torrc.d/.40_onionjuggler.conf-orig to /usr/local/etc/torrc.d/40_onionjuggler.conf
removed '/usr/local/etc/torrc.d/40_onionjuggler.conf.afaqv.conf'
</code></pre>
<p>but giving the target on cli or conf works</p>
<pre><code class="lang-auto">sudo ./onionjuggler-cli --on --service abc --port 80:10.137.0.10:6000
Saving a copy of /usr/local/etc/torrc.d/40_onionjuggler.conf to /usr/local/etc/torrc.d/40_onionjuggler.conf.gMjNp.conf
Moving original file /usr/local/etc/torrc.d/40_onionjuggler.conf to /usr/local/etc/torrc.d/.40_onionjuggler.conf-orig
Including Hidden Service configuration to /usr/local/etc/torrc.d/40_onionjuggler.conf.gMjNp.conf

HiddenServiceDir /var/lib/tor/services/abc
HiddenServiceVersion 3
HiddenServicePort 80 10.137.0.10:6000

Verifying tor configuration
Aug 19 09:04:19.649 [warn] Option 'DisableNetwork' used more than once; all but the last value will be ignored.
Configuration OK
File /usr/local/etc/torrc.d/40_onionjuggler.conf.gMjNp.conf differs from /usr/local/etc/torrc.d/.40_onionjuggler.conf-orig
Moving temporary /usr/local/etc/torrc.d/40_onionjuggler.conf.gMjNp.conf back to its original location /usr/local/etc/torrc.d/40_onionjuggler.conf
Removing original file that was made hidden /usr/local/etc/torrc.d/.40_onionjuggler.conf-orig
</code></pre>
<p>The problem here is usability, mentioning the target every time if not configured otherwise.</p>
<aside class="quote no-group" data-username="Patrick" data-post="45" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Seems rather complex. I guess best is to keep the code simple and a low level CLI tool should always require everything mandatory. A higher level usability tool could help the user in the easy cases. For very advanced users, these could use the command line parameters and/or environment variables.</p>
</blockquote>
</aside>
<p>So I will remove the default target address for hiddenservices, which does not have a default for qubes-whonix.<br>
The target will be mandary on the cli.</p>
<aside class="quote no-group" data-username="Patrick" data-post="45" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>That syntax seems a bit weird. <code>--port</code> might be too generic a name here? Hidden service virtual port or local port? But then the parameter is not a simple port. It’s port:ip:port ip:port.</p>
</blockquote>
</aside>
<aside class="onebox githubblob" data-onebox-src="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md#options">
  <header class="source">

      <a href="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md#options" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md#options" target="_blank" rel="noopener nofollow ugc">nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md#options</a></h4>


      <pre><code class="lang-md">% ONIONJUGGLER-CLI(8) Dinamically juggle with onion services with a POSIX compliant shell
% Written by nyxnor (nyxnor@protonmail.com)
% default_date

# NAME

onionjuggler-cli - Dinamically juggle with onion services with a POSIX compliant shell


# SYNOPSIS

**onionjuggler-cli** [**--option**&lt;=*ARGUMENT*&gt;]\
**onionjuggler-cli --on** [**--service** &lt;*SERVICE*&gt;] [**--version** &lt;*VERSION*&gt;] [**--socket** &lt;*tcp*&gt;] [**--port** &lt;*VIRTPORT*[:*TARGET*],[*VIRTPORTn*][:*TARGETn*]&gt;] [**--gateway**]\
**onionjuggler-cli --on**  [**--service** &lt;*SERVICE*&gt;] [**--version** &lt;*VERSION*&gt;] [**--socket** &lt;*unix*&gt;] [**--port** [*VIRTPORT*,[*VIRTPORT2*]&gt;]\
**onionjuggler-cli --off** [**--service** &lt;*SERV1*,*SERV2*,*...*&gt;] [**--purge**]\
**onionjuggler-cli --list** [**--service** &lt;*@all*|*SERV1*,*SERV2*,*...*&gt;] [**--quiet**]\
**onionjuggler-cli --renew** [**--service** &lt;*@all*|*SERV1*,*SERV2*,*...*&gt;]\
**onionjuggler-cli [-V|--version]**\
**onionjuggler-cli [--getconf]**\
**onionjuggler-cli [--getopt]** [**--service** &lt;*SERVICE*&gt;]\
</code></pre>



  This file has been truncated. <a href="https://github.com/nyxnor/onionjuggler/blob/main/man/onionjuggler-cli.8.md#options" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Actually, I experimented with a lot of syntax options before, and this seemed the better  so far, but contributions can be received.<br>
The syntax is <code>--port VIRTPORT[:TARGET_ADDR[:TARGET_PORT]] VIRTPORTn[:TARGET_ADDRn[:TARGET_PORTn]]</code></p>
<p>Virtport is the onion service virtual port.<br>
Target address and port is the local address and port.</p>
<p>Any number of HiddenServicePort lines can be used, it loops.<br>
So you can set <code>--port="80 22" --gateway</code> or <code>--port="80:127.0.0.1 22:127.0.0.1" --gateway</code> or <code>--port="80:127.0.0.1:80 22:127.0.0.1:22" --gateway</code> and both will produce:</p>
<pre><code class="lang-auto">HiddenServicePort 80
HiddenServicePort 22
</code></pre>
<p>or</p>
<pre><code class="lang-auto">HiddenServicePort 80 127.0.0.1
HiddenServicePort 22 127.0.0.1
</code></pre>
<p>But for uniformity I make the script only create full explict options</p>
<pre><code class="lang-auto">HiddenServicePort 80 127.0.0.1:80
HiddenServicePort 22 127.0.0.1:22
</code></pre>
<p>as these options are equal.</p>
<p>Actualy, my syntax is following tor defaults.<br>
If only VIRTPORT is set but TARGET is not, bind the VIRTPORT port to 127.0.0.1:VIRTPORT<br>
If VIRTPORT is set but TARGET_PORT is not set, bind the same port to TARGET_ADDR:VIRTPORT.</p>
<p>This can be read on <code>man torrc</code> and <code>man onionjuggler-cli</code></p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/47">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/47</link>
        <pubDate>Fri, 19 Aug 2022 09:14:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-47</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="42" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does it use Tor configuration drop-in folder <code>/etc/tor/torrc.d</code>? In Qubes-Whonix, <code>/usr/local/etc/tor/torrc.d</code> would be required so for consistency for all Whonix platforms <code>/usr/local/etc/tor/torrc.d</code>.</p>
</blockquote>
</aside>
<p>On that note, I noticed something yesterday.</p>
<p><code>onionjuggler --list</code> to print service information only list services that are managed by onionjuggler.conf, which is kinda expected, but on the other hand, it will mist services created by other files and  other programs. Maybe I should list all services on the system and indicate which ones are managed by each files…</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/46">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/46</link>
        <pubDate>Fri, 19 Aug 2022 09:00:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-46</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I haven’t looked deep enough yet. Hence, skipped this question for now. I didn’t find <code>--gateway</code> in the man page. Therefore not sure I understand the question good enough.</p>
<aside class="quote no-group" data-username="nyxnor" data-post="41" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>But if it is more secure to host different application servers on different workstation,</p>
</blockquote>
</aside>
<p>More secure probably but that really depends on user preferences, effort vs security.</p>
<aside class="quote no-group" data-username="nyxnor" data-post="41" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>But how to easily set a HiddenServicePort TARGET_ADDR targeting the workstation?</p>
</blockquote>
</aside>
<p>For a cli tool, I don’t know any easy option. In the default setup without multiple workstation, that’s easier, since IP could be hardcoded. So a low level CLI tool probably shouldn’t have a hardcoded default. But any higher level usability tools on top could guide through that by asking that as a question (“Do you use multiple Whonix-Workstation behind the same Whonix-Gateway?” or “Did you change Whonix-Workstation internal IP address? In doubt, say no”)</p>
<aside class="quote no-group" data-username="nyxnor" data-post="41" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p><strong>For services targeting the workstation:</strong><br>
If variable is not set:</p>
<ul>
<li><code>--port 80:10.137.0.10:5000 22:10.137.0.10:22</code></li>
</ul>
<p>If variable is set:</p>
<ul>
<li><code>--port 80:5000 22:22</code></li>
</ul>
<p>If variable is set to <code>10.137.0.10</code> and you want to target another ws <code>10.137.0.11</code>, target set by command line overrides the configuration option as expected:</p>
<ul>
<li><code>--port 80:10.137.0.11:5000 22:10.137.0.11:22</code></li>
</ul>
<p>Is that really a helper or you feel it will be an underused variable is for every server it is set to target a different workstation?</p>
</blockquote>
</aside>
<p>Seems rather complex. I guess best is to keep the code simple and a low level CLI tool should always require everything mandatory. A higher level usability tool could help the user in the easy cases. For very advanced users, these could use the command line parameters and/or environment variables.</p>
<aside class="quote no-group" data-username="nyxnor" data-post="41" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<ul>
<li><code>--port 80:10.137.0.10:5000 22:10.137.0.10:22</code></li>
</ul>
</blockquote>
</aside>
<p>That syntax seems a bit weird. <code>--port</code> might be too generic a name here? Hidden service virtual port or local port? But then the parameter is not a simple port. It’s port:ip:port ip:port.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/45">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/45</link>
        <pubDate>Fri, 19 Aug 2022 08:59:19 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-45</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>If you don’t understand, that is okay, maybe it is difficult to grasp in the beginning.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/44">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/44</link>
        <pubDate>Fri, 19 Aug 2022 08:43:06 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-44</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>Y</p>
<aside class="quote no-group" data-username="Patrick" data-post="42" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Does it use Tor configuration drop-in folder <code>/etc/tor/torrc.d</code>? In Qubes-Whonix, <code>/usr/local/etc/tor/torrc.d</code> would be required so for consistency for all Whonix platforms <code>/usr/local/etc/tor/torrc.d</code>.</p>
</blockquote>
</aside>
<p>Yes <a href="https://github.com/nyxnor/onionjuggler/blob/efb585ddc89549b7f0ddab6994b7d206ce6c170b/etc/onionjuggler/anon.conf#L39" rel="noopener nofollow ugc">https://github.com/nyxnor/onionjuggler/blob/efb585ddc89549b7f0ddab6994b7d206ce6c170b/etc/onionjuggler/anon.conf#L39</a><br>
but that is unrelated to the above question.</p>
<p>When creating an onion service:</p>
<p>In short, do you think setting a defaut WS as target for the onion services would be useful or it is better to explictly set on the command line every time?</p>
<p>On every other system, the default is 127.0.0.1.<br>
But on whonix, is purposefully block 127.0.0.1 (service targeting the GW) unless <code>--gateway</code> option is given.<br>
But if service should target the WS, is it useful to set a default target address or explictly set it on the cli?</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/43">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/43</link>
        <pubDate>Fri, 19 Aug 2022 08:41:11 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-43</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Does it use Tor configuration drop-in folder <code>/etc/tor/torrc.d</code>? In Qubes-Whonix, <code>/usr/local/etc/tor/torrc.d</code> would be required so for consistency for all Whonix platforms <code>/usr/local/etc/tor/torrc.d</code>.</p>
<p>torrc.d support is now very stable. Only config files matching <code>*.conf</code> are parsed. (<code>*.conf.dpkg-old</code>, <code>~</code>, etc. are not parsed).</p>
<p>No need compete with the user editing <code>/etc/tor/torrc</code> file.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/42">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/42</link>
        <pubDate>Fri, 19 Aug 2022 08:35:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-42</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>Question about a variable utility for Whonix:</p>
<p><code>tor_hiddenserviceport_target_addr</code></p>
<p>For debian, HiddenServicePort defaults to 127.0.0.1.<br>
For anon-gateway, onionjuggler-cli blocks setting 127.0.0.1 as HiddenServicePort unless <code>--gateway</code> is specified, this is to avoid making an onion service targeting the gateway when it is better to target the workstation, if that is understandable, then using the gateway option the service can be created for the gateway.</p>
<p>But how to easily set a HiddenServicePort TARGET_ADDR targeting the workstation?<br>
On Qubes-Whonix, it asks for the variable <code>tor_hiddenserviceport_target_addr</code> to be set.<br>
On other virtualizers, it defaults to <code>10.152.152.11</code>.</p>
<p>If <code>tor_hiddenserviceport_target_addr</code> is set, you only need to specify the virtual port and the target port, the target_addr will be set by that variable.</p>
<p>But if it is more secure to host different application servers on different workstation, is it really useful to have <code>tor_hiddenserviceport_target_addr</code>?</p>
<p>First thing is that option needs to be set once on the configuration else it needs to be specified everytime on the command line.</p>
<p><strong>For services targeting the workstation:</strong><br>
If variable is not set:</p>
<ul>
<li><code>--port 80:10.137.0.10:5000 22:10.137.0.10:22</code></li>
</ul>
<p>If variable is set:</p>
<ul>
<li><code>--port 80:5000 22:22</code></li>
</ul>
<p>If variable is set to <code>10.137.0.10</code> and you want to target another ws <code>10.137.0.11</code>, target set by command line overrides the configuration option as expected:</p>
<ul>
<li><code>--port 80:10.137.0.11:5000 22:10.137.0.11:22</code></li>
</ul>
<p>Is that really a helper or you feel it will be an underused variable is for every server it is set to target a different workstation?</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/41">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/41</link>
        <pubDate>Thu, 18 Aug 2022 17:32:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-41</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest" data-onebox-src="https://github.com/Whonix/anon-apps-config/pull/2">
  <header class="source">

      <a href="https://github.com/Whonix/anon-apps-config/pull/2" target="_blank" rel="noopener nofollow ugc">github.com/Whonix/anon-apps-config</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/anon-apps-config/pull/2" target="_blank" rel="noopener nofollow ugc">add onionjuggler whonix conf</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>nyxnor:onionjuggler-inclusion</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-08-17" data-time="20:08:34" data-timezone="UTC">08:08PM - 17 Aug 22 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/nyxnor" target="_blank" rel="noopener nofollow ugc">
          <img alt="nyxnor" src="https://avatars.githubusercontent.com/u/69700936?v=4" class="onebox-avatar-inline" width="20" height="20">
          nyxnor
        </a>
      </div>

      <div class="lines" title="1 commits changed 1 files with 63 additions and 0 deletions">
        <a href="https://github.com/Whonix/anon-apps-config/pull/2/files" target="_blank" rel="noopener nofollow ugc">
          <span class="added">+63</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">This is the only command that needs to be done to update the conf if ever change<span class="show-more-container"><a href="https://github.com/Whonix/anon-apps-config/pull/2" target="_blank" rel="noopener nofollow ugc" class="show-more">…</a></span><span class="excerpt hidden">d upstream:
```sh
cp onionjuggler/etc/onionjuggler/anon.conf anon-apps-config/etc/onionjuggler/conf.d/30_whonix.conf
```</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/40">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/40</link>
        <pubDate>Wed, 17 Aug 2022 20:08:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-40</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="38" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>But it works nicely and there is no security reason against it?</p>
</blockquote>
</aside>
<p>No security reason. It was to parse configuration and print invalid configuration options <a href="https://github.com/nyxnor/onionjuggler/issues/58" rel="noopener nofollow ugc">https://github.com/nyxnor/onionjuggler/issues/58</a><br>
but I couldn’t do this in the end.</p>
<aside class="quote no-group" data-username="Patrick" data-post="38" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/2848_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>It’s quite common too. Examples include:</p>
</blockquote>
</aside>
<p>Didn’t know, thanks for sharing, will revert to source the configuration as before.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/39">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/39</link>
        <pubDate>Wed, 17 Aug 2022 19:20:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-39</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="nyxnor" data-post="37" data-topic="9117">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/nyxnor/40/2874_2.png" class="avatar"> nyxnor:</div>
<blockquote>
<p>configuration files are not intended to run commands</p>
</blockquote>
</aside>
<p>But it works nicely and there is no security reason against it?<br>
It’s quite common too. Examples include:</p>
<ul>
<li>/etc/grub/default file</li>
<li>/etc/grub/default.d folder</li>
<li>/etc/grub.d folder folder</li>
</ul>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/38">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/38</link>
        <pubDate>Wed, 17 Aug 2022 19:16:02 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-38</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>I stopped sourcing configuration files directly</p><aside class="onebox githubissue" data-onebox-src="https://github.com/nyxnor/onionjuggler/issues/70">
  <header class="source">

      <a href="https://github.com/nyxnor/onionjuggler/issues/70" target="_blank" rel="noopener nofollow ugc">github.com/nyxnor/onionjuggler</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/nyxnor/onionjuggler/issues/70" target="_blank" rel="noopener nofollow ugc">[BUG] improve source_conf validation</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2022-08-14" data-time="23:53:58" data-timezone="UTC">11:53PM - 14 Aug 22 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2022-08-15" data-time="14:29:17" data-timezone="UTC">02:29PM - 15 Aug 22 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/nyxnor" target="_blank" rel="noopener nofollow ugc">
          <img alt="nyxnor" src="https://avatars.githubusercontent.com/u/69700936?v=4" class="onebox-avatar-inline" width="20" height="20">
          nyxnor
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          bug
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">**Describe the bug**

It sources everything from /etc/onionjuggler/conf.d/*.co<span class="show-more-container"><a href="http://forums.whonix.org" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">nf
What could be done is reading line per line for key=val just as in https://github.com/dylanaraps/pfetch/blob/a906ff89680c78cec9785f3ff49ca8b272a0f96b/pfetch#L242

Just some thoughts:
The scripts need to source /usr/share/onionjuggler/defaults.sh for functions, and that can't really be treated because it is necessary.

Both /etc/onionjuggler and /usr/share/onionjuggler requires root, so why would it matter to protect the conf dir but not the lib dir as it is not possible to protect the lib dir? Doesn't this create a false sense of security?
If thinking of security, yes, it doesn't bring, if adversary has root, it doesn't matter anyway.

So the reason can't be security, can it be user mitigating error? Maybe but improbable.

**To Reproduce**



**Expected behavior**



**Terminal output**



**Screenshots**



**Please complete the following specifications:**
&lt;!--
 - Operating system and Distribution: - $ uname -a
 - Shell and its Version - $ printf "$SHELL\n"]
 - Last git commit - $ git log -1
--&gt;


**Additional context**</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<aside class="onebox githubblob" data-onebox-src="https://github.com/nyxnor/onionjuggler/blob/9e44fce8e3b35ea4c0d328bfba54adea6f605775/usr/share/onionjuggler/defaults.sh#L149">
  <header class="source">

      <a href="https://github.com/nyxnor/onionjuggler/blob/9e44fce8e3b35ea4c0d328bfba54adea6f605775/usr/share/onionjuggler/defaults.sh#L149" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/nyxnor/onionjuggler/blob/9e44fce8e3b35ea4c0d328bfba54adea6f605775/usr/share/onionjuggler/defaults.sh#L149" target="_blank" rel="noopener nofollow ugc">nyxnor/onionjuggler/blob/9e44fce8e3b35ea4c0d328bfba54adea6f605775/usr/share/onionjuggler/defaults.sh#L149</a></h4>



    <pre class="onebox">      <code class="lang-sh">
        <ol class="start lines" start="139" style="counter-reset: li-counter 138 ;">
            <li>  : "${tor_conf:="${tor_conf_dir}/torrc"}"</li>
            <li>  : "${tor_hiddenserviceport_target_addr:="127.0.0.1"}"</li>
            <li>}</li>
            <li>
            </li>
<li>## 1. source default configuration file first</li>
            <li>## 2. source local (user made) configuration files to override the default values</li>
            <li>## 3. set default values for empty variables</li>
            <li>source_conf(){</li>
            <li>  test -f /etc/onionjuggler/onionjuggler.conf || error_msg "Default configuration file not found: /etc/onionjuggler/onionjuggler.conf"</li>
            <li>  for file in /etc/onionjuggler/onionjuggler.conf /etc/onionjuggler/conf.d/*.conf; do</li>
            <li class="selected">    ## not sourcing file directly to avoid running commands</li>
            <li>    ## also us"eful to save variables to a list to be later printed</li>
            <li>    conf_filtered="/tmp/onionjuggler.conf.read"</li>
            <li>    grep -v -e "^[[:space:]]*\#" -e "^[[:space:]]*$" "${file}" | tee "${conf_filtered}" &gt;/dev/null</li>
            <li>    #printf '%s\n' "${conf_read}" | while IFS='=' read -r key val; do</li>
            <li>    while IFS='=' read -r key val; do</li>
            <li>       test -n "${key}" &amp;&amp; eval "${key}"="${val}"</li>
            <li>    done &lt; "${conf_filtered}"</li>
            <li>  done</li>
            <li>  rm -f "${conf_filtered}"</li>
            <li>  set_default_conf_values</li>
        </ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<ul>
<li>configuration files are not intended to run commands</li>
</ul>
<p><s>After seeing it will not be done by anon-apps-config, I get back to the point of building two <code>onionjuggler-lib</code>s, one for WS and one for GW. Would you accept this?</s><br>
Can’t be because then I’d need to modify the dependencies of other packages to point to the right lib.</p>
<p>I think the best to be done is two onionjuggler packages, one for gw, one for ws.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/37">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/37</link>
        <pubDate>Wed, 17 Aug 2022 17:27:28 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-37</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Inside the config snippet there could be</p>
<pre><code class="lang-auto">if test -f ... ; then
...
elif test -f ... ; then
...
else
...
fi
</code></pre>
<p>Therefore the same snippet could be used in different VMs.</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/36">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/36</link>
        <pubDate>Wed, 17 Aug 2022 16:35:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-36</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
      <item>
        <title>Improve Onion Service Usability by Script / GUI</title>
        <dc:creator><![CDATA[nyxnor]]></dc:creator>
        <description><![CDATA[
            <p>My thinking:</p>
<p>anon-apps-config copies every config from etc/* to /etc</p><aside class="onebox githubblob" data-onebox-src="https://github.com/Whonix/anon-apps-config/blob/master/debian/anon-apps-config.install#L6">
  <header class="source">

      <a href="https://github.com/Whonix/anon-apps-config/blob/master/debian/anon-apps-config.install#L6" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/anon-apps-config/blob/master/debian/anon-apps-config.install#L6" target="_blank" rel="noopener nofollow ugc">Whonix/anon-apps-config/blob/master/debian/anon-apps-config.install#L6</a></h4>



    <pre class="onebox">      <code class="lang-install">
        <ol class="start lines" start="1" style="counter-reset: li-counter 0 ;">
            <li>## Copyright (C) 2020 - 2022 ENCRYPTED SUPPORT LP &lt;adrelanos@whonix.org&gt;</li>
            <li>## See the file COPYING for copying conditions.</li>
            <li>
            </li>
<li>## This file was generated using genmkfile 'make debinstfile'.</li>
            <li>
            </li>
<li class="selected">etc/*</li>
            <li>lib/*</li>
            <li>usr/*</li>
        </ol>
      </code>
    </pre>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>There is anon-workstation.conf and anon-gateway.conf, but only one can prevail as /etc/onionjuggler/conf.d/30_whonix.conf</p>
          <p><a href="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/35">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117/35</link>
        <pubDate>Wed, 17 Aug 2022 14:52:24 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-9117-35</guid>
        <source url="http://forums.whonix.org/t/improve-onion-service-usability-by-script-gui/9117.rss">Improve Onion Service Usability by Script / GUI</source>
      </item>
  </channel>
</rss>
