<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
    <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647</link>
    <description>Should all kernel patches for CPU bugs be unconditionally enabled? We currently enable all of the mds vulnerability mitigations.

Setting `spectre_v2=on` as a boot parameter will force the spectre v2 mitigation to be enabled.

`l1tf=full,force` will enable all mitigations for the L1TF vulnerability and disable smt (which is already disabled with the mds mitigations).

`spec_store_bypass_disable=on` will enable the SSB vulnerability mitigation (spectre v4). ClipOS recommends to use `spec_store_bypass_disable=seccomp` which disables the mitigation by default but enables it for programs using seccomp.

This should also partly get rid of the need for microcode updates.</description>
    <language>en</language>
    <lastBuildDate>Sat, 07 Nov 2020 16:32:53 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="1" data-topic="10536">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar">
    <a href="https://forums.whonix.org/t/spectre-meltdown-mitigation-defaults-changed/10536">spectre / meltdown mitigation defaults changed</a> <a class="badge-wrapper  bullet" href="http://forums.whonix.org/c/development/8"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="Hacking on the Whonix software and code. (devs) (list of unmaintained components)">Development</span></a>
  </div>
  <blockquote>
    Linux devs decided to change the scope and method of these mitigations by default in upcoming kernel version. Let’s try to make head or tail of how this affects older systems and if we need to keep them toggled on 
<a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-Spectre-SECCOMP-Default" class="onebox" target="_blank">https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-Spectre-SECCOMP-Default</a>
  </blockquote>
</aside>

          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/39">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/39</link>
        <pubDate>Sat, 07 Nov 2020 16:32:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-39</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>Speak of the devil…</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://zdnet2.cbsistatic.com/fly/bundles/zdnetcss/images/logos/logo-192x192.png" class="site-icon" width="192" height="192">
      <a href="https://www.zdnet.com/article/amd-processors-from-2011-to-2019-vulnerable-to-two-new-attacks/" target="_blank">ZDNet</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:666/500;"><img src="https://zdnet4.cbsistatic.com/hub/i/r/2020/03/07/935f8767-dc85-426b-b8fa-6db5de74ca92/thumbnail/770x578/db48020b90b74cabf66981a1301b7f5f/amd.jpg" class="thumbnail" width="666" height="500"></div>

<h3><a href="https://www.zdnet.com/article/amd-processors-from-2011-to-2019-vulnerable-to-two-new-attacks/" target="_blank">AMD processors from 2011 to 2019 vulnerable to two new attacks | ZDNet</a></h3>

<p>Academics disclose new Collide+Probe and Load+Reload attacks on AMD CPUs.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<aside class="onebox pdf">
  <header class="source">
      <a href="https://gruss.cc/files/takeaway.pdf" target="_blank">gruss.cc</a>
  </header>
  <article class="onebox-body">
    <a href="https://gruss.cc/files/takeaway.pdf" target="_blank"><span class="pdf-onebox-logo"></span></a>
<h3><a href="https://gruss.cc/files/takeaway.pdf" target="_blank">takeaway.pdf</a></h3>

<p class="filesize">711.33 KB</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/38">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/38</link>
        <pubDate>Sun, 08 Mar 2020 19:06:40 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-38</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="anontor" data-post="36" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/a/b2d939/40.png" class="avatar"> anontor:</div>
<blockquote>
<p>in Intel; AMD appears to not have this problem</p>
</blockquote>
</aside>
<p>AMD is still affected although not to the extent of Intel. I’d still recommend to disable SMT on AMD too to be sure.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/37">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/37</link>
        <pubDate>Fri, 14 Feb 2020 17:20:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-37</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[anontor]]></dc:creator>
        <description><![CDATA[
            <p>I can confirm with spectre-meltdown-checker set on paranoid, that in addition to the kernel patches and updates to microcode, that for Intel in particular, it is a prudent choice to turn off hyperthreading (depending on what you are doing like workloads and things like that). A lot of the bugs will be mitigated by running the tool in regular mode, but to be doubly sure, turn off smt (in Intel; AMD appears to not have this problem). For example, true mitigation for speculative store bypass can only be had by turning off smt/hyperthreads. There are software solutions via kernel commandline, or you can permanently switch off the capability in uefi settings.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/36">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/36</link>
        <pubDate>Thu, 13 Feb 2020 21:27:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-36</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>madaidan via Whonix Forum:</p>
<blockquote>
<p><a href="https://github.com/Whonix/security-misc/pull/58">https://github.com/Whonix/security-misc/pull/58</a></p>
</blockquote>
<p>Merged.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/35">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/35</link>
        <pubDate>Thu, 13 Feb 2020 18:38:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-35</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/pull/58" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Pull Request">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/pull/58" target="_blank">Improve CPU mitigations documentation</a>
    </h4>

    <div class="branches">
      <code>Whonix:master</code> ← <code>madaidan:mitigations</code>
    </div>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2020-02-12" data-time="18:45:01" data-timezone="UTC">06:45PM - 12 Feb 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/madaidan" target="_blank">
          <img alt="madaidan" src="https://avatars0.githubusercontent.com/u/50278627?v=4" class="onebox-avatar-inline" width="20" height="20">
          madaidan
        </a>
      </div>

      <div class="lines" title="3 commits changed 3 files with 43 additions and 27 deletions">
        <a href="https://github.com/Whonix/security-misc/pull/58/files" target="_blank">
          <span class="added">+43</span>
          <span class="removed">-27</span>
        </a>
      </div>
    </div>

  </div>
</div>
  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/34">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/34</link>
        <pubDate>Wed, 12 Feb 2020 18:45:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-34</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="32" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>There are way too many CPU models and this is a huge mess. I don’t think we have enough people who have each CPU and then test if these vulnerabilities are propeller detected and mitigated? Looking at how few care about spectre-meltdown-checker (you’d expect more contributions there), I don’t think there is a strong handle on this issue yet.</p>
</blockquote>
</aside>
<p>This is a great point. I didn’t think about that. Considering that, forcing mitigations sounds like a really good idea.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/33">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/33</link>
        <pubDate>Wed, 12 Feb 2020 18:29:01 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-33</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="29" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I think we should just leave all CPU mitigation things to the kernel default as it automatically enables needed mitigations if the device is vulnerable.</p>
</blockquote>
</aside>
<p>I see. Well these questions / this discussion actually convinced me that this is a good idea. I did re-read this whole forum thread just now. These were the main points which convinced me most:</p>
<p>We’re passing <code>spectre-meltdown-checker --paranoid</code> test.</p>
<aside class="quote no-group" data-username="madaidan" data-post="6" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>If the kernel doesn’t properly detect if the CPU is vulnerable or not then the patches won’t be applied.</p>
</blockquote>
</aside>
<p>Then also reading this strengthened this:<br>
</p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.theregister.co.uk/design_picker/4ee431b84ac2d23c13376f753522acd7ecbb9b47/graphics/favicons/favicon-16x16.png" class="site-icon" width="16" height="16">
      <a href="https://www.theregister.co.uk/2019/10/29/intel_disable_hyper_threading_linux_kernel_maintainer/" target="_blank">theregister.co.uk</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/457;"><img src="https://regmedia.co.uk/2019/10/29/gregkh.jpg" class="thumbnail" width="690" height="457"></div>

<h3><a href="https://www.theregister.co.uk/2019/10/29/intel_disable_hyper_threading_linux_kernel_maintainer/" target="_blank">Running on Intel? If you want security, disable hyper-threading, says Linux...</a></h3>

<p>Speculative execution bugs will be with us for a very long time</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>Quoting specifically:</p>
<blockquote>
<p>Kroah-Hartman dispelled the idea that an issue like Spectre has a single fix. “We are still fixing Spectre 1.0 issues [almost] two years later. It’s taken a couple of thousand patches over [almost] two years. Always take the latest kernel and always take the latest BIOS update.”</p>
</blockquote>
<p>There are way too many CPU models and this is a huge mess. I don’t think we have enough people who have each CPU and then test if these vulnerabilities are properly detected and mitigated? Looking at how few care about spectre-meltdown-checker (you’d expect more contributions there), I don’t think there is a strong handle on this issue yet.</p>
<aside class="quote no-group" data-username="madaidan" data-post="6" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Enabling all mitigations may also prevent unknown bugs. For example, smt seems to be a big part in many of these CPU bugs.</p>
</blockquote>
</aside>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="11" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Let’s please reconsider this. Quote <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.html#default-mitigations">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.html#default-mitigations</a></p>
<blockquote>
<p>The kernel does not by default enforce the disabling of SMT, which leaves SMT systems vulnerable when running untrusted guests with EPT enabled.</p>
</blockquote>
<blockquote>
<p>The administrators of cloud and hosting setups have to carefully analyze the risk for their scenarios and make the appropriate mitigation choices, which might even vary across their deployed machines and also result in other changes of their overall setup. There is no way for the kernel to provide a sensible default for this kind of scenarios.</p>
</blockquote>
<p>My reading of that page is that the kernel developers do not want to set secure defaults for all scenarios due to:</p>
<ul>
<li>the huge degraded performance as well as</li>
<li>breaking existing systems that use unattended upgrades.</li>
</ul>
<p>But we have secure by default development goals and more flexibility of blessing some scenarios “then you need to change back the settings” or unsupported.</p>
</blockquote>
</aside>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="20" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/spectre.html">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/spectre.html</a></p>
<blockquote>
<p>High security mode</p>
<p>All Spectre variant 2 mitigations can be forced on at boot time for all programs (See the “on” option in <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/spectre.html#spectre-mitigation-control-command-line">Mitigation control on the kernel command line</a>). This will add overhead as indirect branch speculations for all programs will be restricted.</p>
</blockquote>
</blockquote>
</aside>
<p>We want the <code>High security mode</code>.</p>
<p>Edit by Patrick:<br>
fix typo - propeller -&gt; properly</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/32">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/32</link>
        <pubDate>Wed, 12 Feb 2020 18:02:46 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-32</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>The original post was more of a question than a suggestion, but yes.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/31">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/31</link>
        <pubDate>Wed, 12 Feb 2020 17:26:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-31</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="29" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I think we should just leave all CPU mitigation things to the kernel default as it automatically enables needed mitigations if the device is vulnerable.</p>
</blockquote>
</aside>
<p>Is this a complete reversal of your original post here <a href="https://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647" class="inline-onebox">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</a>?</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/30">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/30</link>
        <pubDate>Wed, 12 Feb 2020 08:11:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-30</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="28" data-topic="7647" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Could you please look this up in the kernel source code?</p>
</blockquote>
</aside>
<p>I couldn’t find anything.</p>
<p>I think we should just leave all CPU mitigation things to the kernel default as it automatically enables needed mitigations if the device is vulnerable.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/29">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/29</link>
        <pubDate>Tue, 11 Feb 2020 20:10:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-29</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Could you please look this up in the kernel source code?</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/28">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/28</link>
        <pubDate>Sat, 08 Feb 2020 10:23:18 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-28</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="26" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>but on the other hand if <code>tsx=off</code> is set anyhow, <code>tsx_async_abort=full</code> is superfluous and shouldn’t do harm. Therefore in doubt, set it.</p>
</blockquote>
</aside>
<p>No.</p>
<blockquote>
<p>My interpretation of the docs is using <code>tsx=off</code> and <code>tsx_async_abort=full,nosmt</code> together will only disable TSX <strong>if the mitigation isn’t available</strong> . Just using <code>tsx=off</code> should disable TSX regardless.</p>
</blockquote>
<p>Using <code>tsx_async_abort=full</code> along with <code>tsx=off</code> will still enable TSX which can leave us open to 0days the mitigation doesn’t prevent.</p>
<p>Just using <code>tsx=off</code> should leave TSX always disabled and protect us from all TSX vulnerabilities.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/27">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/27</link>
        <pubDate>Fri, 07 Feb 2020 16:26:20 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-27</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="25" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>All except maybe <code>tsx=off</code> .</p>
</blockquote>
</aside>
<p>I might still misinterpret that. Please send a pull request since I guess that is easier than trying to ask/explain it.</p>
<hr>
<p>Intuition tells me that</p>
<ul>
<li>if <code>tsx=off</code> is set, i.e. if tsx is disabled anyhow, there is no need for <code>tsx_async_abort=full</code>.</li>
<li>but on the other hand if <code>tsx=off</code> is set anyhow, <code>tsx_async_abort=full</code> is superfluous and shouldn’t do harm. Therefore in doubt, set it.</li>
</ul>
<p>However, quote <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/tsx_async_abort.html">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/tsx_async_abort.html</a> contradicts my intuition:</p>
<blockquote>
<p>Default mitigations<br>
The kernel’s default action for vulnerable processors is:<br>
Deploy TSX disable mitigation (tsx_async_abort=full tsx=off).</p>
</blockquote>
<p>Therefore I interpret <code>tsx_async_abort=full tsx=off</code> as a valid, sensible, non-illogical option. Switching <code>tsx_async_abort=full</code> to <code>tsx_async_abort=full,nosmt</code> is just an extension of that.</p>
<p>The kernel’s default action for vulnerable processors is <code>tsx_async_abort=full tsx=off</code>. Therefore I concluded to set <code>tsx_async_abort=full tsx=off</code> regardless to reach goal of unconditionally enabling mitigation seven if the processor not detected as vulnerable. [Plus add <code>,nosmt</code>.]</p>
<p>I guess we’ll get only higher certainty on that by asking the kernel developers and/or reading the kernel source code.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/26">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/26</link>
        <pubDate>Thu, 06 Feb 2020 10:16:06 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-26</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="23" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>Which ones? All recent ones or only the ones mentioned in your last post?</p>
</blockquote>
</aside>
<p>All except maybe <code>tsx=off</code>.</p>
<aside class="quote no-group" data-username="Patrick" data-post="23" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p><code>mds=full,nosmt</code> does not say “Implies the ‘nosmt=force’”.</p>
</blockquote>
</aside>
<p><code>mds=full,nosmt</code>:</p>
<blockquote>
<p>full,nosmt - Enable MDS mitigation and disable SMT on vulnerable CPUs</p>
</blockquote>
<p><code>nosmt=force</code>:</p>
<blockquote>
<p>nosmt=force: Force disable SMT, cannot be undone via the sysfs control file.</p>
</blockquote>
<p>They both do essentially the same thing. <code>mds=full,nosmt</code> can’t be undone via sysfs either.</p>
<pre><code class="lang-auto">user@host:~$ cat /sys/devices/system/cpu/smt/control
notsupported
</code></pre>
<aside class="quote no-group" data-username="Patrick" data-post="23" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>I see your point. But I am not sure.</p>
</blockquote>
</aside>
<p>My interpretation of the docs is using <code>tsx=off</code> and <code>tsx_async_abort=full,nosmt</code> together will only disable TSX <strong>if the mitigation isn’t available</strong>. Just using <code>tsx=off</code> should disable TSX regardless.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/25">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/25</link>
        <pubDate>Wed, 05 Feb 2020 21:42:11 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-25</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>3 posts were merged into an existing topic: <a href="http://forums.whonix.org/t/whonix-vulerable-due-to-missing-processor-microcode-packages-spectre-meltdown-retpoline-l1-terminal-fault-l1tf/5739/81">Whonix vulerable due to missing processor microcode packages? spectre / meltdown / retpoline / L1 Terminal Fault (L1TF)</a></p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/24">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/24</link>
        <pubDate>Sun, 02 Feb 2020 07:47:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-24</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="22" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>I don’t see any point in forcing these to be enabled.</p>
</blockquote>
</aside>
<p>Which ones? All recent ones or only the ones mentioned in your last post?</p>
<aside class="quote no-group" data-username="madaidan" data-post="22" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Debian disables TSX by default with <code>CONFIG_X86_INTEL_TSX_MODE_OFF=y</code> but I guess the <code>tsx=off</code> parameter is useful for kernels with it enabled by default.</p>
</blockquote>
</aside>
<p>Yes.</p>
<aside class="quote no-group" data-username="madaidan" data-post="22" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><code>nosmt=force</code> is redundant. We already disable SMT with <code>mds=full,nosmt</code> .</p>
</blockquote>
</aside>
<p><code>mds=full,nosmt</code> does not make that redundant.<br>
Though, <code>l1tf=full,force</code> makes it redundant.</p>
<p><code>l1tf=full,force</code> <a href="https://www.kernel.org/doc/Documentation/admin-guide/kernel-parameters.txt">https://www.kernel.org/doc/Documentation/admin-guide/kernel-parameters.txt</a> says</p>
<blockquote>
<p>Implies the ‘nosmt=force’ command line option. (i.e. sysfs control of SMT is disabled.)</p>
</blockquote>
<p><code>mds=full,nosmt</code> does not say “Implies the ‘nosmt=force’”.</p>
<p>The reason why I am interested in <code>nosmt=force</code> is:</p>
<blockquote>
<p>Force disable SMT, cannot be undone via the sysfs control file.</p>
</blockquote>
<p>Which seems useful at least for purposes of <a href="https://forums.whonix.org/t/untrusted-root-improve-security-by-restricting-root/7998" class="inline-onebox">Untrusted Root - improve Security by Restricting Root</a>.</p>
<aside class="quote no-group" data-username="madaidan" data-post="22" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><code>tsx_async_abort=full,nosmt</code> is redundant as TSX is already disabled.</p>
</blockquote>
</aside>
<p>I see your point. But I am not sure.</p>
<p>As per <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/tsx_async_abort.html">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/tsx_async_abort.html</a> here are some possible combinations (these are listed in a table on that page):</p>
<hr>
<ul>
<li>tsx=on</li>
<li>tsx_async_abort=full,nosmt</li>
<li>As above, cross-thread attacks on SMT mitigated.</li>
</ul>
<hr>
<ul>
<li>tsx=off</li>
<li>tsx_async_abort=full,nosmt</li>
<li>TSX might be disabled if microcode provides a TSX control MSR. If so, system is not vulnerable.</li>
</ul>
<hr>
<p>What also confuses me:</p>
<blockquote>
<p>Default mitigations</p>
<p>The kernel’s default action for vulnerable processors is:</p>
<p>Deploy TSX disable mitigation (tsx_async_abort=full tsx=off).</p>
</blockquote>
<p>A combination of tsx=off and tsx_async_abort=full.</p>
<p>Why didn’t they write simpler:</p>
<blockquote>
<p>Deploy TSX disable mitigation (tsx=off).</p>
</blockquote>
<p>Therefore perhaps better to keep  <code>tsx_async_abort=full,nosmt</code>?</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/23">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/23</link>
        <pubDate>Sat, 01 Feb 2020 14:06:26 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-23</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[madaidan]]></dc:creator>
        <description><![CDATA[
            <p>I don’t see any point in forcing these to be enabled. The kernel will automatically detect if the CPU is vulnerable and if it is, will enable the mitigations. If it isn’t vulnerable, it won’t enable the mitigations but that doesn’t matter since they aren’t needed.</p>
<p>Debian disables TSX by default with <code>CONFIG_X86_INTEL_TSX_MODE_OFF=y</code> but I guess the <code>tsx=off</code> parameter is useful for kernels with it enabled by default.</p>
<p><code>nosmt=force</code> is redundant. We already disable SMT with <code>mds=full,nosmt</code>.</p>
<p><code>tsx_async_abort=full,nosmt</code> is redundant as TSX is already disabled.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/22">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/22</link>
        <pubDate>Fri, 31 Jan 2020 17:15:34 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-22</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="HulaHoop" data-post="375" data-topic="166">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"><a href="//forums.whonix.org/t/help-welcome-kvm-development-staying-the-course/166/375">[Help Welcome] KVM Development - staying the course</a>
</div>
<blockquote>
<p>As an aside it seems the new kernel command turns all mitigations on including disabling SMT. I think it’s more manageable if you switch to using that instead of specifying every knob.</p>
<pre><code class="lang-auto">mitigations=auto,nosmt
</code></pre>
</blockquote>
</aside>
<p>This is an important point. I was wondering about this too. And I could be wrong here. It would be very much desirable to simplify this. However, I think <code>mitigations=auto</code> isn’t the same as <code>mitigations=force</code>, while the latter does not seem to exist yet. This seems like a missing kernel feature but I wasn’t sure it’s worth a feature request.</p>
<p><code>mitigations=auto</code> means “conditionally enable” while <code>mitigations=force</code> would mean “unconditionally enable”.</p>
<p><a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/index.html">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/index.html</a> and following pages don’t mention <code>mitigations=</code>.</p>
<p>quote <a href="https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html?highlight=kernel%20parameters">https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html?highlight=kernel%20parameters</a></p>
<blockquote>
<p>mitigations=<br>
[X86,PPC,S390,ARM64] Control optional mitigations for<br>
CPU vulnerabilities.  This is a set of curated,<br>
arch-independent options, each of which is an<br>
aggregation of existing arch-specific options.</p>
</blockquote>
<blockquote>
<p>auto (default)</p>
</blockquote>
<p>I.e. auto is already the default. <code>mitigations=auto</code> would essentially do nothing.</p>
<blockquote>
<p>auto,nosmt<br>
Mitigate all CPU vulnerabilities, disabling SMT<br>
if needed.  This is for users who always want to<br>
be fully mitigated, even if it means losing SMT.<br>
Equivalent to: l1tf=flush,nosmt [X86]<br>
mds=full,nosmt [X86]<br>
tsx_async_abort=full,nosmt [X86]</p>
</blockquote>
<p>It does not set <code>l1tf=full,force</code>, <code>nosmt=force</code>, <code>tsx=off</code>, <code>spectre_v2=on</code>, <code>pti=on</code>.</p>
<p><a href="https://docs.clip-os.org/clipos/kernel.html">https://docs.clip-os.org/clipos/kernel.html</a> writes</p>
<blockquote>
<ul>
<li>
<code>mitigations</code> : This parameter controls optional mitigations for CPU vulnerabilities in an arch-independent and more coarse-grained way. For now, we keep using arch-specific options for the sake of explicitness. Not setting this parameter equals setting it to <code>auto</code> , which itself does not update anything.</li>
</ul>
</blockquote>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/21">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/21</link>
        <pubDate>Thu, 30 Jan 2020 20:42:27 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-21</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Should all kernel patches for CPU bugs be unconditionally enabled?</p>
</blockquote>
</aside>
<p>After the recent reconsideration, yes.</p>
<aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p>Setting <code>spectre_v2=on</code> as a boot parameter will force the spectre v2 mitigation to be enabled.</p>
</blockquote>
</aside>
<p>Seems like a good idea.</p>
<p><a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/spectre.html" class="onebox" target="_blank">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/spectre.html</a></p>
<blockquote>
<p>High security mode</p>
<p>All Spectre variant 2 mitigations can be forced on at boot time for all programs (See the “on” option in <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/spectre.html#spectre-mitigation-control-command-line">Mitigation control on the kernel command line</a>). This will add overhead as indirect branch speculations for all programs will be restricted.</p>
</blockquote>
<aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><code>l1tf=full,force</code> will enable all mitigations for the L1TF vulnerability and disable smt (which is already disabled with the mds mitigations).</p>
</blockquote>
</aside>
<p>Done above.</p>
<aside class="quote no-group" data-username="madaidan" data-post="1" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/m/ea5d25/40.png" class="avatar"> madaidan:</div>
<blockquote>
<p><code>spec_store_bypass_disable=on</code> will enable the SSB vulnerability mitigation (spectre v4).</p>
</blockquote>
</aside>
<p>Using that now.</p>
<hr>
<aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/b9d65338bcc76552e4d2169106cd04e6276eb320" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/b9d65338bcc76552e4d2169106cd04e6276eb320" target="_blank">unconditionally enable all CPU bugs (spectre, meltdown, L1TF, ...)</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-01-30" data-time="10:55:13" data-timezone="UTC">10:55AM - 30 Jan 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 1 files with 8 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/b9d65338bcc76552e4d2169106cd04e6276eb320" target="_blank">
          <span class="added">+8</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">this might reduce performance
* `spectre_v2=on`
* `spec_store_bypass_disable=on`
* `tsx=off`
* `tsx_async_abort=full,nosmt`
Thanks to @madaidan for the suggestion!
https://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Please let me know should any mitigation not be unconditionally enabled yet.</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/20">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/20</link>
        <pubDate>Thu, 30 Jan 2020 10:56:47 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-20</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit">
  <header class="source">
      <a href="https://github.com/Whonix/security-misc/commit/c1a0da60beacd027c1c7c94ae44a9d7b1ab708b9" target="_blank">github.com/Whonix/security-misc</a>
  </header>
  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Whonix/security-misc/commit/c1a0da60beacd027c1c7c94ae44a9d7b1ab708b9" target="_blank">set kernel boot parameter `l1tf=full,force` and `nosmt=force`</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2020-01-30" data-time="05:46:48" data-timezone="UTC">05:46AM - 30 Jan 20 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank">
          <img alt="adrelanos" src="https://avatars3.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
        
      </div>

      <div class="lines" title="changed 2 files with 8 additions and 0 deletions">
        <a href="https://github.com/Whonix/security-misc/commit/c1a0da60beacd027c1c7c94ae44a9d7b1ab708b9" target="_blank">
          <span class="added">+8</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>

  </div>
</div>


  <div class="github-row">
    <pre class="github-content" style="white-space: normal;">https://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/17</pre>
  </div>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/19">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/19</link>
        <pubDate>Thu, 30 Jan 2020 05:48:07 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-19</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[HulaHoop]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="17" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>This has to remain future work. While there are many researchers find out more and more attacks and kernel developers invent mitigations, there seems to be a severe shortage of people who are working on analysis tools such as spectre-meltdown-checker or enabling mitigations for as many users as easily as possible.</p>
</blockquote>
</aside>
<p>+1</p>
<hr>
<aside class="quote no-group" data-username="Patrick" data-post="17" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>( <a href="https://github.com/QubesOS/qubes-issues/issues/5547">https://github.com/QubesOS/qubes-issues/issues/5547</a> )<br>
Performance is OK for me with disabled HT but it’s a powerful machine.</p>
<p>I think we should disable HT. Qubes disables it too.</p>
</blockquote>
</aside>
<p>OK</p>
<hr>
<p>The amount of new bugs that keeps being uncovered is staggering and will make anyone’s head spin:<br>
<a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Intel-Two-More-Data-Leakage" class="onebox" target="_blank">https://www.phoronix.com/scan.php?page=news_item&amp;px=Intel-Two-More-Data-Leakage</a></p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/18">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/18</link>
        <pubDate>Wed, 29 Jan 2020 15:04:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-18</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="HulaHoop" data-post="13" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>One important consideration is to find out if AMD systems are unfairly impacted by these mitigations when they don’t really apply to them. In that case we should turn them on for certain CPU families.</p>
</blockquote>
</aside>
<p>This has to remain future work. While there are many researchers find out more and more attacks and kernel developers invent mitigations, there seems to be a severe shortage of people who are working on analysis tools such as spectre-meltdown-checker or enabling mitigations for as many users as easily as possible. Such as through installation of a package such as security-misc or a distribution such as Kicksecure or Whonix-Host. I am not aware of anyone else working on that currently. There are way too many vulnerabilities, mitigations, use scenarios, processors and therefore resulting combinations which makes this hard to implement.</p>
<p>For start, we could use a wiki table with an overview. Not even sure yet what contents such as table would need. Vulnerabilities, mitigations, use scenarios, processor(s) (families), locally exploitable, remotely exploitable, local information leak, remote information leak (<a href="https://www.eweek.com/security/netspectre-attack-could-enable-remote-cpu-exploitation">NetSpectre</a>), relevant when using a hypervisor vs not using a hypervisor.</p>
<aside class="quote no-group" data-username="HulaHoop" data-post="14" data-topic="7647">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v4/letter/h/edb3f5/40.png" class="avatar"> HulaHoop:</div>
<blockquote>
<p>Without disabling HT the vuln would be there, but I heard HT disabling really cripples system perf.</p>
</blockquote>
</aside>
<p>Qubes disabled HT.<br>
( <a href="https://github.com/QubesOS/qubes-issues/issues/5547">https://github.com/QubesOS/qubes-issues/issues/5547</a> )<br>
Performance is OK for me with disabled HT but it’s a powerful machine.</p>
<p>I think we should disable HT. Qubes disables it too.</p>
<p>Quote <a href="https://coreos.com/os/docs/latest/disabling-smt.html">https://coreos.com/os/docs/latest/disabling-smt.html</a></p>
<blockquote>
<p>Recent Intel CPU vulnerabilities (<a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.html">L1TF</a> and <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/mds.html">MDS</a>) cannot be fully mitigated in software without disabling Simultaneous Multi-Threading.</p>
</blockquote>
<p>Therefore we better disable it.</p>
<blockquote>
<p>This can have a substantial performance impact and is only necessary for certain workloads, so for compatibility reasons, SMT is enabled by default.</p>
</blockquote>
<p>I guess for good security, switch from Windows to a Linux distribution. And I guess for advanced security, use Whonix, Whonix-Host, Kicksecure. For our target user it seems appropriate to disable SMT.</p>
<blockquote>
<p>In addition, the Intel <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/tsx_async_abort.html">TAA</a> vulnerability cannot be fully mitigated without disabling either of SMT or the Transactional Synchronization Extensions (TSX).</p>
</blockquote>
<blockquote>
<p>SMT and TSX should be disabled on affected Intel processors under the following circumstances:</p>
<ol>
<li>A bare-metal host runs untrusted virtual machines, and <a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.html#mitigation-selection-guide">other arrangements</a> have not been made for mitigation.</li>
<li>A bare-metal host runs untrusted code outside a virtual machine.</li>
</ol>
</blockquote>
<p>In our threat model we deem most code untrusted. We don’t want to trust any code but sometimes we have to. That’s why we use linux user account separation and mandatory access controls. Because some code is considered not deliberately malicious (such as the browser) but potentially exploitable (therefore considered untrusted). Therefore I think “runs untrusted code outside a virtual machine” always applies in our threat model.</p>
<p>Otherwise also things would be more complicated.</p>
<ul>
<li><s>Kicksecure users not using a hypervisor: no need to disable SMT</s></li>
<li><s>Whonix host users running VMs: should disable SMT</s></li>
</ul>
<blockquote>
<p>SMT can be conditionally disabled by passing <code>mitigations=auto,nosmt</code> on the kernel command line. This will disable SMT only if required for mitigating a vulnerability. This approach has two caveats:</p>
</blockquote>
<blockquote>
<ol>
<li>It does not protect against unknown vulnerabilities in SMT.</li>
</ol>
</blockquote>
<p>I guess at the quantity and speed at which vulnerabilities are published we again ought to disable SMT here.</p>
<blockquote>
<p>Alternatively, SMT can be unconditionally disabled by passing <code>nosmt</code> on the kernel command line. This provides the most protection and avoids possible behavior changes on upgrades, at the cost of a potentially unnecessary reduction in performance.</p>
</blockquote>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/17">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/17</link>
        <pubDate>Wed, 29 Jan 2020 14:47:06 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-17</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>A post was merged into an existing topic: <a href="http://forums.whonix.org/t/whonix-vulerable-due-to-missing-processor-microcode-packages-spectre-meltdown-retpoline-l1-terminal-fault-l1tf/5739/78">Whonix vulerable due to missing processor microcode packages? spectre / meltdown / retpoline / L1 Terminal Fault (L1TF)</a></p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/15</link>
        <pubDate>Wed, 29 Jan 2020 13:33:55 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-15</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
      <item>
        <title>Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Trying to decode this mostly fluff talk video by Intel on L1TF. Quote <a href="https://www.youtube.com/watch?v=n_pa2AisRUs">https://www.youtube.com/watch?v=n_pa2AisRUs</a></p>
<blockquote>
<p>in some cases where it can’t be guaranteed that all virtualized operating systems have been updated some customers may choose to take additional actions first and coupled with the l1 cache flush they can ensure that only trusted siblings have access to the same processor core this capability is called core scheduling and is already supported by some hypervisors if course scheduling isn’t available and they suspect there might be potentially untrustworthy sibling sharing access to the l1 cache it may be appropriate to take further action like only allowing one thread to run per core this demonstrates what would happen if SMT were disabled while these actions might be applicable to a relatively small portion of the overall market we think it’s important to provide solutions for all our customers</p>
</blockquote>
<p>Did they really mean “if the microcode, host and guest operating systems is patched, then there is no need to disable SMT”?</p>
<p>In other words, did they really mean “only if guests are not patched it might make sense to pin CPUs to guests and/or to disable SMT”?</p>
<p>Is it true that SMT needs to be disabled when running unpatched guests? A malicious guest using kexec to load a malicious kernel couldn’t read secrets by another VM using the same L1 cache if that other VM was patched?</p>
          <p><a href="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/16">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647/16</link>
        <pubDate>Wed, 29 Jan 2020 13:33:37 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-7647-16</guid>
        <source url="http://forums.whonix.org/t/should-all-kernel-patches-for-cpu-bugs-be-unconditionally-enabled-vs-performance-vs-applicability/7647.rss">Should all kernel patches for CPU bugs be unconditionally enabled? Vs Performance vs Applicability</source>
      </item>
  </channel>
</rss>
