<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Qubes-whonix Debian package</title>
    <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764</link>
    <description>I just finished creating the whonix-qubes Debian package that contains all the configurations scripts, etc to allow Whonix to function in Qubes.  I am pretty sure we previously agreed they belong with Whonix since they are Whonix specific.

These scripts will allow online updates to fix any bugs or add features that are not directly related to Whonix or Qubes.  There are no dependencies on Qubes or Whonix since I plan on installing it as the first package once the template has been bootstrapped.

I tried to follow the Whonix packaging format as most as I could figure out but I also needed to make sure I can build it with Qubes builder which uses a different logic to build.  I version-ed it to be same as Whonix Release, so this version is 9.4-1 as I figure I will need a matching version for each build.

It would be nice to get this package in the Whonix repo so I can start testing like adding a feature or fix a bug via an update as well as use the Whonix repo directly as my source when initially creating and building the template.  There currently is one issue that would be nice to test on someone like WhonixQubes (I have a way to make those notification work properly; that feature just got missed in the massive merge).

Let me know of any issues.  I don&#39;t have much experience with Debian Packages so there may be some room for improvement.

My repo is here [url=https://github.com/nrgaway/whonix-qubes.git]https://github.com/nrgaway/whonix-qubes.git[/url].  I sign all my commits and tags.  Here is a link to my public key [url=https://raw.githubusercontent.com/nrgaway/qubes-builder/master/nrgaway-qubes-signing-key.asc]https://raw.githubusercontent.com/nrgaway/qubes-builder/master/nrgaway-qubes-signing-key.asc[/url] for verification or you can grab key from gpg server (0x5A4C6DAD).  Fingerprint: E0E3 2283 FDCA C1A5 1007 8F27 1BB9 B1FB 5A4C 6DAD.</description>
    <language>en</language>
    <lastBuildDate>Mon, 16 Feb 2015 22:36:58 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Many thanks to nrgaway for the qubes-whonix package! It would have taken quite a lot time until I could have figured out how to make Whonix run on top of Qubes.</p>
<p>I think there are still major issues with the package.</p>
<p>(Independently from this, I’ll add it to the repository. [<a href="https://phabricator.whonix.org/T182">https://phabricator.whonix.org/T182</a>])</p>
<p>Lintian reports many warnings for the package:<br>
<a href="https://phabricator.whonix.org/T186" class="onebox" target="_blank">https://phabricator.whonix.org/T186</a></p>
<p>For most of them, separate tickets have been created by me.</p>
<p>For a lot stuff, it’s hacks and workarounds, for stuff that would be cleaner if it was fixed upstream in Qubes or Whonix. No security issues (didn’t test the code or leak test, that’s up to you), but I it’s prone to generate all sorts of issues. (Issues with upgrading, support requests, various instability.) It’s good enough as initial implementation but should be implemented in a more robust way.</p>
<p>There are a few tickets closed as invalid:<br>
<a href="https://phabricator.whonix.org/maniphest/query/lFf8LAejlxKO/#R" class="onebox" target="_blank">https://phabricator.whonix.org/maniphest/query/lFf8LAejlxKO/#R</a></p>
<p>I suggested to solve these issues upstream in Qubes so these hacks can be removed from the qubes-whonix package. And to add them as goals to later milestones. Or if you don’t want to work on them, consider to reopen them and to leave them just tagged Qubes, so anyone else can figure out there is an issue that should be sorted out.</p>
<p>(Adding version goals should be up to the maintainers, because it’s you who would / would not work on it anyhow. See the “Qubes” tag as a general catch all. And other tags [whonix-qubes 11 or w/e] for stuff you plan to work on.)</p>
<p>Also derivation from Whonix (systemd, whonix-setup-wizard) is a bad idea in my opinion and inviting trouble. Adding the latest hot stuff is more like the rolling distribution style (Gentoo and similar) and doesn’t match Whonix’s model with stable hotfixes and major new version.</p>
<p>Anyhow. That’s just my feedback. What you make out of it is up to you, since you maintain it.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/34">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/34</link>
        <pubDate>Mon, 16 Feb 2015 22:36:58 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-34</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Went through this whole thread again and created separate tickets for all stuff not addressed yet:<br>
<a href="https://phabricator.whonix.org/maniphest/?statuses=open%2Creview&amp;allProjects=PHID-PROJ-o2gfrvskvs2nnw6amfsd#R" class="onebox" target="_blank">https://phabricator.whonix.org/maniphest/?statuses=open%2Creview&amp;allProjects=PHID-PROJ-o2gfrvskvs2nnw6amfsd#R</a></p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/33">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/33</link>
        <pubDate>Mon, 16 Feb 2015 10:08:41 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-33</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="31" data-topic="764">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>[quote]here is the script I use to install systemd on Wheezy</p>
</blockquote>
</aside>
<p>Hm. Sounds brave. See also:<br>
</p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Dev/APT_Pinning" target="_blank" rel="nofollow noopener" title="05:39AM - 19 February 2020">Whonix – 19 Feb 20</a>
  </header>
  <article class="onebox-body">
    <img src="" class="thumbnail" width="" height="">

<h3><a href="https://www.whonix.org/wiki/Dev/APT_Pinning" target="_blank" rel="nofollow noopener">Dev/APT Pinning - Whonix</a></h3>

<p>Why we should avoid Debian APT Pinning</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
I wonder if this could cause issues when trying to upgrade to jessie and/or Whonix 10.[/quote]<br>
I don’t think it will cause any issues.  The pinning just prevents sysvinit from being re installed.  If the pin is not added sysvinit will get re-installed automatically with an ‘apt-get dist-upgrade’.  A separate template is already available for Jessie, and I would use that over updating any existing template.  Jessie does not need to have sysvinit pinned when upgrading to or using systemd.<p></p>
<p>If any issues were to come to light, the qubes-whonix package could change the pin.  I don’t think the comments of the posts you linked to apply to this situation since the wheezy templates and Whonix implementation are more of a distribution and I would not just consider it a just a package and the pinning is also not being used to control an installed package.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/32">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/32</link>
        <pubDate>Wed, 07 Jan 2015 17:21:51 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-32</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <blockquote>When installing the actual package after Whonix has been installed (or just in wheezy) I do get an install error from makefile.bsh.  I had to create a script to remake /dev/fd directory:</blockquote>
Looks like a Qubes specific issue.
<blockquote>I don't actually know why your script calls /dev/fd62</blockquote>
It doesn't. At least not explicitly.
<blockquote>(I wonder if this is normal?)</blockquote>
No idea.
<blockquote>here is the script I use to install systemd on Wheezy</blockquote>
Hm. Sounds brave. See also:
https://www.whonix.org/wiki/Dev/APT_Pinning
I wonder if this could cause issues when trying to upgrade to jessie and/or Whonix 10.
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/31">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/31</link>
        <pubDate>Wed, 07 Jan 2015 15:06:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-31</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:29, topic:764”]There is one issue why I haven’t added the package to <a href="https://github.com/Whonix/Whonix/tree/master/packages" rel="nofollow noopener">https://github.com/Whonix/Whonix/tree/master/packages</a> folder yet. It [font=courier]Build-Depends:[/font] on [font=courier]dh-systemd[/font]. That dependency isn’t available as long as Whonix is based on Debian wheezy. So building Whonix would break when attempting to build the qubes-whonix package.</p>
<p>We could add another hack to <a href="https://github.com/Whonix/Whonix/blob/master/build-steps.d/1100_prepare-build-machine#L415" rel="nofollow noopener">https://github.com/Whonix/Whonix/blob/master/build-steps.d/1100_prepare-build-machine#L415</a> to install it from jessie in meanwhile. Want me to do this?</p>
<p>How do you install systemd in wheezy based Whonix-Qubes anyhow?[/quote]</p>
<p>I will get to the issues above when I get a chance.  For now I just build the package with qubes-builder along with the other Qubes modules.</p>
<p>When installing the actual package after Whonix has been installed (or just in wheezy) I do get an install error from makefile.bsh.  I had to create a script to remake /dev/fd directory:</p>
<pre><code class="lang-auto"># Debian chroot /dev/fd is all messed up; links are not normal and prevents dpkg redirect:
        # /make-helper.bsh: line 256: /dev/fd/62: No such file or directory
        @if [ ! -L $(CHROOT_DIR)/dev/fd ]; then \
            if [ ! -a $(CHROOT_DIR)/dev/fd ]; then \
                sudo chroot $(CHROOT_DIR) mv /dev/fd /dev/fd.dist; \
            fi; \
            sudo chroot $(CHROOT_DIR) ln -s /proc/self/fd /dev/fd; \
        fi
</code></pre>
<p>I don’t actually know why your script calls /dev/fd62 but I noticed that the wheezy /fd directories look like this (I wonder if this is normal?) compared to say Fedora:</p>
<pre><code class="lang-auto">Wheezy:
drwxr-xr-x 2 root root 4096 Nov 25 18:58 .
drwxr-xr-x 4 root root 4096 Jan  6 16:51 ..
lrwxrwxrwx 1 root root   15 Nov 25 18:58 fd -&gt; ../proc/self/fd
lrwxrwxrwx 1 root root   17 Nov 25 18:58 stderr -&gt; ../proc/self/fd/2
lrwxrwxrwx 1 root root   17 Nov 25 18:58 stdin -&gt; ../proc/self/fd/0
lrwxrwxrwx 1 root root   17 Nov 25 18:58 stdout -&gt; ../proc/self/fd/1

Fedora (linked directly to /proc/self/fd
dr-x------ 2 user user  0 Jan  7 09:27 .
dr-xr-xr-x 7 user user  0 Jan  7 09:27 ..
lrwx------ 1 /user user 64 Jan  7 09:27 0 -&gt; /dev/pts/0
lrwx------ 1 user user 64 Jan  7 09:27 1 -&gt; /dev/pts/0
lrwx------ 1 user user 64 Jan  7 09:27 2 -&gt; /dev/pts/0
lr-x------ 1 user user 64 Jan  7 09:27 3 -&gt; /proc/19185/fd</code></pre>
<p>See Wheezy has no number codes 0, 1 2 instead names.  Have you ever experienced this?</p>
<p>This is what causes it; even if I just manually install the package via ‘dpkg -i qubes-whonix’, or build run ‘make deb-dist’.  When I apply the patch above it works:</p>
<pre><code class="lang-auto"> done &lt; &lt;( dpkg-parsechangelog )</code></pre>
<p>Anyway, here is the script I use to install systemd on Wheezy (The aptRemove/Install just calls a bash function that chroots to image with apt-get install command…):</p>
<pre><code class="lang-auto">#### '--------------------------------------------------------------------------
info ' Remove sysvinit'
#### '--------------------------------------------------------------------------
echo 'Yes, do as I say!' | aptRemove sysvinit

#### '--------------------------------------------------------------------------
info ' Preventing sysvinit re-installation'
#### '--------------------------------------------------------------------------
chroot apt-mark hold sysvinit

#### '--------------------------------------------------------------------------
info ' Pin sysvinit to prevent being re-installed'
#### '--------------------------------------------------------------------------
cat &gt; "${INSTALLDIR}/etc/apt/preferences.d/qubes_sysvinit" &lt;&lt;EOF
Package: sysvinit
Pin: version *
Pin-Priority: -100
EOF
chmod 0644 "${INSTALLDIR}/etc/apt/preferences.d/qubes_sysvinit"

#### '--------------------------------------------------------------------------
info ' Install Systemd'
#### '--------------------------------------------------------------------------
aptUpdate
aptInstall systemd-sysv

#### '--------------------------------------------------------------------------
info ' Set multu-user.target as the default target (runlevel 3)'
#### '--------------------------------------------------------------------------
chroot rm -f /etc/systemd/system/default.target
chroot ln -sf /lib/systemd/system/multi-user.target /etc/systemd/system/default.target

#
# From functions.sh; a sourced script
#

# ==============================================================================
# apt-get remove
# ==============================================================================
function aptRemove() {
    files="$@"
    DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true \
        chroot apt-get ${APT_GET_OPTIONS} remove ${files[@]}
}

# ==============================================================================
# apt-get install
# ==============================================================================
function aptInstall() {
    files="$@"
    DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true \
        chroot apt-get ${APT_GET_OPTIONS} install ${files[@]}
</code></pre>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/30">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/30</link>
        <pubDate>Wed, 07 Jan 2015 14:46:22 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-30</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>There is one issue why I haven’t added the package to <a href="https://github.com/Whonix/Whonix/tree/master/packages">https://github.com/Whonix/Whonix/tree/master/packages</a> folder yet. It [font=courier]Build-Depends:[/font] on [font=courier]dh-systemd[/font]. That dependency isn’t available as long as Whonix is based on Debian wheezy. So building Whonix would break when attempting to build the qubes-whonix package.</p>
<p>We could add another hack to <a href="https://github.com/Whonix/Whonix/blob/master/build-steps.d/1100_prepare-build-machine#L415">https://github.com/Whonix/Whonix/blob/master/build-steps.d/1100_prepare-build-machine#L415</a> to install it from jessie in meanwhile. Want me to do this?</p>
<p>How do you install systemd in wheezy based Whonix-Qubes anyhow?</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/29">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/29</link>
        <pubDate>Tue, 06 Jan 2015 16:05:05 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-29</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>I am not opposed to the python script, just I prefer to exhausting other options before inventing something, i.e. asking upstream about it.</p>
<p>[hr]</p>
<p>32_uwt_default… Wouldn’t 32_uwt_qubes be more appropriate?</p>
<blockquote>Think I have them all handled at this point.</blockquote>
<p>There is a lot that has not been addressed. Didn’t go through everything again yet. Just a few that are missing:</p>
<ul>
<li>/etc/hosts - <a href="https://www.whonix.org/forum/index.php/topic,841.msg6263.html#msg6263">https://www.whonix.org/forum/index.php/topic,841.msg6263.html#msg6263</a>
</li>
<li>.anondist - <a href="https://www.whonix.org/forum/index.php/topic,841.msg6264.html#msg6264">https://www.whonix.org/forum/index.php/topic,841.msg6264.html#msg6264</a>
</li>
<li>typos - <a href="https://www.whonix.org/forum/index.php/topic,841.msg6266.html#msg6266">https://www.whonix.org/forum/index.php/topic,841.msg6266.html#msg6266</a>
</li>
<li>CONTRIBUTING.md - <a href="https://www.whonix.org/forum/index.php/topic,841.msg6266.html#msg6266">https://www.whonix.org/forum/index.php/topic,841.msg6266.html#msg6266</a>
</li>
</ul>
<p>Don’t get me wrong. You’re not obligated to address any of these. Of course not. I just preferred if they were in the bug tracker, so we don’t forget about them, perhaps I or someone else fixing them.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/28">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/28</link>
        <pubDate>Tue, 06 Jan 2015 14:12:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-28</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:19, topic:764”]There is dpkg-parsechangelog. See also:<br>
</p><aside class="onebox stackexchange">
  <header class="source">
      <a href="https://askubuntu.com/questions/332771/how-do-i-extract-the-package-version-from-debian-changelog/423534#423534" target="_blank" rel="nofollow noopener">askubuntu.com</a>
  </header>
  <article class="onebox-body">
      <a href="https://askubuntu.com/users/92147/martin-geisler" target="_blank" rel="nofollow noopener">
    <img alt="Martin Geisler" src="https://www.gravatar.com/avatar/6bf0300fc4a5c9012fd254d3da2a6e69?s=128&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="128" height="128">
  </a>
<h4>
  <a href="https://askubuntu.com/questions/332771/how-do-i-extract-the-package-version-from-debian-changelog/423534#423534" target="_blank" rel="nofollow noopener">How do I extract the package version from debian/changelog?</a>
</h4>

<div class="tags">
  <strong>packaging, deb, source-packages</strong>
</div>

<div class="date">
  
  answered by
  <a href="https://askubuntu.com/users/92147/martin-geisler" target="_blank" rel="nofollow noopener">
    Martin Geisler
  </a>
  on <a href="https://askubuntu.com/questions/332771/how-do-i-extract-the-package-version-from-debian-changelog/423534#423534" target="_blank" rel="nofollow noopener">08:07AM - 20 Feb 14 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
I think once based on jessie, it will be improved.<p></p>
<p>It’s used by make-helper.bsh also.</p>
<p>make-helper.bsh can also be <code>source</code>d, it will do nothing then, but when you run make_get_variables it will set all the version numbers to variables it has parsed from debian/changelog.</p>
<p>Debian must have existing code to parse debian/control, no? Otherwise how is stuff like “apt-get build-dep” working?[/quote]</p>
<p>It will be interesting to see what replies you receive back from your post.  There does seem to be many utilities that do parse the Debian control and changelog, but I had not seen any that are meant to retrieve only the desired fields, etc.</p>
<p>I am happy with the parse_debian script I wrote since it will parse the log and only return what I ask it to return, therefore no further parsing is required.  For example:</p>
<p>Will only return a space separated string of build dependencies:</p>
<pre><code class="lang-auto">parse_debian control --build-depends debian/control</code></pre>
<p>Will only return a space separated string of package dependencies:</p>
<pre><code class="lang-auto">parse_debian control --depends debian/control</code></pre>
<p>Returns the package release name (qubes-whonix_9.4-1):</p>
<pre><code class="lang-auto">parse_debian changelog --package-release-name debian/changelog</code></pre>
<p>Returns epoc:</p>
<pre><code class="lang-auto">parse_debian changelog --package-version-epoc debian/changelog</code></pre>
<p>Returns version without epoc</p>
<pre><code class="lang-auto">parse_debian changelog --package-version debian/changelog</code></pre>
<p>Returns version including epoc</p>
<pre><code class="lang-auto">parse_debian changelog --package-version-full debian/changelog</code></pre>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/27">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/27</link>
        <pubDate>Mon, 05 Jan 2015 22:30:17 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-27</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:25, topic:764”]qubes-whonix-preinst - I don’t think this one is necessary. Any folders required are created during install so or so.</p>
<pre><code class="lang-auto"></code></pre>
<p>[hr]</p>
<p>There are more matches of “qubes-whonixcheck”.</p>
<p>[hr]</p>
<p>Not that important:<br>
but usually it’s not two new lines at the end, just one.[/quote]</p>
<p>Think I took care of this</p>
<p>[quote=“Patrick, post:24, topic:764”]Why is this needed?</p>
<pre><code class="lang-auto"></code></pre>
<p>It’s needed for the Qubes builder.  Qubes builds a bit differently than you do <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<blockquote>Looks like it's getting quite a lot comments. Perhaps it would have been better if I created tickets for each of them to not forget about any?</blockquote>
<p>I have been going though them one by one.   Think I have them all handled at this point.</p>
<p>[quote=“Patrick, post:17, topic:764”]Can you change the location from <a href="https://github.com/nrgaway/qubes-whonix" rel="nofollow noopener">https://github.com/nrgaway/qubes-whonix</a> to <a href="https://github.com/nrgaway/whonix-qubes" rel="nofollow noopener">https://github.com/nrgaway/whonix-qubes</a> please?</p>
<p>Because the package is called whonix-qubes as well and the name of the folder is used in scripts as package name. Would really simplify things. That might have been the issue with make-helper.bsh also.[/quote]</p>
<p>I see you posted this one after (although it is showing before) I renamed the whole package to qubes-whonix so I figure this is not required anymore.  It is pointing to Whonix repo though.</p>
<p>Everything seems to be building correctly now since I wrote those new Debian parsers.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/26">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/26</link>
        <pubDate>Mon, 05 Jan 2015 22:18:04 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-26</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>qubes-whonix-preinst - I don’t think this one is necessary. Any folders required are created during install so or so.</p>
<pre><code class="lang-auto"></code></pre>
<p>[hr]</p>
<p>There are more matches of “qubes-whonixcheck”.</p>
<p>[hr]</p>
<p>Not that important:<br>
but usually it’s not two new lines at the end, just one.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/25">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/25</link>
        <pubDate>Mon, 05 Jan 2015 15:11:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-25</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Why is this needed?</p>
<pre><code class="lang-auto"></code></pre>
<p>[hr]</p>
<p>Looks like it’s getting quite a lot comments. Perhaps it would have been better if I created tickets for each of them to not forget about any?</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/24">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/24</link>
        <pubDate>Mon, 05 Jan 2015 13:45:09 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-24</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="20" data-topic="764">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/user_avatar/forums.whonix.org/patrick/40/17_1.png" class="avatar"> Patrick:</div>
<blockquote>
<p><a href="https://unix.stackexchange.com/questions/177505/how-to-install-parse-build-dependencies-from-debian-control">https://unix.stackexchange.com/questions/177505/how-to-install-parse-build-dependencies-from-debian-control</a></p>
</blockquote>
</aside>
<p>A helpful answer.</p>
<pre><code class="lang-auto"></code></pre>
<pre><code class="lang-auto"></code></pre>
<p>Parsing that should make things a bit easier at least than doing the whole debian/control parsing?</p>
<p>Shows only missing build dependencies. Not already installed ones. Otherwise outputs nothing. But that is actually an advantage for this use case, no?</p>
<p>By asking on some debian mailing list, we could likely learn about even more suitable tools.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/23">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/23</link>
        <pubDate>Mon, 05 Jan 2015 13:14:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-23</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Same for this.</p>
<pre><code class="lang-auto"></code></pre>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/22">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/22</link>
        <pubDate>Mon, 05 Jan 2015 13:08:53 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-22</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Looks like a mistake.</p>
<pre><code class="lang-auto"></code></pre>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/21">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/21</link>
        <pubDate>Mon, 05 Jan 2015 11:27:45 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-21</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>How to install / parse build dependencies from debian/control?:<br>
</p><aside class="onebox stackexchange">
  <header class="source">
      <a href="https://unix.stackexchange.com/questions/177505/how-to-install-parse-build-dependencies-from-debian-control" target="_blank">unix.stackexchange.com</a>
  </header>
  <article class="onebox-body">
      <a href="https://unix.stackexchange.com/users/49297/adrelanos" target="_blank">
    <img alt="adrelanos" src="https://www.gravatar.com/avatar/83f6805262f0dcc117814487c5b2d1c4?s=128&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="128" height="128">
  </a>
<h4>
  <a href="https://unix.stackexchange.com/questions/177505/how-to-install-parse-build-dependencies-from-debian-control" target="_blank">How to install / parse build dependencies from debian/control?</a>
</h4>

<div class="tags">
  <strong>debian, command-line, package-management, packaging</strong>
</div>

<div class="date">
  asked by
  
  <a href="https://unix.stackexchange.com/users/49297/adrelanos" target="_blank">
    adrelanos
  </a>
  on <a href="https://unix.stackexchange.com/questions/177505/how-to-install-parse-build-dependencies-from-debian-control" target="_blank">10:10AM - 05 Jan 15 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>I’d ask some more Debian devs for existing tools. Probably we’re not the first ones ever on the internet that need this, no?</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/20">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/20</link>
        <pubDate>Mon, 05 Jan 2015 10:11:15 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-20</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>There is dpkg-parsechangelog. See also:<br>
</p><aside class="onebox stackexchange">
  <header class="source">
      <a href="https://askubuntu.com/questions/332771/how-do-i-extract-the-package-version-from-debian-changelog/423534#423534" target="_blank">askubuntu.com</a>
  </header>
  <article class="onebox-body">
      <a href="https://askubuntu.com/users/92147/martin-geisler" target="_blank">
    <img alt="Martin Geisler" src="https://www.gravatar.com/avatar/6bf0300fc4a5c9012fd254d3da2a6e69?s=128&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="128" height="128">
  </a>
<h4>
  <a href="https://askubuntu.com/questions/332771/how-do-i-extract-the-package-version-from-debian-changelog/423534#423534" target="_blank">How do I extract the package version from debian/changelog?</a>
</h4>

<div class="tags">
  <strong>packaging, deb, source-packages</strong>
</div>

<div class="date">
  
  answered by
  <a href="https://askubuntu.com/users/92147/martin-geisler" target="_blank">
    Martin Geisler
  </a>
  on <a href="https://askubuntu.com/questions/332771/how-do-i-extract-the-package-version-from-debian-changelog/423534#423534" target="_blank">08:07AM - 20 Feb 14 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
I think once based on jessie, it will be improved.<p></p>
<p>It’s used by make-helper.bsh also.</p>
<p>make-helper.bsh can also be <code>source</code>d, it will do nothing then, but when you run make_get_variables it will set all the version numbers to variables it has parsed from debian/changelog.</p>
<p>Debian must have existing code to parse debian/control, no? Otherwise how is stuff like “apt-get build-dep” working?</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/19">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/19</link>
        <pubDate>Mon, 05 Jan 2015 10:04:23 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-19</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for all the infos.  I am too tired to go though it all today but I will get to it in the next few days.</p>
<p>I implemented many of your suggestions already including moving away from the /usr/lib/whonix directory.  Qubes also has there own so I just picked a new one, based on how my systems unit files were named; /usr/lib/qubes-whonix. I changed the package name to match.</p>
<p>That Makefile scripts that installs dependencies won’t work when the depends span multiple lines.  I am kind of surprised how lacking good tools are for Debian.  I would have expected some easy to use command like Redhat has.  Anyway, today I threw together a short python script that should handle multiple lines.  I designed it so it will be able to parse pretty much anything from the control file.  I also need something to read changelog for proper version detection since the EPOC was messing up Qubes builder.  Hopefully that is sorted for now.</p>
<p><a href="https://github.com/nrgaway/qubes-whonix" data-bbcode="true" rel="nofollow noopener">https://github.com/nrgaway/qubes-whonix</a>.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/18">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/18</link>
        <pubDate>Mon, 05 Jan 2015 05:36:10 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-18</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Can you change the location from <a href="https://github.com/nrgaway/qubes-whonix">https://github.com/nrgaway/qubes-whonix</a> to <a href="https://github.com/nrgaway/whonix-qubes">https://github.com/nrgaway/whonix-qubes</a> please?</p>
<p>Because the package is called whonix-qubes as well and the name of the folder is used in scripts as package name. Would really simplify things. That might have been the issue with make-helper.bsh also.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/17">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/17</link>
        <pubDate>Sun, 04 Jan 2015 17:50:49 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-17</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[nrgaway]]></dc:creator>
        <description><![CDATA[
            <p>[quote=“Patrick, post:10, topic:764”]Still reviewing… Still looking at the easy stuff.</p>
<p>[hr]</p>
<pre><code class="lang-auto">dist-build-dep::
	@sudo apt-get update
	@grep Build-Depends: debian/control | cut -d: -f 2- |\
	    sed -e 's/ *, */\n/g'| cut -d'(' -f 1 |tr -d " " |\
	    xargs sudo apt-get install -y</code></pre>
<p>This is a great addition. I would like to add this the generic “master” make file:<br>
</p><aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/blob/master/Makefile" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/Whonix/blob/master/Makefile" target="_blank" rel="nofollow noopener">Whonix/Whonix/blob/master/Makefile</a></h4>
<pre><code class="lang-">#!/usr/bin/make -f

## Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

## genmkfile - Makefile - version 1.7

## This is a copy.
## master location:
## https://github.com/Whonix/genmkfile/blob/master/usr/share/genmkfile/Makefile

.PHONY: about

GENMKFILE_NAME ?= makefile-full
GENMKFILE_BOOTSTRAP_ONE ?= ./packages/genmkfile/usr/share/genmkfile
GENMKFILE_BOOTSTRAP_TWO ?= ./usr/share/genmkfile
GENMKFILE_ROOT_DIR := $(dir $(abspath $(lastword $(MAKEFILE_LIST))))
GENMKFILE_CURRENT := $(CURDIR)/$(word $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST))

ifndef GENMKFILE_INCLUDE_FILE_MAIN
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/Whonix/blob/master/Makefile" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>But with a small change. If one were to do this for all packages, it would be a waste always running “sudo apt-get update”.</p>
<p>Could you split this into two commands please? One that automatically runs “sudo apt-get update” and one that only apt-get installs?</p>
<p>Also slightly different names would be good if possible. Since it’s debian specific, “deb-pkg-update-build-dep”  and “deb-pkg-build-dep” or so would be good names?[/quote]</p>
<p>Yes I can do both</p>
<blockquote>Did you modify make-helper.bsh? If not, can you update to https://github.com/nrgaway/whonix-qubes/blob/master/make-helper.bsh please?</blockquote>
<p>I have been unable to get the newer make-helper.bsh play nice with Qubes builder.  I am looking into it more now.  I actually had to use the older script and remove epoch from changelog to get whonix-setup-wizard to build with qubes-builder (5 minutes ago I got it building at least).  I am limited to what Qubes currently supports.  Also Qubes does not support quilt format at the time, but I was able to get it to build anyway.</p>
<p>I will figure it out but I need to make sure I can build with both systems.</p>
<blockquote>debian/control... This description would look a bit more consistent and nicer.
<p><code>
Description: Qubes Configuration for Whonix-Gateway and Whonix-Workstation
 This package contains all the scripts and configuration options to be able
 to run Whonix-Gateway and Whonix-Workstation within a Qubes environment.
 .
 Whonix-Gateway should run as a ProxyVM.
 .
 Whonix-Workstation should run as an AppVM.
 .
 Template updates over Tor.
</code></p>
</blockquote>
<p>Hehe.  Yes it would.  I lack in being descriptive <img src="//forums.whonix.org/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:">  Will change that too!</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/16">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/16</link>
        <pubDate>Sun, 04 Jan 2015 01:25:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-16</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>The whonix-qubes packages uses a few [font=courier]Recommends:[/font]:<br>
</p><aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/nrgaway/qubes-whonix/blob/master/debian/control#L22" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/nrgaway/qubes-whonix/blob/master/debian/control#L22" target="_blank">nrgaway/qubes-whonix/blob/master/debian/control#L22</a></h4>
<pre class="onebox"><code class="lang-"><ol class="start lines" start="12" style="counter-reset: li-counter 11 ;">
<li>Maintainer: Jason Mehring &lt;nrgaway@gmail.com&gt;</li>
<li>Uploaders: Patrick Schleizer &lt;adrelanos@riseup.net&gt;</li>
<li>Build-Depends: debhelper (&gt;= 9), faketime, genmkfile, python, dh-systemd (&gt;= 1.5)</li>
<li>Homepage: https://github.com/Whonix/qubes-whonix</li>
<li>Vcs-Browser: https://github.com/Whonix/qubes-whonix</li>
<li>Vcs-Git: https://github.com/Whonix/qubes-whonix.git</li>
<li>Standards-Version: 3.9.6</li>
<li>
</li><li>Package: qubes-whonix</li>
<li>Architecture: all</li>
<li class="selected">Depends: qubes-core-agent (&gt;= 2.1.60), python-guimessages, whonix-setup-wizard, ethtool, initscripts, iptables, lintian, locales, net-tools, notify-osd, python, sudo, systemd, xen-utils-common, xinit, xsettingsd, xdg-user-dirs, ${misc:Depends}</li>
<li>Recommends: nautilus-open-terminal, gnome-packagekit, gnome-terminal, network-manager (&gt;= 0.8.1-1), network-manager-gnome</li>
<li>Description: Qubes Configuration for Whonix-Gateway and Whonix-Workstation</li>
<li> This package contains all the scripts and configuration options to be able</li>
<li> to run Whonix-Gateway and Whonix-Workstation within a Qubes environment.</li>
<li> .</li>
<li> Whonix-Gateway should run as a ProxyVM.</li>
<li> .</li>
<li> Whonix-Workstation should run as an AppVM.</li>
<li> .</li>
<li> Template updates over Tor.</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>This is fine. Other packages by the Whonix project do this as well. But… You you need to know it has little effect.</p>
<p>Whonix’s build script installs all packages using “apt-get --no-install-recommends”. Reasons for that are a bit weird and difficult, but explained here:<br>
</p><aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/w/images/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Whonix_Debian_Packages#Technical_Stuff" target="_blank" title="10:26PM - 23 November 2019">Whonix – 23 Nov 19</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:614/500;"><img src="https://www.whonix.org/w/images/a/aa/Box-158523640.png" class="thumbnail" width="614" height="500"></div>

<h3><a href="https://www.whonix.org/wiki/Whonix_Debian_Packages#Technical_Stuff" target="_blank">Whonix Debian Packages - Whonix</a></h3>

<p>Which Whonix ™ Debian packages are safe to remove? What is a meta package? What other packages do Whonix ™ meta packages install? Which packages should never be removed? Why is package X installed?</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>So care to you get the [font=courier]Recommends:[/font] installed by default and plan to install the whonix-qubes package as part of [font=arial]build-steps.d/1700_install-packages[/font] or some <a href="https://github.com/Whonix/anon-meta-packages/" data-bbcode="true">anon-meta-package</a>, then recommends would not be installed by default. We’d have to think of something. If you install it as part of the Qubes build process somehow without using --no-install-recommends then there will be no problem.</p>
<p>It’s just something to be aware of.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/15">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/15</link>
        <pubDate>Sat, 03 Jan 2015 23:32:43 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-15</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Instead of dynamically patching /usr/lib/anon-shared-helper-scripts/tor_bootstrap_check.bsh, what do you think about implementing some if/then magic into /usr/lib/anon-shared-helper-scripts/tor_bootstrap_check.bsh?</p>
<p>[hr]</p>
<p>Please add the <a href="https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md">https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md</a> file to the source root folder unless there are objections.</p>
<p>[hr]</p>
<p>typos:</p>
<ul>
<li>annondist -&gt; anondist</li>
<li>accesss -&gt; access</li>
</ul>
<p>[hr]</p>
<pre><code class="lang-auto"></code></pre>
<p>I would be happy if we could add some suitable hook mechanism to whonix_firewall or add some if/then code to whonix_firewall to simplify that code. Sed injection doesn’t look future proof.</p>
<p>[hr]</p>
<p>Generally all the scripts could use some “set -e” or “trap -E error_handler ERR”. You don’t necessarily have to break execution on ERR, but at least a textual notification for unexpected non-zero exit codes would be useful.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/14">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/14</link>
        <pubDate>Sat, 03 Jan 2015 22:06:50 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-14</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This is unnecessary:</p>
<pre><code class="lang-auto"></code></pre>
<p>Shipping a file</p>
<pre><code class="lang-auto"></code></pre>
<p>or so could be a better way.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/13">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/13</link>
        <pubDate>Sat, 03 Jan 2015 21:48:56 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-13</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>In debian/whonix-qubes.triggers you are writing twice.</p>
<pre><code class="lang-auto"></code></pre>
<p>Dunno if that could lead to issues. Unless it’s auto generated or some other reasons, I’d rather advice to play safe and remove one.</p>
<p>[hr]</p>
<p>I’ve never used triggers, but it’s most interesting. I see a potential issue here.</p>
<pre><code class="lang-auto"># Reset back to Whonix defaults
interest-noawait /etc/resolv.conf
interest-noawait /etc/hosts
interest-noawait /etc/hostname</code></pre>
<p>I think you might want to use /etc/resolv.conf.anondist instead. Because the file known to dpkg is<br>
</p><aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/anon-gw-dns-conf/blob/master/etc/resolv.conf.anondist" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/anon-gw-dns-conf/blob/master/etc/resolv.conf.anondist" target="_blank" rel="nofollow noopener">Whonix/anon-gw-dns-conf/blob/master/etc/resolv.conf.anondist</a></h4>
<pre><code class="lang-anondist">## Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

## /etc/dhcp/dhclient-enter-hooks.d/nodnsupdate (package anon-gw-dhcp-conf) can
## prevent this file from getting overwritten by DHCP.
## If you want to disable that, run.
## sudo apt-get purge anon-gateway-dhcp-conf

## Torified DNS server for Gateway's own traffic.
nameserver 127.0.0.1

## Advanced users only!
## Only if you know what you are doing!
## If you do *not* want Gateway's own DNS
## (This has nothing to do with Workstation's DNS.)
## to be routed through Tor, but using clearnet DNS,
## use the VirtualBox DHCP server below
## and comment out the torified DNS server above.
#nameserver 10.0.2.3
</code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
(or <a href="https://github.com/Whonix/anon-ws-dns-conf/blob/master/etc/resolv.conf.anondist">https://github.com/Whonix/anon-ws-dns-conf/blob/master/etc/resolv.conf.anondist</a>).<br>
Moving /etc/resolv.conf out of the way and the symlink magic is done by config-package-dev. And I suppose that dpkg uses triggers on files it knows to manage. Probably not on dpkg-diverted files. But I might be wrong about this. I advice to actually test this if you want to make sure this really works.<p></p>
<p>Similarly, you might wish to use:</p>
<ul>
<li>/etc/hosts.anondist and</li>
<li>/etc/hostname.anondist<br>
for the same reasoning.</li>
</ul>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/12">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/12</link>
        <pubDate>Sat, 03 Jan 2015 21:46:16 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-12</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>most likely you already know this… For changing the paths, I am using a mass search and replace editor such as jedit. Allows changing everything at once without manually forgetting about something.</p>
<p>[hr]</p>
<p>You probably already know this as well. In debian/whonix-qubes.preinst this should not be required for the same reason as setPermissions is not required. Just noting so it will not be forgotten.</p>
<pre><code class="lang-auto">    # --------------------------------------------------------------------------
    # Create required directories
    # --------------------------------------------------------------------------
    mkdir -p /var/lib/whonix/init
    chown -R root:root /usr/lib/whonix
    chmod -R u+rwX,go+rX /usr/lib/whonix</code></pre>
<p>[hr]</p>
<p>Why ship</p>
<ul>
<li>
<a href="https://github.com/nrgaway/whonix-qubes/blob/master/etc/hostname">https://github.com/nrgaway/whonix-qubes/blob/master/etc/hostname</a> and</li>
<li>
<a href="https://github.com/nrgaway/whonix-qubes/blob/master/etc/hosts">https://github.com/nrgaway/whonix-qubes/blob/master/etc/hosts</a><br>
?</li>
</ul>
<p>I think those are likely to conflict with anon-base-files (<a href="https://github.com/Whonix/anon-base-files">https://github.com/Whonix/anon-base-files</a>), with</p>
<ul>
<li>
<a href="https://github.com/Whonix/anon-base-files/blob/master/etc/hostname.anondist">https://github.com/Whonix/anon-base-files/blob/master/etc/hostname.anondist</a> and</li>
<li>
<a href="https://github.com/Whonix/anon-base-files/blob/master/etc/hosts.anondist">https://github.com/Whonix/anon-base-files/blob/master/etc/hosts.anondist</a><br>
.</li>
</ul>
<p>Can you remove those from whonix-qubes package or are they required for something? I think at the moment those files are not in use anyhow. Due to anon-base-files use of config-package-dev and .anondist extension, those will take precedence.</p>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/11">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/11</link>
        <pubDate>Sat, 03 Jan 2015 21:34:30 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-11</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
      <item>
        <title>Qubes-whonix Debian package</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Still reviewing… Still looking at the easy stuff.</p>
<p>[hr]</p>
<pre><code class="lang-auto">dist-build-dep::
	@sudo apt-get update
	@grep Build-Depends: debian/control | cut -d: -f 2- |\
	    sed -e 's/ *, */\n/g'| cut -d'(' -f 1 |tr -d " " |\
	    xargs sudo apt-get install -y</code></pre>
<p>This is a great addition. I would like to add this the generic “master” make file:<br>
</p><aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Whonix/Whonix/blob/master/Makefile" target="_blank" rel="nofollow noopener">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Whonix/Whonix/blob/master/Makefile" target="_blank" rel="nofollow noopener">Whonix/Whonix/blob/master/Makefile</a></h4>
<pre><code class="lang-">#!/usr/bin/make -f

## Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;
## See the file COPYING for copying conditions.

## genmkfile - Makefile - version 1.7

## This is a copy.
## master location:
## https://github.com/Whonix/genmkfile/blob/master/usr/share/genmkfile/Makefile

.PHONY: about

GENMKFILE_NAME ?= makefile-full
GENMKFILE_BOOTSTRAP_ONE ?= ./packages/genmkfile/usr/share/genmkfile
GENMKFILE_BOOTSTRAP_TWO ?= ./usr/share/genmkfile
GENMKFILE_ROOT_DIR := $(dir $(abspath $(lastword $(MAKEFILE_LIST))))
GENMKFILE_CURRENT := $(CURDIR)/$(word $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST))

ifndef GENMKFILE_INCLUDE_FILE_MAIN
</code></pre>

  This file has been truncated. <a href="https://github.com/Whonix/Whonix/blob/master/Makefile" target="_blank" rel="nofollow noopener">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>But with a small change. If one were to do this for all packages, it would be a waste always running “sudo apt-get update”.</p>
<p>Could you split this into two commands please? One that automatically runs “sudo apt-get update” and one that only apt-get installs?</p>
<p>Also slightly different names would be good if possible. Since it’s debian specific, “deb-pkg-update-build-dep”  and “deb-pkg-build-dep” or so would be good names?</p>
<p>[hr]</p>
<p>Did you modify make-helper.bsh? If not, can you update to <a href="https://github.com/nrgaway/whonix-qubes/blob/master/make-helper.bsh">https://github.com/nrgaway/whonix-qubes/blob/master/make-helper.bsh</a> please?</p>
<p>[hr]</p>
<p>debian/control… This description would look a bit more consistent and nicer.</p>
<pre><code class="lang-auto">Description: Qubes Configuration for Whonix-Gateway and Whonix-Workstation
 This package contains all the scripts and configuration options to be able
 to run Whonix-Gateway and Whonix-Workstation within a Qubes environment.
 .
 Whonix-Gateway should run as a ProxyVM.
 .
 Whonix-Workstation should run as an AppVM.
 .
 Template updates over Tor.</code></pre>
          <p><a href="http://forums.whonix.org/t/qubes-whonix-debian-package/764/10">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/qubes-whonix-debian-package/764/10</link>
        <pubDate>Sat, 03 Jan 2015 21:18:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-764-10</guid>
        <source url="http://forums.whonix.org/t/qubes-whonix-debian-package/764.rss">Qubes-whonix Debian package</source>
      </item>
  </channel>
</rss>
