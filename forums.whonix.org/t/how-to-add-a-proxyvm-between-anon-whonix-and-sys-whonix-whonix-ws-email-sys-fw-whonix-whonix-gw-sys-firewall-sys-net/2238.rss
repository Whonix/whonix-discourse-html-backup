<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</title>
    <link>http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238</link>
    <description>Is it possible to add a FirewallVM between a Whonix-Workstation and a Whonix-Gateway, so that only certain types of traffic are allowed (just like with a regular, clearnet VM)? For example:

`whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net`

Then set up firewall rules allowing only pop3s traffic to `whonix-ws-email`. The result should be that `whonix-ws-email` can only download mail over pop3s; no other traffic gets through.

I tried testing this but couldn&#39;t get it to work. Either all traffic gets through, or nothing gets through.

---------------------------------------------------------------------

Related point:

Changing the NetVM of a TemplateVM from sys-firewall (clearnet) to a Whonix-Gateway means that traffic is no longer restricted to the Updates Proxy. *All* traffic is allowed. This seems kind of dangerous, but the benefit of Torified updates probably outweighs this drawback for (careful) users. IIRC, this is a known issue.</description>
    <language>en</language>
    <lastBuildDate>Wed, 16 Mar 2016 15:03:48 +0000</lastBuildDate>
    <category>Qubes-Whonix</category>
    <atom:link href="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</title>
        <dc:creator><![CDATA[axon]]></dc:creator>
        <description><![CDATA[
            <p>Very informative; thank you!</p>
          <p><a href="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/4">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/4</link>
        <pubDate>Wed, 16 Mar 2016 15:03:48 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2238-4</guid>
        <source url="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238.rss">How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</source>
      </item>
      <item>
        <title>How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This is an interesting question. I guess it could lead to more stuff and analysis than I can foresee.</p>
<aside class="quote" data-post="1" data-topic="2238">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/a/977dab/40.png" class="avatar"> axon:</div>
<blockquote>
<p>Is it possible to add a FirewallVM between a Whonix-Workstation and a Whonix-Gateway, so that only certain types of traffic are allowed (just like with a regular, clearnet VM)? For example:</p>
<p>whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net</p>
</blockquote>
</aside>
<p>Possible in theory but undocumented and not researched.</p>
<p>Stream isolation might get into the way depending on which application you tried to use. Background information on stream isolation:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Stream_Isolation" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:386/500;"><img src="https://www.whonix.org/w/images/e/eb/Streamisolationme.jpg" class="thumbnail"></div>

<h3><a href="https://www.whonix.org/wiki/Stream_Isolation" target="_blank" rel="nofollow noopener">Stream Isolation</a></h3>

<p>Prevent Identity Correlation through Circuit Sharing by using Tor Stream Isolation</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Applications inside whonix-ws AppVMs either A) directly connect to the local network where a SocksPort where Tor is listening or B) use the operating system’s default networking. This is also called transparent proxying.</p>
<p>A) complicates things for this kind of advanced endeavors. I would advice to disable stream isolation (for the applications that you may be using that may be pre-configured) during development of this. Then later when it works figuring out if stream isolation can be re-enabled. For instructions on stream isolation deactivation, see:</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.whonix.org/favicon.ico" class="site-icon" width="16" height="16">
      <a href="https://www.whonix.org/wiki/Stream_Isolation/Disable_Easy" target="_blank" rel="nofollow noopener">Whonix</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/362;"><img src="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" class="thumbnail"></div>

<h3><a href="https://www.whonix.org/wiki/Stream_Isolation/Disable_Easy" target="_blank" rel="nofollow noopener">Stream Isolation/Disable Easy</a></h3>

<p>How to disable stream isolation. Most easy and common methods only.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>B) is easier. <code>sys-fw-whonix</code> would, as I imagine, be a Qubes ProxyVM. Use IP forwarding. (Unless you figure out some solution that does not require it. But maybe not important.) Accept the traffic, filter it with iptables, then forward it to <code>sys-whonix</code>. Probably in the first iteration just using transparent proxying.</p>
<p>As an pre-exercise it may be useful to to remove Whonix from the equation. Have some AppVM that connects to some ProxyVM that does some filtering and then forwards to sys-net. Re-applying this setup to Whonix than may be simpler because by then you would have figured out all the non-Whonix stumbling points.</p>
          <p><a href="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/3">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/3</link>
        <pubDate>Wed, 16 Mar 2016 14:55:30 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2238-3</guid>
        <source url="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238.rss">How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</source>
      </item>
      <item>
        <title>How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote" data-post="1" data-topic="2238">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="//forums.whonix.org/letter_avatar_proxy/v2/letter/a/977dab/40.png" class="avatar"> axon:</div>
<blockquote>
<p>Related point:</p>
<p>Changing the NetVM of a TemplateVM from sys-firewall (clearnet) to a Whonix-Gateway means that traffic is no longer restricted to the Updates Proxy. All traffic is allowed. This seems kind of dangerous, but the benefit of Torified updates probably outweighs this drawback for (careful) users. IIRC, this is a known issue.</p>
</blockquote>
</aside>
<p>Moved here:<br>
<a href="https://forums.whonix.org/t/sys-whonix-does-not-yet-function-was-qubes-firewallvm/2239">sys-whonix does not yet function was Qubes FirewallVM</a></p>
          <p><a href="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/2">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/2</link>
        <pubDate>Wed, 16 Mar 2016 14:27:15 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2238-2</guid>
        <source url="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238.rss">How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</source>
      </item>
      <item>
        <title>How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</title>
        <dc:creator><![CDATA[axon]]></dc:creator>
        <description><![CDATA[
            <p>Is it possible to add a FirewallVM between a Whonix-Workstation and a Whonix-Gateway, so that only certain types of traffic are allowed (just like with a regular, clearnet VM)? For example:</p>
<p><code>whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net</code></p>
<p>Then set up firewall rules allowing only pop3s traffic to <code>whonix-ws-email</code>. The result should be that <code>whonix-ws-email</code> can only download mail over pop3s; no other traffic gets through.</p>
<p>I tried testing this but couldn’t get it to work. Either all traffic gets through, or nothing gets through.</p>
<hr>
<p>Related point:</p>
<p>Changing the NetVM of a TemplateVM from sys-firewall (clearnet) to a Whonix-Gateway means that traffic is no longer restricted to the Updates Proxy. <em>All</em> traffic is allowed. This seems kind of dangerous, but the benefit of Torified updates probably outweighs this drawback for (careful) users. IIRC, this is a known issue.</p>
          <p><a href="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/1">Read full topic</a></p>
        ]]></description>
        <link>http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238/1</link>
        <pubDate>Wed, 16 Mar 2016 12:05:13 +0000</pubDate>
        <guid isPermaLink="false">forums.whonix.org-post-2238-1</guid>
        <source url="http://forums.whonix.org/t/how-to-add-a-proxyvm-between-anon-whonix-and-sys-whonix-whonix-ws-email-sys-fw-whonix-whonix-gw-sys-firewall-sys-net/2238.rss">How to add a ProxyVM between anon-whonix and sys-whonix? (whonix-ws-email -&gt; sys-fw-whonix -&gt; whonix-gw -&gt; sys-firewall -&gt; sys-net)</source>
      </item>
  </channel>
</rss>
